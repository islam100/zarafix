<!DOCTYPE html>
<html>
<head>
  <title>üîß ZaraFix - Service Requests</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: sans-serif;
      background: #f0f0f0;
      margin: 0;
      padding: 20px;
    }

    .card {
      background: white;
      border-radius: 10px;
      box-shadow: 2px 2px 5px #ccc;
      margin: 10px 0;
      padding: 10px;
      position: relative;
      transition: box-shadow 0.3s;
    }

    .card.blink-approved {
      animation: blinkBorder 1s infinite;
    }

    @keyframes blinkBorder {
      0% { box-shadow: 0 0 5px 3px yellow; }
      50% { box-shadow: 0 0 10px 5px transparent; }
      100% { box-shadow: 0 0 5px 3px yellow; }
    }

    .card h3 {
      margin: 0 0 5px;
    }

    .btn-3d {
      background: #4CAF50;
      border: none;
      color: white;
      padding: 10px 20px;
      margin-top: 10px;
      text-align: center;
      font-weight: bold;
      border-radius: 10px;
      box-shadow: 0 5px #2d6a34;
      cursor: pointer;
      transition: 0.2s;
    }

    .btn-3d:active {
      box-shadow: 0 2px #2d6a34;
      transform: translateY(3px);
    }

    @media (max-width: 600px) {
      .card {
        font-size: 14px;
        padding: 8px;
      }

      .btn-3d {
        padding: 8px 15px;
      }
    }
  </style>
</head>
<body>

  <div id="requestContainer"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, get, update } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCH17_8W_UPmPt4KqpCaV7BpN6KsA4a67E",
      authDomain: "zara-fix.firebaseapp.com",
      databaseURL: "https://zara-fix-default-rtdb.firebaseio.com",
      projectId: "zara-fix",
      storageBucket: "zara-fix.appspot.com",
      messagingSenderId: "925235258156",
      appId: "1:925235258156:web:f118ac390d6a30e78c8183"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const requestContainer = document.getElementById("requestContainer");

    const posterUid = "wjbEIAEF5jWgJKb2LlfWoIv4EqO2"; // Current poster UID

    const requestsRef = ref(db, "requests");
    const postersRef = ref(db, "posters/" + posterUid);
    const rechargeRef = ref(db, "recharge/" + posterUid);

    const posterSnap = await get(postersRef);
    const poster = posterSnap.exists() ? posterSnap.val() : {};

    const rechargeSnap = await get(rechargeRef);
    const rechargeApproved = rechargeSnap.exists() && rechargeSnap.val().status === "approved";

    const snapshot = await get(requestsRef);
    if (snapshot.exists()) {
      const data = snapshot.val();
      Object.keys(data).forEach(userId => {
        Object.keys(data[userId]).forEach(requestId => {
          const req = data[userId][requestId];
          const acceptedBy = req.acceptedBy || {};
          if (acceptedBy[posterUid]) {
            const card = document.createElement("div");
            card.className = "card";
            if (rechargeApproved) {
              card.classList.add("blink-approved");
            }

            card.innerHTML = `
              <h3>‡§®‡§æ‡§Æ: ${req.name}</h3>
              <p>‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ: ${req.problem}</p>
              <p>‡§∂‡•ç‡§∞‡•á‡§£‡•Ä: ${req.category}</p>
              <p>‡§™‡§§‡§æ: ${req.address}</p>
              <p>‡§¶‡•Å‡§ï‡§æ‡§®: ${poster.shop || 'N/A'}</p>
              <p>WhatsApp: ${req.whatsapp}</p>
              <button class="btn-3d" onclick="window.location.href='https://wa.me/${req.whatsapp}'">WhatsApp</button>
            `;

            requestContainer.appendChild(card);
          }
        });
      });
    } else {
      requestContainer.innerHTML = "<p>‡§ï‡•ã‡§à ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ‡•§</p>";
    }
  </script>

</body>
</html>
