<!DOCTYPE html>
<html>
<head>
  <title>Worker Cards</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: sans-serif; background: #f0f0f0; padding: 20px; }
    .card {
      background: white;
      padding: 15px;
      margin-bottom: 15px;
      border-left: 6px solid green;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      max-width: 300px;
    }
    .approved {
      animation: blink 1s infinite;
      border-color: gold;
    }
    @keyframes blink {
      50% { border-color: yellow; }
    }
    button {
      padding: 6px 12px;
      border: none;
      background: green;
      color: white;
      border-radius: 4px;
      cursor: pointer;
      margin-right: 8px;
    }
  </style>
</head>
<body>

<div id="cardContainer"></div>

<!-- Firebase CDN -->
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCH17_8W_UPmPt4KqpCaV7BpN6KsA4a67E",
    authDomain: "zara-fix.firebaseapp.com",
    databaseURL: "https://zara-fix-default-rtdb.firebaseio.com",
    projectId: "zara-fix",
    storageBucket: "zara-fix.appspot.com",
    messagingSenderId: "305380405847",
    appId: "1:305380405847:web:b50ea5ad3e2dc7e1dc65f5"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const cardContainer = document.getElementById('cardContainer');

  function renderCard(uid, worker) {
    const card = document.createElement('div');
    card.className = 'card';
    if (worker.status === 'approved') card.classList.add('approved');

    const walletAmount = worker.wallet || 0;

    card.innerHTML = `
      <div>ğŸ§‘â€ğŸ”§ <strong>${worker.name}</strong></div>
      <div>ğŸª Shop: ${worker.shop || 'N/A'}</div>
      <div>ğŸ”§ Category: ${worker.category || 'N/A'}</div>
      <div>ğŸ“ Address: ${worker.address || 'N/A'}</div>
      <div>ğŸ“± Contact: ${worker.contact || 'N/A'}</div>
      <div>ğŸ’¼ Status: ${worker.status || 'N/A'}</div>
      <div>ğŸ’° Wallet: â‚¹<span id="wallet-${uid}">${walletAmount}</span></div>
      <br>
      ${worker.status === 'approved' ? `
        <button onclick="recharge('${uid}')">Recharge â‚¹100</button>
        <a href="https://wa.me/${worker.contact}" target="_blank">
          <button style="background: #25D366;">WhatsApp</button>
        </a>
      ` : ''}
    `;
    cardContainer.appendChild(card);
  }

  function recharge(uid) {
    const walletSpan = document.getElementById('wallet-' + uid);
    const current = parseInt(walletSpan.innerText);
    const updated = current + 100;

    db.ref('requests/' + uid).update({ wallet: updated }).then(() => {
      walletSpan.innerText = updated;
      alert("Recharge successful!");
    }).catch(err => {
      alert("Recharge failed: " + err.message);
    });
  }

  db.ref('requests').once('value').then(snapshot => {
    cardContainer.innerHTML = '';
    snapshot.forEach(child => {
      renderCard(child.key, child.val());
    });
  });
</script>

</body>
</html>
