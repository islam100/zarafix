<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Dashboard</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f1f1f1;
      margin: 0;
      padding: 1rem;
    }

    h2 {
      margin-top: 2rem;
      font-size: 1.4rem;
    }

    button {
      padding: 0.5rem 1rem;
      margin: 0.2rem;
      border: none;
      background: #007BFF;
      color: white;
      border-radius: 8px;
      box-shadow: 0 4px #0056b3;
      cursor: pointer;
      font-weight: bold;
    }

    button:active {
      box-shadow: 0 2px #0056b3;
      transform: translateY(2px);
    }

    .card {
      background: white;
      padding: 1rem;
      margin: 1rem 0;
      border-radius: 16px;
      box-shadow: 2px 4px 10px rgba(0,0,0,0.1);
    }

    .led {
      width: 14px;
      height: 14px;
      border-radius: 50%;
      display: inline-block;
      margin-left: 8px;
    }

    .led.green {
      background-color: green;
    }

    .led.red {
      background-color: red;
      animation: blink 1s infinite;
    }

    @keyframes blink {
      50% { opacity: 0; }
    }

    .btn-group {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-top: 0.5rem;
    }

    @media screen and (max-width: 600px) {
      .card { font-size: 0.9rem; }
      button { padding: 0.4rem 0.7rem; font-size: 0.85rem; }
    }
  </style>
</head>
<body>

  <h1>👨‍💼 Admin Dashboard</h1>

  <div class="btn-group">
    <button onclick="loadPosterUsers()">📢 Load Poster Users</button>
    <button onclick="loadProviders()">🛠️ Load Providers</button>
    <button onclick="loadUsers()">👤 Load Users</button>
    <button onclick="loadRechargeRequests()">💰 Load Recharge Requests</button>
  </div>

  <div id="output"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, get, remove, update } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCH17_8W_UPmPt4KqpCaV7BpN6KsA4a67E",
      authDomain: "zara-fix.firebaseapp.com",
      databaseURL: "https://zara-fix-default-rtdb.firebaseio.com",
      projectId: "zara-fix",
      storageBucket: "zara-fix.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const output = document.getElementById('output');

    function createCard(title, data, type = 'default') {
      const card = document.createElement('div');
      card.className = 'card';

      let html = `<strong>👤 ${data.name || 'No Name'}</strong><br/>
        📱 WhatsApp: ${data.phone || 'N/A'}<br/>
        🎯 Pincode: ${data.pincode || 'N/A'}<br/>`;

      if (type === 'poster') {
        const approved = data.approved === true;
        const ledClass = approved ? 'green' : 'red';
        html += `
          🔔 Approved: ${approved ? 'Yes' : 'No'}
          <span class="led ${ledClass}"></span><br/>
        `;
        html += `<div class="btn-group">
            ${!approved ? `<button onclick="approvePoster('${data.id}')">Approve</button>
            <button onclick="rejectPoster('${data.id}')">Reject</button>` : ''}
            <button onclick="deletePoster('${data.id}')">🗑️ Delete</button>
          </div>`;
      } else {
        html += `🕒 ${new Date(data.timestamp || Date.now()).toLocaleString()}<br/>
          <div class="btn-group">
            <button onclick="deleteData('${type}', '${data.id}')">🗑️ Delete</button>
          </div>`;
      }

      card.innerHTML = html;
      return card;
    }

    async function loadPosterUsers() {
      output.innerHTML = "<h2>Poster Users</h2>";
      const snap = await get(ref(db, 'posterUsers'));
      if (!snap.exists()) return output.innerHTML += "<p>No poster users found.</p>";

      Object.entries(snap.val()).forEach(([id, user]) => {
        user.id = id;
        output.appendChild(createCard('Poster User', user, 'poster'));
      });
    }

    async function loadProviders() {
      output.innerHTML = "<h2>Providers</h2>";
      const snap = await get(ref(db, 'providers'));
      if (!snap.exists()) return output.innerHTML += "<p>No providers found.</p>";

      Object.entries(snap.val()).forEach(([id, user]) => {
        user.id = id;
        output.appendChild(createCard('Provider', user, 'providers'));
      });
    }

    async function loadUsers() {
      output.innerHTML = "<h2>Users</h2>";
      const snap = await get(ref(db, 'users'));
      if (!snap.exists()) return output.innerHTML += "<p>No users found.</p>";

      Object.entries(snap.val()).forEach(([id, user]) => {
        user.id = id;
        output.appendChild(createCard('User', user, 'users'));
      });
    }

    async function loadRechargeRequests() {
      output.innerHTML = "<h2>Recharge Requests</h2>";
      const snap = await get(ref(db, 'rechargeRequests'));
      if (!snap.exists()) return output.innerHTML += "<p>No recharge requests found.</p>";

      Object.entries(snap.val()).forEach(([id, req]) => {
        req.id = id;
        output.appendChild(createCard('Recharge', req, 'rechargeRequests'));
      });
    }

    function deleteData(path, id) {
      if (confirm('Delete this entry?')) {
        remove(ref(db, `${path}/${id}`));
      }
    }

    function deletePoster(id) {
      deleteData('posterUsers', id);
    }

    function approvePoster(id) {
      update(ref(db, `posterUsers/${id}`), { approved: true });
    }

    function rejectPoster(id) {
      update(ref(db, `posterUsers/${id}`), { approved: false });
    }
  </script>
</body>
</html>
