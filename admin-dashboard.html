<!DOCTYPE html>
<html>
<head>
  <title>User / Provider View</title>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js"></script>
  <style>
    body { font-family: Arial; padding: 20px; }
    button { padding: 10px 15px; margin: 5px; }
    .box { border: 1px solid #ccc; padding: 10px; margin-top: 20px; }
    .hidden { display: none; }
  </style>
</head>
<body>

<h2>Login as User or Provider</h2>
<button onclick="login()">Login with Google</button>
<button onclick="logout()">Logout</button>

<div id="userView" class="box hidden">
  <h3>User Dashboard</h3>
  <p id="userName"></p>
  <p id="userWallet"></p>

  <h4>Recharge Request</h4>
  <input type="number" id="rechargeAmount" placeholder="Enter amount">
  <button onclick="sendRechargeRequest()">Send Recharge</button>
  <p id="rechargeStatus"></p>
</div>

<div id="providerView" class="box hidden">
  <h3>Provider Dashboard</h3>
  <p id="providerName"></p>
  <p id="providerCategory"></p>
  <p id="providerWallet"></p>
</div>

<script>
  // ðŸ”§ Replace this with your own Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyCH17_8W_UPmPt4KqpCaV7BpN6KsA4a67E",
    authDomain: "zara-fix.firebaseapp.com",
    databaseURL: "https://zara-fix-default-rtdb.firebaseio.com",
    projectId: "zara-fix",
    storageBucket: "zara-fix.appspot.com",
    messagingSenderId: "99236472578",
    appId: "1:99236472578:web:9b6747c163b83f3f0e4eec"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.database();

  let currentUser = null;

  function login() {
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider)
      .then(res => {
        currentUser = res.user;
        const uid = currentUser.uid;
        // Check role
        db.ref(`users/${uid}`).once('value', snap => {
          if (snap.exists()) {
            showUserView(uid);
          } else {
            db.ref(`providers/${uid}`).once('value', snap2 => {
              if (snap2.exists()) {
                showProviderView(uid);
              } else {
                alert("User not found in database.");
              }
            });
          }
        });
      })
      .catch(err => alert(err.message));
  }

  function logout() {
    auth.signOut();
    currentUser = null;
    document.getElementById('userView').classList.add('hidden');
    document.getElementById('providerView').classList.add('hidden');
  }

  function showUserView(uid) {
    db.ref(`users/${uid}`).once('value').then(snap => {
      const user = snap.val();
      document.getElementById('userName').innerText = `Name: ${user.name}`;
      document.getElementById('userWallet').innerText = `Wallet: â‚¹${user.wallet}`;
      document.getElementById('userView').classList.remove('hidden');
      document.getElementById('providerView').classList.add('hidden');
    });
  }

  function showProviderView(uid) {
    db.ref(`providers/${uid}`).once('value').then(snap => {
      const provider = snap.val();
      document.getElementById('providerName').innerText = `Name: ${provider.name}`;
      document.getElementById('providerCategory').innerText = `Category: ${provider.category} (${provider.subcategory})`;
      document.getElementById('providerWallet').innerText = `Wallet: â‚¹${provider.wallet}`;
      document.getElementById('providerView').classList.remove('hidden');
      document.getElementById('userView').classList.add('hidden');
    });
  }

  function sendRechargeRequest() {
    const amount = parseInt(document.getElementById('rechargeAmount').value);
    if (!amount || amount < 1) {
      alert("Please enter a valid amount.");
      return;
    }
    const uid = currentUser.uid;
    db.ref(`users/${uid}`).once('value').then(snap => {
      const user = snap.val();
      const reqId = db.ref().child("rechargeRequests").push().key;
      const data = {
        uid: uid,
        name: user.name,
        phone: user.phone,
        amount: amount,
        status: "Pending",
        timestamp: new Date().toISOString()
      };
      db.ref(`rechargeRequests/${reqId}`).set(data).then(() => {
        document.getElementById('rechargeStatus').innerText = "Recharge request sent!";
      });
    });
  }
</script>
</body>
</html>
