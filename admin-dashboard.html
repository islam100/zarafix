<!DOCTYPE html>
<html>
<head>
  <title>üõ†Ô∏è ZaraFix Admin Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      margin: 0;
      padding: 10px;
    }
    .tab {
      display: flex;
      justify-content: space-around;
      margin-bottom: 20px;
    }
    .tab button {
      padding: 10px 20px;
      font-weight: bold;
      border: none;
      background: #1976d2;
      color: white;
      border-radius: 5px;
      cursor: pointer;
    }
    .tab button.active {
      background: #0d47a1;
    }
    .card {
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      padding: 15px;
      margin-bottom: 15px;
    }
    .card img {
      max-width: 100%;
      border-radius: 10px;
    }
    .approve-btn {
      margin-top: 10px;
      padding: 5px 10px;
      background: green;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .wallet {
      color: green;
      font-weight: bold;
    }
  </style>
</head>
<body>

<div class="tab">
  <button onclick="showTab('recharges')" class="active">üìã Recharge Requests</button>
  <button onclick="showTab('providers')">üß∞ All Providers</button>
</div>

<div id="recharges"></div>
<div id="providers" style="display:none;"></div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import {
    getDatabase, ref, onValue, update
  } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCH17_8W_UPmPt4KqpCaV7BpN6KsA4a67E",
    authDomain: "zara-fix.firebaseapp.com",
    databaseURL: "https://zara-fix-default-rtdb.firebaseio.com",
    projectId: "zara-fix",
    storageBucket: "zara-fix.appspot.com",
    messagingSenderId: "476473209200",
    appId: "1:476473209200:web:9f6efe6c32fd4248949fb5"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const rechargeDiv = document.getElementById("recharges");
  const providerDiv = document.getElementById("providers");

  function showTab(tabName) {
    document.querySelectorAll('.tab button').forEach(btn => btn.classList.remove('active'));
    document.querySelector(`.tab button[onclick*="${tabName}"]`).classList.add('active');
    rechargeDiv.style.display = tabName === 'recharges' ? 'block' : 'none';
    providerDiv.style.display = tabName === 'providers' ? 'block' : 'none';
  }

  // Load recharge requests
  onValue(ref(db, 'recharges'), (snapshot) => {
    rechargeDiv.innerHTML = '';
    const data = snapshot.val();
    if (data) {
      Object.entries(data).forEach(([posterId, recharges]) => {
        Object.entries(recharges).forEach(([rechargeId, recharge]) => {
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h4>Poster ID: ${posterId}</h4>
            <img src="${recharge.screenshotUrl}" alt="Payment Screenshot" />
            <p>Approved: ${recharge.approved}</p>
            ${recharge.approved ? '' : `<button class="approve-btn">‚úÖ Approve ‚Çπ100</button>`}
          `;
          if (!recharge.approved) {
            card.querySelector('.approve-btn').onclick = () => {
              update(ref(db, `recharges/${posterId}/${rechargeId}`), { approved: true });
              update(ref(db, `posters/${posterId}`), {
                wallet: (data.wallet || 0) + 100
              });
              alert('Recharge approved and ‚Çπ100 added to wallet!');
            };
          }
          rechargeDiv.appendChild(card);
        });
      });
    } else {
      rechargeDiv.innerHTML = '<p>No recharge requests found.</p>';
    }
  });

  // Load all providers (posters)
  onValue(ref(db, 'posters'), (snapshot) => {
    providerDiv.innerHTML = '';
    const data = snapshot.val();
    if (data) {
      Object.entries(data).forEach(([posterId, poster]) => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <h4>Name: ${poster.name}</h4>
          <p>Shop: ${poster.shop || poster.shopname}</p>
          <p>Category: ${poster.category}</p>
          <p>WhatsApp: ${poster.whatsapp}</p>
          <p class="wallet">Wallet: ‚Çπ${poster.wallet || 0}</p>
        `;
        providerDiv.appendChild(card);
      });
    } else {
      providerDiv.innerHTML = '<p>No providers found.</p>';
    }
  });
</script>

</body>
</html>
