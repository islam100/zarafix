<!DOCTYPE html>
<html>
<head>
  <title>üõ†Ô∏è ZaraFix Admin Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Arial; background: #f2f2f2; padding: 10px; }
    h2 { text-align: center; }
    .card {
      background: white; padding: 15px; margin: 10px auto;
      max-width: 500px; border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    button {
      background: #28a745; color: white; padding: 8px 12px;
      border: none; border-radius: 5px; cursor: pointer;
      margin-top: 8px;
    }
  </style>
</head>
<body>
  <h2>üõ†Ô∏è ZaraFix Admin Dashboard</h2>
  <div id="adminSection"></div>

  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      databaseURL: "YOUR_DB_URL",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_BUCKET",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    auth.onAuthStateChanged(user => {
      if (!user) {
        alert("Login First");
        window.location.href = "index.html";
        return;
      }

      const uid = user.uid;
      db.ref("admins/" + uid).once("value", snap => {
        if (snap.exists()) {
          loadDashboard();
        } else {
          alert("Access Denied");
          window.location.href = "index.html";
        }
      });
    });

    function loadDashboard() {
      const adminSection = document.getElementById("adminSection");
      adminSection.innerHTML = "<h3>‚úîÔ∏è Welcome Admin</h3>";

      // Posters
      db.ref("posters").once("value", snap => {
        adminSection.innerHTML += "<h3>üß∞ Service Providers</h3>";
        snap.forEach(child => {
          const p = child.val();
          adminSection.innerHTML += `
            <div class="card">
              <b>Name:</b> ${p.name}<br>
              <b>Shop:</b> ${p.shop}<br>
              <b>Category:</b> ${p.category}<br>
              <b>WhatsApp:</b> ${p.whatsapp}<br>
              <b>Wallet:</b> ‚Çπ${p.wallet}
            </div>
          `;
        });
      });

      // Service Requests
      db.ref("requests").once("value", snap => {
        adminSection.innerHTML += "<h3>üìã Service Requests</h3>";
        snap.forEach(userSnap => {
          const userId = userSnap.key;
          userSnap.forEach(reqSnap => {
            const req = reqSnap.val();
            const acceptedBy = req.acceptedBy ? Object.keys(req.acceptedBy).join(", ") : "None";
            adminSection.innerHTML += `
              <div class="card">
                <b>User ID:</b> ${userId}<br>
                <b>Category:</b> ${req.category}<br>
                <b>Description:</b> ${req.description}<br>
                <b>Accepted By:</b> ${acceptedBy}
              </div>
            `;
          });
        });
      });

      // Recharges
      db.ref("recharges").once("value", snap => {
        adminSection.innerHTML += "<h3>üí∞ Recharge Requests</h3>";
        snap.forEach(posterSnap => {
          const posterId = posterSnap.key;
          posterSnap.forEach(rSnap => {
            const r = rSnap.val();
            if (!r.approved) {
              adminSection.innerHTML += `
                <div class="card">
                  <b>Poster ID:</b> ${posterId}<br>
                  <img src="${r.screenshotUrl}" width="100"><br>
                  <button onclick="approveRecharge('${posterId}', '${rSnap.key}')">Approve</button>
                </div>
              `;
            }
          });
        });
      });
    }

    function approveRecharge(posterId, rechargeId) {
      db.ref(`recharges/${posterId}/${rechargeId}/approved`).set(true);
      db.ref(`posters/${posterId}/wallet`).once("value", snap => {
        const oldWallet = snap.val() || 0;
        db.ref(`posters/${posterId}/wallet`).set(oldWallet + 100);
        alert("Recharge Approved");
        location.reload();
      });
    }
  </script>
</body>
</html>
