<!DOCTYPE html>
<html>
<head>
  <title>ğŸ› ï¸ ZaraFix Admin Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: Arial;
      background: #f0f0f0;
      margin: 0;
      padding: 10px;
    }
    .button-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      margin-bottom: 20px;
    }
    .dash-btn {
      padding: 15px 25px;
      font-weight: bold;
      border: none;
      border-radius: 12px;
      box-shadow: 3px 3px 8px #aaa;
      cursor: pointer;
      background: linear-gradient(to right, #4CAF50, #81C784);
      color: white;
    }
    .section {
      display: none;
    }
    .card {
      background: white;
      margin: 10px auto;
      padding: 15px;
      max-width: 500px;
      border-radius: 15px;
      box-shadow: 0 5px 12px rgba(0,0,0,0.2);
    }
    .led {
      height: 10px;
      width: 10px;
      border-radius: 50%;
      display: inline-block;
      margin-right: 5px;
    }
    .green { background-color: green; }
    .red { background-color: red; }
    .card button {
      margin: 5px;
      padding: 8px 15px;
      border: none;
      border-radius: 8px;
      background: #2196F3;
      color: white;
      cursor: pointer;
    }
    img { max-width: 100%; }
  </style>
</head>
<body>

<h2>ğŸ› ï¸ ZaraFix Admin Dashboard</h2>

<div class="button-bar">
  <button class="dash-btn" onclick="showSection('requests')">ğŸ“‹ Service Requests</button>
  <button class="dash-btn" onclick="showSection('providers')">ğŸ§° Service Providers</button>
  <button class="dash-btn" onclick="showSection('recharges')">ğŸ’° Recharge Requests</button>
</div>

<div id="requests" class="section"></div>
<div id="providers" class="section"></div>
<div id="recharges" class="section"></div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyDx8m7yo...",
    authDomain: "zarafix.firebaseapp.com",
    databaseURL: "https://zarafix-default-rtdb.firebaseio.com",
    projectId: "zarafix",
    storageBucket: "zarafix.appspot.com",
    messagingSenderId: "1234567890",
    appId: "1:1234567890:web:abcd1234"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const adminUID = "wjbEIAEF5jWgJKb2LlfWoIv4EqO2"; // your admin UID

  firebase.auth().onAuthStateChanged(user => {
    if (!user || user.uid !== adminUID) {
      alert("Access Denied. Admins only.");
      window.location.href = "index.html";
    } else {
      loadAllData();
    }
  });

  function showSection(id) {
    document.querySelectorAll('.section').forEach(sec => sec.style.display = 'none');
    document.getElementById(id).style.display = 'block';
  }

  function loadAllData() {
    // Load Service Requests
    db.ref("requests").once('value', snap => {
      const div = document.getElementById("requests");
      div.innerHTML = "<h3>Service Requests</h3>";
      snap.forEach(userSnap => {
        userSnap.forEach(reqSnap => {
          const d = reqSnap.val();
          div.innerHTML += `
            <div class="card">
              <span class="led ${d.acceptedBy ? 'green' : 'red'}"></span>
              <b>${d.name}</b> - ${d.category}<br>
              ğŸ“ ${d.address}<br>ğŸ“ ${d.whatsapp}<br>
              <button onclick="deleteRequest('${userSnap.key}', '${reqSnap.key}')">Delete</button>
            </div>`;
        });
      });
    });

    // Load Providers
    db.ref("providers").once('value', snap => {
      const div = document.getElementById("providers");
      div.innerHTML = "<h3>Service Providers</h3>";
      snap.forEach(child => {
        const d = child.val();
        div.innerHTML += `
          <div class="card">
            <span class="led ${d.approved ? 'green' : 'red'}"></span>
            <b>${d.name}</b> - ${d.category}/${d.subcategory}<br>
            ğŸ“ ${d.whatsapp} | ğŸª ${d.shopName}<br>
            ğŸ’° Wallet: â‚¹${d.wallet || 0}<br>
            <button onclick="approveProvider('${child.key}')">Approve</button>
            <button onclick="deleteProvider('${child.key}')">Delete</button>
          </div>`;
      });
    });

    // Load Recharge Requests
    db.ref("recharges").once('value', snap => {
      const div = document.getElementById("recharges");
      div.innerHTML = "<h3>Recharge Requests</h3>";
      snap.forEach(child => {
        const d = child.val();
        div.innerHTML += `
          <div class="card">
            <span class="led ${d.approved ? 'green' : 'red'}"></span>
            UID: ${child.key}<br>
            <img src="${d.screenshot}" alt="screenshot"/><br>
            <button onclick="approveRecharge('${child.key}')">Approve</button>
          </div>`;
      });
    });
  }

  function deleteRequest(userId, requestId) {
    db.ref(`requests/${userId}/${requestId}`).remove().then(() => {
      alert("Deleted!");
      loadAllData();
    });
  }

  function approveProvider(uid) {
    db.ref(`providers/${uid}`).update({ approved: true }).then(loadAllData);
  }

  function deleteProvider(uid) {
    db.ref(`providers/${uid}`).remove().then(loadAllData);
  }

  function approveRecharge(uid) {
    db.ref(`recharges/${uid}`).update({ approved: true }).then(() => {
      db.ref(`providers/${uid}`).once('value', snap => {
        const wallet = (snap.val().wallet || 0) + 100;
        db.ref(`providers/${uid}`).update({ wallet });
      });
      loadAllData();
    });
  }
</script>

</body>
</html>
