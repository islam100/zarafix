<!DOCTYPE html>
<html>
<head>
  <title>Admin Dashboard</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f4f4f4; }
    h2 { background: #222; color: white; padding: 10px; }
    .section { margin-bottom: 40px; background: white; padding: 15px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background: #eee; }
  </style>
</head>
<body>

  <h1>Admin Dashboard</h1>

  <div class="section" id="posterUsersSection">
    <h2>Poster Users</h2>
    <table id="posterUsersTable">
      <thead>
        <tr>
          <th>Name</th><th>Shop</th><th>Whatsapp</th><th>Pincode</th><th>Category</th><th>Approved</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="section" id="serviceRequestsSection">
    <h2>Service Requests</h2>
    <table id="serviceRequestsTable">
      <thead>
        <tr><th>Name</th><th>Address</th><th>Whatsapp</th><th>Category</th><th>Subcategory</th><th>Description</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="section" id="rechargeRequestsSection">
    <h2>Recharge Requests</h2>
    <table id="rechargeRequestsTable">
      <thead>
        <tr><th>Name</th><th>Whatsapp</th><th>Amount</th><th>Status</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="section" id="walletsSection">
    <h2>Wallet Balances</h2>
    <table id="walletsTable">
      <thead>
        <tr><th>User ID</th><th>Balance</th><th>Transactions</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="section" id="loginLogsSection">
    <h2>Login Logs</h2>
    <table id="loginLogsTable">
      <thead>
        <tr><th>User ID</th><th>Name</th><th>Whatsapp</th><th>Last Login</th><th>Method</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCH17_8W_UPmPt4KqpCaV7BpN6KsA4a67E",
      authDomain: "zara-fix.firebaseapp.com",
      databaseURL: "https://zara-fix-default-rtdb.firebaseio.com",
      projectId: "zara-fix",
      storageBucket: "zara-fix.appspot.com",
      messagingSenderId: "1055330634384",
      appId: "1:1055330634384:web:4e0a33ddc81f5cc6c55fc4"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function loadPosterUsers() {
      db.ref('posterUsers').once('value', snap => {
        const data = snap.val();
        const table = document.querySelector('#posterUsersTable tbody');
        table.innerHTML = '';
        for (let uid in data) {
          const u = data[uid];
          table.innerHTML += `<tr>
            <td>${u.name}</td>
            <td>${u.shopname}</td>
            <td>${u.whatsapp}</td>
            <td>${u.pincode}</td>
            <td>${u.category} - ${u.subcategory}</td>
            <td>${u.approved}</td>
          </tr>`;
        }
      });
    }

    function loadServiceRequests() {
      db.ref('serviceRequests').once('value', snap => {
        const data = snap.val();
        const table = document.querySelector('#serviceRequestsTable tbody');
        table.innerHTML = '';
        for (let rid in data) {
          const r = data[rid];
          table.innerHTML += `<tr>
            <td>${r.name}</td><td>${r.address}</td><td>${r.whatsapp}</td>
            <td>${r.category}</td><td>${r.subcategory}</td><td>${r.description}</td>
          </tr>`;
        }
      });
    }

    function loadRechargeRequests() {
      db.ref('rechargeRequests').once('value', snap => {
        const data = snap.val();
        const table = document.querySelector('#rechargeRequestsTable tbody');
        table.innerHTML = '';
        for (let recid in data) {
          const r = data[recid];
          table.innerHTML += `<tr>
            <td>${r.name}</td><td>${r.whatsapp}</td><td>${r.amount}</td><td>${r.status}</td>
          </tr>`;
        }
      });
    }

    function loadWallets() {
      db.ref('wallets').once('value', snap => {
        const data = snap.val();
        const table = document.querySelector('#walletsTable tbody');
        table.innerHTML = '';
        for (let uid in data) {
          const w = data[uid];
          let txnList = '';
          for (let tid in w.transactions) {
            const t = w.transactions[tid];
            txnList += `${t.type}: ₹${t.amount} (${t.status})<br>`;
          }
          table.innerHTML += `<tr>
            <td>${uid}</td><td>₹${w.balance}</td><td>${txnList || '-'}</td>
          </tr>`;
        }
      });
    }

    function loadLoginLogs() {
      db.ref('loginLogs').once('value', snap => {
        const data = snap.val();
        const table = document.querySelector('#loginLogsTable tbody');
        table.innerHTML = '';
        for (let uid in data) {
          const log = data[uid];
          table.innerHTML += `<tr>
            <td>${uid}</td><td>${log.name}</td><td>${log.whatsapp}</td>
            <td>${log.lastLogin}</td><td>${log.method}</td>
          </tr>`;
        }
      });
    }

    // Load All
    loadPosterUsers();
    loadServiceRequests();
    loadRechargeRequests();
    loadWallets();
    loadLoginLogs();
  </script>
</body>
</html>
