<!DOCTYPE html>
<html>
<head>
  <title>üõ†Ô∏è ZaraFix Admin Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: Arial;
      background: #f4f4f4;
      padding: 10px;
    }
    h2 {
      text-align: center;
      margin-top: 0;
    }
    .section {
      margin: 20px 0;
    }
    .card {
      background: white;
      padding: 15px;
      margin: 10px 0;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    button {
      margin-top: 10px;
      padding: 8px 12px;
      border: none;
      border-radius: 10px;
      background: #007BFF;
      color: white;
      cursor: pointer;
    }
    button.delete {
      background: #e53935;
    }
    button.approve {
      background: #43a047;
    }
    .led {
      height: 12px;
      width: 12px;
      border-radius: 50%;
      display: inline-block;
      margin-left: 5px;
    }
    .led.green {
      background-color: green;
    }
    .led.red {
      background-color: red;
    }
    @media (max-width: 600px) {
      .card {
        font-size: 14px;
      }
    }
  </style>
</head>
<body>
  <h2>üõ†Ô∏è ZaraFix Admin Dashboard</h2>
  <div class="section" id="providers">
    <h3>üß∞ Service Providers</h3>
  </div>

  <div class="section" id="requests">
    <h3>üìã Service Requests</h3>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import {
      getDatabase, ref, onValue, update, remove
    } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCH17_8W_UPmPt4KqpCaV7BpN6KsA4a67E",
      authDomain: "zara-fix.firebaseapp.com",
      databaseURL: "https://zara-fix-default-rtdb.firebaseio.com",
      projectId: "zara-fix",
      storageBucket: "zara-fix.appspot.com",
      messagingSenderId: "476473209200",
      appId: "1:476473209200:web:9f6efe6c32fd4248949fb5"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const providersDiv = document.getElementById('providers');
    const requestsDiv = document.getElementById('requests');

    // Load Posters
    onValue(ref(db, 'posters'), (snapshot) => {
      providersDiv.innerHTML = "<h3>üß∞ Service Providers</h3>";
      const posters = snapshot.val() || {};
      for (let posterId in posters) {
        const p = posters[posterId];
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <b>Name:</b> ${p.name} <br>
          <b>Shop:</b> ${p.shop} <br>
          <b>Category:</b> ${p.category} <br>
          <b>WhatsApp:</b> <a href="https://wa.me/91${p.whatsapp}" target="_blank">${p.whatsapp}</a><br>
          <b>Address:</b> ${p.address || "N/A"} <br>
          <b>Wallet:</b> ‚Çπ${p.wallet || 0}<br>
          <button onclick="recharge('${posterId}')">+ ‚Çπ100 Recharge</button>
          <button class="delete" onclick="deletePoster('${posterId}')">üóëÔ∏è Delete</button>
          <button class="approve" onclick="approvePoster('${posterId}')">‚úîÔ∏è Approve</button>
        `;
        providersDiv.appendChild(card);
      }
    });

    // Load Requests
    onValue(ref(db, 'requests'), (snapshot) => {
      requestsDiv.innerHTML = "<h3>üìã Service Requests</h3>";
      const allRequests = snapshot.val() || {};
      for (let userId in allRequests) {
        const userRequests = allRequests[userId];
        for (let requestId in userRequests) {
          const r = userRequests[requestId];
          let acceptedBy = r.acceptedBy || {};
          let acceptedInfo = "";

          for (let pid in acceptedBy) {
            acceptedInfo += `<br>‚úÖ Accepted By: ${pid}`;
            const posterRef = ref(db, `posters/${pid}`);
            onValue(posterRef, (snap) => {
              const p = snap.val();
              if (p) {
                acceptedInfo += `<br>üìû <a href="https://wa.me/91${p.whatsapp}" target="_blank">${p.whatsapp}</a> (${p.name})`;
              }
            }, { onlyOnce: true });
          }

          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <b>User ID:</b> ${userId}<br>
            <b>Category:</b> ${r.category}<br>
            <b>Description:</b> ${r.description}<br>
            <b>Address:</b> ${r.address || "N/A"}<br>
            <b>Status:</b> ${
              Object.keys(acceptedBy).length
                ? `<span class="led green"></span> Accepted`
                : `<span class="led red"></span> Not Accepted`
            }
            ${acceptedInfo}
          `;
          requestsDiv.appendChild(card);
        }
      }
    });

    // Recharge ‚Çπ100 manually
    window.recharge = (posterId) => {
      const walletRef = ref(db, `posters/${posterId}`);
      onValue(walletRef, (snap) => {
        const p = snap.val();
        if (p) {
          const newWallet = (p.wallet || 0) + 100;
          update(walletRef, { wallet: newWallet });
        }
      }, { onlyOnce: true });
    };

    // Delete poster
    window.deletePoster = (posterId) => {
      if (confirm("Delete this service provider?")) {
        remove(ref(db, `posters/${posterId}`));
      }
    };

    // Approve logic placeholder
    window.approvePoster = (posterId) => {
      alert("‚úÖ Approved: " + posterId);
    };
  </script>
</body>
</html>
