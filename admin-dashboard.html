<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
  <style>
    button {
      margin: 10px;
      padding: 10px;
      font-weight: bold;
      border-radius: 8px;
      cursor: pointer;
    }
    .card {
      border: 2px solid #ccc;
      padding: 12px;
      margin: 10px;
      border-radius: 8px;
      background: #f8f8f8;
    }
  </style>
</head>
<body>

  <h2>📋 Admin Dashboard</h2>

  <button onclick="loadUsers()">🧑‍💻 User Requests</button>
  <button onclick="loadProviders()">🛠️ Service Provider Requests</button>

  <div id="requestContainer"></div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCH17_8W_UPmPt4KqpCaV7BpN6KsA4a67E",
      authDomain: "zara-fix.firebaseapp.com",
      databaseURL: "https://zara-fix-default-rtdb.firebaseio.com",
      projectId: "zara-fix",
      storageBucket: "zara-fix.appspot.com",
      messagingSenderId: "417651647879",
      appId: "1:417651647879:web:ad10b907399d50107e4a8f"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const container = document.getElementById('requestContainer');

    function createCard(data, id, type) {
      const div = document.createElement('div');
      div.className = "card";
      div.innerHTML = `
        <strong>Name:</strong> ${data.name || "N/A"}<br>
        <strong>Email:</strong> ${data.email || "N/A"}<br>
        <strong>WhatsApp:</strong> ${data.phone || "N/A"}<br>
        <strong>Address:</strong> ${data.address || "N/A"}<br>
        <strong>Category:</strong> ${data.category || "N/A"} (${data.subcategory || ""})<br>
        <strong>Issue:</strong> ${data.description || "N/A"}<br>
        <strong>Status:</strong> ${data.status || "Pending"}<br>
        <strong>Date & Time:</strong> ${data.timestamp || "N/A"}<br><br>

        ${
          data.status === "Approved"
          ? `<button onclick="deleteRequest('${id}', '${type}')">❌ Reject/Delete</button>`
          : `<button onclick="approveRequest('${id}', '${type}')">✅ Approve</button>
             <button onclick="deleteRequest('${id}', '${type}')">❌ Reject/Delete</button>`
        }
      `;
      container.appendChild(div);
    }

    function loadUsers() {
      container.innerHTML = "<h3>🧑‍💻 User Requests</h3>";
      db.ref("serviceRequests").once("value", (snapshot) => {
        snapshot.forEach((child) => {
          createCard(child.val(), child.key, "serviceRequests");
        });
      });
    }

    function loadProviders() {
      container.innerHTML = "<h3>🛠️ Service Provider Requests</h3>";
      db.ref("posterUsers").once("value", (snapshot) => {
        snapshot.forEach((child) => {
          createCard(child.val(), child.key, "posterUsers");
        });
      });
    }

    function approveRequest(id, type) {
      db.ref(`${type}/${id}`).update({ status: "Approved" });
      alert("Approved ✅");
      location.reload();
    }

    function deleteRequest(id, type) {
      if (confirm("Are you sure to Reject/Delete this?")) {
        db.ref(`${type}/${id}`).remove();
        alert("Deleted ❌");
        location.reload();
      }
    }
  </script>
</body>
</html>
