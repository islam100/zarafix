<!DOCTYPE html>
<html>
<head>
  <title>üõ†Ô∏è ZaraFix Admin Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Arial; background: #f9f9f9; margin: 0; padding: 20px; }
    h2 { text-align: center; }
    .tabs button {
      padding: 10px 15px;
      margin: 5px;
      border: none;
      border-radius: 8px;
      background: #007bff;
      color: white;
      font-weight: bold;
    }
    .section { display: none; margin-top: 20px; }
    .card {
      background: white;
      border-radius: 12px;
      padding: 15px;
      margin: 10px 0;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .led {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      display: inline-block;
      margin-right: 5px;
    }
    .led-green { background: green; }
    .led-red { background: red; }
    button.action-btn {
      margin-top: 10px;
      background: #28a745;
      color: white;
      padding: 5px 10px;
      border: none;
      border-radius: 6px;
    }
    button.delete-btn {
      background: #dc3545;
    }
  </style>
</head>
<body>
  <h2>ZaraFix Admin Dashboard</h2>

  <div class="tabs" style="text-align:center">
    <button onclick="showSection('recharge')">üìã Recharge Requests</button>
    <button onclick="showSection('providers')">üß∞ All Providers</button>
    <button onclick="showSection('requests')">üì¶ Service Requests</button>
  </div>

  <div id="recharge" class="section"></div>
  <div id="providers" class="section"></div>
  <div id="requests" class="section"></div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      databaseURL: "https://YOUR_PROJECT.firebaseio.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT.appspot.com",
      messagingSenderId: "YOUR_MSG_ID",
      appId: "YOUR_APP_ID"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function showSection(id) {
      document.querySelectorAll(".section").forEach(div => div.style.display = "none");
      document.getElementById(id).style.display = "block";
    }

    function loadRechargeRequests() {
      const container = document.getElementById('recharge');
      container.innerHTML = '<h3>Recharge Requests</h3>';
      db.ref('recharges').once('value', snapshot => {
        snapshot.forEach(posterSnap => {
          const posterId = posterSnap.key;
          posterSnap.forEach(rechargeSnap => {
            const recharge = rechargeSnap.val();
            const approved = recharge.approved;
            const led = `<span class="led ${approved ? 'led-green' : 'led-red'}"></span>`;
            container.innerHTML += `
              <div class="card">
                ${led} <strong>${posterId}</strong><br>
                <img src="${recharge.screenshotUrl}" width="100"><br>
                Status: ${approved ? 'Approved' : 'Pending'}<br>
                ${!approved ? `<button class="action-btn" onclick="approveRecharge('${posterId}', '${rechargeSnap.key}')">Approve</button>` : ''}
              </div>
            `;
          });
        });
      });
    }

    function approveRecharge(posterId, rechargeId) {
      db.ref(`recharges/${posterId}/${rechargeId}/approved`).set(true);
      db.ref(`posters/${posterId}/wallet`).get().then(snap => {
        const current = snap.val() || 0;
        db.ref(`posters/${posterId}/wallet`).set(current + 100);
        alert('Recharge Approved!');
        loadRechargeRequests();
      });
    }

    function loadProviders() {
      const container = document.getElementById('providers');
      container.innerHTML = '<h3>All Service Providers</h3>';
      db.ref('posters').once('value', snap => {
        snap.forEach(child => {
          const p = child.val();
          container.innerHTML += `
            <div class="card">
              <strong>${p.name}</strong><br>
              Shop: ${p.shop}<br>
              Category: ${p.category}<br>
              WhatsApp: <a href="https://wa.me/91${p.whatsapp}" target="_blank">${p.whatsapp}</a><br>
              Wallet: ‚Çπ${p.wallet}<br>
              <button class="delete-btn action-btn" onclick="deleteProvider('${child.key}')">Delete</button>
              <button class="action-btn" onclick="approveRechargeManually('${child.key}')">+ ‚Çπ100 Recharge</button>
            </div>
          `;
        });
      });
    }

    function deleteProvider(uid) {
      if (confirm("Delete this provider?")) {
        db.ref(`posters/${uid}`).remove().then(() => {
          alert('Deleted');
          loadProviders();
        });
      }
    }

    function approveRechargeManually(posterId) {
      db.ref(`posters/${posterId}/wallet`).get().then(snap => {
        const current = snap.val() || 0;
        db.ref(`posters/${posterId}/wallet`).set(current + 100).then(() => {
          alert('Manually recharged ‚Çπ100');
          loadProviders();
        });
      });
    }

    function loadServiceRequests() {
      const container = document.getElementById('requests');
      container.innerHTML = '<h3>Service Requests</h3>';
      db.ref('requests').once('value', snapshot => {
        snapshot.forEach(userSnap => {
          const userId = userSnap.key;
          userSnap.forEach(reqSnap => {
            const req = reqSnap.val();
            const acceptedBy = req.acceptedBy ? Object.keys(req.acceptedBy).join(', ') : 'None';
            container.innerHTML += `
              <div class="card">
                <strong>User ID:</strong> ${userId}<br>
                <strong>Category:</strong> ${req.category}<br>
                <strong>Description:</strong> ${req.description}<br>
                <strong>Location:</strong> ${req.location || 'Not provided'}<br>
                <strong>Accepted By:</strong> ${acceptedBy}
              </div>
            `;
          });
        });
      });
    }

    // Load all on start
    showSection('recharge');
    loadRechargeRequests();
    loadProviders();
    loadServiceRequests();
  </script>
</body>
</html>
