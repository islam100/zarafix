<!DOCTYPE html>
<html>
<head>
  <title>🔐 ZaraFix Admin Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: Arial;
      margin: 0;
      padding: 10px;
      background: #e3f2fd;
    }
    .btn {
      display: inline-block;
      padding: 15px 25px;
      margin: 10px 5px;
      border: none;
      border-radius: 12px;
      background: linear-gradient(145deg, #4fc3f7, #0288d1);
      color: white;
      font-weight: bold;
      font-size: 16px;
      cursor: pointer;
      box-shadow: 0 8px 15px rgba(0,0,0,0.2);
      transition: all 0.3s ease-in-out;
    }
    .btn:hover {
      transform: scale(1.05);
      box-shadow: 0 12px 20px rgba(0,0,0,0.3);
    }
    .section {
      display: none;
      margin-top: 20px;
    }
    .card {
      background: white;
      padding: 15px;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      margin-bottom: 15px;
    }
    .led {
      height: 12px;
      width: 12px;
      border-radius: 50%;
      display: inline-block;
      margin-right: 6px;
    }
    .led-red { background: red; }
    .led-green { background: green; }
    .whatsapp {
      color: green;
      text-decoration: none;
      font-weight: bold;
    }
    img {
      max-width: 100px;
      display: block;
      margin: 5px 0;
    }
  </style>
</head>
<body>
  <h2>🛠️ ZaraFix Admin Dashboard</h2>
  <button class="btn" onclick="showSection('posters')">🧰 Posters</button>
  <button class="btn" onclick="showSection('requests')">📋 Requests</button>
  <button class="btn" onclick="showSection('recharges')">💸 Recharges</button>

  <div id="posters" class="section"></div>
  <div id="requests" class="section"></div>
  <div id="recharges" class="section"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, get, update, remove } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCH17_8W_UPmPt4KqpCaV7BpN6KsA4a67E",
      authDomain: "zara-fix.firebaseapp.com",
      databaseURL: "https://zara-fix-default-rtdb.firebaseio.com",
      projectId: "zara-fix",
      storageBucket: "zara-fix.appspot.com",
      messagingSenderId: "476473209200",
      appId: "1:476473209200:web:9f6efe6c32fd4248949fb5"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    function showSection(id) {
      document.querySelectorAll(".section").forEach(sec => sec.style.display = "none");
      document.getElementById(id).style.display = "block";
      if (id === "posters") loadPosters();
      else if (id === "requests") loadRequests();
      else if (id === "recharges") loadRecharges();
    }

    async function loadPosters() {
      const postersDiv = document.getElementById('posters');
      postersDiv.innerHTML = '';
      const snap = await get(ref(db, 'posters'));
      if (snap.exists()) {
        const posters = snap.val();
        for (const uid in posters) {
          const p = posters[uid];
          const led = p.approved ? '<span class="led led-green"></span>' : '<span class="led led-red"></span>';
          postersDiv.innerHTML += `
            <div class="card">
              ${led} <strong>${p.name}</strong><br>
              🏪 ${p.shopName} | 📞 <a class="whatsapp" href="https://wa.me/${p.whatsapp}" target="_blank">${p.whatsapp}</a><br>
              📍 ${p.address}<br>
              🔧 ${p.category} → ${p.subcategory || 'N/A'}<br>
              💰 Wallet: ₹${p.wallet || 0}
              <br><br>
              <button onclick="deletePoster('${uid}')">🗑️ Delete</button>
            </div>`;
        }
      } else {
        postersDiv.innerHTML = 'No posters found.';
      }
    }

    async function loadRequests() {
      const reqDiv = document.getElementById('requests');
      reqDiv.innerHTML = '';
      const snap = await get(ref(db, 'requests'));
      if (snap.exists()) {
        const all = snap.val();
        for (const uid in all) {
          const requests = all[uid];
          for (const key in requests) {
            const r = requests[key];
            reqDiv.innerHTML += `
              <div class="card">
                👤 ${r.name || 'N/A'}<br>
                🆘 ${r.issue || 'N/A'}<br>
                📍 ${r.address || 'N/A'}<br>
                📞 <a class="whatsapp" href="https://wa.me/${r.whatsapp}" target="_blank">${r.whatsapp}</a>
                <br><br>
                <button onclick="deleteRequest('${uid}', '${key}')">🗑️ Delete</button>
              </div>`;
          }
        }
      } else {
        reqDiv.innerHTML = 'No requests found.';
      }
    }

    async function loadRecharges() {
      const recDiv = document.getElementById('recharges');
      recDiv.innerHTML = '';
      const snap = await get(ref(db, 'recharges'));
      if (snap.exists()) {
        const data = snap.val();
        for (const uid in data) {
          const r = data[uid];
          const led = r.approved ? '<span class="led led-green"></span>' : '<span class="led led-red"></span>';
          recDiv.innerHTML += `
            <div class="card">
              ${led} <strong>${r.name || 'N/A'}</strong><br>
              📞 <a class="whatsapp" href="https://wa.me/${r.whatsapp}" target="_blank">${r.whatsapp}</a><br>
              🖼️ <img src="${r.screenshot}" alt="screenshot"><br>
              ${!r.approved ? `<button onclick="approveRecharge('${uid}')">✅ Approve ₹100</button>` : '✅ Approved'}
              <br><br>
              <button onclick="deleteRecharge('${uid}')">🗑️ Delete</button>
            </div>`;
        }
      } else {
        recDiv.innerHTML = 'No recharge requests.';
      }
    }

    async function approveRecharge(uid) {
      const walletRef = ref(db, `posters/${uid}`);
      const snap = await get(walletRef);
      if (snap.exists()) {
        const current = snap.val().wallet || 0;
        await update(walletRef, { wallet: current + 100 });
        await update(ref(db, `recharges/${uid}`), { approved: true });
        loadRecharges();
      }
    }

    function deletePoster(uid) {
      if (confirm("Delete this poster?")) {
        remove(ref(db, 'posters/' + uid));
        loadPosters();
      }
    }

    function deleteRequest(uid, key) {
      if (confirm("Delete this request?")) {
        remove(ref(db, `requests/${uid}/${key}`));
        loadRequests();
      }
    }

    function deleteRecharge(uid) {
      if (confirm("Delete this recharge?")) {
        remove(ref(db, 'recharges/' + uid));
        loadRecharges();
      }
    }
  </script>
</body>
</html>
