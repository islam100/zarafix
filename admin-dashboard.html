<div class="p-4">
  <h1 class="text-2xl font-bold mb-4">ğŸ‘¨â€ğŸ’¼ Admin Dashboard</h1>
  <div class="flex gap-2 mb-4">
    <button id="loadProvidersBtn" class="bg-blue-500 text-white px-4 py-2 rounded-2xl shadow-lg active:scale-95">ğŸ› ï¸ Load Providers</button>
    <button id="loadRequestsBtn" class="bg-green-500 text-white px-4 py-2 rounded-2xl shadow-lg active:scale-95">ğŸ§¾ Load Service Requests</button>
  </div>
  
  <div id="adminContent" class="grid gap-4"></div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getDatabase, ref, onValue, update, remove } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCH17_8W_UPmPt4KqpCaV7BpN6KsA4a67E",
    authDomain: "zara-fix.firebaseapp.com",
    databaseURL: "https://zara-fix-default-rtdb.firebaseio.com",
    projectId: "zara-fix",
    storageBucket: "zara-fix.appspot.com",
    messagingSenderId: "67837243802",
    appId: "1:67837243802:web:237aa662b4e5cf9ae29f49"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const adminContent = document.getElementById("adminContent");
  const loadProvidersBtn = document.getElementById("loadProvidersBtn");
  const loadRequestsBtn = document.getElementById("loadRequestsBtn");

  function renderCard(key, data, type) {
    return `
      <div class="bg-white p-4 rounded-2xl shadow-xl border">
        <h2 class="text-lg font-bold mb-2">${data.shopname || "No Shop Name"}</h2>
        <p><strong>Name:</strong> ${data.name || "-"}</p>
        <p><strong>WhatsApp:</strong> ${data.whatsapp || "-"}</p>
        <p><strong>Address:</strong> ${data.address || "-"}</p>
        <p><strong>Category:</strong> ${data.category || "-"} / ${data.subcategory || "-"}</p>
        <div class="flex gap-2 mt-2">
          ${data.approved === false ? `<button class="bg-green-500 text-white px-3 py-1 rounded" onclick="approve('${type}','${key}')">Approve</button>` : ""}
          <button class="bg-yellow-500 text-white px-3 py-1 rounded" onclick="reject('${type}','${key}')">Reject</button>
          <button class="bg-red-600 text-white px-3 py-1 rounded" onclick="removeItem('${type}','${key}')">Delete</button>
        </div>
      </div>
    `;
  }

  window.approve = (path, key) => update(ref(db, `${path}/${key}`), { approved: true });
  window.reject = (path, key) => update(ref(db, `${path}/${key}`), { approved: false });
  window.removeItem = (path, key) => remove(ref(db, `${path}/${key}`));

  loadProvidersBtn.onclick = () => {
    adminContent.innerHTML = "<h2 class='font-bold text-lg'>ğŸ”„ Loading Providers...</h2>";
    onValue(ref(db, "providers"), (snapshot) => {
      adminContent.innerHTML = "<h2 class='text-xl font-bold mb-2'>Unapproved Providers</h2>";
      snapshot.forEach((child) => {
        const data = child.val();
        if (data.approved === false) {
          adminContent.innerHTML += renderCard(child.key, data, "providers");
        }
      });
    });
  };

  loadRequestsBtn.onclick = () => {
    adminContent.innerHTML = "<h2 class='font-bold text-lg'>ğŸ”„ Loading Service Requests...</h2>";
    onValue(ref(db, "serviceRequests"), (snapshot) => {
      adminContent.innerHTML = "<h2 class='text-xl font-bold mb-2'>Unapproved Service Requests</h2>";
      snapshot.forEach((child) => {
        const data = child.val();
        if (data.approved === false) {
          adminContent.innerHTML += renderCard(child.key, data, "serviceRequests");
        }
      });
    });
  };
</script>
