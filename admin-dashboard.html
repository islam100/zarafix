<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard - Service Requests</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f4f4f4;
      padding: 20px;
    }
    h2 {
      text-align: center;
      color: #444;
    }
    .card {
      background: white;
      padding: 20px;
      margin: 10px auto;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      max-width: 400px;
      position: relative;
    }
    .blinking-led {
      width: 15px;
      height: 15px;
      border-radius: 50%;
      background-color: red;
      position: absolute;
      top: 10px;
      right: 10px;
      animation: blink 1s infinite;
    }
    @keyframes blink {
      0%, 50%, 100% { opacity: 1; }
      25%, 75% { opacity: 0; }
    }
    .btn {
      padding: 10px 20px;
      margin: 10px 5px 0;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 2px 2px 6px rgba(0,0,0,0.2);
      transition: transform 0.2s ease;
    }
    .btn:hover {
      transform: scale(1.05);
    }
    .approve-btn { background: #28a745; color: white; }
    .delete-btn { background: #dc3545; color: white; }
    .status-approved { color: green; font-weight: bold; }
  </style>
</head>
<body>
  <h2>Admin Dashboard - All Service Requests</h2>
  <div id="requestsContainer"></div>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <script>
    // ✅ Firebase Config (use your actual config)
    const firebaseConfig = {
      apiKey: "AIzaSyCH17_8W_UPmPt4KqpCaV7BpN6KsA4a67E",
      authDomain: "zara-fix.firebaseapp.com",
      databaseURL: "https://zara-fix-default-rtdb.firebaseio.com",
      projectId: "zara-fix",
      storageBucket: "zara-fix.appspot.com",
      messagingSenderId: "878664327534",
      appId: "1:878664327534:web:6cc3eaef53878b43dcf688"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const container = document.getElementById("requestsContainer");

    function createCard(key, data) {
      const card = document.createElement("div");
      card.className = "card";

      const html = `
        <h3>${data.name || 'No Name'}</h3>
        <p><strong>Email:</strong> ${data.email || 'N/A'}</p>
        <p><strong>Service:</strong> ${data.service || 'N/A'}</p>
        <p><strong>Status:</strong> ${data.status === "Approved" ? '<span class="status-approved">✅ Approved</span>' : data.status || 'Pending'}</p>
      `;
      card.innerHTML = html;

      // ✅ Blinking LED if not approved
      if (data.status !== "Approved") {
        const led = document.createElement("div");
        led.className = "blinking-led";
        card.appendChild(led);
      }

      // ✅ Buttons
      const approveBtn = document.createElement("button");
      approveBtn.className = "btn approve-btn";
      approveBtn.textContent = "✅ Approve";

      const deleteBtn = document.createElement("button");
      deleteBtn.className = "btn delete-btn";
      deleteBtn.textContent = "❌ Reject/Delete";

      // ✅ Only show buttons based on status
      if (data.status === "Approved") {
        card.appendChild(deleteBtn);
      } else {
        card.appendChild(approveBtn);
        card.appendChild(deleteBtn);
      }

      // ✅ Approve functionality
      approveBtn.onclick = () => {
        firebase.database().ref(`serviceRequests/${key}`).update({
          status: "Approved"
        });
        alert("Approved Successfully!");
      };

      // ✅ Delete functionality
      deleteBtn.onclick = () => {
        if (confirm("Are you sure you want to delete this request?")) {
          firebase.database().ref(`serviceRequests/${key}`).remove();
          alert("Deleted Successfully!");
        }
      };

      container.appendChild(card);
    }

    // ✅ Load all serviceRequests
    db.ref("serviceRequests").on("value", snapshot => {
      container.innerHTML = ""; // clear before reload
      snapshot.forEach(child => {
        createCard(child.key, child.val());
      });
    });
  </script>
</body>
</html>
