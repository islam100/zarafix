<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zara Real Estate</title>
<style>
/* Reset & Base */
* { margin:0; padding:0; box-sizing:border-box; font-family:Arial, sans-serif; }
body { background:#f0f2f5; }

/* Header */
header { display:flex; justify-content:space-between; align-items:center; padding:10px 20px; background:#2563eb; color:#fff; position:sticky; top:0; z-index:1000; }
header h1 { font-size:24px; font-weight:bold; text-shadow:2px 2px 5px #000; }
header button { padding:8px 15px; font-size:16px; border:none; border-radius:5px; cursor:pointer; box-shadow: 2px 2px 5px #000; }
header button:hover { opacity:0.9; }

/* Cards Grid */
.grid { display:grid; grid-template-columns: repeat(auto-fit,minmax(280px,1fr)); gap:15px; padding:20px; }
.card { background:#fff; border-radius:10px; overflow:hidden; position:relative; box-shadow:0 4px 6px rgba(0,0,0,0.2); cursor:pointer; transition:transform 0.2s; }
.card:hover { transform:scale(1.03); }
.card img { width:100%; height:200px; object-fit:cover; }
.card-content { padding:10px; }
.card-content h3 { margin-bottom:5px; font-size:18px; }
.card-content p { font-size:14px; color:#555; margin-bottom:5px; }

/* WhatsApp Button */
.whatsapp-btn { position:absolute; bottom:10px; right:10px; background:#25d366; color:#fff; padding:6px 10px; border-radius:5px; text-decoration:none; font-weight:bold; box-shadow:2px 2px 5px #000; }

/* Modal */
.modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); justify-content:center; align-items:center; z-index:2000; }
.modal-content { background:#fff; border-radius:10px; padding:20px; max-width:90%; max-height:90%; overflow:auto; position:relative; }
.modal-content img { width:100%; margin-bottom:10px; border-radius:5px; }

/* Admin Buttons */
.admin-btn { padding:5px 10px; margin-right:5px; font-weight:bold; border:none; border-radius:5px; cursor:pointer; box-shadow:2px 2px 5px #000; }
.approve { background:green; color:#fff; }
.reject { background:red; color:#fff; animation: blink 1s infinite; }
@keyframes blink { 0%,50%,100%{opacity:1;}25%,75%{opacity:0;} }

/* Pagination */
.pagination { display:flex; justify-content:center; gap:10px; padding:10px; }
.page-btn { padding:5px 10px; border:none; border-radius:5px; cursor:pointer; box-shadow:2px 2px 5px #000; }
.page-btn.active { background:#2563eb; color:#fff; }

/* Upload Form */
#uploadForm { padding:20px; background:#fff; margin:20px; border-radius:10px; box-shadow:0 4px 6px rgba(0,0,0,0.2); }
#uploadForm input, #uploadForm textarea { width:100%; padding:8px; margin-bottom:10px; border-radius:5px; border:1px solid #ccc; }
#uploadForm button { padding:8px 15px; border:none; border-radius:5px; cursor:pointer; background:#2563eb; color:#fff; box-shadow:2px 2px 5px #000; }
</style>
</head>
<body>

<header>
  <h1>Zara</h1>
  <button id="authBtn">Login</button>
</header>

<div id="uploadForm" style="display:none;">
  <h3>Post Property</h3>
  <input type="text" id="title" placeholder="Property Title" required>
  <textarea id="desc" placeholder="Description" required></textarea>
  <input type="text" id="whatsapp" placeholder="WhatsApp Number" required>
  <input type="file" id="images" accept="image/*" multiple>
  <button id="postBtn">Post Property</button>
</div>

<div class="grid" id="propertyGrid"></div>

<div class="pagination" id="pagination"></div>

<div class="modal" id="modal">
  <div class="modal-content" id="modalContent"></div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

<script>
// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyDTj2n1yhr1sFmuyBZ-jUwOmx1YqAN5QjA",
  authDomain: "property-20d6d.firebaseapp.com",
  databaseURL: "https://property-20d6d-default-rtdb.firebaseio.com",
  projectId: "property-20d6d",
  storageBucket: "property-20d6d.appspot.com",
  messagingSenderId: "916859697394",
  appId: "1:916859697394:web:2a8f9ad2d62f8306dcb86b"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

let currentUser = null;
const adminEmails = ["admin@example.com"]; // Admin email

// Elements
const authBtn = document.getElementById("authBtn");
const uploadForm = document.getElementById("uploadForm");
const propertyGrid = document.getElementById("propertyGrid");
const modal = document.getElementById("modal");
const modalContent = document.getElementById("modalContent");
const pagination = document.getElementById("pagination");

let allProperties = [];
let currentPage = 1;
const perPage = 10;

// Login/Logout
authBtn.addEventListener("click", ()=>{
  if(currentUser){
    auth.signOut();
  } else {
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider);
  }
});

auth.onAuthStateChanged(user=>{
  currentUser = user;
  if(user){
    authBtn.textContent = "Logout";
    uploadForm.style.display = "block";
  } else {
    authBtn.textContent = "Login";
    uploadForm.style.display = "none";
  }
});

// Post Property
document.getElementById("postBtn").addEventListener("click", async ()=>{
  const title = document.getElementById("title").value;
  const desc = document.getElementById("desc").value;
  const whatsapp = document.getElementById("whatsapp").value;
  const files = document.getElementById("images").files;

  if(!title || !desc || !whatsapp || files.length===0) { alert("Complete form"); return; }
  if(files.length>5){ alert("Max 5 images"); return; }

  const urls = [];
  for(let i=0;i<files.length;i++){
    const formData = new FormData();
    formData.append("image", files[i]);
    const res = await fetch(`https://api.imgbb.com/1/upload?key=cad1f0dbfbd25346460789376cc2d7d5`, {method:"POST", body:formData});
    const data = await res.json();
    urls.push(data.data.url);
  }

  const propRef = db.ref("properties").push();
  propRef.set({
    title, desc, whatsapp, images:urls, userEmail:currentUser.email, approved:false, timestamp:Date.now()
  });

  alert("Posted! Waiting for approval.");
  document.getElementById("title").value="";
  document.getElementById("desc").value="";
  document.getElementById("whatsapp").value="";
  document.getElementById("images").value="";
});

// Fetch & Display Properties
db.ref("properties").on("value", snapshot=>{
  allProperties = [];
  snapshot.forEach(child=>{
    const prop = child.val();
    prop.key = child.key;
    allProperties.push(prop);
  });
  renderPage(currentPage);
});

function renderPage(page){
  propertyGrid.innerHTML="";
  const start = (page-1)*perPage;
  const end = start+perPage;
  const pageProps = allProperties.slice(start,end);

  pageProps.forEach(prop=>{
    const card = document.createElement("div");
    card.className="card";

    const img = document.createElement("img");
    img.src = prop.images[0];
    card.appendChild(img);

    const content = document.createElement("div");
    content.className="card-content";
    content.innerHTML = `<h3>${prop.title}</h3><p>${prop.desc}</p>`;
    card.appendChild(content);

    const waBtn = document.createElement("a");
    waBtn.href=`https://wa.me/${prop.whatsapp}`;
    waBtn.target="_blank";
    waBtn.className="whatsapp-btn";
    waBtn.textContent="WhatsApp";
    card.appendChild(waBtn);

    // Modal full screen
    card.addEventListener("click", e=>{
      if(e.target!==waBtn){
        modal.style.display="flex";
        modalContent.innerHTML="";
        prop.images.forEach(src=>{
          const im = document.createElement("img");
          im.src=src;
          modalContent.appendChild(im);
        });
        const info = document.createElement("div");
        info.innerHTML=`<h3>${prop.title}</h3><p>${prop.desc}</p>`;
        modalContent.appendChild(info);

        // Admin buttons
        if(currentUser && adminEmails.includes(currentUser.email)){
          const approveBtn = document.createElement("button");
          approveBtn.className="admin-btn approve";
          approveBtn.textContent="Approve";
          approveBtn.onclick = ()=>{
            db.ref("properties/"+prop.key).update({approved:true});
            modal.style.display="none";
          }
          const rejectBtn = document.createElement("button");
          rejectBtn.className="admin-btn reject";
          rejectBtn.textContent="Reject";
          rejectBtn.onclick = ()=>{
            db.ref("properties/"+prop.key).update({approved:false});
            modal.style.display="none";
          }
          modalContent.appendChild(approveBtn);
          modalContent.appendChild(rejectBtn);
        }

        // Delete for poster
        if(currentUser && currentUser.email===prop.userEmail){
          const delBtn = document.createElement("button");
          delBtn.className="admin-btn reject";
          delBtn.textContent="Delete";
          delBtn.onclick = ()=>{
            db.ref("properties/"+prop.key).remove();
            modal.style.display="none";
          }
          modalContent.appendChild(delBtn);
        }
      }
    });

    propertyGrid.appendChild(card);
  });

  // Pagination
  const totalPages = Math.ceil(allProperties.length/perPage);
  pagination.innerHTML="";
  for(let i=1;i<=totalPages;i++){
    const btn = document.createElement("button");
    btn.className="page-btn "+(i===page?"active":"");
    btn.textContent=i;
    btn.onclick=()=>{ currentPage=i; renderPage(currentPage); }
    pagination.appendChild(btn);
  }
}

// Close modal
modal.addEventListener("click", e=>{
  if(e.target===modal) modal.style.display="none";
});
</script>

</body>
</html>
