<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Zara Fix</title>
  <style>
    body {margin:0; font-family:Arial, sans-serif; background:#f9f9f9;}
    header {
      background:linear-gradient(45deg,#ff0080,#7928ca);
      color:white; padding:10px 20px;
      display:flex; justify-content:space-between; align-items:center;
    }
    .logo {font-size:28px; font-weight:bold; text-shadow:2px 2px 6px black;}
    .menu {display:flex; gap:20px;}
    .dropdown {position:relative;}
    .dropdown button {
      background:#fff; color:#333; padding:6px 12px; border:none;
      border-radius:8px; font-weight:bold; cursor:pointer;
      box-shadow:2px 2px 6px rgba(0,0,0,0.3);
    }
    .dropdown-content {
      display:none; position:absolute; top:100%; left:0;
      background:#fff; min-width:160px; border-radius:8px;
      box-shadow:0 8px 16px rgba(0,0,0,0.2); z-index:10;
    }
    .dropdown-content a {
      color:black; padding:8px 12px; display:block; text-decoration:none;
    }
    .dropdown:hover .dropdown-content {display:block;}
    #login-btn {
      background:#fff; color:#333; padding:6px 12px; border:none;
      border-radius:8px; font-weight:bold; cursor:pointer;
      box-shadow:2px 2px 6px rgba(0,0,0,0.3);
    }

    /* Shop Form */
    .shop-form {
      max-width:400px; margin:20px auto; padding:15px;
      background:white; border-radius:12px;
      box-shadow:0 4px 10px rgba(0,0,0,0.15);
    }
    .shop-form input, .shop-form select {
      width:100%; margin:6px 0; padding:8px;
      border:1px solid #ccc; border-radius:8px;
    }
    .shop-form button {
      width:100%; margin-top:10px; padding:10px;
      border:none; border-radius:10px; font-weight:bold;
      background:linear-gradient(45deg,#7928ca,#ff0080); color:white;
      box-shadow:2px 2px 6px rgba(0,0,0,0.3); cursor:pointer;
    }

    /* Grid + Cards */
    .grid {
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(160px,1fr));
      gap:10px; padding:15px;
    }
    .card {
      background:white; border-radius:12px;
      padding:10px; box-shadow:2px 2px 10px rgba(0,0,0,0.2);
      cursor:pointer; transition:transform 0.3s;
    }
    .card img {width:100%; height:150px; object-fit:cover; border-radius:10px;}
    .card.expanded {
      position:fixed; top:50%; left:50%;
      transform:translate(-50%,-50%);
      width:90%; max-height:90vh; overflow:auto; z-index:1000;
    }
    .card.expanded img {
      width:100%; height:auto; max-height:80vh;
      object-fit:contain; border-radius:10px;
    }
    .whatsapp-btn, .reject-btn, .approve-btn, .delete-btn {
      margin-top:5px; padding:8px 12px;
      border:none; border-radius:10px; font-weight:bold;
      display:block; cursor:pointer;
      box-shadow:2px 2px 5px rgba(0,0,0,0.3);
    }
    .whatsapp-btn {background:green; color:white;}
    .reject-btn {background:red; color:white;}
    .approve-btn {background:blue; color:white;}
    .delete-btn {background:orange; color:white;}
    .pending {background:#fff8e6;}
    .rejected {background:#ffe6e6;}

    /* Admin Panel */
    .admin-panel {
      max-width:600px; margin:20px auto; padding:15px;
      background:white; border-radius:12px;
      box-shadow:0 4px 10px rgba(0,0,0,0.15);
    }
    .filter-bar {padding:10px; text-align:center;}
    .filter-bar select {padding:6px 10px; border-radius:8px;}
  </style>
</head>
<body>
<header>
  <div class="logo">Zara Fix</div>
  <div class="menu">
    <div class="dropdown">
      <button>Services</button>
      <div class="dropdown-content" id="menu1">
        <a href="#">Property</a>
        <a href="#">Ambulance</a>
        <a href="#">All Services</a>
      </div>
    </div>
    <div class="dropdown">
      <button>Info</button>
      <div class="dropdown-content" id="menu2">
        <a href="#">Provider</a>
        <a href="#">About</a>
        <a href="#">Contact</a>
        <a href="#">Privacy Policy</a>
      </div>
    </div>
  </div>
  <button id="login-btn">Login</button>
</header>

<!-- Shop Form -->
<div id="shopFormContainer" style="display:none;">
  <form class="shop-form" id="shopForm">
    <h3>नया Product Add करें</h3>
    <input type="text" id="pName" placeholder="Product Name" required/>
    <input type="number" id="pPrice" placeholder="Price" required/>
    <input type="number" id="pDiscount" placeholder="Discount (%)" required/>
    <input type="text" id="pWhatsapp" placeholder="Shop WhatsApp Number" required/>
    <input type="text" id="pCategory" placeholder="Category" required/>
    <input type="text" id="pImage" placeholder="Image URL" required/>
    <button type="submit">Submit</button>
  </form>
</div>

<div class="filter-bar">
  <select id="categoryFilter">
    <option value="">सभी Categories</option>
  </select>
</div>

<div class="grid" id="productGrid"></div>

<!-- Admin Panel -->
<div id="adminPanel" class="admin-panel" style="display:none;">
  <h3>Admin Panel</h3>
  <p>Approve / Reject Products यहाँ से करें</p>
</div>

<!-- Firebase -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getDatabase, ref, onValue, push, update, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
  import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAa8htkfGK-4D3cIQVyxT3o_8WMvghkr-8",
    authDomain: "loot-lo-15328.firebaseapp.com",
    databaseURL: "https://loot-lo-15328-default-rtdb.firebaseio.com",
    projectId: "loot-lo-15328",
    storageBucket: "loot-lo-15328.appspot.com",
    messagingSenderId: "677769861892",
    appId: "1:677769861892:web:bb235cb8479aeee9b58e51"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const auth = getAuth(app);
  const provider = new GoogleAuthProvider();

  const loginBtn = document.getElementById("login-btn");
  const shopFormContainer = document.getElementById("shopFormContainer");
  const shopForm = document.getElementById("shopForm");
  const productGrid = document.getElementById("productGrid");
  const filter = document.getElementById("categoryFilter");
  const adminPanel = document.getElementById("adminPanel");

  loginBtn.onclick = async () => {
    if(auth.currentUser) signOut(auth);
    else await signInWithPopup(auth, provider);
  };

  onAuthStateChanged(auth, user => {
    if(user){
      loginBtn.textContent = "Logout ("+user.email+")";
      shopFormContainer.style.display="block";
      if(user.email==="zarasamajiksevasanstha@gmail.com"){
        adminPanel.style.display="block";
      } else adminPanel.style.display="none";
    } else {
      loginBtn.textContent="Login";
      shopFormContainer.style.display="none";
      adminPanel.style.display="none";
    }
  });

  shopForm.onsubmit = e => {
    e.preventDefault();
    const user=auth.currentUser;
    if(!user) return alert("Login required");
    const newRef=push(ref(db,"products"));
    update(newRef,{
      name:pName.value, price:pPrice.value, discount:pDiscount.value,
      whatsapp:pWhatsapp.value, category:pCategory.value,
      images:[pImage.value], shopEmail:user.email,
      status:"pending", createdAt:Date.now()
    });
    shopForm.reset();
    alert("Product submitted for approval");
  };

  function loadProducts(){
    onValue(ref(db,"products"), snapshot=>{
      let products=[];
      snapshot.forEach(child=>{
        let p=child.val(); p.key=child.key;
        products.push(p);
      });
      products.sort((a,b)=>(b.createdAt||0)-(a.createdAt||0));
      renderProducts(products);
    });
  }

  function renderProducts(products){
    productGrid.innerHTML="";
    let cats=new Set();
    products.forEach(p=>{if(p.category) cats.add(p.category);});
    filter.innerHTML='<option value="">सभी Categories</option>';
    cats.forEach(c=> filter.innerHTML+=`<option value="${c}">${c}</option>`);

    let selected=filter.value;
    products.forEach(p=>{
      if(selected && p.category!==selected) return;
      const div=document.createElement("div");
      div.className="card"+(p.status==="pending"?" pending":"")+(p.status==="rejected"?" rejected":"");
      div.innerHTML=`
        <img src="${p.images?p.images[0]:""}"/>
        <h3>${p.name}</h3>
        <p>₹${p.price} - ${p.discount}% off</p>
        <p>${p.category||""}</p>
        <button class="whatsapp-btn">WhatsApp</button>
        ${
          auth.currentUser && auth.currentUser.email===p.shopEmail
          ? `<button class="delete-btn">Delete</button>` : ""
        }
        ${
          auth.currentUser && auth.currentUser.email==="zarasamajiksevasanstha@gmail.com"
          ? `<button class="approve-btn">Approve</button>
             <button class="reject-btn">Reject</button>` : ""
        }
      `;
      div.querySelector(".whatsapp-btn").onclick=()=> {
        window.open(`https://wa.me/${p.whatsapp}?text=हमें आपका product "${p.name}" पसंद आया है, कृपया पूरी जानकारी दें`,"_blank");
      };
      if(div.querySelector(".delete-btn")){
        div.querySelector(".delete-btn").onclick=()=> {
          if(confirm("Delete your product?")){
            remove(ref(db,"products/"+p.key));
          }
        };
      }
      if(div.querySelector(".approve-btn")){
        div.querySelector(".approve-btn").onclick=()=> update(ref(db,"products/"+p.key),{status:"approved"});
      }
      if(div.querySelector(".reject-btn")){
        div.querySelector(".reject-btn").onclick=()=> update(ref(db,"products/"+p.key),{status:"rejected"});
      }
      div.onclick=(e)=>{if(e.target.tagName!=="BUTTON") div.classList.toggle("expanded");};
      productGrid.appendChild(div);
    });
  }

  filter.onchange=()=> loadProducts();
  loadProducts();
</script>
</body>
</html>
