<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ZaraFix Property Listing</title>
<style>
  body { font-family: Arial, sans-serif; background: #f0f2f5; margin:0; padding:0; }
  header { display:flex; justify-content:space-between; align-items:center; padding:10px 20px; background:#2563eb; color:#fff; }
  .logo { font-size:24px; font-weight:bold; }
  .login-btn { background:#fff; color:#2563eb; border:none; padding:8px 16px; cursor:pointer; border-radius:5px; }

  .grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(280px,1fr)); gap:15px; padding:20px; }
  .card { background:#fff; border-radius:10px; padding:10px; box-shadow:0 4px 6px rgba(0,0,0,0.1); position:relative; }
  .card img { width:100%; height:200px; object-fit:cover; border-radius:10px; }
  .card .blink { animation: blinkAnim 1s infinite; }
  @keyframes blinkAnim { 0%,100% {opacity:1;} 50% {opacity:0.3;} }

  .card h3 { margin:10px 0 5px; font-size:18px; }
  .card p { margin:5px 0; font-size:14px; }
  .card button { margin-top:5px; padding:5px 10px; cursor:pointer; border:none; border-radius:5px; }

  /* Modal */
  .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.6); justify-content:center; align-items:center; }
  .modal-content { background:#fff; padding:20px; border-radius:10px; width:90%; max-width:600px; max-height:90%; overflow-y:auto; }
  .modal img { width:100%; max-height:300px; object-fit:contain; }
  .modal .close { float:right; cursor:pointer; font-size:20px; font-weight:bold; }
</style>
</head>
<body>
<header>
  <div class="logo">ZaraFix</div>
  <button class="login-btn" id="loginBtn">Login</button>
</header>
<div class="grid" id="postsGrid"></div>

<div class="modal" id="modal">
  <div class="modal-content">
    <span class="close" id="modalClose">&times;</span>
    <div id="modalBody"></div>
  </div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script>
// Firebase config
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_AUTH_DOMAIN",
  databaseURL: "YOUR_DB_URL",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_STORAGE_BUCKET",
  messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
  appId: "YOUR_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const auth = firebase.auth();

let currentUser = null;
let isAdmin = false;
const admins = ["admin@example.com"]; // admin emails array

// Login
document.getElementById('loginBtn').addEventListener('click', ()=>{
  const provider = new firebase.auth.GoogleAuthProvider();
  auth.signInWithPopup(provider);
});

auth.onAuthStateChanged(user => {
  if(user){
    currentUser = user;
    document.getElementById('loginBtn').style.display='none';
    isAdmin = admins.includes(user.email);
    fetchPosts();
  }
});

// Fetch posts
function fetchPosts(){
  db.ref('posts').on('value', snapshot => {
    const data = snapshot.val() || {};
    renderPosts(Object.entries(data));
  });
}

// Render posts
function renderPosts(posts){
  const grid = document.getElementById('postsGrid');
  grid.innerHTML='';
  posts.forEach(([id, post])=>{
    const card = document.createElement('div');
    card.className='card';
    if(post.approved !== true) card.classList.add('blink');

    let images = post.images ? post.images.join(',') : '';
    card.innerHTML=`
      <img src="${post.images ? post.images[0] : ''}" alt="">
      <h3>${post.title || ''}</h3>
      <p>${post.description || ''}</p>
      <p>Price: ${post.price || ''}</p>
      <p>Location: ${post.location || ''}</p>
      <p>Area: ${post.area || ''}, BHK: ${post.bhk || ''}</p>
      <p>Floor: ${post.floor || ''}, Facing: ${post.facing || ''}</p>
      <button onclick="openModal('${id}')">View</button>
      ${isAdmin && !post.approved ? `<button onclick="approvePost('${id}')">Approve</button>` : ''}
      ${currentUser && (currentUser.email===post.poster || isAdmin) ? `<button onclick="deletePost('${id}')">Delete</button>` : ''}
      <a href="https://wa.me/${post.whatsapp}" target="_blank">WhatsApp</a>
    `;
    grid.appendChild(card);
  });
}

// Approve post
function approvePost(id){
  db.ref('posts/'+id).update({approved:true});
}

// Delete post
function deletePost(id){
  if(confirm('Are you sure?')){
    db.ref('posts/'+id).remove();
  }
}

// Modal
const modal = document.getElementById('modal');
const modalBody = document.getElementById('modalBody');
document.getElementById('modalClose').onclick=()=>{ modal.style.display='none'; }
window.onclick = function(event){ if(event.target==modal) modal.style.display='none'; }

function openModal(id){
  db.ref('posts/'+id).once('value').then(snap=>{
    const post = snap.val();
    if(!post) return;
    let imgHTML = post.images ? post.images.map(src=>`<img src="${src}">`).join('') : '';
    modalBody.innerHTML = `
      ${imgHTML}
      <h2>${post.title || ''}</h2>
      <p>${post.description || ''}</p>
      <p>Price: ${post.price || ''}</p>
      <p>Location: ${post.location || ''}</p>
      <p>Area: ${post.area || ''}, BHK: ${post.bhk || ''}</p>
      <p>Floor: ${post.floor || ''}, Facing: ${post.facing || ''}</p>
      <a href="https://wa.me/${post.whatsapp}" target="_blank">WhatsApp</a>
    `;
    modal.style.display='flex';
  });
}
</script>
</body>
</html>
