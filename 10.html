<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Real Estate</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <style>
    body{font-family:sans-serif;margin:0;padding:0;background:#f5f5f5}
    header{display:flex;justify-content:space-between;align-items:center;padding:10px 20px;background:#222;color:#fff}
    .logo{font-size:20px;font-weight:bold;text-shadow:2px 2px 5px #000}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:14px;padding:10px}
    .card{background:#fff;border-radius:14px;box-shadow:0 4px 10px rgba(0,0,0,0.1);overflow:hidden;cursor:pointer;transition:.2s}
    .card:hover{transform:translateY(-4px)}
    .thumb{width:100%;height:180px;object-fit:cover}
    .desc{padding:8px;font-size:14px}
    h4{margin:8px;font-size:16px}
    .wa-btn{display:inline-block;margin:8px;padding:8px 12px;border-radius:8px;background:linear-gradient(145deg,#25D366,#128C7E);color:#fff;text-decoration:none;font-weight:600;box-shadow:2px 2px 6px rgba(0,0,0,.3)}
    .badge{padding:4px 8px;border-radius:6px;font-size:12px;display:inline-block;margin:6px}
    .badge.approved{background:#22c55e;color:#fff}
    .badge.rejected{background:#ef4444;color:#fff}
    .btn-3d{padding:8px 14px;margin:4px;border:none;border-radius:8px;font-weight:600;color:white;cursor:pointer;box-shadow:2px 2px 6px rgba(0,0,0,.3),-2px -2px 6px rgba(255,255,255,.2);transition:all .2s}
    .btn-3d:hover{transform:translateY(-2px)}
    .btn-approve{background:linear-gradient(145deg,#22c55e,#15803d)}
    .btn-reject{background:linear-gradient(145deg,#ef4444,#991b1b)}
    .btn-delete{background:linear-gradient(145deg,#3b82f6,#1e40af)}
    form{padding:10px;background:#fff;margin:10px;border-radius:10px;box-shadow:0 4px 10px rgba(0,0,0,0.1)}
    form input, form select, form textarea{display:block;width:100%;padding:8px;margin:6px 0;border-radius:6px;border:1px solid #ccc}
    form button{width:100%}
  </style>
</head>
<body>
  <header>
    <div class="logo">üè† RealEstate 3D</div>
    <div id="authBtns">
      <button id="loginBtn" class="btn-3d btn-approve">Login</button>
      <button id="logoutBtn" class="btn-3d btn-reject" style="display:none">Logout</button>
    </div>
  </header>

  <!-- Post Form -->
  <form id="postForm" style="display:none">
    <h3>Post Property</h3>
    <input type="number" id="price" placeholder="Price" required>
    <input type="text" id="bhk" placeholder="BHK" required>
    <input type="text" id="ptype" placeholder="Property Type" required>
    <input type="text" id="address" placeholder="Address" required>
    <input type="text" id="phone" placeholder="Your WhatsApp Number" required>

    <!-- üîπ New Dropdown -->
    <label for="posterType">Poster Type:</label>
    <select id="posterType" required>
      <option value="Builder">Builder</option>
      <option value="Owner">Owner</option>
      <option value="Agent">Agent</option>
    </select>

    <input type="file" id="images" multiple accept="image/*" />
    <button type="submit" class="btn-3d btn-approve">Submit Post</button>
  </form>

  <div id="posts" class="grid"></div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDTj2n1yhr1sFmuyBZ-jUwOmx1YqAN5QjA",
      authDomain: "property-20d6d.firebaseapp.com",
      databaseURL: "https://property-20d6d-default-rtdb.firebaseio.com",
      projectId: "property-20d6d",
      storageBucket: "property-20d6d.appspot.com",
      messagingSenderId: "916859697394",
      appId: "1:916859697394:web:2a8f9ad2d62f8306dcb86b"
    };
    firebase.initializeApp(firebaseConfig);
    const db=firebase.database();
    const auth=firebase.auth();

    let currentUser=null;
    let isAdmin=false;
    const adminEmail="zarasamajiksevasanstha@gmail.com";

    const loginBtn=document.getElementById('loginBtn');
    const logoutBtn=document.getElementById('logoutBtn');
    const postForm=document.getElementById('postForm');
    const postsDiv=document.getElementById('posts');

    loginBtn.onclick=()=>auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
    logoutBtn.onclick=()=>auth.signOut();

    auth.onAuthStateChanged(u=>{
      if(u){
        currentUser=u;
        isAdmin=(u.email===adminEmail);
        loginBtn.style.display="none";
        logoutBtn.style.display="inline-block";
        postForm.style.display="block";
      }else{
        currentUser=null;isAdmin=false;
        loginBtn.style.display="inline-block";
        logoutBtn.style.display="none";
        postForm.style.display="none";
      }
      loadPosts();
    });

    async function uploadImages(files){
      const urls=[];
      for(let f of files){
        const fd=new FormData();
        fd.append("image",f);
        const res=await fetch("https://api.imgbb.com/1/upload?key=cad1f0dbfbd25346460789376cc2d7d5",{method:"POST",body:fd});
        const data=await res.json();
        if(data.data) urls.push(data.data.url);
      }
      return urls;
    }

    postForm.onsubmit=async e=>{
      e.preventDefault();
      if(!currentUser) return alert("Login first");

      const submitBtn=postForm.querySelector("button[type=submit]");
      submitBtn.disabled=true;
      submitBtn.textContent="‚è≥ Submitting...";

      const post={
        price:document.getElementById('price').value,
        bhk:document.getElementById('bhk').value,
        propertyType:document.getElementById('ptype').value,
        address:document.getElementById('address').value,
        posterPhone:document.getElementById('phone').value,
        posterType:document.getElementById('posterType').value,
        posterName:currentUser.displayName,
        posterUid:currentUser.uid,
        status:"pending",
        created:Date.now()
      };

      const files=document.getElementById('images').files;
      if(files.length>0) post.images=await uploadImages(files);

      db.ref('posts').push(post,(err)=>{
        if(err){alert("‚ùå Error while submitting. Try again.");}
        else{alert("‚úÖ Post submitted! Waiting for approval.");postForm.reset();}
        submitBtn.disabled=false;
        submitBtn.textContent="Submit Post";
      });
    };

    function makeCard(p){
      const card=document.createElement('div');
      card.className='card';
      const img=document.createElement('img');
      img.className='thumb';
      img.src=(p.images&&p.images[0])||'https://via.placeholder.com/400';
      card.appendChild(img);
      const h=document.createElement('h4');
      h.textContent=`${p.price} ‚Äî ${p.bhk} ${p.propertyType}`;
      card.appendChild(h);
      const d=document.createElement('div');
      d.className='desc';
      d.innerHTML=`üìç ${p.address}<br>üë§ ${p.posterName||''} (${p.posterType||''})`;
      card.appendChild(d);

      const badge=document.createElement('div');
      badge.className='badge '+(p.status||'pending');
      badge.textContent=p.status||'pending';
      card.appendChild(badge);

      const wa=document.createElement('a');
      wa.className='wa-btn';
      wa.href=`https://wa.me/${(p.posterPhone||'').replace(/\D/g,'')}`;
      wa.target='_blank';wa.textContent='WhatsApp';
      card.appendChild(wa);

      if(isAdmin){
        const approve=document.createElement('button');
        approve.className='btn-3d btn-approve';
        approve.textContent='Approve';
        approve.onclick=(e)=>{e.stopPropagation();db.ref('posts/'+p.id).update({status:'approved'});};
        const reject=document.createElement('button');
        reject.className='btn-3d btn-reject';
        reject.textContent='Reject';
        reject.onclick=(e)=>{e.stopPropagation();db.ref('posts/'+p.id).update({status:'rejected'});};
        card.appendChild(approve);
        card.appendChild(reject);
      }
      if(currentUser && currentUser.uid===p.posterUid){
        const del=document.createElement('button');
        del.className='btn-3d btn-delete';
        del.textContent='Delete';
        del.onclick=(e)=>{e.stopPropagation();if(confirm("Delete this post?"))db.ref('posts/'+p.id).remove();};
        card.appendChild(del);
      }
      return card;
    }

    function loadPosts(){
      db.ref('posts').on('value',snap=>{
        postsDiv.innerHTML='';
        snap.forEach(ch=>{
          const post=ch.val();post.id=ch.key;
          if(isAdmin || post.status==='approved' || (currentUser && post.posterUid===currentUser.uid)){
            postsDiv.appendChild(makeCard(post));
          }
        });
      });
    }
  </script>
</body>
</html>
