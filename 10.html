<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zara Real Estate</title>
<style>
  body{margin:0;font-family:sans-serif;background:#f0f2f5;}
  header{background:#2563eb;color:#fff;padding:15px;display:flex;justify-content:space-between;align-items:center;box-shadow:0 4px 6px rgba(0,0,0,0.1);}
  .logo{font-weight:bold;font-size:24px;text-shadow:2px 2px 5px #000;}
  .btn{padding:8px 15px;margin:0 5px;border:none;border-radius:5px;cursor:pointer;box-shadow:0 4px 6px rgba(0,0,0,0.2);}
  .btn-login{background:#fff;color:#2563eb;}
  .btn-logout{background:#ff4d4d;color:#fff;}
  #uploadForm{display:none;padding:20px;background:#fff;margin:15px;border-radius:10px;box-shadow:0 4px 6px rgba(0,0,0,0.1);}
  #uploadForm input,#uploadForm textarea{width:100%;padding:10px;margin:5px 0;border:1px solid #ccc;border-radius:5px;}
  #properties{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:15px;padding:15px;}
  .card{background:#fff;padding:15px;border-radius:10px;position:relative;box-shadow:0 4px 6px rgba(0,0,0,0.1);cursor:pointer;transition:transform 0.3s;}
  .card:hover{transform:scale(1.03);}
  .card h3{margin:5px 0;}
  .card p{margin:5px 0;color:#555;}
  .card img{width:100%;border-radius:10px;object-fit:cover;max-height:200px;}
  .whatsapp-btn{position:absolute;top:10px;right:10px;background:#25D366;color:#fff;padding:5px 10px;border-radius:5px;text-decoration:none;box-shadow:0 2px 4px rgba(0,0,0,0.2);}
  .admin-btn{margin:5px;padding:5px 10px;border:none;border-radius:5px;color:#fff;cursor:pointer;box-shadow:0 2px 4px rgba(0,0,0,0.3);}
  .approve{background:green;}
  .reject{background:red;}
  .blink{animation:blink 1s infinite;}
  @keyframes blink{0%,50%,100%{opacity:1;}25%,75%{opacity:0;}}
  /* Modal */
  #modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);justify-content:center;align-items:center;}
  #modal img{max-width:90%;max-height:90%;border-radius:10px;}
  .pagination{display:flex;justify-content:center;margin:15px;}
  .pagination button{padding:8px 15px;margin:0 5px;border:none;border-radius:5px;cursor:pointer;background:#2563eb;color:#fff;box-shadow:0 4px 6px rgba(0,0,0,0.2);}
</style>
</head>
<body>

<header>
  <div class="logo">Zara 3D</div>
  <div>
    <button id="loginBtn" class="btn btn-login">Login</button>
    <button id="logoutBtn" class="btn btn-logout" style="display:none;">Logout</button>
  </div>
</header>

<div id="uploadForm">
  <h3>Post Property</h3>
  <input type="text" id="title" placeholder="Property Title" required>
  <input type="text" id="address" placeholder="Property Address" required>
  <textarea id="desc" placeholder="Description" required></textarea>
  <input type="text" id="whatsapp" placeholder="WhatsApp Number" required>
  <input type="file" id="images" accept="image/*" multiple>
  <button id="postBtn" class="btn">Post Property</button>
</div>

<div id="properties"></div>

<div class="pagination">
  <button id="prevBtn">Prev</button>
  <button id="nextBtn">Next</button>
</div>

<div id="modal" onclick="this.style.display='none'">
  <img id="modalImg" src="">
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDTj2n1yhr1sFmuyBZ-jUwOmx1YqAN5QjA",
  authDomain: "property-20d6d.firebaseapp.com",
  databaseURL: "https://property-20d6d-default-rtdb.firebaseio.com",
  projectId: "property-20d6d",
  storageBucket: "property-20d6d.appspot.com",
  messagingSenderId: "916859697394",
  appId: "1:916859697394:web:2a8f9ad2d62f8306dcb86b"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const auth = firebase.auth();

const adminEmails = ["admin@example.com"]; // change admin email

let currentUser = null;
let propertiesData = [];
let currentPage = 0;
const cardsPerPage = 10;

// Login/Logout buttons
const loginBtn = document.getElementById("loginBtn");
const logoutBtn = document.getElementById("logoutBtn");
const uploadForm = document.getElementById("uploadForm");

loginBtn.onclick = ()=>{
  const provider = new firebase.auth.GoogleAuthProvider();
  auth.signInWithPopup(provider);
};

logoutBtn.onclick = ()=>{
  auth.signOut();
};

auth.onAuthStateChanged(user=>{
  currentUser = user;
  if(user){
    loginBtn.style.display="none";
    logoutBtn.style.display="inline-block";
    uploadForm.style.display="block";
  }else{
    loginBtn.style.display="inline-block";
    logoutBtn.style.display="none";
    uploadForm.style.display="none";
  }
});

// Imgbb API
const imgbbApiKey = "cad1f0dbfbd25346460789376cc2d7d5";

document.getElementById("postBtn").onclick=async ()=>{
  const title = document.getElementById("title").value;
  const address = document.getElementById("address").value;
  const desc = document.getElementById("desc").value;
  const whatsapp = document.getElementById("whatsapp").value;
  const files = document.getElementById("images").files;

  if(!title || !address || !desc || !whatsapp || files.length===0){alert("Complete form");return;}
  if(files.length>5){alert("Max 5 images");return;}

  let urls = [];
  for(let file of files){
    let form = new FormData();
    form.append("image",file);
    let res = await fetch(`https://api.imgbb.com/1/upload?key=${imgbbApiKey}`,{method:"POST",body:form});
    let data = await res.json();
    urls.push(data.data.url);
  }

  const propRef = db.ref("properties").push();
  propRef.set({
    title,address,desc,whatsapp,images:urls,userEmail:currentUser.email,approved:false,timestamp:Date.now()
  });

  alert("Property Posted!");
  document.getElementById("title").value="";
  document.getElementById("address").value="";
  document.getElementById("desc").value="";
  document.getElementById("whatsapp").value="";
  document.getElementById("images").value="";
};

// Fetch properties
function fetchProperties(){
  db.ref("properties").on("value",snap=>{
    propertiesData = [];
    snap.forEach(s=>{
      propertiesData.push({...s.val(), key:s.key});
    });
    displayProperties();
  });
}

function displayProperties(){
  const container = document.getElementById("properties");
  container.innerHTML="";
  const start = currentPage*cardsPerPage;
  const end = start+cardsPerPage;
  const pageData = propertiesData.slice(start,end);

  pageData.forEach(prop=>{
    const card = document.createElement("div");
    card.className="card";
    card.innerHTML=`<h3>${prop.title}</h3>
                    <p>${prop.address}</p>
                    <p>${prop.desc}</p>
                    <img src="${prop.images[0]}" alt="Property">`;
    const waBtn = document.createElement("a");
    waBtn.href = `https://wa.me/${prop.whatsapp}`;
    waBtn.target="_blank";
    waBtn.className="whatsapp-btn";
    waBtn.textContent="WhatsApp";
    card.appendChild(waBtn);

    // Zoom modal
    card.querySelector("img").onclick=()=>{document.getElementById("modal").style.display="flex";document.getElementById("modalImg").src=prop.images[0];};

    // Admin buttons
    if(currentUser && adminEmails.includes(currentUser.email)){
      const approveBtn=document.createElement("button");
      approveBtn.className="admin-btn approve";
      approveBtn.textContent="Approve";
      approveBtn.onclick=()=>db.ref("properties/"+prop.key).update({approved:true});
      const rejectBtn=document.createElement("button");
      rejectBtn.className="admin-btn reject";
      rejectBtn.textContent="Reject";
      rejectBtn.onclick=()=>db.ref("properties/"+prop.key).update({approved:false});
      card.appendChild(approveBtn);
      card.appendChild(rejectBtn);
    }else if(!prop.approved){
      card.classList.add("blink");
    }

    // Delete by poster
    if(currentUser && currentUser.email===prop.userEmail){
      const delBtn=document.createElement("button");
      delBtn.className="admin-btn reject";
      delBtn.textContent="Delete";
      delBtn.onclick=()=>db.ref("properties/"+prop.key).remove();
      card.appendChild(delBtn);
    }

    container.appendChild(card);
  });
}

// Pagination
document.getElementById("prevBtn").onclick=()=>{
  if(currentPage>0){currentPage--;displayProperties();}
};
document.getElementById("nextBtn").onclick=()=>{
  if((currentPage+1)*cardsPerPage<propertiesData.length){currentPage++;displayProperties();}
};

fetchProperties();
</script>

</body>
</html>
