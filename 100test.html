<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Zara Fix</title>
  <style>
    body {margin:0; font-family:Arial, sans-serif; background:#f9f9f9;}
    header {
      background:linear-gradient(45deg,#ff0080,#7928ca);
      color:white; padding:10px 20px;
      display:flex; justify-content:space-between; align-items:center;
    }
    .logo {font-size:28px; font-weight:bold; text-shadow:2px 2px 6px black;}
    .menu {display:flex; gap:20px;}
    .dropdown {position:relative;}
    .dropdown button {
      background:#fff; color:#333; padding:6px 12px; border:none;
      border-radius:8px; font-weight:bold; cursor:pointer;
      box-shadow:2px 2px 6px rgba(0,0,0,0.3);
    }
    .dropdown-content {
      display:none; position:absolute; top:100%; left:0;
      background:#fff; min-width:160px; border-radius:8px;
      box-shadow:0 8px 16px rgba(0,0,0,0.2); z-index:10;
    }
    .dropdown-content a {
      color:black; padding:8px 12px; display:block; text-decoration:none;
    }
    .dropdown:hover .dropdown-content {display:block;}
    #login-btn {
      background:#fff; color:#333; padding:6px 12px; border:none;
      border-radius:8px; font-weight:bold; cursor:pointer;
      box-shadow:2px 2px 6px rgba(0,0,0,0.3);
    }
    /* Shop Form */
    .shop-form {
      max-width:400px; margin:20px auto; padding:15px;
      background:white; border-radius:12px;
      box-shadow:0 4px 10px rgba(0,0,0,0.15);
    }
    .shop-form input, .shop-form select {
      width:100%; margin:6px 0; padding:8px;
      border:1px solid #ccc; border-radius:8px;
    }
    .shop-form button {
      width:100%; margin-top:10px; padding:10px;
      border:none; border-radius:10px; font-weight:bold;
      background:linear-gradient(45deg,#7928ca,#ff0080); color:white;
      box-shadow:2px 2px 6px rgba(0,0,0,0.3); cursor:pointer;
    }
  </style>
</head>
<body>
<header>
  <div class="logo">Zara Fix</div>
  <button id="login-btn">Login</button>
</header>

<!-- Shop Form -->
<div id="shopFormContainer" style="display:none;">
  <form class="shop-form" id="shopForm">
    <h3>नया Product Add करें</h3>
    <input type="text" id="shopName" placeholder="Shop Name" required/>
    <input type="text" id="pName" placeholder="Product Name" required/>
    <input type="number" id="pPrice" placeholder="Price (₹)" required/>
    <input type="number" id="pDiscount" placeholder="Discount (₹)" required/>
    <input type="text" id="pWhatsapp" placeholder="Shop WhatsApp Number" required/>
    
    <!-- Category Dropdown -->
    <select id="pCategory" required>
      <option value="">Select Category</option>
      <option value="Electronics">Electronics</option>
      <option value="Clothing">Clothing</option>
      <option value="Furniture">Furniture</option>
      <option value="Food">Food</option>
      <option value="Other">Other</option>
    </select>

    <!-- Image Upload -->
    <input type="file" id="pImage" accept="image/*" required/>
    <button type="submit">Submit</button>
  </form>
</div>

<div class="grid" id="productGrid"></div>

<!-- Firebase -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getDatabase, ref, push, update, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
  import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { getStorage, ref as sRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAa8htkfGK-4D3cIQVyxT3o_8WMvghkr-8",
    authDomain: "loot-lo-15328.firebaseapp.com",
    databaseURL: "https://loot-lo-15328-default-rtdb.firebaseio.com",
    projectId: "loot-lo-15328",
    storageBucket: "loot-lo-15328.appspot.com",
    messagingSenderId: "677769861892",
    appId: "1:677769861892:web:bb235cb8479aeee9b58e51"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const auth = getAuth(app);
  const provider = new GoogleAuthProvider();
  const storage = getStorage(app);

  const loginBtn = document.getElementById("login-btn");
  const shopFormContainer = document.getElementById("shopFormContainer");
  const shopForm = document.getElementById("shopForm");
  const productGrid = document.getElementById("productGrid");

  loginBtn.onclick = async () => {
    if(auth.currentUser) signOut(auth);
    else await signInWithPopup(auth, provider);
  };

  onAuthStateChanged(auth, user => {
    if(user){
      loginBtn.textContent = "Logout ("+user.email+")";
      shopFormContainer.style.display="block";
    } else {
      loginBtn.textContent="Login";
      shopFormContainer.style.display="none";
    }
  });

  shopForm.onsubmit = async e => {
    e.preventDefault();
    const user=auth.currentUser;
    if(!user) return alert("Login required");

    const file = document.getElementById("pImage").files[0];
    if(!file) return alert("Please upload an image");

    const storageRef = sRef(storage, "products/"+Date.now()+"_"+file.name);
    await uploadBytes(storageRef, file);
    const downloadURL = await getDownloadURL(storageRef);

    const newRef=push(ref(db,"products"));
    update(newRef,{
      shopName:shopName.value,
      name:pName.value,
      price:pPrice.value,
      discount:pDiscount.value,
      whatsapp:pWhatsapp.value,
      category:pCategory.value,
      images:[downloadURL],
      shopEmail:user.email,
      status:"pending",
      createdAt:Date.now()
    });

    shopForm.reset();
    alert("✅ Product submitted for approval");
  };

  function loadProducts(){
    onValue(ref(db,"products"), snapshot=>{
      productGrid.innerHTML="";
      snapshot.forEach(child=>{
        let p=child.val(); 
        let div=document.createElement("div");
        div.className="card";
        div.innerHTML=`
          <img src="${p.images?p.images[0]:""}" width="100%"/>
          <h3>${p.name}</h3>
          <p>Shop: ${p.shopName||""}</p>
          <p>₹${p.price} - ₹${p.discount} off</p>
          <p>${p.category||""}</p>
        `;
        productGrid.appendChild(div);
      });
    });
  }
  loadProducts();
</script>
</body>
</html>
