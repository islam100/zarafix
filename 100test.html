<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ZaraFix App</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .btn-3d {
      box-shadow: 0px 4px 0px #222;
      transform: translateY(0);
      transition: transform 0.1s, box-shadow 0.1s;
    }
    .btn-3d:active {
      transform: translateY(3px);
      box-shadow: 0px 1px 0px #222;
    }
    .card-3d {
      transition: transform 0.2s;
    }
    .card-3d:hover {
      transform: scale(1.03);
      z-index: 20;
    }
  </style>
</head>
<body class="bg-gray-900 text-white">
  <!-- Header -->
  <header class="flex justify-between items-center p-4 bg-gray-800 shadow-lg sticky top-0 z-50">
    <h1 class="text-3xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-pink-500 via-yellow-400 to-green-400 drop-shadow-lg">ZARA FIX</h1>
    <nav class="flex space-x-6">
      <select class="bg-gray-700 p-2 rounded">
        <option>All Services</option>
        <option>Property</option>
        <option>Ambulance</option>
        <option>Home</option>
      </select>
      <select class="bg-gray-700 p-2 rounded">
        <option>Provider</option>
        <option>About</option>
        <option>Contact</option>
        <option>Privacy Policy</option>
      </select>
    </nav>
    <div id="authSection">
      <button onclick="login()" class="btn-3d bg-green-500 px-4 py-2 rounded">Login with Google</button>
    </div>
  </header>

  <!-- Main -->
  <main class="p-4 grid grid-cols-1 sm:grid-cols-2 gap-4" id="listing"></main>

  <!-- Firebase + Logic -->
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAa8htkfGK-4D3cIQVyxT3o_8WMvghkr-8",
      authDomain: "loot-lo-15328.firebaseapp.com",
      databaseURL: "https://loot-lo-15328-default-rtdb.firebaseio.com",
      projectId: "loot-lo-15328",
      storageBucket: "loot-lo-15328.appspot.com",
      messagingSenderId: "677769861892",
      appId: "1:677769861892:web:bb235cb8479aeee9b58e51"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();

    const ADMIN_EMAIL = "zarasamajiksevasanstha@gmail.com";
    let currentUser = null;

    function login(){
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider);
    }
    function logout(){ auth.signOut(); }

    auth.onAuthStateChanged(user=>{
      currentUser = user;
      document.getElementById("authSection").innerHTML = user ? 
        `<span>${user.email}</span> 
         <button onclick="logout()" class="btn-3d bg-red-500 px-4 py-2 rounded">Logout</button>` 
        : `<button onclick="login()" class="btn-3d bg-green-500 px-4 py-2 rounded">Login with Google</button>`;
      loadProducts();
    });

    function loadProducts(){
      db.ref("products").on("value",snap=>{
        const items=[];
        snap.forEach(c=>items.push({...c.val(),id:c.key}));
        items.sort((a,b)=>b.createdAt-a.createdAt); // New posts on top
        renderProducts(items);
      });
    }

    function renderProducts(products){
      const container=document.getElementById("listing");
      container.innerHTML="";
      products.forEach(p=>{
        const borderClass = p.status!=="approved" ? "border-4 border-red-600" : "border border-gray-700";
        const card=document.createElement("div");
        card.className=`card-3d bg-gray-800 rounded-xl shadow-lg overflow-hidden ${borderClass}`;
        card.innerHTML=`
          <div class="h-48 bg-black flex justify-center items-center">
            <img src="${p.images? p.images[0]:""}" class="h-full object-contain">
          </div>
          <div class="p-3">
            <h2 class="text-lg font-bold">${p.name}</h2>
            <p>₹${p.price} <span class="text-green-400">-${p.discount}%</span></p>
            <button onclick="whatsappShop('${p.whatsapp}','${p.name}','${p.price}')" class="btn-3d mt-2 bg-green-600 px-3 py-1 rounded">WhatsApp</button>
            ${adminButtons(p)}
            ${shopkeeperButtons(p)}
            ${statusLabel(p)}
          </div>`;
        container.appendChild(card);
      });
    }

    function whatsappShop(num,name,price){
      const msg=encodeURIComponent(`Hi, I like your product ${name} for ₹${price}. Please share details.`);
      window.open(`https://wa.me/${num}?text=${msg}`,'_blank');
    }

    function adminButtons(p){
      if(!currentUser || currentUser.email!==ADMIN_EMAIL) return "";
      if(p.status==="approved"){
        return `<button class="btn-3d mt-2 bg-yellow-600 px-3 py-1 rounded" onclick="updateStatus('${p.id}','rejected')">Reject</button>`;
      } else {
        return `<button class="btn-3d mt-2 bg-green-600 px-3 py-1 rounded" onclick="updateStatus('${p.id}','approved')">Approve</button>`;
      }
    }

    function shopkeeperButtons(p){
      if(!currentUser || currentUser.email!==p.owner) return "";
      return `<button class="btn-3d mt-2 bg-red-600 px-3 py-1 rounded" onclick="deleteProduct('${p.id}')">Delete</button>`;
    }

    function statusLabel(p){
      if(p.status!=="approved"){
        return `<p class="text-red-400 font-bold">WAIT FOR APPROVAL</p>`;
      }
      return "";
    }

    function updateStatus(id,status){ db.ref("products/"+id).update({status}); }
    function deleteProduct(id){ db.ref("products/"+id).remove(); }
  </script>
</body>
</html>
