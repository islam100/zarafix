<!DOCTYPE html>
<html>
<head>
  <title>ZaraFix - Service Request</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: sans-serif; background: #f1f1f1; padding: 20px; text-align: center; }
    button {
      padding: 12px 20px;
      margin: 10px;
      border: none;
      background: linear-gradient(to right, #4CAF50, #45a049);
      color: white;
      border-radius: 10px;
      font-size: 16px;
      cursor: pointer;
      box-shadow: 2px 4px 8px rgba(0,0,0,0.2);
      transition: 0.3s ease;
    }
    button:hover { transform: scale(1.05); }
    form, #dashboard { display: none; max-width: 400px; margin: auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 2px 4px 10px rgba(0,0,0,0.1); }
    input, textarea, select {
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    .request-card {
      background: #ffffff;
      margin: 10px auto;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 1px 2px 6px rgba(0,0,0,0.1);
      text-align: left;
    }
  </style>
</head>
<body>

  <h2>ZaraFix: Free Service Request</h2>
  <button onclick="showForm()">üìù Post Service Request</button>
  <button onclick="showDashboard()">üìÇ My Dashboard</button>

  <!-- Form Section -->
  <form id="serviceForm">
    <input type="text" id="name" placeholder="Your Name" required />
    <input type="text" id="city" placeholder="City" required />
    <select id="category" required>
      <option value="">Select Category</option>
      <option>AC Repair</option>
      <option>Plumbing</option>
      <option>Electrician</option>
      <option>Appliance Repair</option>
    </select>
    <input type="text" id="whatsapp" placeholder="WhatsApp Number" required />
    <textarea id="issue" placeholder="Describe the issue" required></textarea>
    <button type="submit">üì§ Submit Request</button>
  </form>

  <!-- Dashboard Section -->
  <div id="dashboard">
    <h3>üìã Your Submitted Requests</h3>
    <div id="requestsContainer"></div>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script src="firebase.js"></script>

  <script>
    // Track user ID
    if (!localStorage.getItem("userId")) {
      localStorage.setItem("userId", "user_" + Date.now());
    }
    const userId = localStorage.getItem("userId");

    const form = document.getElementById("serviceForm");
    const dashboard = document.getElementById("dashboard");
    const requestsContainer = document.getElementById("requestsContainer");

    function showForm() {
      form.style.display = "block";
      dashboard.style.display = "none";
    }

    function showDashboard() {
      form.style.display = "none";
      dashboard.style.display = "block";
      loadRequests();
    }

    form.addEventListener("submit", function (e) {
      e.preventDefault();
      const name = document.getElementById("name").value;
      const city = document.getElementById("city").value;
      const category = document.getElementById("category").value;
      const whatsapp = document.getElementById("whatsapp").value;
      const issue = document.getElementById("issue").value;

      firebase.database().ref("services").push({
        name,
        city,
        category,
        whatsapp,
        issue,
        userId,
        timestamp: new Date().toLocaleString()
      }).then(() => {
        alert("‚úÖ Request submitted successfully!");
        form.reset();
        showDashboard();
      });
    });

    function loadRequests() {
      requestsContainer.innerHTML = "";
      firebase.database().ref("services").orderByChild("userId").equalTo(userId).once("value", snapshot => {
        snapshot.forEach(child => {
          const data = child.val();
          const card = `
            <div class="request-card">
              <b>${data.name}</b> | ${data.city}<br/>
              <b>Category:</b> ${data.category}<br/>
              <b>Issue:</b> ${data.issue}<br/>
              <b>WhatsApp:</b> ${data.whatsapp}<br/>
              <small>${data.timestamp}</small>
            </div>
          `;
          requestsContainer.innerHTML += card;
        });
      });
    }

    // By default, show form
    showForm();
  </script>
</body>
</html>
