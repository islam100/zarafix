<!DOCTYPE html>
<html>
<head>
  <title>🛠️ ZaraFix Admin Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: Arial;
      background: linear-gradient(to bottom right, #f0f8ff, #e6ffe6);
      margin: 0;
      padding: 20px;
    }
    h2 {
      text-align: center;
      margin-bottom: 20px;
    }
    input {
      padding: 8px;
      width: 100%;
      max-width: 300px;
      margin-bottom: 10px;
    }
    .poster-card {
      background: white;
      border-radius: 20px;
      padding: 15px;
      margin: 15px auto;
      max-width: 500px;
      box-shadow: 0 10px 20px rgba(0,0,0,0.2);
      transform: scale(1);
      transition: 0.2s;
    }
    .poster-card:hover {
      transform: scale(1.02);
    }
    .btn {
      margin: 5px;
      padding: 8px 12px;
      border: none;
      border-radius: 10px;
      color: white;
      cursor: pointer;
      font-weight: bold;
    }
    .approve-btn {
      background-color: green;
    }
    .delete-btn {
      background-color: red;
    }
  </style>
</head>
<body>
  <h2>🛠️ ZaraFix Admin Dashboard</h2>
  <input type="text" id="searchInput" placeholder="Search by name, shop, category..." oninput="loadPosters()">
  <div id="posterList"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import {
      getDatabase, ref, get, update, remove
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    const firebaseConfig = {
      databaseURL: "https://zarafix-default-rtdb.firebaseio.com/"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    async function loadPosters() {
      const posterRef = ref(db, 'posterUsers');
      const snapshot = await get(posterRef);
      const listDiv = document.getElementById('posterList');
      const search = document.getElementById('searchInput').value.toLowerCase();

      listDiv.innerHTML = '';

      if (snapshot.exists()) {
        const data = snapshot.val();
        Object.entries(data).forEach(([posterId, info]) => {
          const text = (info.name + info.shopname + info.category + info.whatsapp).toLowerCase();
          if (text.includes(search)) {
            const card = document.createElement('div');
            card.className = 'poster-card';
            card.innerHTML = `
              <b>🧑‍🔧 ${info.name}</b><br>
              📍 Shop: ${info.shopname}<br>
              📞 WhatsApp: ${info.whatsapp}<br>
              🏷️ Category: ${info.category} (${info.subcategory || ''})<br>
              📬 Pincode: ${info.pincode}<br>
              ✅ Approved: <b>${info.approved}</b><br><br>
              <button class="btn approve-btn" onclick="approvePoster('${posterId}')">✅ Approve</button>
              <button class="btn delete-btn" onclick="deletePoster('${posterId}')">🗑️ Delete</button>
            `;
            listDiv.appendChild(card);
          }
        });
      } else {
        listDiv.innerHTML = '<p>No posters found.</p>';
      }
    }

    window.approvePoster = async function (id) {
      await update(ref(db, 'posterUsers/' + id), { approved: true });
      alert('Approved');
      loadPosters();
    }

    window.deletePoster = async function (id) {
      const confirmDelete = confirm('Delete this poster?');
      if (confirmDelete) {
        await remove(ref(db, 'posterUsers/' + id));
        alert('Deleted');
        loadPosters();
      }
    }

    loadPosters();
  </script>
</body>
</html>
