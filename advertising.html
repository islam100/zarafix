<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ZaraFix All Service</title>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #ffffff;
  overflow: hidden; /* Scroll lock */
}

/* Header */
header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 20px;
  background: white;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

.logo {
  font-size: 3rem;
  font-weight: 900;
  background: linear-gradient(45deg, red, orange, yellow, green, blue, indigo, violet);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

nav {
  position: relative;
}

.menu {
  cursor: pointer;
  font-weight: bold;
}

.dropdown {
  display: none;
  position: absolute;
  top: 25px;
  right: 0;
  background: white;
  box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}

.dropdown a {
  display: block;
  padding: 8px 12px;
  text-decoration: none;
  color: #333;
}

.dropdown a:hover {
  background: #f0f0f0;
}

#loginBtn, #logoutBtn {
  padding: 6px 12px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}

#loginBtn { background: #28a745; color: white; }
#logoutBtn { background: #dc3545; color: white; }

/* Slider */
.slider {
  width: 100%;
  height: calc(100vh - 60px);
  background: #f5f5f5;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
}

.slider img {
  max-width: 100%;
  max-height: 100%;
  object-fit: contain;
  transition: transform 0.5s ease;
}

/* Admin Controls */
.admin-controls {
  position: absolute;
  bottom: 10px;
  left: 50%;
  transform: translateX(-50%);
}

.admin-controls button {
  padding: 8px 14px;
  margin: 5px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}

.upload-btn { background: #28a745; color: white; }
.delete-btn { background: #dc3545; color: white; }
</style>
</head>

<body>

<header>
  <div class="logo">ZaraFix</div>
  <nav>
    <div class="menu" onclick="toggleMenu()">â˜° Menu</div>
    <div class="dropdown" id="dropdownMenu">
      <a href="#">Home</a>
      <a href="#">Services</a>
      <a href="#">Contact</a>
      <a href="#">About</a>
    </div>
  </nav>
  <div>
    <button id="loginBtn">Login with Google</button>
    <button id="logoutBtn" style="display:none;">Logout</button>
  </div>
</header>

<div class="slider" id="imageSlider"></div>

<div class="admin-controls" id="adminControls" style="display:none;">
  <button class="upload-btn" id="adminUploadBtn">Upload Image</button>
  <button class="delete-btn" id="adminDeleteBtn">Delete Current Image</button>
</div>

<script>
// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyD7ZqL-PVuFdd8rMVIyW7CgHQjPRGHD2h8",
  authDomain: "zara-fix-2e35a.firebaseapp.com",
  databaseURL: "https://zara-fix-2e35a-default-rtdb.firebaseio.com/",
  projectId: "zara-fix-2e35a",
  storageBucket: "zara-fix-2e35a.appspot.com",
  messagingSenderId: "636550144008",
  appId: "1:636550144008:web:a849496ad1d1557d7ab1bd"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();
const storage = firebase.storage();

const adminEmail = "zarasamajiksevasanstha@gmail.com";
let sliderImages = [];
let currentIndex = 0;

// Menu toggle
function toggleMenu() {
  const menu = document.getElementById('dropdownMenu');
  menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
}

// Login
document.getElementById('loginBtn').onclick = () => {
  const provider = new firebase.auth.GoogleAuthProvider();
  auth.signInWithPopup(provider).catch(console.error);
};

// Logout
document.getElementById('logoutBtn').onclick = () => auth.signOut();

// Auth state
auth.onAuthStateChanged(user => {
  if (user) {
    document.getElementById('loginBtn').style.display = "none";
    document.getElementById('logoutBtn').style.display = "inline-block";
    if (user.email === adminEmail) {
      document.getElementById('adminControls').style.display = "block";
    }
  } else {
    document.getElementById('loginBtn').style.display = "inline-block";
    document.getElementById('logoutBtn').style.display = "none";
    document.getElementById('adminControls').style.display = "none";
  }
});

// Upload
document.getElementById('adminUploadBtn').onclick = () => {
  let input = document.createElement('input');
  input.type = "file";
  input.accept = "image/*";
  input.onchange = async () => {
    const file = input.files[0];
    if (!file) return;
    const fileName = Date.now() + "_" + file.name;
    const storageRef = storage.ref('slider/' + fileName);
    const uploadTask = storageRef.put(file);

    uploadTask.on('state_changed', 
      snapshot => {
        const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
        console.log('Upload progress: ' + progress + '%');
      },
      error => console.error('Upload error:', error),
      async () => {
        const url = await storageRef.getDownloadURL();
        const timestamp = Date.now();
        await db.ref('slider').push({ url, timestamp, fileName });
        loadSliderImages();
      }
    );
  };
  input.click();
};

// Delete
document.getElementById('adminDeleteBtn').onclick = async () => {
  if (sliderImages.length === 0) return;
  const currentImage = sliderImages[currentIndex];
  try {
    await storage.ref('slider/' + currentImage.fileName).delete();
  } catch(e) {
    console.warn("Storage delete error:", e);
  }
  await db.ref('slider/' + currentImage.key).remove();
  loadSliderImages();
};

// Load images
async function loadSliderImages() {
  const snapshot = await db.ref('slider').once('value');
  sliderImages = [];
  snapshot.forEach(child => {
    sliderImages.push({
      key: child.key,
      url: child.val().url,
      fileName: child.val().fileName || ""
    });
  });
  currentIndex = 0;
  showImage();
}

function showImage() {
  if (sliderImages.length === 0) {
    document.getElementById('imageSlider').innerHTML = "<p>No images</p>";
    return;
  }
  document.getElementById('imageSlider').innerHTML =
    `<img src="${sliderImages[currentIndex].url}">`;
}

setInterval(() => {
  if (sliderImages.length > 1) {
    currentIndex = (currentIndex + 1) % sliderImages.length;
    showImage();
  }
}, 3000);

loadSliderImages();
</script>
</body>
</html>
