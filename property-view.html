<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Zara Property - Public & Admin</title>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<style>
  /* ... (पिछले कोड जैसा ही CSS होगा, बस Delete button के लिए अलग स्टाइल) */
  .delete-btn {
    background-color: #dc3545;
    color: white;
    border: none;
    border-radius: 8px;
    padding: 6px 10px;
    cursor: pointer;
    font-weight: bold;
    user-select: none;
    box-shadow: 2px 2px 6px #a83232;
    transition: background-color 0.3s ease;
  }
  .delete-btn:hover {
    background-color: #a82828;
  }
</style>
</head>
<body>

<header>
  <h1>Zara Property</h1>
  <div id="btnGroup">
    <button id="adminLoginBtn">Admin Login (Google)</button>
    <button id="adminLogoutBtn" style="display:none;">Admin Logout</button>
  </div>
</header>

<section id="propertyList"></section>

<script>
  // Firebase config डालें अपनी Firebase प्रोजेक्ट की जानकारी से
  const firebaseConfig = {
    apiKey: "AIzaSyDTj2n1yhr1sFmuyBZ-jUwOmx1YqAN5QjA",
    authDomain: "property-20d6d.firebaseapp.com",
    databaseURL: "https://property-20d6d-default-rtdb.firebaseio.com",
    projectId: "property-20d6d",
    storageBucket: "property-20d6d.appspot.com",
    messagingSenderId: "916859697394",
    appId: "1:916859697394:web:2a8f9ad2d62f8306dcb86b"
  };
  firebase.initializeApp(firebaseConfig);

  const auth = firebase.auth();
  const db = firebase.database();

  const whatsappPhone = "917378342192"; // आपका WhatsApp नंबर

  const adminLoginBtn = document.getElementById('adminLoginBtn');
  const adminLogoutBtn = document.getElementById('adminLogoutBtn');
  const propertyList = document.getElementById('propertyList');

  let isAdmin = false;

  // Admin Google Login
  adminLoginBtn.onclick = () => {
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider).catch(err => alert("Login failed: " + err.message));
  };

  adminLogoutBtn.onclick = () => {
    auth.signOut();
  };

  // Admin की पहचान (email या uid के आधार पर) — आप अपने admin Google account का email डालें यहाँ:
  const adminEmails = ["admin@gmail.com"]; // <-- यहाँ अपना admin gmail डालें

  // WhatsApp लिंक जनरेट करने वाला फंक्शन
  function whatsappLink(title, city, price, key){
    const msg = `नमस्ते, मैं इस प्रॉपर्टी के बारे में जानना चाहता हूँ:\n\nTitle: ${title}\nCity: ${city}\nPrice: ₹${price}\n\nLink: ${window.location.origin + window.location.pathname}#property=${key}`;
    return `https://wa.me/${whatsappPhone}?text=${encodeURIComponent(msg)}`;
  }

  // प्रॉपर्टी लोड करें और दिखाएं
  function loadProperties(){
    db.ref('properties').once('value').then(snapshot => {
      const data = snapshot.val();
      propertyList.innerHTML = "";
      if(!data){
        propertyList.innerHTML = "<p style='text-align:center; padding:20px; color:#666;'>कोई प्रॉपर्टी उपलब्ध नहीं है।</p>";
        return;
      }
      Object.entries(data).forEach(([key, post]) => {
        const card = document.createElement('div');
        card.className = "property-card";
        card.style = `
          background: white;
          border-radius: 12px;
          box-shadow: 0 5px 15px rgb(0 0 0 / 0.1);
          overflow: hidden;
          margin: 15px;
          padding: 12px;
          max-width: 320px;
          display: inline-block;
          vertical-align: top;
          cursor: default;
          font-family: Arial, sans-serif;
        `;

        // Image
        const img = document.createElement('img');
        img.src = post.imageUrls?.[0] || post.imageUrl || "";
        img.alt = post.title;
        img.style = "width:100%; height:180px; object-fit:cover; border-radius:8px;";
        card.appendChild(img);

        // Title
        const title = document.createElement('h3');
        title.textContent = post.title;
        title.style.color = "#0066cc";
        card.appendChild(title);

        // City, Type, Price
        const city = document.createElement('p');
        city.textContent = "City: " + post.city;
        card.appendChild(city);

        const type = document.createElement('p');
        type.textContent = "Type: " + (post.type === "sale" ? "Buy" : "Rent");
        card.appendChild(type);

        const price = document.createElement('p');
        price.textContent = "Price: ₹" + post.price.toLocaleString('en-IN');
        card.appendChild(price);

        // Description
        const desc = document.createElement('p');
        desc.textContent = post.description;
        card.appendChild(desc);

        // WhatsApp Button
        const waBtn = document.createElement('a');
        waBtn.href = whatsappLink(post.title, post.city, post.price, key);
        waBtn.target = "_blank";
        waBtn.textContent = "WhatsApp";
        waBtn.style = `
          display: inline-block;
          background-color: #25d366;
          color: white;
          padding: 8px 14px;
          border-radius: 8px;
          text-decoration: none;
          font-weight: bold;
          margin-top: 10px;
          user-select: none;
        `;
        card.appendChild(waBtn);

        // अगर admin लॉगिन है तो Delete बटन दिखाओ
        if(isAdmin){
          const delBtn = document.createElement('button');
          delBtn.textContent = "Delete";
          delBtn.className = "delete-btn";
          delBtn.onclick = (e) => {
            e.stopPropagation();
            if(confirm("क्या आप इस प्रॉपर्टी को डिलीट करना चाहते हैं?")){
              db.ref('properties/' + key).remove()
                .then(() => {
                  alert("प्रॉपर्टी डिलीट हो गई है।");
                  loadProperties();
                })
                .catch(err => alert("डिलीट करते समय त्रुटि: " + err.message));
            }
          };
          card.appendChild(delBtn);
        }

        propertyList.appendChild(card);
      });
    }).catch(err => {
      propertyList.innerHTML = `<p style="color:red; padding:20px; text-align:center;">Error loading properties: ${err.message}</p>`;
    });
  }

  // Firebase ऑथ स्टेटस मॉनिटर करें
  auth.onAuthStateChanged(user => {
    if(user && adminEmails.includes(user.email)){
      isAdmin = true;
      adminLoginBtn.style.display = "none";
      adminLogoutBtn.style.display = "inline-block";
    } else {
      isAdmin = false;
      adminLoginBtn.style.display = "inline-block";
      adminLogoutBtn.style.display = "none";
    }
    loadProperties();
  });

  // पेज लोड पर प्रॉपर्टी लोड करें
  loadProperties();
</script>

</body>
</html>
