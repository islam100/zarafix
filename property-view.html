<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Zara Property Listing</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f7f9fc;
    margin: 0; padding: 0;
  }
  header {
    background-color: #007bff;
    color: white;
    padding: 15px 20px;
    text-align: center;
  }
  #btnGroup button {
    margin: 5px;
    padding: 10px 18px;
    font-weight: bold;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    color: white;
    background: linear-gradient(45deg,#0066cc, #00aaff);
    transition: background 0.3s;
  }
  #btnGroup button:hover {
    background: linear-gradient(45deg,#004a99, #0088cc);
  }
  #postSection {
    max-width: 500px;
    margin: 20px auto;
    background: white;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 0 15px rgba(0,0,0,0.1);
    display: none;
  }
  #postSection input, #postSection select, #postSection textarea {
    width: 100%;
    margin: 8px 0 15px 0;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 6px;
    font-size: 14px;
  }
  #propertyContainer {
    display: grid;
    grid-template-columns: repeat(auto-fit,minmax(280px,1fr));
    gap: 15px;
    padding: 15px;
  }
  .property-card {
    background: white;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    overflow: hidden;
    cursor: pointer;
    transition: transform 0.2s;
  }
  .property-card:hover {
    transform: scale(1.03);
  }
  .property-card img {
    width: 100%;
    height: 180px;
    object-fit: cover;
  }
  .property-info {
    padding: 12px 15px;
  }
  .property-info h3 {
    margin: 0 0 6px;
  }
  .property-info p {
    margin: 4px 0;
    color: #555;
    font-size: 14px;
  }
  .btn-whatsapp {
    display: inline-block;
    background-color: #25d366;
    color: white;
    padding: 8px 14px;
    border-radius: 6px;
    text-decoration: none;
    font-weight: bold;
    margin-top: 8px;
  }
  /* Modal Styles */
  #modalOverlay {
    position: fixed;
    top: 0; left: 0;
    width: 100vw; height: 100vh;
    background: rgba(0,0,0,0.6);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 9999;
  }
  #modalContent {
    background: white;
    max-width: 600px;
    width: 90%;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 0 25px rgba(0,0,0,0.25);
  }
  #modalContent img {
    width: 100%;
    height: 300px;
    object-fit: cover;
  }
  #modalBody {
    padding: 15px;
  }
  #modalBody h3 {
    margin-top: 0;
  }
  #modalClose {
    background: #dc3545;
    color: white;
    border: none;
    padding: 10px 15px;
    font-weight: bold;
    cursor: pointer;
    width: 100%;
    border-radius: 0 0 12px 12px;
  }
</style>
</head>
<body>

<header>
  <h1>Zara Property Listing</h1>
  <div id="btnGroup">
    <button id="loginBtn">Google Login</button>
    <button id="logoutBtn" style="display:none;">Logout</button>
    <button id="showPostBtn" style="display:none;">Post Property</button>
  </div>
</header>

<section id="postSection">
  <h2>Post Your Property</h2>
  <input type="text" id="title" placeholder="Title (e.g. 2BHK Flat for Sale)" required />
  <input type="text" id="city" placeholder="City" required />
  <select id="type">
    <option value="sale">Buy</option>
    <option value="rent">Rent</option>
  </select>
  <input type="number" id="price" placeholder="Price (INR)" required />
  <textarea id="description" placeholder="Description"></textarea>
  <input type="file" id="imageFile" accept="image/*" required />
  <input type="text" id="whatsapp" placeholder="WhatsApp Number (with country code)" required />
  <button id="submitPostBtn">Submit Property</button>
  <button id="cancelPostBtn" style="margin-left:10px;">Cancel</button>
  <p id="uploadStatus"></p>
</section>

<div id="propertyContainer"></div>

<!-- Modal for Property Details -->
<div id="modalOverlay">
  <div id="modalContent">
    <img id="modalImage" src="" alt="Property Image" />
    <div id="modalBody">
      <h3 id="modalTitle"></h3>
      <p><b>City:</b> <span id="modalCity"></span></p>
      <p><b>Type:</b> <span id="modalType"></span></p>
      <p><b>Price:</b> ₹<span id="modalPrice"></span></p>
      <p id="modalDescription"></p>
      <a id="modalWhatsappBtn" href="#" target="_blank" class="btn-whatsapp">WhatsApp</a>
    </div>
    <button id="modalClose">Close</button>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>

<script>
  // Firebase config - अपनी Firebase details यहाँ डालें
  const firebaseConfig = {
  apiKey: "AIzaSyDTj2n1yhr1sFmuyBZ-jUwOmx1YqAN5QjA",
  authDomain: "property-20d6d.firebaseapp.com",
  databaseURL: "https://property-20d6d-default-rtdb.firebaseio.com",
  projectId: "property-20d6d",
  storageBucket: "property-20d6d.appspot.com",
  messagingSenderId: "916859697394",
  appId: "1:916859697394:web:2a8f9ad2d62f8306dcb86b"
};

  firebase.initializeApp(firebaseConfig);

  const auth = firebase.auth();
  const db = firebase.database();
  const storage = firebase.storage();

  // Admin email और नंबर सेट करें
  const adminEmail = "admin@example.com";
  const adminWhatsapp = "91917378342192";

  // DOM Elements
  const loginBtn = document.getElementById("loginBtn");
  const logoutBtn = document.getElementById("logoutBtn");
  const showPostBtn = document.getElementById("showPostBtn");
  const postSection = document.getElementById("postSection");
  const submitPostBtn = document.getElementById("submitPostBtn");
  const cancelPostBtn = document.getElementById("cancelPostBtn");
  const uploadStatus = document.getElementById("uploadStatus");
  const propertyContainer = document.getElementById("propertyContainer");

  // Modal Elements
  const modalOverlay = document.getElementById("modalOverlay");
  const modalImage = document.getElementById("modalImage");
  const modalTitle = document.getElementById("modalTitle");
  const modalCity = document.getElementById("modalCity");
  const modalType = document.getElementById("modalType");
  const modalPrice = document.getElementById("modalPrice");
  const modalDescription = document.getElementById("modalDescription");
  const modalWhatsappBtn = document.getElementById("modalWhatsappBtn");
  const modalClose = document.getElementById("modalClose");

  let currentUser = null;

  // Login Logic
  loginBtn.onclick = () => {
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider).catch(console.error);
  };
  logoutBtn.onclick = () => {
    auth.signOut();
  };

  // Auth state change
  auth.onAuthStateChanged(user => {
    currentUser = user;
    if (user) {
      loginBtn.style.display = "none";
      logoutBtn.style.display = "inline-block";
      showPostBtn.style.display = "inline-block";
      loadProperties();
    } else {
      loginBtn.style.display = "inline-block";
      logoutBtn.style.display = "none";
      showPostBtn.style.display = "none";
      postSection.style.display = "none";
      propertyContainer.innerHTML = "";
    }
  });

  // Show post property form
  showPostBtn.onclick = () => {
    postSection.style.display = "block";
  };

  // Cancel post form
  cancelPostBtn.onclick = () => {
    clearPostForm();
    postSection.style.display = "none";
  };

  // Clear form inputs
  function clearPostForm() {
    document.getElementById("title").value = "";
    document.getElementById("city").value = "";
    document.getElementById("type").value = "sale";
    document.getElementById("price").value = "";
    document.getElementById("description").value = "";
    document.getElementById("imageFile").value = "";
    document.getElementById("whatsapp").value = "";
    uploadStatus.textContent = "";
  }

  // Submit Property
  submitPostBtn.onclick = () => {
    const title = document.getElementById("title").value.trim();
    const city = document.getElementById("city").value.trim();
    const type = document.getElementById("type").value;
    const price = Number(document.getElementById("price").value);
    const description = document.getElementById("description").value.trim();
    const whatsapp = document.getElementById("whatsapp").value.trim();
    const imageFile = document.getElementById("imageFile").files[0];

    if (!title || !city || !price || !whatsapp || !imageFile) {
      alert("कृपया सभी आवश्यक फ़ील्ड भरें और इमेज अपलोड करें।");
      return;
    }

    uploadStatus.textContent = "Uploading image...";

    // Upload image to Firebase Storage
    const imageRef = storage.ref('property_images/' + Date.now() + '_' + imageFile.name);
    imageRef.put(imageFile).then(snapshot => {
      return snapshot.ref.getDownloadURL();
    }).then(downloadURL => {
      uploadStatus.textContent = "Image uploaded. Saving property data...";

      // Save property to Realtime Database
      const newPropertyRef = db.ref("properties").push();
      newPropertyRef.set({
        title,
        city,
        type,
        price,
        description,
        imageUrl: downloadURL,
        whatsapp,
        userId: currentUser.uid,
        userEmail: currentUser.email,
        approved: false,
        timestamp: Date.now()
      }).then(() => {
        alert("Property posted successfully! Admin approval pending.");
        clearPostForm();
        postSection.style.display = "none";
        uploadStatus.textContent = "";
      });
    }).catch(error => {
      alert("Error uploading image: " + error.message);
      uploadStatus.textContent = "";
    });
  };

  // Load properties with approval check
  function loadProperties() {
    db.ref("properties").orderByChild("approved").equalTo(true).on("value", snapshot => {
      propertyContainer.innerHTML = "";
      snapshot.forEach(child => {
        const property = child.val();
        const isAdmin = currentUser.email === adminEmail;
        const showWhatsappNumber = isAdmin ? property.whatsapp : adminWhatsapp;

        const card = document.createElement("div");
        card.className = "property-card";

        card.innerHTML = `
          <img src="${property.imageUrl}" alt="Property Image" />
          <div class="property-info">
            <h3>${property.title}</h3>
            <p><b>City:</b> ${property.city}</p>
            <p><b>Price:</b> ₹${property.price.toLocaleString()}</p>
            <a href="https://wa.me/${showWhatsappNumber}" target="_blank" class="btn-whatsapp">WhatsApp</a>
          </div>
        `;

        // Click to open modal with details
        card.onclick = (e) => {
          if(e.target.tagName.toLowerCase() === 'a') return; // Don't open modal if whatsapp clicked
          openModal(property, showWhatsappNumber);
        };

        propertyContainer.appendChild(card);
      });
    });
  }

  // Modal logic
  function openModal(property, whatsappNumber) {
    modalImage.src = property.imageUrl;
    modalTitle.textContent = property.title;
    modalCity.textContent = property.city;
    modalType.textContent = property.type === "sale" ? "Buy" : "Rent";
    modalPrice.textContent = property.price.toLocaleString();
    modalDescription.textContent = property.description;
    modalWhatsappBtn.href = "https://wa.me/" + whatsappNumber;
    modalWhatsappBtn.textContent = "WhatsApp";

    modalOverlay.style.display = "flex";
  }

  modalClose.onclick = () => {
    modalOverlay.style.display = "none";
  };

  // Close modal on clicking outside modal content
  modalOverlay.onclick = (e) => {
    if(e.target === modalOverlay) {
      modalOverlay.style.display = "none";
    }
  };
</script>

</body>
</html>
