<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ZaraFix ‚Äì 3D Portal (Login Required)</title>
  <style>
    :root{
      --grad-a: linear-gradient(135deg,#ff9a9e,#fad0c4);
      --grad-b: linear-gradient(135deg,#a18cd1,#fbc2eb);
      --btn: linear-gradient(145deg,#36d1dc,#5b86e5);
      --btn-2: linear-gradient(145deg,#ff9966,#ff5e62);
      --surface: #ffffffee;
      --shadow-3d: 0 16px 30px rgba(0,0,0,.25), 0 10px 12px rgba(0,0,0,.18);
      --inset-3d: inset 0 10px 18px rgba(0,0,0,.12), 0 14px 24px rgba(0,0,0,.22);
      --radius: 20px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: var(--grad-a);
      background-attachment: fixed;
      color:#111827;
    }
    header{
      position:sticky; top:0; z-index:20; width:100%;
      background: var(--grad-b);
      display:flex; align-items:center; justify-content:space-between;
      padding:10px 14px; box-shadow: var(--shadow-3d);
    }
    .brand{ display:flex; align-items:center; gap:10px; min-width:0; }
    .logoText{
      font-size: clamp(22px, 6vw, 36px); font-weight: 900; letter-spacing:1.2px;
      background: conic-gradient(from 180deg,#ff00cc,#3333ff,#00ffcc,#ff00cc);
      -webkit-background-clip:text; background-clip:text; -webkit-text-fill-color:transparent;
      filter: drop-shadow(0 8px 14px rgba(0,0,0,.35));
      white-space:nowrap;
    }
    .logoImg{ height:44px; width:auto; border-radius:14px; box-shadow: var(--shadow-3d); display:none; }
    .authBtn{ border:0; color:#fff; font-weight:800; border-radius:14px; padding:10px 14px; cursor:pointer; background: var(--btn); box-shadow: var(--shadow-3d); white-space:nowrap; }
    .authBtn:active{ transform: translateY(2px); }

    main{ max-width:980px; margin:20px auto; padding:0 12px; }
    .card{ background:var(--surface); backdrop-filter: blur(6px); border-radius: var(--radius); padding:16px; box-shadow: var(--inset-3d); }

    .gate{ min-height: calc(100vh - 110px); display:grid; place-items:center; }
    .loginBox{ width:min(520px,92%); text-align:center; padding:22px; border-radius:20px; background:#ffffffee; box-shadow: var(--shadow-3d); }
    .loginTitle{ font-size:22px; font-weight:900; margin-bottom:10px; }
    .googleBtn{ border:0; color:#fff; font-weight:800; border-radius:16px; padding:14px 18px; cursor:pointer; background: var(--btn); box-shadow: var(--shadow-3d); width:100%; }

    .actions{ display:grid; grid-template-columns:1fr; gap:14px; }
    @media (min-width:520px){ .actions{ grid-template-columns:1fr 1fr; } }
    .btn3d{ display:flex; align-items:center; justify-content:center; gap:10px; text-decoration:none; border-radius:16px; padding:16px; font-size:18px; font-weight:900; color:#fff; background: var(--btn); box-shadow: var(--shadow-3d); text-align:center; }
    .btnAdmin{ background: var(--btn-2); }
    .btnHidden{ display:none !important; }

    .noticeTitle{ font-size:18px; font-weight:900; margin-bottom:8px; }
    .noticeView{ background:#fff; border-radius:14px; padding:14px; box-shadow: var(--inset-3d); min-height:72px; }
    .noticeImg{ max-width:100%; border-radius:12px; margin-top:8px; box-shadow: var(--shadow-3d); }

    .adminTools{ margin-top:12px; display:none; }
    .row{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; }
    .input, textarea{ width:100%; border:1px solid #d1d5db; border-radius:12px; padding:10px; font-size:15px; background:#fff; box-shadow: inset 0 2px 4px rgba(0,0,0,.05); }
    textarea{ min-height:90px; resize:vertical; }
    .saveBtn{ border:0; border-radius:12px; padding:10px 16px; font-weight:800; color:#fff; cursor:pointer; background: var(--btn-2); box-shadow: var(--shadow-3d); }

    /* tiny phones */
    @media (max-width:360px){ .logoText{ font-size:22px; } header{ padding:8px; } .authBtn{ padding:8px 10px; font-size:14px; } }
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <img id="logoImg" class="logoImg" alt="ZaraFix Logo" />
      <div class="logoText" id="logoText">ZaraFix</div>
    </div>
    <button id="authBtn" class="authBtn">Login with Google</button>
  </header>

  <!-- LOGIN GATE (visible only when signed out) -->
  <section id="loginGate" class="gate">
    <div class="loginBox">
      <div class="loginTitle">Login to continue</div>
      <p style="margin:6px 0 16px">Google login required to access the portal.</p>
      <button id="googleBtn" class="googleBtn">Continue with Google</button>
    </div>
  </section>

  <!-- APP (visible only when signed in) -->
  <main id="app" style="display:none">
    <section class="card">
      <div class="actions">
        <a class="btn3d" id="providerBtn" href="https://zarafix.vercel.app/2poster.html">üöÄ Provider</a>
        <a class="btn3d btnAdmin btnHidden" id="adminBtn" href="https://zarafix.vercel.app/4-button.html">üõ†Ô∏è Admin</a>
      </div>

      <div style="height:10px"></div>

      <div class="noticeTitle">üìå Notice Board</div>
      <div id="noticeView" class="noticeView">Loading notice‚Ä¶</div>

      <div id="adminTools" class="adminTools">
        <textarea id="noticeInput" placeholder="Write notice here (admin only)"></textarea>
        <div class="row" style="margin-top:8px;">
          <input class="input" type="file" id="noticeImage" accept="image/*" />
          <button class="saveBtn" id="saveNoticeBtn">Save Notice</button>
        </div>
        <p class="row" style="margin-top:6px"><small>Tip: Optional image will be uploaded to ImgBB and shown under the notice.</small></p>
      </div>
    </section>
  </main>

  <!-- Firebase (Compat SDK to use v8-style API) -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

  <script>
    // ====== CONFIGS ======
    const ADMIN_EMAIL = 'zarasamajiksevasansth@gmail.com';
    const IMGBB_API_KEY = 'ff05d1b5c3b3e139253856f0ad1123df';
    const firebaseConfig = {
      apiKey: "AIzaSyAa8htkfGK-4D3cIQVyxT3o_8WMvghkr-8",
      authDomain: "loot-lo-15328.firebaseapp.com",
      databaseURL: "https://loot-lo-15328-default-rtdb.firebaseio.com",
      projectId: "loot-lo-15328",
      storageBucket: "loot-lo-15328.appspot.com",
      messagingSenderId: "677769861892",
      appId: "1:677769861892:web:bb235cb8479aeee9b58e51"
    };

    // ====== INIT ======
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    // ====== ELTs ======
    const authBtn = document.getElementById('authBtn');
    const googleBtn = document.getElementById('googleBtn');
    const loginGate = document.getElementById('loginGate');
    const appView = document.getElementById('app');
    const adminBtn = document.getElementById('adminBtn');
    const adminTools = document.getElementById('adminTools');
    const noticeView = document.getElementById('noticeView');
    const noticeInput = document.getElementById('noticeInput');
    const saveNoticeBtn = document.getElementById('saveNoticeBtn');
    const noticeImage = document.getElementById('noticeImage');
    const logoImg = document.getElementById('logoImg');
    const logoText = document.getElementById('logoText');

    // ====== AUTH BUTTON (header) ======
    function doLogin(){ const provider = new firebase.auth.GoogleAuthProvider(); auth.signInWithPopup(provider).catch(e=>alert(e.message)); }
    function doLogout(){ auth.signOut().catch(e=>alert(e.message)); }
    authBtn.addEventListener('click', ()=>{ auth.currentUser ? doLogout() : doLogin(); });
    googleBtn.addEventListener('click', doLogin);

    // ====== NOTICE: load for signed-in users (page itself is gated) ======
    const noticeRef = db.ref('notice');
    noticeRef.on('value', (snap) => {
      const data = snap.val() || {};
      const text = data.text || '‚Äî No notice yet ‚Äî';
      const img = data.imageUrl;
      noticeView.innerHTML = '';
      const p = document.createElement('div'); p.textContent = text; noticeView.appendChild(p);
      if(img){ const im = document.createElement('img'); im.src = img; im.alt = 'notice image'; im.className = 'noticeImg'; noticeView.appendChild(im); }
      if(data.logoUrl){ logoImg.src = data.logoUrl; logoImg.style.display = 'block'; logoText.style.display = 'none'; }
      else { logoImg.style.display = 'none'; logoText.style.display = 'block'; }
    });

    // ====== AUTH STATE ======
    auth.onAuthStateChanged((user)=>{
      if(user){
        // gate open
        loginGate.style.display = 'none';
        appView.style.display = 'block';
        authBtn.textContent = 'Logout';
        const isAdmin = user.email === ADMIN_EMAIL;
        adminBtn.classList.toggle('btnHidden', !isAdmin);
        adminTools.style.display = isAdmin ? 'block' : 'none';
      } else {
        // gate closed
        loginGate.style.display = 'block';
        appView.style.display = 'none';
        authBtn.textContent = 'Login with Google';
        adminBtn.classList.add('btnHidden');
        adminTools.style.display = 'none';
      }
    });

    // ====== SAVE NOTICE (ADMIN ONLY) ======
    saveNoticeBtn.addEventListener('click', async ()=>{
      const user = auth.currentUser;
      if(!user || user.email !== ADMIN_EMAIL){ return alert('Only admin can save notices.'); }
      const text = (noticeInput.value || '').trim();
      let imageUrl = null;
      const file = noticeImage.files && noticeImage.files[0];
      if(file){
        try{ imageUrl = await uploadToImgBB(file); }
        catch(err){ alert('ImgBB upload failed: '+err.message); return; }
      }
      await db.ref('notice').set({ text, imageUrl });
      noticeInput.value = ''; if(noticeImage) noticeImage.value = '';
      alert('Notice saved');
    });

    // ====== ImgBB helper ======
    async function uploadToImgBB(file){
      const base64 = await fileToBase64(file);
      const form = new FormData(); form.append('image', base64.split(',')[1]);
      const url = `https://api.imgbb.com/1/upload?key=${encodeURIComponent(IMGBB_API_KEY)}`;
      const res = await fetch(url, { method:'POST', body: form });
      if(!res.ok) throw new Error('HTTP '+res.status);
      const json = await res.json(); if(!json || !json.success) throw new Error('Upload failed');
      return json.data.display_url;
    }
    function fileToBase64(file){ return new Promise((resolve,reject)=>{ const r=new FileReader(); r.onload=()=>resolve(r.result); r.onerror=reject; r.readAsDataURL(file); }); }
  </script>

  <!--
  ===================== IMPORTANT: Firebase Realtime Database Rules =====================
  Everyone can READ (after login gate opens), but only Admin can WRITE notice:

  {
    "rules": {
      ".read": "auth != null",  
      "notice": {
        ".write": "auth != null && auth.token.email === 'zarasamajiksevasansth@gmail.com'"
      }
    }
  }
  ============================================================================
  -->
</body>
</html>
