<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ZaraFix Portal</title>
  <style>
    :root{
      --grad-1: linear-gradient(135deg,#ff9a9e,#fad0c4);
      --grad-2: linear-gradient(135deg,#a18cd1,#fbc2eb);
      --grad-3: linear-gradient(135deg,#f6d365,#fda085);
      --btn-grad: linear-gradient(145deg,#36d1dc,#5b86e5);
      --danger-grad: linear-gradient(145deg,#ff5e62,#ff9966);
      --accent: #111827;
      --radius: 18px;
      --shadow-3d: 0 14px 28px rgba(0,0,0,.25),0 10px 10px rgba(0,0,0,.22);
      --inset-3d: inset 0 8px 16px rgba(0,0,0,.18), 0 12px 24px rgba(0,0,0,.24);
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: 'Segoe UI', system-ui, -apple-system, Roboto, Arial, sans-serif;
      min-height:100vh; display:flex; flex-direction:column;
      background: var(--grad-1);
      background-attachment: fixed;
    }
    header{
      position:sticky; top:0; z-index:10; width:100%;
      background: var(--grad-2);
      display:flex; align-items:center; justify-content:space-between;
      padding:10px 14px; box-shadow: var(--shadow-3d);
    }
    .brand{
      display:flex; align-items:center; gap:10px;
    }
    .logoText{ 
      font-size: clamp(22px, 6vw, 36px);
      font-weight: 900; letter-spacing:1.2px;
      background: conic-gradient(from 180deg, #ff00cc, #3333ff, #00ffcc, #ff00cc);
      -webkit-background-clip:text; background-clip:text; -webkit-text-fill-color:transparent;
      filter: drop-shadow(0 6px 10px rgba(0,0,0,.35));
    }
    .logoImg{ height:42px; width:auto; border-radius:12px; box-shadow: var(--shadow-3d); display:none; }
    .rightZone{ display:flex; align-items:center; gap:8px; }
    .authBtn{
      border:0; color:#fff; font-weight:700; border-radius:14px; padding:10px 14px; cursor:pointer;
      background: var(--btn-grad);
      box-shadow: var(--shadow-3d); transition: transform .15s ease;
      white-space:nowrap;
    }
    .authBtn:active{ transform: translateY(2px); }

    main{ width:100%; max-width:980px; margin:22px auto; padding:0 12px; }

    .card{
      background:#ffffffdd; backdrop-filter: blur(6px);
      border-radius: var(--radius); padding:16px; box-shadow: var(--inset-3d);
    }

    .actions{ display:grid; grid-template-columns:1fr; gap:14px; margin-top:16px; }
    @media (min-width:520px){ .actions{ grid-template-columns:1fr 1fr; } }

    .btn3d{
      display:flex; align-items:center; justify-content:center; gap:10px; text-decoration:none;
      border-radius:16px; padding:16px; font-size:18px; font-weight:800; color:#fff;
      background: var(--btn-grad); box-shadow: var(--shadow-3d); transition: transform .15s ease, filter .15s ease;
      text-align:center;
    }
    .btn3d:active{ transform: translateY(2px); }
    .btnHidden{ display:none !important; }

    .noticeBoard{ margin-top:20px; }
    .noticeTitle{ font-size:18px; font-weight:800; color:var(--accent); margin-bottom:10px; }
    .noticeView{ background:#fff; border-radius:14px; padding:14px; box-shadow: var(--inset-3d); min-height:72px; }
    .noticeImg{ max-width:100%; border-radius:12px; margin-top:8px; box-shadow: var(--shadow-3d); }

    .adminTools{ margin-top:12px; display:none; }
    .input, textarea{
      width:100%; border:1px solid #d1d5db; border-radius:12px; padding:10px; font-size:15px; background:#fff;
      box-shadow: inset 0 2px 4px rgba(0,0,0,.05);
    }
    textarea{ min-height:90px; resize:vertical; }

    .saveBtn{ border:0; border-radius:12px; padding:10px 16px; font-weight:800; color:#fff; cursor:pointer; background: var(--danger-grad); box-shadow: var(--shadow-3d); }
    .row{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; }
    .muted{ color:#374151; font-size:12px; }
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <img id="logoImg" class="logoImg" alt="ZaraFix Logo" />
      <div class="logoText" id="logoText">ZaraFix</div>
    </div>
    <div class="rightZone">
      <button id="authBtn" class="authBtn">Login with Google</button>
    </div>
  </header>

  <main>
    <section class="card">
      <div class="actions">
        <a class="btn3d" id="providerBtn" href="https://zarafix.vercel.app/2poster.html">üöÄ Provider</a>
        <a class="btn3d btnHidden" id="adminBtn" href="https://zarafix.vercel.app/4-button.html">üõ†Ô∏è Admin</a>
      </div>

      <div class="noticeBoard">
        <div class="noticeTitle">üìå Notice Board</div>
        <div id="noticeView" class="noticeView">Loading notice‚Ä¶</div>

        <div id="adminTools" class="adminTools">
          <textarea id="noticeInput" placeholder="Write notice here (admin only)"></textarea>
          <div class="row" style="margin-top:8px;">
            <input class="input" type="file" id="noticeImage" accept="image/*" />
            <button class="saveBtn" id="saveNoticeBtn">Save Notice</button>
          </div>
          <div class="muted">Tip: Add an optional image; it's uploaded to ImgBB and shown under the notice.</div>
        </div>
      </div>
    </section>
  </main>

  <!-- Firebase (Compat SDK so v8-style code works reliably) -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

  <script>
    // ==== CONFIGS ====
    const ADMIN_EMAIL = 'zarasamajiksevasansth@gmail.com';
    const IMGBB_API_KEY = 'ff05d1b5c3b3e139253856f0ad1123df';

    const firebaseConfig = {
      apiKey: "AIzaSyAa8htkfGK-4D3cIQVyxT3o_8WMvghkr-8",
      authDomain: "loot-lo-15328.firebaseapp.com",
      databaseURL: "https://loot-lo-15328-default-rtdb.firebaseio.com",
      projectId: "loot-lo-15328",
      storageBucket: "loot-lo-15328.appspot.com",
      messagingSenderId: "677769861892",
      appId: "1:677769861892:web:bb235cb8479aeee9b58e51"
    };

    // ==== INIT ====
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    // ==== UI ELTS ====
    const authBtn = document.getElementById('authBtn');
    const adminBtn = document.getElementById('adminBtn');
    const adminTools = document.getElementById('adminTools');
    const noticeView = document.getElementById('noticeView');
    const noticeInput = document.getElementById('noticeInput');
    const saveNoticeBtn = document.getElementById('saveNoticeBtn');
    const noticeImage = document.getElementById('noticeImage');
    const logoImg = document.getElementById('logoImg');
    const logoText = document.getElementById('logoText');

    // ==== AUTH BUTTON ====
    authBtn.addEventListener('click', async () => {
      if(auth.currentUser){
        await auth.signOut();
      } else {
        const provider = new firebase.auth.GoogleAuthProvider();
        try{
          await auth.signInWithPopup(provider);
        }catch(err){
          alert(err.message);
        }
      }
    });

    // ==== LOAD NOTICE (ALWAYS, even if signed out) ====
    const noticeRef = db.ref('notice');
    noticeRef.on('value', (snap) => {
      const data = snap.val() || {};
      const text = data.text || '‚Äî No notice yet ‚Äî';
      const img = data.imageUrl;
      noticeView.innerHTML = '';
      const p = document.createElement('div');
      p.textContent = text;
      noticeView.appendChild(p);
      if(img){
        const im = document.createElement('img');
        im.src = img; im.alt = 'notice image'; im.className = 'noticeImg';
        noticeView.appendChild(im);
      }
      // Show logo image if admin set it
      if(data.logoUrl){
        logoImg.src = data.logoUrl; logoImg.style.display = 'block'; logoText.style.display = 'none';
      } else {
        logoImg.style.display = 'none'; logoText.style.display = 'block';
      }
    });

    // ==== AUTH STATE ====
    auth.onAuthStateChanged((user) => {
      if(user){
        authBtn.textContent = 'Logout';
        const isAdmin = user.email === ADMIN_EMAIL;
        adminBtn.classList.toggle('btnHidden', !isAdmin);
        adminTools.style.display = isAdmin ? 'block' : 'none';
      } else {
        authBtn.textContent = 'Login with Google';
        adminBtn.classList.add('btnHidden');
        adminTools.style.display = 'none';
      }
    });

    // ==== SAVE NOTICE (ADMIN ONLY on UI; rules should also enforce) ====
    saveNoticeBtn.addEventListener('click', async () => {
      const user = auth.currentUser;
      if(!user || user.email !== ADMIN_EMAIL){
        return alert('Only admin can save notices.');
      }
      const text = (noticeInput.value || '').trim();
      let imageUrl = null;

      const file = noticeImage.files && noticeImage.files[0];
      if(file){
        try{
          imageUrl = await uploadToImgBB(file);
        }catch(err){
          alert('ImgBB upload failed: ' + err.message);
          return; // don't save if image failed (optional: still save text)
        }
      }

      await db.ref('notice').set({ text, imageUrl });
      noticeInput.value = '';
      if(noticeImage) noticeImage.value = '';
      alert('Notice saved.');
    });

    // ==== ImgBB upload helper ====
    async function uploadToImgBB(file){
      const base64 = await fileToBase64(file);
      const form = new FormData();
      form.append('image', base64.split(',')[1]);
      const url = `https://api.imgbb.com/1/upload?key=${encodeURIComponent(IMGBB_API_KEY)}`;
      const res = await fetch(url, { method:'POST', body: form });
      if(!res.ok){ throw new Error('HTTP '+res.status); }
      const json = await res.json();
      if(!json || !json.success){ throw new Error('Upload failed'); }
      return json.data.display_url;
    }
    function fileToBase64(file){
      return new Promise((resolve,reject)=>{
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    // (Optional) ADMIN: set a custom logo once (uncomment to expose a quick UI)
    // Example: store under notice/logoUrl via console:
    // db.ref('notice/logoUrl').set('https://i.ibb.co/your-logo.png')

  </script>

  <!--
  ===================== IMPORTANT: Security Rules (set in Firebase Console) =====================
  Realtime Database rules example so everyone can READ notice but only admin can WRITE:

  {
    "rules": {
      ".read": true,
      "notice": {
        ".write": "auth != null && auth.token.email === 'zarasamajiksevasansth@gmail.com'"
      }
    }
  }

  (If you want to restrict reads too, adjust accordingly.)
  =================================================================================================
  -->
</body>
</html>
