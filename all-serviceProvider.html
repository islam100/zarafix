<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Service Posts</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<style>
  body {font-family:sans-serif;padding:10px;margin:0;background:#f5f5f5;}
  h2 {text-align:center;}
  form {max-width:500px;margin:10px auto;padding:15px;background:white;border-radius:10px;box-shadow:0 4px 8px rgba(0,0,0,0.1);}
  input, textarea {width:100%;padding:8px;margin:5px 0;border-radius:5px;border:1px solid #ccc;}
  button {padding:8px 15px;margin:5px;cursor:pointer;border:none;border-radius:8px;box-shadow:0 4px #999;transition:0.2s;}
  button:hover {box-shadow:0 2px #666;transform:translateY(2px);}
  .card {border-radius:10px;padding:10px;margin:10px auto;max-width:500px;background:white;box-shadow:0 4px 8px rgba(0,0,0,0.1);}
  .approved {border-left:5px solid green;}
  .waiting {border-left:5px solid orange;}
  .btn-approve {background:green;color:white;}
  .btn-reject {background:orange;color:white;}
  .btn-delete {background:red;color:white;}
  .btn-logout {background:#555;color:white;float:right;margin:10px;}
  @media(max-width:600px){form,input,textarea,.card{width:95%;}}
</style>
</head>
<body>

<h2>Service Posts</h2>
<button id="loginBtn">Login</button>
<button id="logoutBtn" style="display:none;">Logout</button>

<form id="postForm">
  <input type="text" id="shopName" placeholder="Shop Name" required>
  <input type="text" id="address" placeholder="Address" required>
  <input type="text" id="category" placeholder="Category" required>
  <input type="text" id="whatsapp" placeholder="WhatsApp No." required>
  <button type="submit">New Post</button>
</form>

<div id="postsContainer"></div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyD7ZqL-PVuFdd8rMVIyW7CgHQjPRGHD2h8",
  authDomain: "zara-fix-2e35a.firebaseapp.com",
  databaseURL: "https://zara-fix-2e35a-default-rtdb.firebaseio.com",
  projectId: "zara-fix-2e35a",
  storageBucket: "zara-fix-2e35a.appspot.com",
  messagingSenderId: "636550144008",
  appId: "1:636550144008:web:a849496ad1d1557d7ab1bd"
};


firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const auth = firebase.auth();
const adminEmail = "zarasamajiksevasanstha@gmail.com";

// Login / Logout
document.getElementById('loginBtn').onclick = ()=>{
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider);
}
document.getElementById('logoutBtn').onclick = ()=>auth.signOut();

auth.onAuthStateChanged(user=>{
    if(user){
        document.getElementById('loginBtn').style.display='none';
        document.getElementById('logoutBtn').style.display='inline-block';
    } else {
        document.getElementById('loginBtn').style.display='inline-block';
        document.getElementById('logoutBtn').style.display='none';
    }
});

// Submit post
document.getElementById('postForm').addEventListener('submit', e=>{
    e.preventDefault();
    const newPost = {
        shopName: document.getElementById('shopName').value,
        address: document.getElementById('address').value,
        category: document.getElementById('category').value,
        whatsapp: document.getElementById('whatsapp').value,
        status: 'waiting',
        timestamp: Date.now()
    };
    db.ref('posts').push(newPost);
    document.getElementById('postForm').reset();
});

// Fetch posts
db.ref('posts').on('value', snapshot=>{
    const container = document.getElementById('postsContainer');
    container.innerHTML = "";
    const posts = snapshot.val();
    if(posts){
        Object.keys(posts).sort((a,b)=>posts[b].timestamp - posts[a].timestamp).forEach(key=>{
            const p = posts[key];
            const div = document.createElement('div');
            div.className = "card " + (p.status==="approved"?"approved":"waiting");
            div.innerHTML = `
                <p><strong>${p.shopName}</strong></p>
                <p>${p.address}</p>
                <p>Category: ${p.category}</p>
                <p>WhatsApp: ${p.whatsapp}</p>
                <p>Status: ${p.status==="approved"?"Approved":"Waiting Approval"}</p>
            `;
            
            // Admin buttons
            auth.onAuthStateChanged(user=>{
                if(user && user.email===adminEmail){
                    const approveBtn = document.createElement('button');
                    approveBtn.className='btn-approve';
                    approveBtn.textContent='Approve';
                    approveBtn.onclick = ()=>db.ref('posts/'+key).update({status:'approved'});
                    
                    const rejectBtn = document.createElement('button');
                    rejectBtn.className='btn-reject';
                    rejectBtn.textContent='Reject';
                    rejectBtn.onclick = ()=>db.ref('posts/'+key).update({status:'waiting'});
                    
                    const deleteBtn = document.createElement('button');
                    deleteBtn.className='btn-delete';
                    deleteBtn.textContent='Delete';
                    deleteBtn.onclick = ()=>db.ref('posts/'+key).remove();
                    
                    div.appendChild(approveBtn);
                    div.appendChild(rejectBtn);
                    div.appendChild(deleteBtn);
                }
            });

            container.appendChild(div);
        });
    }
});
</script>

</body>
</html>
