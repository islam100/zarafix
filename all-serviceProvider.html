<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zara Service Posts</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<style>
.card {
  transition: transform 0.2s;
}
.card:hover {
  transform: translateY(-5px);
}
button {
  transition: transform 0.2s;
}
button:hover {
  transform: translateY(-2px);
}
.status-waiting { background-color: #facc15; } /* Yellow */
.status-approved { background-color: #22c55e; } /* Green */
.status-rejected { background-color: #ef4444; } /* Red */
</style>
</head>
<body class="bg-gray-100">

<div id="loginDiv" class="p-5 text-center">
  <button id="loginBtn" class="px-4 py-2 bg-blue-600 text-white rounded-md">Login with Google</button>
</div>

<div id="postDiv" class="p-5 max-w-md mx-auto hidden">
  <h2 class="text-xl font-bold mb-2">New Post</h2>
  <form id="postForm" class="flex flex-col gap-2">
    <input type="text" id="title" placeholder="Title" class="p-2 border rounded">
    <textarea id="desc" placeholder="Description" class="p-2 border rounded"></textarea>
    <input type="file" id="image" class="p-2">
    <button type="submit" class="px-4 py-2 bg-green-600 text-white rounded-md">Post</button>
  </form>
</div>

<h2 class="text-center text-2xl font-bold mt-5">All Posts</h2>
<div id="postsList" class="p-5 grid gap-4 max-w-xl mx-auto"></div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyD7ZqL-PVuFdd8rMVIyW7CgHQjPRGHD2h8",
  authDomain: "zara-fix-2e35a.firebaseapp.com",
  databaseURL: "https://zara-fix-2e35a-default-rtdb.firebaseio.com",
  projectId: "zara-fix-2e35a",
  storageBucket: "zara-fix-2e35a.appspot.com",
  messagingSenderId: "636550144008",
  appId: "1:636550144008:web:a849496ad1d1557d7ab1bd"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

const adminEmail = "zarasamajiksevasanstha@gmail.com";

const loginBtn = document.getElementById('loginBtn');
const loginDiv = document.getElementById('loginDiv');
const postDiv = document.getElementById('postDiv');
const postForm = document.getElementById('postForm');
const postsList = document.getElementById('postsList');

let currentUser = null;

// Google Login
loginBtn.onclick = () => {
  const provider = new firebase.auth.GoogleAuthProvider();
  auth.signInWithPopup(provider);
};

auth.onAuthStateChanged(user => {
  if(user) {
    currentUser = user;
    loginDiv.style.display = 'none';
    postDiv.style.display = 'block';
  } else {
    currentUser = null;
    loginDiv.style.display = 'block';
    postDiv.style.display = 'none';
  }
});

// Post Form submit
postForm.addEventListener('submit', async e => {
  e.preventDefault();
  if(!currentUser) { alert("Login required!"); return; }
  const title = document.getElementById('title').value;
  const desc = document.getElementById('desc').value;
  const file = document.getElementById('image').files[0];
  if(!title || !desc) { alert("Fill all fields"); return; }

  let imageUrl = "";
  if(file) {
    const fd = new FormData();
    fd.append('image', file);
    const r = await fetch("https://api.imgbb.com/1/upload?key=cad1f0dbfbd25346460789376cc2d7d5", { method:"POST", body:fd });
    const data = await r.json();
    imageUrl = data.data.display_url;
  }

  const newPostKey = db.ref().child('posts').push().key;
  db.ref('posts/' + newPostKey).set({
    title, desc, imageUrl,
    poster: currentUser.email,
    status: "waiting",
    timestamp: Date.now()
  });

  postForm.reset();
});

// Listen for posts
db.ref('posts').on('value', snapshot => {
  const posts = snapshot.val();
  postsList.innerHTML = "";
  if(!posts) return;
  const sortedKeys = Object.keys(posts).sort((a,b)=>posts[b].timestamp - posts[a].timestamp);
  sortedKeys.forEach(key => {
    const post = posts[key];
    const card = document.createElement('div');
    card.className = `card p-4 rounded shadow ${post.status==='approved'?'status-approved':post.status==='rejected'?'status-rejected':'status-waiting'}`;
    card.innerHTML = `
      <h3 class="font-bold text-lg">${post.title}</h3>
      <p>${post.desc}</p>
      ${post.imageUrl ? `<img src="${post.imageUrl}" class="mt-2 max-h-48 w-full object-cover rounded">` : ""}
      <p class="mt-1 font-semibold">By: ${post.poster}</p>
      <p class="mt-1 font-semibold">Status: ${post.status}</p>
    `;

    if(currentUser && currentUser.email === adminEmail){
      const approveBtn = document.createElement('button');
      approveBtn.textContent = 'Approve';
      approveBtn.className = 'px-2 py-1 m-1 bg-green-600 text-white rounded';
      approveBtn.onclick = ()=> db.ref('posts/' + key + '/status').set('approved');

      const rejectBtn = document.createElement('button');
      rejectBtn.textContent = 'Reject';
      rejectBtn.className = 'px-2 py-1 m-1 bg-red-600 text-white rounded';
      rejectBtn.onclick = ()=> db.ref('posts/' + key + '/status').set('rejected');

      const deleteBtn = document.createElement('button');
      deleteBtn.textContent = 'Delete';
      deleteBtn.className = 'px-2 py-1 m-1 bg-gray-600 text-white rounded';
      deleteBtn.onclick = ()=> db.ref('posts/' + key).remove();

      card.appendChild(approveBtn);
      card.appendChild(rejectBtn);
      card.appendChild(deleteBtn);
    }

    postsList.appendChild(card);
  });
});
</script>

</body>
</html>
