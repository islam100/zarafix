<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ZaraFix - Provider/Admin Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; background: #f0f2f5; margin:0; padding:20px; }
    .card {
      background:#fff; padding:20px; border-radius:15px; 
      box-shadow:0 4px 8px rgba(0,0,0,0.1); margin-bottom:20px;
    }
    .btn { padding:10px 15px; border:none; border-radius:8px; cursor:pointer; margin:5px; }
    .btn-accept { background:#4CAF50; color:#fff; }
    .btn-reject { background:#f44336; color:#fff; }
    h2 { margin-top:0; }
  </style>
</head>
<body>
  <h1>ZaraFix Dashboard</h1>
  <div id="dashboard"></div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <script>
    // üî• Firebase config
  const firebaseConfig = {
  apiKey: "AIzaSyD7ZqL-PVuFdd8rMVIyW7CgHQjPRGHD2h8",
  authDomain: "zara-fix-2e35a.firebaseapp.com",
  databaseURL: "https://zara-fix-2e35a-default-rtdb.firebaseio.com",
  projectId: "zara-fix-2e35a",
  storageBucket: "zara-fix-2e35a.appspot.com",
  messagingSenderId: "636550144008",
  appId: "1:636550144008:web:a849496ad1d1557d7ab1bd"
};
    firebase.initializeApp(firebaseConfig);

    const db = firebase.database();
    const dashboard = document.getElementById("dashboard");

    firebase.auth().onAuthStateChanged(user => {
      if(user){
        if(user.email === "admin@gmail.com"){
          loadAdminView();   // üëâ Admin ‡§ï‡•ã ‡§∏‡§¨ ‡§¶‡§ø‡§ñ‡•á‡§ó‡§æ
        } else {
          loadProviderView(user.uid);  // üëâ Provider ‡§ï‡•ã ‡§∏‡§ø‡§∞‡•ç‡§´ ‡§Ö‡§™‡§®‡§æ
        }
      } else {
        dashboard.innerHTML = "<p>Please login first.</p>";
      }
    });

    // -------- Provider View --------
    function loadProviderView(uid){
      db.ref("providers/"+uid).once("value", snap => {
        let data = snap.val();
        if(!data){
          dashboard.innerHTML = "<p>No profile found.</p>";
          return;
        }
        dashboard.innerHTML = `
          <div class="card">
            <h2>${data.name} (${data.category})</h2>
            <p><b>Shop:</b> ${data.shopName}</p>
            <p><b>Address:</b> ${data.address}</p>
            <p><b>WhatsApp:</b> ${data.whatsapp}</p>
            <p><b>Wallet:</b> ‚Çπ${data.wallet || 0}</p>
          </div>
        `;
      });
    }

    // -------- Admin View --------
    function loadAdminView(){
      dashboard.innerHTML = `<h2>Admin Panel</h2>`;

      // ‡§∏‡§¨ providers
      db.ref("providers").once("value", snap => {
        snap.forEach(p => {
          let data = p.val();
          let div = document.createElement("div");
          div.className = "card";
          div.innerHTML = `
            <h3>${data.name} (${data.category})</h3>
            <p><b>Shop:</b> ${data.shopName}</p>
            <p><b>Wallet:</b> ‚Çπ${data.wallet || 0}</p>
            <button class="btn btn-accept" onclick="recharge('${p.key}')">Recharge +100</button>
          `;
          dashboard.appendChild(div);
        });
      });

      // ‡§∏‡§¨ users requests
      db.ref("requests").once("value", snap => {
        snap.forEach(u => {
          u.forEach(r => {
            let req = r.val();
            let div = document.createElement("div");
            div.className = "card";
            div.innerHTML = `
              <h3>Request: ${req.category}</h3>
              <p><b>Issue:</b> ${req.issue}</p>
              <p><b>User:</b> ${req.userName || ''}</p>
            `;
            dashboard.appendChild(div);
          });
        });
      });
    }

    // Recharge for admin
    function recharge(uid){
      let ref = db.ref("providers/"+uid+"/wallet");
      ref.transaction(wallet => (wallet||0)+100);
      alert("Wallet recharged for "+uid);
    }
  </script>
</body>
</html>
