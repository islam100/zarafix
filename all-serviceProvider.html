<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ZaraFix | All Services</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  .card { @apply bg-white shadow-md rounded-lg p-4 mb-4 relative; }
  .btn3d { @apply bg-blue-500 text-white px-4 py-2 rounded-lg shadow-md hover:shadow-lg active:translate-y-1 transition-all; }
  .approved { @apply border-l-4 border-green-500; }
  .waiting { @apply border-l-4 border-yellow-500; }
  .admin-btn { @apply bg-red-500 text-white px-2 py-1 rounded shadow-md hover:shadow-lg; }
</style>
</head>
<body class="bg-gray-100 p-4">

<div class="flex justify-between mb-4">
  <button id="loginBtn" class="btn3d">Login with Google</button>
  <button id="logoutBtn" class="btn3d hidden">Logout</button>
</div>

<!-- Post Form -->
<div id="postForm" class="bg-white p-4 rounded shadow-md mb-6 hidden">
  <h2 class="text-xl font-bold mb-2">New Post</h2>
  <input type="text" id="shopName" placeholder="Shop Name" class="w-full mb-2 p-2 border rounded"/>
  <input type="text" id="address" placeholder="Address" class="w-full mb-2 p-2 border rounded"/>
  <input type="text" id="whatsapp" placeholder="WhatsApp Number" class="w-full mb-2 p-2 border rounded"/>
  <input type="file" id="imageFile" class="mb-2"/>
  <button id="submitPost" class="btn3d">Submit Post</button>
</div>

<!-- Posts List -->
<div id="postsList"></div>

<script>
  // Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyD7ZqL-PVuFdd8rMVIyW7CgHQjPRGHD2h8",
  authDomain: "zara-fix-2e35a.firebaseapp.com",
  databaseURL: "https://zara-fix-2e35a-default-rtdb.firebaseio.com",
  projectId: "zara-fix-2e35a",
  storageBucket: "zara-fix-2e35a.appspot.com",
  messagingSenderId: "636550144008",
  appId: "1:636550144008:web:a849496ad1d1557d7ab1bd"
};

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();
  const storage = firebase.storage();

  const loginBtn = document.getElementById("loginBtn");
  const logoutBtn = document.getElementById("logoutBtn");
  const postForm = document.getElementById("postForm");
  const postsList = document.getElementById("postsList");

  let currentUser = null;
  const adminEmail = "zarasamajiksevasanstha@gmail.com";

  // Login
  loginBtn.addEventListener("click", () => {
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider);
  });

  // Logout
  logoutBtn.addEventListener("click", () => auth.signOut());

  // Auth state change
  auth.onAuthStateChanged(user => {
    currentUser = user;
    if(user){
      loginBtn.classList.add("hidden");
      logoutBtn.classList.remove("hidden");
      postForm.classList.remove("hidden");
      loadPosts();
    } else {
      loginBtn.classList.remove("hidden");
      logoutBtn.classList.add("hidden");
      postForm.classList.add("hidden");
      postsList.innerHTML = "";
    }
  });

  // Submit Post
  document.getElementById("submitPost").addEventListener("click", async () => {
    const shopName = document.getElementById("shopName").value.trim();
    const address = document.getElementById("address").value.trim();
    const whatsapp = document.getElementById("whatsapp").value.trim();
    const file = document.getElementById("imageFile").files[0];
    if(!shopName || !address || !whatsapp || !file) return alert("सब फील्ड भरें।");

    const storageRef = storage.ref("posts/" + file.name);
    await storageRef.put(file);
    const imageUrl = await storageRef.getDownloadURL();

    await db.collection("posts").add({
      shopName,
      address,
      whatsapp,
      imageUrl,
      uid: currentUser.uid,
      email: currentUser.email,
      status: "waiting",
      timestamp: firebase.firestore.FieldValue.serverTimestamp()
    });

    document.getElementById("shopName").value = "";
    document.getElementById("address").value = "";
    document.getElementById("whatsapp").value = "";
    document.getElementById("imageFile").value = "";
  });

  // Load Posts
  function loadPosts(){
    db.collection("posts").orderBy("timestamp","desc").onSnapshot(snapshot => {
      postsList.innerHTML = "";
      snapshot.docs.forEach(doc => {
        const data = doc.data();
        const isAdmin = currentUser && currentUser.email === adminEmail;
        let card = document.createElement("div");
        card.className = "card " + (data.status === "approved" ? "approved" : "waiting");
        card.innerHTML = `
          <img src="${data.imageUrl}" class="w-full h-48 object-cover rounded mb-2"/>
          <h3 class="text-lg font-bold">${data.shopName}</h3>
          <p>${data.address}</p>
          <a href="https://wa.me/${data.whatsapp}" target="_blank" class="btn3d inline-block mt-2">WhatsApp</a>
          <p class="mt-2 font-bold">Status: ${data.status}</p>
        `;
        if(isAdmin){
          const approveBtn = document.createElement("button");
          approveBtn.className = "admin-btn m-1";
          approveBtn.innerText = "Approve";
          approveBtn.onclick = () => doc.ref.update({status:"approved"});
          
          const rejectBtn = document.createElement("button");
          rejectBtn.className = "admin-btn m-1 bg-yellow-500";
          rejectBtn.innerText = "Reject";
          rejectBtn.onclick = () => doc.ref.update({status:"waiting"});
          
          const deleteBtn = document.createElement("button");
          deleteBtn.className = "admin-btn m-1 bg-gray-700";
          deleteBtn.innerText = "Delete";
          deleteBtn.onclick = () => doc.ref.delete();

          card.appendChild(approveBtn);
          card.appendChild(rejectBtn);
          card.appendChild(deleteBtn);
        } else if(data.uid === currentUser.uid){
          const deleteBtn = document.createElement("button");
          deleteBtn.className = "admin-btn m-1 bg-gray-700";
          deleteBtn.innerText = "Delete";
          deleteBtn.onclick = () => doc.ref.delete();
          card.appendChild(deleteBtn);
        }

        if(data.status==="approved" || isAdmin || data.uid===currentUser.uid){
          postsList.appendChild(card);
        }
      });
    });
  }
</script>

</body>
</html>
