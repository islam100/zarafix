<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>All Service Posts</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<style>
  body { font-family: Arial, sans-serif; margin: 10px; }
  .btn3d {
    background: linear-gradient(#4CAF50, #2E7D32);
    border: none; color: white; padding: 10px 20px;
    text-align: center; font-size: 16px;
    border-radius: 10px; cursor: pointer;
    box-shadow: 0 5px #1B5E20;
  }
  .btn3d:active { box-shadow: 0 2px #1B5E20; transform: translateY(3px); }
  #postForm { margin-top: 20px; display: none; }
  .post { border: 1px solid #ccc; margin: 10px 0; padding: 10px; border-radius: 8px; }
</style>
</head>
<body>

<h2>All Service Posts</h2>

<button id="loginBtn" class="btn3d">Login with Google</button>
<button id="logoutBtn" class="btn3d" style="display:none;">Logout</button>

<div id="postForm">
  <h3>New Post</h3>
  <input type="text" id="title" placeholder="Title" style="width:100%; padding:5px; margin:5px 0;">
  <textarea id="desc" placeholder="Description" style="width:100%; padding:5px; margin:5px 0;"></textarea>
  <input type="file" id="image"><br><br>
  <button id="submitPost" class="btn3d">Submit Post</button>
</div>

<h3>Approved Posts</h3>
<div id="postsList"></div>

<script>
  // Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyD7ZqL-PVuFdd8rMVIyW7CgHQjPRGHD2h8",
  authDomain: "zara-fix-2e35a.firebaseapp.com",
  databaseURL: "https://zara-fix-2e35a-default-rtdb.firebaseio.com",
  projectId: "zara-fix-2e35a",
  storageBucket: "zara-fix-2e35a.appspot.com",
  messagingSenderId: "636550144008",
  appId: "1:636550144008:web:a849496ad1d1557d7ab1bd"
};

  firebase.initializeApp(firebaseConfig);

  const auth = firebase.auth();
  const db = firebase.database();

  const loginBtn = document.getElementById('loginBtn');
  const logoutBtn = document.getElementById('logoutBtn');
  const postForm = document.getElementById('postForm');
  const submitPost = document.getElementById('submitPost');
  const postsList = document.getElementById('postsList');

  loginBtn.onclick = () => {
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider);
  };

  logoutBtn.onclick = () => auth.signOut();

  auth.onAuthStateChanged(user => {
    if(user){
      loginBtn.style.display='none';
      logoutBtn.style.display='inline-block';
      postForm.style.display='block';
      // Check admin
      if(user.email==='zarasamajiksevasanstha@gmail.com'){
        alert('Welcome Admin');
      }
    } else {
      loginBtn.style.display='inline-block';
      logoutBtn.style.display='none';
      postForm.style.display='none';
    }
  });

  // Submit post
  submitPost.onclick = async () => {
    const title = document.getElementById('title').value.trim();
    const desc = document.getElementById('desc').value.trim();
    const imgFile = document.getElementById('image').files[0];

    if(!title || !desc){
      alert('Title और Description दोनों भरें');
      return;
    }

    let imageUrl = '';
    if(imgFile){
      const fd = new FormData();
      fd.append('image', imgFile);
      const r = await fetch("https://api.imgbb.com/1/upload?key=cad1f0dbfbd25346460789376cc2d7d5", {method:"POST", body:fd});
      const result = await r.json();
      imageUrl = result.data.url;
    }

    const newPost = {
      title,
      desc,
      imageUrl,
      approved: true, // approved by default for all users to see
      timestamp: Date.now()
    };
    db.ref('posts').push(newPost);
    document.getElementById('title').value='';
    document.getElementById('desc').value='';
    document.getElementById('image').value='';
  };

  // Show approved posts
  db.ref('posts').on('value', snapshot => {
    postsList.innerHTML = '';
    snapshot.forEach(child => {
      const p = child.val();
      if(p.approved){
        const div = document.createElement('div');
        div.className='post';
        div.innerHTML = `<h4>${p.title}</h4><p>${p.desc}</p>${p.imageUrl?'<img src="'+p.imageUrl+'" style="max-width:100%;">':''}`;
        postsList.appendChild(div);
      }
    });
  });
</script>

</body>
</html>
