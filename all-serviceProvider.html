<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Service Posts</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<style>
  body{font-family:sans-serif;padding:20px;}
  .card{border:1px solid #ccc;padding:10px;margin:10px 0;border-radius:10px;position:relative;}
  .approved{background-color:#d4edda;}
  .waiting{background-color:#fff3cd;}
  .btn{padding:5px 10px;margin:2px;cursor:pointer;border:none;border-radius:5px;}
  .approve{background-color:green;color:white;}
  .reject{background-color:red;color:white;}
  .delete{background-color:#555;color:white;}
</style>
</head>
<body>

<h2>Service Posts</h2>
<div id="postsContainer"></div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyD7ZqL-PVuFdd8rMVIyW7CgHQjPRGHD2h8",
  authDomain: "zara-fix-2e35a.firebaseapp.com",
  databaseURL: "https://zara-fix-2e35a-default-rtdb.firebaseio.com",
  projectId: "zara-fix-2e35a",
  storageBucket: "zara-fix-2e35a.appspot.com",
  messagingSenderId: "636550144008",
  appId: "1:636550144008:web:a849496ad1d1557d7ab1bd"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const auth = firebase.auth();
const adminEmail = "zarasamajiksevasanstha@gmail.com";

// Login user (popup)
function login() {
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider);
}

// Check login
auth.onAuthStateChanged(user=>{
    if(user && user.email===adminEmail){
        console.log("Admin logged in");
    }else if(user){
        console.log("User logged in");
    }else{
        console.log("Not logged in");
    }
});

// Fetch posts
db.ref('posts').on('value', snapshot=>{
    const container = document.getElementById('postsContainer');
    container.innerHTML = "";
    const posts = snapshot.val();
    if(posts){
        Object.keys(posts).sort((a,b)=>posts[b].timestamp - posts[a].timestamp).forEach(key=>{
            const p = posts[key];
            const div = document.createElement('div');
            div.className = "card " + (p.status==="approved"?"approved":"waiting");
            div.innerHTML = `
                <p><strong>${p.title}</strong></p>
                <p>${p.description}</p>
                <p>Status: ${p.status==="approved"?"Approved":"Waiting Approval"}</p>
            `;
            // Admin buttons
            auth.onAuthStateChanged(user=>{
                if(user && user.email===adminEmail){
                    const approveBtn = document.createElement('button');
                    approveBtn.className = 'btn approve';
                    approveBtn.textContent = 'Approve';
                    approveBtn.onclick = ()=>db.ref('posts/'+key).update({status:'approved'});
                    
                    const rejectBtn = document.createElement('button');
                    rejectBtn.className = 'btn reject';
                    rejectBtn.textContent = 'Reject';
                    rejectBtn.onclick = ()=>db.ref('posts/'+key).update({status:'waiting'});
                    
                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'btn delete';
                    deleteBtn.textContent = 'Delete';
                    deleteBtn.onclick = ()=>db.ref('posts/'+key).remove();
                    
                    div.appendChild(approveBtn);
                    div.appendChild(rejectBtn);
                    div.appendChild(deleteBtn);
                }
            });
            container.appendChild(div);
        });
    }
});
</script>

</body>
</html>
