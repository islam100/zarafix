<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ZaraFix â€“ Public | New Post</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<style>
  body { font-family: Arial, sans-serif; padding: 10px; }
  input, textarea, button { padding: 10px; margin: 5px 0; width: 100%; box-sizing: border-box; }
  button { background: linear-gradient(145deg,#eee,#ccc); border: none; border-radius: 10px; box-shadow: 5px 5px 10px #aaa, -5px -5px 10px #fff; cursor: pointer; }
  button:hover { box-shadow: inset 5px 5px 10px #aaa, inset -5px -5px 10px #fff; }
  #postForm { display: none; }
  img { max-width: 100%; height: auto; }
  .post { border:1px solid #ddd; border-radius:10px; padding:10px; margin:10px 0; box-shadow:2px 2px 5px #aaa; }
</style>
</head>
<body>

<h2>ZaraFix Posts</h2>

<div id="loginDiv">
  <button id="loginBtn">Login with Google</button>
</div>

<div id="postFormDiv">
  <form id="postForm">
    <label>Title</label>
    <input type="text" id="title" required><br>

    <label>Description</label>
    <textarea id="description" required></textarea><br>

    <label>Image</label>
    <input type="file" id="image" accept="image/*" required><br>

    <button type="submit">Add Post</button>
    <button type="button" id="logoutBtn">Logout</button>
  </form>
</div>

<hr>

<h3>Search Posts</h3>
<input type="text" id="search" placeholder="Search posts...">
<div id="posts"></div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyD7ZqL-PVuFdd8rMVIyW7CgHQjPRGHD2h8",
  authDomain: "zara-fix-2e35a.firebaseapp.com",
  databaseURL: "https://zara-fix-2e35a-default-rtdb.firebaseio.com",
  projectId: "zara-fix-2e35a",
  storageBucket: "zara-fix-2e35a.appspot.com",
  messagingSenderId: "636550144008",
  appId: "1:636550144008:web:a849496ad1d1557d7ab1bd"
};

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.database().ref('posts');

const loginBtn = document.getElementById('loginBtn');
const logoutBtn = document.getElementById('logoutBtn');
const postFormDiv = document.getElementById('postFormDiv');
const postForm = document.getElementById('postForm');
const postsDiv = document.getElementById('posts');

let adminEmail = "zarasamajiksevasanstha@gmail.com";
let currentUserEmail = "";

// Login
loginBtn.onclick = () => {
  const provider = new firebase.auth.GoogleAuthProvider();
  auth.signInWithPopup(provider);
}

// Logout
logoutBtn.onclick = () => {
  auth.signOut();
}

// Auth state listener
auth.onAuthStateChanged(user => {
  if(user){
    currentUserEmail = user.email;
    loginBtn.style.display = "none";
    postFormDiv.style.display = "block";
  } else {
    currentUserEmail = "";
    loginBtn.style.display = "block";
    postFormDiv.style.display = "none";
  }
});

// Submit post
postForm.addEventListener('submit', async (e)=>{
  e.preventDefault();
  if(!currentUserEmail){
    alert("Please login first!");
    return;
  }

  const title = document.getElementById('title').value;
  const description = document.getElementById('description').value;
  const imageFile = document.getElementById('image').files[0];

  const fd = new FormData();
  fd.append("image", imageFile);

  const res = await fetch("https://api.imgbb.com/1/upload?key=cad1f0dbfbd25346460789376cc2d7d5", {
    method: "POST",
    body: fd
  });
  const data = await res.json();
  const imageUrl = data.data.display_url;

  const newPost = {
    title,
    description,
    image: imageUrl,
    author: currentUserEmail,
    timestamp: Date.now()
  };
  db.push(newPost);
  postForm.reset();
  loadPosts();
});

// Load posts with search
function loadPosts(filter=""){
  db.on('value', snapshot=>{
    postsDiv.innerHTML = "";
    const posts = snapshot.val();
    for(let id in posts){
      const post = posts[id];
      if(filter && !post.title.toLowerCase().includes(filter.toLowerCase()) && !post.description.toLowerCase().includes(filter.toLowerCase())) continue;
      const div = document.createElement('div');
      div.classList.add('post');
      div.innerHTML = `<h3>${post.title}</h3>
                       <p>${post.description}</p>
                       <img src="${post.image}">`;
      postsDiv.appendChild(div);
    }
  });
}

document.getElementById('search').addEventListener('input', (e)=>{
  loadPosts(e.target.value);
});

// Initial load
loadPosts();
</script>
</body>
</html>
