<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ZaraFix | All Services</title>
<meta name="description" content="ZaraFix ‡§Æ‡•á‡§Ç ‡§∏‡§≠‡•Ä service providers ‡§ï‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§™‡§æ‡§è‡§Å‡•§ ‡§Ü‡§∏‡§æ‡§®‡•Ä ‡§∏‡•á contact ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ booking ‡§ï‡§∞‡•á‡§Ç‡•§">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body { margin:0; font-family:Arial, sans-serif; background:#f5f5f5; }
header { background:linear-gradient(135deg,#2196F3,#21CBF3); color:white; display:flex; align-items:center; justify-content:space-between; padding:10px 20px; box-shadow:0 3px 8px rgba(0,0,0,0.3); flex-wrap:wrap; }
header h1 { margin:0; font-size:20px; text-shadow:1px 1px 3px #000; }
button { cursor:pointer; padding:6px 10px; border:none; border-radius:6px; box-shadow:0 3px 5px rgba(0,0,0,0.25); font-weight:bold; margin:3px; font-size:13px; }
.searchBar { margin:12px; display:flex; justify-content:center; align-items:center; gap:10px; flex-wrap:wrap; }
.searchBar input { padding:8px; border-radius:6px; border:1px solid #ccc; font-size:14px; min-width:180px; }

.grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap:16px; padding:12px; }
.card { background:#fff; border-radius:12px; box-shadow:0 3px 6px rgba(0,0,0,0.12); padding:12px; position:relative; transition: transform 0.2s ease, box-shadow 0.2s ease; cursor:pointer; font-size:14px; border:2px solid red; overflow:hidden; }
.card:hover { border-color:blue; transform:translateY(-3px) scale(1.02); }
.card img { width:100%; height:180px; object-fit:contain; background:#f9f9f9; border-radius:8px; padding:6px; margin-bottom:10px; display:block; }
.card h3 { margin:6px 0; font-size:15px; font-weight:600; color:#222; text-overflow:ellipsis; white-space:nowrap; overflow:hidden; }
.card p { margin:4px 0; font-size:13px; color:#555; line-height:1.5; }
.pending { background:#ffcdd2; border:2px solid #f44336; animation:blinkBorder 1s infinite; }
@keyframes blinkBorder { 50% { border-color:#b71c1c; } }
.modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); align-items:center; justify-content:center; }
.modal-content { background:#fff; padding:15px; border-radius:10px; width:90%; max-width:420px; max-height:90%; overflow:auto; position:relative; font-size:14px; }
.close { position:absolute; top:8px; right:12px; cursor:pointer; font-weight:bold; font-size:18px; }
.btnRow { margin-top:6px; display:flex; flex-wrap:wrap; gap:5px; }
</style>
</head>
<body>
<header>
  <h1>All Services</h1>
  <div>
    <a href="index.html"><button style="background-color:blue; color:white;">üè° Home</button></a>
    <button id="loginBtn" style="background-color:#4ade80; color:white;">üîë Login</button>
    <button id="logoutBtn" style="display:none; background-color:#ef4444; color:white;">Logout</button>
    <button id="newPostBtn" style="display:none; background-color:#2563eb; color:white;">+ New Post</button>
  </div>
</header>

<!-- Search Bar -->
<div class="searchBar">
  <input type="text" id="searchInput" placeholder="Search by type, shop, address, name...">
  <input type="text" id="categoryInput" placeholder="Type Service Category...">
</div>

<main>
  <div class="grid" id="posts"></div>
</main>

<!-- Card Modal -->
<div class="modal" id="cardModal">
  <div class="modal-content" id="cardContent">
    <span class="close" id="closeCard">&times;</span>
  </div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyD7ZqL-PVuFdd8rMVIyW7CgHQjPRGHD2h8",
  authDomain: "zara-fix-2e35a.firebaseapp.com",
  databaseURL: "https://zara-fix-2e35a-default-rtdb.firebaseio.com",
  projectId: "zara-fix-2e35a",
  storageBucket: "zara-fix-2e35a.appspot.com",
  messagingSenderId: "636550144008",
  appId: "1:636550144008:web:a849496ad1d1557d7ab1bd"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

const loginBtn = document.getElementById('loginBtn');
const logoutBtn = document.getElementById('logoutBtn');
const newPostBtn = document.getElementById('newPostBtn');
const postsDiv = document.getElementById('posts');
const cardModal = document.getElementById('cardModal');
const cardContent = document.getElementById('cardContent');
const closeCard = document.getElementById('closeCard');
const searchInput = document.getElementById('searchInput');
const categoryInput = document.getElementById('categoryInput');

let currentUser = null;
let allPosts = [];

loginBtn.onclick = () => { const provider = new firebase.auth.GoogleAuthProvider(); auth.signInWithPopup(provider); };
logoutBtn.onclick = () => auth.signOut();

auth.onAuthStateChanged(u => {
  currentUser = u;
  if(u){
    loginBtn.style.display="none";
    logoutBtn.style.display="inline-block";
    newPostBtn.style.display="inline-block";
  } else {
    loginBtn.style.display="inline-block";
    logoutBtn.style.display="none";
    newPostBtn.style.display="none";
  }
  loadPosts();
});

closeCard.onclick = ()=>cardModal.style.display="none";

// Load posts
function loadPosts(){
  db.ref("posts").orderByChild("created").on("value", snap => {
    allPosts = [];
    snap.forEach(ch => { allPosts.push({...ch.val(), id: ch.key}); });
    allPosts.reverse();
    renderPosts();
  });
}

// Render posts
function renderPosts(){
  postsDiv.innerHTML="";
  const keyword = searchInput.value.toLowerCase();
  const category = categoryInput.value.toLowerCase();

  allPosts.forEach(p=>{
    // Admin sees all
    if(currentUser?.email !== "zarasamajiksevasanstha@gmail.com"){
      if(p.status!=="approved" && (!currentUser || p.posterUid!==currentUser.uid)) return;
    }

    // Filter
    if(category && !p.posterType?.toLowerCase().includes(category)) return;
    if(keyword && !(p.shopName?.toLowerCase().includes(keyword) ||
                    p.address?.toLowerCase().includes(keyword) ||
                    p.posterName?.toLowerCase().includes(keyword))) return;

    const card = document.createElement("div");
    card.className="card";
    if(p.status==="pending") card.classList.add("pending");

    if(p.images && p.images.length){
      const img = document.createElement("img");
      img.src = p.images[0];
      card.appendChild(img);
    }

    card.innerHTML += `<p><b>Shop:</b> ${p.shopName}</p>
                       <p>${p.address}</p>
                       <p>üë§ ${p.posterName} (${p.posterType})</p>
                       <p>${p.status==="approved"?"‚úÖ Approved":"‚è≥ Pending"}</p>`;

    card.onclick = ()=>{
      cardContent.innerHTML='<span class="close" id="closeCard">&times;</span>';
      cardContent.innerHTML += `<p><b>Shop:</b> ${p.shopName}</p>
                                <p><b>Address:</b> ${p.address}</p>
                                <p><b>Poster:</b> ${p.posterName} (${p.posterType})</p>
                                <p><b>Phone:</b> ${p.posterPhone}</p>`;
      if(p.images){
        p.images.forEach(u=>{
          cardContent.innerHTML += `<img src="${u}" style="width:100%; margin:5px 0; border-radius:8px;">`;
        });
      }
      cardModal.style.display="flex";
      document.getElementById("closeCard").onclick=()=>cardModal.style.display="none";
    };

    postsDiv.appendChild(card);
  });
}

searchInput.addEventListener("input", renderPosts);
categoryInput.addEventListener("input", renderPosts);
</script>
</body>
</html>
