<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zara Property Listing</title>
<style>
  body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f5f5f5; }
  header { background: #333; color: #fff; padding: 10px; text-align: center; font-size: 24px; font-weight: bold; }
  .property-list { display: flex; flex-wrap: wrap; justify-content: center; margin: 20px; }
  .property-card { background: #fff; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); margin: 10px; width: 300px; overflow: hidden; display: flex; flex-direction: column; }
  .property-card img { width: 100%; height: 200px; object-fit: cover; }
  .property-card .content { padding: 10px; flex: 1; display: flex; flex-direction: column; justify-content: space-between; }
  .btn { padding: 10px 15px; margin-top: 10px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; box-shadow: 0 4px #999; transition: all 0.2s; }
  .btn:hover { transform: translateY(-2px); box-shadow: 0 6px #666; }
  .btn:active { transform: translateY(2px); box-shadow: 0 2px #666; }
  .btn-green { background: #28a745; color: white; }
  .btn-red { background: #dc3545; color: white; }
  #uploadForm { display: none; background: #fff; padding: 20px; border-radius: 10px; margin: 20px; max-width: 400px; }
  input, select, textarea { width: 100%; padding: 8px; margin: 5px 0; border-radius: 5px; border: 1px solid #ccc; }
</style>
<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
</head>
<body>

<header>Zara Property Listing</header>

<div style="text-align:center; margin: 10px;">
  <button id="loginBtn" class="btn btn-green">Admin Login</button>
  <button id="logoutBtn" class="btn btn-red" style="display:none;">Logout</button>
</div>

<div id="uploadForm">
  <h3>Post Property</h3>
  <input type="text" id="title" placeholder="Title">
  <input type="text" id="city" placeholder="City">
  <select id="type">
    <option value="sale">Sale</option>
    <option value="rent">Rent</option>
  </select>
  <input type="number" id="price" placeholder="Price">
  <textarea id="description" placeholder="Description"></textarea>
  <input type="text" id="whatsapp" placeholder="WhatsApp Number">
  <input type="file" id="imageFile">
  <button id="postBtn" class="btn btn-green">Post Property</button>
</div>

<div class="property-list" id="propertyList"></div>

<script>
  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyDTj2n1yhr1sFmuyBZ-jUwOmx1YqAN5QjA",
    authDomain: "property-20d6d.firebaseapp.com",
    databaseURL: "https://property-20d6d-default-rtdb.firebaseio.com",
    projectId: "property-20d6d",
    storageBucket: "property-20d6d.appspot.com",
    messagingSenderId: "916859697394",
    appId: "1:916859697394:web:2a8f9ad2d62f8306dcb86b"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const auth = firebase.auth();

  const adminEmails = ["admin@example.com"];
  let isAdmin = false;

  const loginBtn = document.getElementById('loginBtn');
  const logoutBtn = document.getElementById('logoutBtn');
  const uploadForm = document.getElementById('uploadForm');
  const propertyList = document.getElementById('propertyList');

  loginBtn.onclick = () => {
    const email = prompt("Admin Email:");
    const password = prompt("Password:");
    auth.signInWithEmailAndPassword(email, password).then((userCredential) => {
      if(adminEmails.includes(email)) {
        isAdmin = true;
        alert("Admin logged in");
        uploadForm.style.display = 'block';
        loginBtn.style.display = 'none';
        logoutBtn.style.display = 'inline-block';
        loadProperties();
      } else {
        alert("Not an admin");
        auth.signOut();
      }
    }).catch(err => alert(err.message));
  };

  logoutBtn.onclick = () => {
    auth.signOut();
    isAdmin = false;
    uploadForm.style.display = 'none';
    loginBtn.style.display = 'inline-block';
    logoutBtn.style.display = 'none';
    loadProperties();
  };

  async function uploadImageToIMGBB(file) {
    const apiKey = "5128d0b0687e9718139752bca8a4ec59";
    const formData = new FormData();
    formData.append("image", file);
    const response = await fetch(`https://api.imgbb.com/1/upload?key=${apiKey}`, {
      method: "POST",
      body: formData
    });
    const data = await response.json();
    return data.data.url;
  }

  document.getElementById('postBtn').onclick = async () => {
    const title = document.getElementById('title').value;
    const city = document.getElementById('city').value;
    const type = document.getElementById('type').value;
    const price = document.getElementById('price').value;
    const description = document.getElementById('description').value;
    const whatsapp = document.getElementById('whatsapp').value;
    const imageFile = document.getElementById('imageFile').files[0];

    if(!title || !city || !price || !description || !whatsapp || !imageFile) {
      alert("Please fill all fields");
      return;
    }

    const imageUrl = await uploadImageToIMGBB(imageFile);

    const newPropRef = db.ref('properties').push();
    newPropRef.set({
      title, city, type, price: Number(price), description,
      whatsapp, userId: auth.currentUser.uid, userEmail: auth.currentUser.email,
      approved: true, timestamp: Date.now(), imageUrl
    });

    alert("Property posted!");
    uploadForm.reset();
    loadProperties();
  };

  function loadProperties() {
    propertyList.innerHTML = '';
    db.ref('properties').orderByChild('timestamp').once('value', snapshot => {
      const data = snapshot.val();
      if(!data) return;
      const keys = Object.keys(data).sort((a,b)=>data[b].timestamp - data[a].timestamp);
      keys.forEach(key => {
        const prop = data[key];
        if(!prop.approved) return;
        const card = document.createElement('div');
        card.className = 'property-card';
        card.innerHTML = `
          <img src="${prop.imageUrl}" alt="${prop.title}">
          <div class="content">
            <div>
              <h3>${prop.title}</h3>
              <p>${prop.city} | ${prop.type}</p>
              <p>â‚¹${prop.price}</p>
              <p>${prop.description}</p>
            </div>
            <div>
              <a href="https://wa.me/${prop.whatsapp}" target="_blank"><button class="btn btn-green">WhatsApp</button></a>
              ${isAdmin ? `<button class="btn btn-red" onclick="deleteProperty('${key}')">Delete</button>` : ''}
            </div>
          </div>
        `;
        propertyList.appendChild(card);
      });
    });
  }

  function deleteProperty(key) {
    if(confirm("Are you sure to delete?")) {
      db.ref('properties/'+key).remove();
      loadProperties();
    }
  }

  loadProperties();
</script>

</body>
</html>
