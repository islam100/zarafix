<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Property Listings</title>
<style>
  body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f0f0f0; }
  header { background: #004aad; color: white; padding: 10px; display: flex; justify-content: space-between; align-items: center; }
  header h1 { margin: 0; font-size: 24px; }
  #loginBtn { background: #ffc107; border: none; padding: 8px 12px; cursor: pointer; border-radius: 5px; }
  #propertyForm { display:none; margin: 10px; background: white; padding: 15px; border-radius: 10px; box-shadow: 0 0 5px rgba(0,0,0,0.2); }
  input, textarea, select { width: 100%; padding: 8px; margin: 5px 0; }
  button { background: #004aad; color: white; border: none; padding: 8px 12px; cursor: pointer; border-radius: 5px; }
  .property-card { background: white; margin: 10px; padding: 10px; border-radius: 10px; box-shadow: 0 0 5px rgba(0,0,0,0.2); display: inline-block; width: 300px; vertical-align: top; }
  .property-card img { width: 100%; height: 200px; object-fit: contain; border-radius: 10px; }
  .admin-btn { background: red; margin-top:5px; }
</style>
</head>
<body>

<header>
  <h1>Property Listings</h1>
  <button id="loginBtn">Login with Google</button>
</header>

<div id="propertyForm">
  <h3>Post Property</h3>
  <input type="text" id="title" placeholder="Title">
  <input type="text" id="city" placeholder="City">
  <select id="type">
    <option value="sale">Sale</option>
    <option value="rent">Rent</option>
  </select>
  <input type="number" id="price" placeholder="Price">
  <textarea id="description" placeholder="Description"></textarea>
  <input type="text" id="whatsapp" placeholder="WhatsApp Number">
  <input type="file" id="imageFile">
  <button id="postBtn">Post Property</button>
</div>

<div id="propertyList"></div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDTj2n1yhr1sFmuyBZ-jUwOmx1YqAN5QjA",
  authDomain: "property-20d6d.firebaseapp.com",
  databaseURL: "https://property-20d6d-default-rtdb.firebaseio.com",
  projectId: "property-20d6d",
  storageBucket: "property-20d6d.appspot.com",
  messagingSenderId: "916859697394",
  appId: "1:916859697394:web:2a8f9ad2d62f8306dcb86b"
};
firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.database();

let currentUser = null;
const admins = {"admin@example.com": true}; // एडमिन ईमेल

const loginBtn = document.getElementById('loginBtn');
const propertyForm = document.getElementById('propertyForm');
const postBtn = document.getElementById('postBtn');
const propertyList = document.getElementById('propertyList');

loginBtn.addEventListener('click', () => {
  const provider = new firebase.auth.GoogleAuthProvider();
  auth.signInWithPopup(provider);
});

auth.onAuthStateChanged(user => {
  if(user){
    currentUser = user;
    loginBtn.style.display = 'none';
    propertyForm.style.display = 'block';
    fetchProperties();
  } else {
    currentUser = null;
    loginBtn.style.display = 'block';
    propertyForm.style.display = 'none';
  }
});

// Post property
postBtn.addEventListener('click', async () => {
  const title = document.getElementById('title').value;
  const city = document.getElementById('city').value;
  const type = document.getElementById('type').value;
  const price = document.getElementById('price').value;
  const description = document.getElementById('description').value;
  const whatsapp = document.getElementById('whatsapp').value;
  const file = document.getElementById('imageFile').files[0];
  if(!title || !city || !price || !description || !whatsapp || !file) { alert('सब भरें'); return; }

  // ImgBB Upload
  const formData = new FormData();
  formData.append('image', file);
  const apiKey = '5128d0b0687e9718139752bca8a4ec59'; // आपका ImgBB key
  const res = await fetch(`https://api.imgbb.com/1/upload?key=${apiKey}`, { method:'POST', body: formData });
  const data = await res.json();
  const imageUrl = data.data.url;

  const newPropertyRef = db.ref('properties').push();
  newPropertyRef.set({
    title, city, type, price, description, whatsapp,
    imageUrl, userId: currentUser.uid, userEmail: currentUser.email,
    approved: admins[currentUser.email] ? true : false,
    timestamp: Date.now()
  });

  alert('Property Posted!');
  document.getElementById('title').value='';
  document.getElementById('city').value='';
  document.getElementById('price').value='';
  document.getElementById('description').value='';
  document.getElementById('whatsapp').value='';
  document.getElementById('imageFile').value='';
});

// Fetch properties
function fetchProperties(){
  db.ref('properties').on('value', snapshot => {
    propertyList.innerHTML = '';
    const properties = snapshot.val();
    for(let key in properties){
      const prop = properties[key];
      if(!prop.approved && !admins[currentUser.email]) continue;
      const card = document.createElement('div');
      card.className = 'property-card';
      card.innerHTML = `
        <img src="${prop.imageUrl}" alt="${prop.title}">
        <h3>${prop.title}</h3>
        <p>${prop.city} | ${prop.type} | ₹${prop.price}</p>
        <p>${prop.description}</p>
        <p>WhatsApp: <a href="https://wa.me/${prop.whatsapp}" target="_blank">${prop.whatsapp}</a></p>
      `;
      if(admins[currentUser.email]){
        const approveBtn = document.createElement('button');
        approveBtn.textContent = prop.approved ? 'Approved' : 'Approve';
        approveBtn.style.background = prop.approved ? 'green' : 'orange';
        approveBtn.onclick = () => db.ref('properties/'+key+'/approved').set(true);
        const delBtn = document.createElement('button');
        delBtn.textContent = 'Delete';
        delBtn.className='admin-btn';
        delBtn.onclick = () => db.ref('properties/'+key).remove();
        card.appendChild(approveBtn);
        card.appendChild(delBtn);
      }
      propertyList.appendChild(card);
    }
  });
}
</script>
</body>
</html>
