<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Poster Registration</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
    }
    form, .dashboard {
      max-width: 400px;
      margin: auto;
      background: #f5f5f5;
      padding: 20px;
      border-radius: 10px;
    }
    label {
      display: block;
      margin-top: 10px;
    }
    input, select, button {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      font-size: 16px;
    }
    .dashboard {
      display: none;
      text-align: center;
    }
  </style>
</head>
<body>

<form id="posterForm">
  <h2>üìù Poster Registration</h2>
  
  <label>Name:</label>
  <input type="text" id="name" required />

  <label>WhatsApp Number:</label>
  <input type="tel" id="whatsapp" inputmode="numeric" pattern="[0-9]{10}" maxlength="10" required />

  <label>Shop Name:</label>
  <input type="text" id="shopname" required />

  <label>Category:</label>
  <select id="category" required>
    <option value="">Select Category</option>
    <option value="Clothing">Clothing</option>
    <option value="Electronics">Electronics</option>
  </select>

  <label>Subcategory:</label>
  <select id="subcategory" required>
    <option value="">Select Subcategory</option>
  </select>

  <label>Pincode:</label>
  <input type="tel" id="pincode" inputmode="numeric" pattern="[0-9]{6}" maxlength="6" required />

  <button type="submit">Submit</button>
</form>

<div class="dashboard" id="dashboard">
  <h2>üßæ Poster Dashboard</h2>
  <p>‚úÖ Wait for Approval</p>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getDatabase, ref, push } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCH17_8W_UPmPt4KqpCaV7BpN6KsA4a67E",
    authDomain: "zara-fix.firebaseapp.com",
    databaseURL: "https://zara-fix-default-rtdb.firebaseio.com",
    projectId: "zara-fix",
    storageBucket: "zara-fix.appspot.com",
    messagingSenderId: "241770233045",
    appId: "1:241770233045:web:fe2d82b256dc431a9ae11e"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const form = document.getElementById("posterForm");
  const dashboard = document.getElementById("dashboard");

  // Category to subcategory options
  const subcategoryMap = {
    "Clothing": ["Men", "Women", "Kids"],
    "Electronics": ["Mobile", "Laptop", "TV"]
  };

  document.getElementById("category").addEventListener("change", function () {
    const subcat = document.getElementById("subcategory");
    subcat.innerHTML = "<option value=''>Select Subcategory</option>";
    const selected = this.value;
    if (subcategoryMap[selected]) {
      subcategoryMap[selected].forEach(opt => {
        const option = document.createElement("option");
        option.value = opt;
        option.text = opt;
        subcat.appendChild(option);
      });
    }
  });

  form.addEventListener("submit", function (e) {
    e.preventDefault();

    const name = document.getElementById("name").value.trim();
    const whatsapp = document.getElementById("whatsapp").value.trim();
    const shopname = document.getElementById("shopname").value.trim();
    const category = document.getElementById("category").value;
    const subcategory = document.getElementById("subcategory").value;
    const pincode = document.getElementById("pincode").value.trim();

    if (pincode.length !== 6 || isNaN(pincode)) {
      alert("Please enter a valid 6-digit Pincode");
      return;
    }

    if (whatsapp.length !== 10 || isNaN(whatsapp)) {
      alert("Enter valid 10-digit WhatsApp number");
      return;
    }

    const data = {
      name,
      whatsapp,
      shopname,
      category,
      subcategory,
      pincode,
      timestamp: new Date().toISOString(),
      approved: false
    };

    push(ref(db, "posterUsers"), data).then(() => {
      form.style.display = "none";
      dashboard.style.display = "block";
    }).catch(err => {
      alert("Error saving data: " + err);
    });
  });
</script>

</body>
</html>
