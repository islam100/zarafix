<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Provider Dashboard</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f1f1f1;
      padding: 20px;
    }

    .container {
      max-width: 600px;
      margin: auto;
      background: white;
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
    }

    h2 {
      text-align: center;
    }

    .request-card {
      background: #f9f9f9;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 15px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    .btn-3d {
      background: linear-gradient(#4CAF50, #388E3C);
      color: white;
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 12px;
      box-shadow: 0 5px #2e7031;
      cursor: pointer;
    }

    .btn-3d:active {
      box-shadow: 0 2px #2e7031;
      transform: translateY(3px);
    }

    .wallet {
      font-weight: bold;
      color: green;
      margin-bottom: 10px;
    }

    .error-msg {
      color: red;
      font-weight: bold;
      margin-top: 10px;
    }
  </style>
</head>
<body>

<div class="container">
  <h2>Provider Panel</h2>
  <p class="wallet">Wallet: ₹<span id="walletAmount">0</span></p>
  <div id="requestList"></div>
  <div id="error" class="error-msg"></div>
</div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCH17_8W_UPmPt4KqpCaV7BpN6KsA4a67E",
    authDomain: "zara-fix.firebaseapp.com",
    databaseURL: "https://zara-fix-default-rtdb.firebaseio.com",
    projectId: "zara-fix",
    storageBucket: "zara-fix.appspot.com",
    messagingSenderId: "1052314014797",
    appId: "1:1052314014797:web:e5c29d3db4cb1edcf07745"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.database();

  let currentUser = null;

  auth.onAuthStateChanged(user => {
    if (user) {
      currentUser = user;
      loadWallet();
      loadRequests();
    } else {
      alert("Please login first.");
      window.location.href = "index.html";
    }
  });

  function loadWallet() {
    db.ref("providers/" + currentUser.uid + "/wallet").on("value", snap => {
      const wallet = snap.val() || 0;
      document.getElementById("walletAmount").innerText = wallet;
    });
  }

  function loadRequests() {
    db.ref("requests").on("value", snapshot => {
      const data = snapshot.val();
      const requestList = document.getElementById("requestList");
      requestList.innerHTML = "";

      for (let id in data) {
        const request = data[id];

        if (request.category === currentUser.displayName && !request.acceptedBy) {
          const div = document.createElement("div");
          div.className = "request-card";
          div.innerHTML = `
            <p><strong>Name:</strong> ${request.name}</p>
            <p><strong>Category:</strong> ${request.category}</p>
            <button class="btn-3d" onclick="acceptRequest('${id}')">Accept</button>
          `;
          requestList.appendChild(div);
        }
      }
    });
  }

  function acceptRequest(requestId) {
    const walletRef = db.ref("providers/" + currentUser.uid + "/wallet");
    walletRef.once("value", snap => {
      const balance = snap.val() || 0;

      if (balance >= 100) {
        walletRef.set(balance - 20);
        db.ref("requests/" + requestId + "/acceptedBy").set(currentUser.uid);
        document.getElementById("error").innerText = "";
      } else {
        document.getElementById("error").innerText = "Please recharge. Minimum ₹100 required to accept requests.";
      }
    });
  }
</script>

</body>
</html>
