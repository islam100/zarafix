<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Property Listing</title>
<style>
  body { font-family: sans-serif; background:#f0f0f0; padding:10px; margin:0;}
  header{ display:flex; justify-content:space-between; align-items:center; padding:10px; background:#2563eb; color:#fff;}
  button { padding:5px 10px; border:none; border-radius:6px; cursor:pointer; background:#fff; color:#2563eb; font-weight:bold; }
  #cardContainer { display:flex; flex-wrap:wrap; justify-content:center; margin-top:10px;}
  .card { background:#fff; border-radius:12px; padding:15px; margin:10px; width:200px; cursor:pointer;
          box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: transform 0.3s, box-shadow 0.3s; position:relative;}
  .card:hover { transform: scale(1.05); box-shadow: 0 8px 12px rgba(0,0,0,0.2);}
  .btn { padding:5px 10px; margin:5px; border:none; border-radius:6px; cursor:pointer; background:#2563eb; color:#fff;}
  /* Modal */
  .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); justify-content:center; align-items:center;}
  .modal-content { background:#fff; padding:20px; border-radius:12px; max-width:90%; max-height:90%; overflow:auto; }
  @media(max-width:600px){
    .card { width:90%; margin:5px;}
  }
</style>
</head>
<body>

<header>
  <h2>Property Listing</h2>
  <button id="loginBtn">Login</button>
  <button id="addPropertyBtn" style="display:none;">Add Property</button>
</header>

<div id="cardContainer"></div>

<!-- Modal -->
<div id="modal" class="modal">
  <div class="modal-content" id="modalContent"></div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDTj2n1yhr1sFmuyBZ-jUwOmx1YqAN5QjA",
  authDomain: "property-20d6d.firebaseapp.com",
  databaseURL: "https://property-20d6d-default-rtdb.firebaseio.com",
  projectId: "property-20d6d",
  storageBucket: "property-20d6d.appspot.com",
  messagingSenderId: "916859697394",
  appId: "1:916859697394:web:2a8f9ad2d62f8306dcb86b"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const auth = firebase.auth();

let currentUser = null;

// Google Login
document.getElementById('loginBtn').addEventListener('click',()=>{
  const provider = new firebase.auth.GoogleAuthProvider();
  auth.signInWithPopup(provider).then(res=>{
    currentUser = res.user;
    document.getElementById('loginBtn').style.display='none';
    document.getElementById('addPropertyBtn').style.display='inline-block';
    alert("Logged in as "+currentUser.displayName);
  });
});

// Add Property Form
document.getElementById('addPropertyBtn').addEventListener('click', ()=>{
  const title = prompt("Property Title");
  const city = prompt("City");
  const type = prompt("Type (Flat/Plot/House)");
  const poster = currentUser.displayName;
  if(title && city && type){
    const newProp = { title, city, type, poster, approved:false };
    db.ref('properties').push(newProp);
    alert("Property added! Waiting admin approval.");
  }
});

// Fetch and Display Properties
function fetchCards(){
  db.ref('properties').on('value', snap=>{
    const container = document.getElementById('cardContainer');
    container.innerHTML = '';
    snap.forEach(child=>{
      const data = child.val();
      const key = child.key;
      if(data.approved){ // Only approved shows
        const div = document.createElement('div');
        div.className='card';
        div.innerHTML=`
          <h3>${data.title}</h3>
          <p>${data.city} - ${data.type}</p>
          <p>Poster: ${data.poster}</p>
        `;
        // Card click to zoom
        div.addEventListener('click', ()=>{
          document.getElementById('modalContent').innerHTML = `
            <h2>${data.title}</h2>
            <p>${data.city} - ${data.type}</p>
            <p>Poster: ${data.poster}</p>
          `;
          document.getElementById('modal').style.display='flex';
        });
        container.appendChild(div);
      }
    });
  });
}
fetchCards();

// Modal close
document.getElementById('modal').addEventListener('click', ()=>{
  document.getElementById('modal').style.display='none';
});

// Admin approval (for testing, simple alert)
db.ref('properties').on('child_added', snap=>{
  const data = snap.val();
  if(!data.approved){
    // Normally admin panel to approve
    console.log("Admin: Approve property ", data.title, "Key:", snap.key);
  }
});
</script>

</body>
</html>
