<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ZaraFix Real Estate</title>
<style>
body {font-family: Arial,sans-serif; margin:0; background:#f4f4f4;}
header {display:flex; justify-content:space-between; align-items:center; padding:10px 20px; background:#222; color:#fff;}
header h1 {font-size:22px; text-shadow:2px 2px 5px #000;}
button {cursor:pointer;}
#loginBtn,#logoutBtn {padding:6px 12px; border:none; border-radius:8px; background:#ff9800; color:#fff; font-weight:bold; box-shadow:0 4px 6px rgba(0,0,0,0.3);}
#cardsContainer {display:grid; grid-template-columns:repeat(auto-fill,minmax(250px,1fr)); gap:15px; padding:20px;}
.card {background:#fff; border-radius:12px; padding:15px; box-shadow:0 6px 16px rgba(0,0,0,0.1); position:relative; transition:0.3s;}
.card:hover {transform: scale(1.02);}
.card img {width:100%; border-radius:8px; margin:5px 0;}
.whatsappBtn, .approveBtn, .rejectBtn, .deleteBtn {margin:5px 3px; padding:8px 12px; border:none; border-radius:10px; font-weight:bold; color:#fff; box-shadow:0 4px 6px rgba(0,0,0,0.3);}
.whatsappBtn {background:#25D366;}
.approveBtn {background:linear-gradient(to right,#43cea2,#185a9d);}
.rejectBtn {background:linear-gradient(to right,#ff4e50,#f9d423);}
.deleteBtn {background:#ff5722;}
.led {width:15px;height:15px;border-radius:50%;position:absolute;top:15px;right:15px;}
.yellow.blink {animation: blink 1s infinite;} .green{} .red{}
@keyframes blink{0%,50%,100%{opacity:1}25%,75%{opacity:0;}}
#fullscreenOverlay {display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.9);justify-content:center;align-items:center;flex-direction:column;z-index:9999;overflow:auto;}
#fullscreenOverlay img {max-width:90%; margin:10px 0; border-radius:10px;}
.pagination {text-align:center; margin:15px;}
.pageBtn {margin:0 5px; padding:6px 12px; border:none; border-radius:8px; background:#2196F3; color:#fff; font-weight:bold;}
#postFormContainer {padding:20px; max-width:600px; margin:auto; background:#fff; border-radius:12px; box-shadow:0 6px 16px rgba(0,0,0,0.1);}
input, select {width:100%; padding:8px; margin:5px 0 15px 0; border-radius:6px; border:1px solid #ccc;}
</style>
</head>
<body>

<header>
  <h1>ZaraFix Real Estate</h1>
  <div>
    <button id="loginBtn">Login</button>
    <button id="logoutBtn" style="display:none;">Logout</button>
  </div>
</header>

<div id="postFormContainer" style="display:none;">
  <h2>Post Your Property</h2>
  <form id="propertyForm">
    <label>Type</label>
    <select id="type" required>
      <option value="Sell">Sell</option>
      <option value="Rent">Rent</option>
    </select>
    <label>Title</label>
    <input type="text" id="title" required>
    <label>Price</label>
    <input type="number" id="price" required>
    <label>Location</label>
    <input type="text" id="location" required>
    <label>Upload Images (Max 5)</label>
    <input type="file" id="images" accept="image/*" multiple required>
    <button type="submit">Submit</button>
  </form>
</div>

<div id="cardsContainer"></div>
<div class="pagination" id="pagination"></div>
<div id="fullscreenOverlay"></div>

<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDTj2n1yhr1sFmuyBZ-jUwOmx1YqAN5QjA",
  authDomain: "property-20d6d.firebaseapp.com",
  databaseURL: "https://property-20d6d-default-rtdb.firebaseio.com",
  projectId: "property-20d6d",
  storageBucket: "property-20d6d.appspot.com",
  messagingSenderId: "916859697394",
  appId: "1:916859697394:web:2a8f9ad2d62f8306dcb86b"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.database();

const imgbbApiKey="cad1f0dbfbd25346460789376cc2d7d5";

let currentUser=null;
let posts=[];
let currentPage=1;
const postsPerPage=10;

// Login/Logout
const loginBtn=document.getElementById("loginBtn");
const logoutBtn=document.getElementById("logoutBtn");
const postFormContainer=document.getElementById("postFormContainer");

loginBtn.onclick=()=>{
  let user=prompt("Enter username (type 'admin' for admin)");
  if(user){
    currentUser=user;
    loginBtn.style.display='none';
    logoutBtn.style.display='inline-block';
    if(user!=="admin") postFormContainer.style.display='block';
    loadPosts();
  }
};
logoutBtn.onclick=()=>{
  currentUser=null;
  loginBtn.style.display='inline-block';
  logoutBtn.style.display='none';
  postFormContainer.style.display='none';
  loadPosts();
};

// Fullscreen overlay
const fullscreenOverlay=document.getElementById("fullscreenOverlay");

// Load posts
function loadPosts(){
  db.ref("properties").once("value").then(snapshot=>{
    posts=[];
    snapshot.forEach(item=>{let p=item.val(); p.id=item.key; posts.push(p);});
    renderPosts();
  });
}

// Render posts
function renderPosts(){
  const container=document.getElementById("cardsContainer");
  container.innerHTML="";
  const paginationDiv=document.getElementById("pagination");
  paginationDiv.innerHTML="";

  const start=(currentPage-1)*postsPerPage;
  const end=start+postsPerPage;
  const pagePosts=posts.slice(start,end);

  pagePosts.forEach(p=>{
    const card=document.createElement("div");
    card.className="card";
    let ledClass="";
    if(p.status==="Pending") ledClass="yellow blink";
    else if(p.status==="Approved") ledClass="green";
    else if(p.status==="Rejected") ledClass="red";
    card.innerHTML=`
      <h3>${p.title}</h3>
      <p>${p.type} - â‚¹${p.price}</p>
      <p>${p.location}</p>
      ${p.images.map(img=>`<img src="${img}">`).join("")}
      <div class="led ${ledClass}"></div>
      ${currentUser===p.userId?`<button class="deleteBtn" onclick="deletePost('${p.id}')">Delete</button>`:""}
      ${p.whatsapp?`<button class="whatsappBtn" onclick="window.open('https://wa.me/${p.whatsapp}')">WhatsApp</button>`:""}
      ${currentUser==="admin"?`<button class="approveBtn" onclick="approvePost('${p.id}')">Approve</button><button class="rejectBtn" onclick="rejectPost('${p.id}')">Reject</button>`:""}
    `;
    card.onclick=(e)=>{if(e.target.tagName!=="BUTTON"){fullscreenOverlay.innerHTML=p.images.map(img=>`<img src="${img}">`).join(""); fullscreenOverlay.style.display="flex";}};
    container.appendChild(card);
  });

  // Pagination
  const totalPages=Math.ceil(posts.length/postsPerPage);
  if(totalPages>1){
    for(let i=1;i<=totalPages;i++){
      let btn=document.createElement("button");
      btn.className="pageBtn";
      btn.innerText=i;
      if(i===currentPage) btn.style.background="#4caf50";
      btn.onclick=(()=>{return ()=>{currentPage=i; renderPosts();}})();
      paginationDiv.appendChild(btn);
    }
  }
}

// Fullscreen close
fullscreenOverlay.onclick=()=>{fullscreenOverlay.style.display="none";};

// Delete post
function deletePost(id){if(confirm("Delete this post?")){db.ref("properties/"+id).remove().then(()=>loadPosts());}}

// Admin approve/reject
function approvePost(id){db.ref("properties/"+id).update({status:"Approved"}).then(()=>loadPosts());}
function rejectPost(id){db.ref("properties/"+id).update({status:"Rejected"}).then(()=>loadPosts());}

// Handle poster form submit
document.getElementById("propertyForm").addEventListener("submit", async function(e){
  e.preventDefault();
  if(!currentUser || currentUser==="admin"){alert("Please login as poster"); return;}

  const type=document.getElementById("type").value;
  const title=document.getElementById("title").value;
  const price=document.getElementById("price").value;
  const location=document.getElementById("location").value;
  const files=document.getElementById("images").files;

  if(files.length>5){alert("Maximum 5 images allowed"); return;}

  let imageUrls=[];
  for(let file of files){
    let formData=new FormData();
    formData.append("image",file);
    let res=await fetch(`https://api.imgbb.com/1/upload?key=${imgbbApiKey}`, {method:"POST", body:formData});
    let data=await res.json();
    imageUrls.push(data.data.url);
  }

  const id=Date.now();
  db.ref("properties/"+id).set({
    type, title, price, location, images:imageUrls, status:"Pending", userId:currentUser, whatsapp:"9112170192"
  }).then(()=>{alert("Property submitted!"); document.getElementById("propertyForm").reset(); loadPosts();});
});

// Initial load
loadPosts();
</script>
</body>
</html>
