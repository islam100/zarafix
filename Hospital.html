<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Property Portal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <style>
    body { font-family: Arial, sans-serif; margin:0; padding:20px; background:#f0f2f5; }
    .card {
      background: white;
      border-radius: 12px;
      padding: 15px;
      margin: 10px 0;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      transition: all 0.3s;
    }
    .approved { border-left: 6px solid green; background:#e6ffe6; }
    .waiting { border-left: 6px solid orange; background:#fff5e6; }
    .highlight { border: 2px solid red; background: #ffe6e6; }
    button { margin-top:10px; padding:6px 12px; border:none; border-radius:6px; cursor:pointer; }
    .delete-btn { background:#ff4d4d; color:white; }
    .admin-btn { background:#3399ff; color:white; margin-left:10px; }
  </style>
</head>
<body>

  <h2>Property Listings</h2>
  <div id="listings"></div>

  <script>
    // ðŸ”¥ Firebase config
  const firebaseConfig = {
  apiKey: "AIzaSyDT-D80OSwDetRfDEKHTKNvdRTPJnG8Cs4",
  authDomain: "hospital-dc40b.firebaseapp.com",
  databaseURL: "https://hospital-dc40b-default-rtdb.firebaseio.com",
  projectId: "hospital-dc40b",
  storageBucket: "hospital-dc40b.appspot.com",   // âœ… à¤¸à¤¹à¥€
  messagingSenderId: "445806713376",
  appId: "1:445806713376:web:77dab96b91f7fc71c07a45"
};
  
    firebase.initializeApp(firebaseConfig);

    const db = firebase.database();
    let currentUser = null;
    const adminEmail = "admin@example.com"; // ðŸ”´ à¤…à¤ªà¤¨à¤¾ admin email à¤¡à¤¾à¤²à¥‡à¤‚

    // âœ… Auth check
    firebase.auth().onAuthStateChanged(user => {
      if (user) {
        currentUser = user;
        loadListings();
      } else {
        alert("Please login first!");
      }
    });

    // âœ… Load Listings
    function loadListings() {
      db.ref("listings").on("value", snapshot => {
        const listingsDiv = document.getElementById("listings");
        listingsDiv.innerHTML = "";
        let listings = [];

        snapshot.forEach(child => {
          let item = child.val();
          item.key = child.key;
          listings.push(item);
        });

        // ðŸ”¹ Newest first (timestamp descending)
        listings.sort((a, b) => b.timestamp - a.timestamp);

        // ðŸ”¹ Admin highlight always on top
        let highlighted = listings.filter(l => l.highlighted);
        let normal = listings.filter(l => !l.highlighted);

        listings = [...highlighted, ...normal];

        listings.forEach(item => {
          const card = document.createElement("div");
          card.className = "card " + (item.approved ? "approved" : "waiting");
          if (item.highlighted) card.classList.add("highlight");

          card.innerHTML = `
            <h3>${item.title || "No Title"}</h3>
            <p>${item.description || ""}</p>
            <p>Status: <b>${item.approved ? "Approved" : "Waiting Approval"}</b></p>
          `;

          // âœ… Poster delete button
          if (currentUser.email === item.userEmail) {
            const delBtn = document.createElement("button");
            delBtn.className = "delete-btn";
            delBtn.textContent = "Delete";
            delBtn.onclick = () => deleteListing(item.key);
            card.appendChild(delBtn);
          }

          // âœ… Admin "Toggle Top" button
          if (currentUser.email === adminEmail) {
            const adminBtn = document.createElement("button");
            adminBtn.className = "admin-btn";
            adminBtn.textContent = item.highlighted ? "Unpin" : "Pin to Top";
            adminBtn.onclick = () => toggleHighlight(item.key, item.highlighted);
            card.appendChild(adminBtn);
          }

          listingsDiv.appendChild(card);
        });
      });
    }

    // âœ… Delete Listing
    function deleteListing(key) {
      if (confirm("Delete this post?")) {
        db.ref("listings/" + key).remove();
      }
    }

    // âœ… Admin Toggle Highlight
    function toggleHighlight(key, isHighlighted) {
      db.ref("listings/" + key).update({ highlighted: !isHighlighted });
    }
  </script>
</body>
</html>
