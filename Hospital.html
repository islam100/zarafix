<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Hospital Provider Portal</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body{margin:0;font-family:Arial,sans-serif;background:#f0f2f5;}
header{background:linear-gradient(135deg,#3498db,#2980b9);color:white;padding:10px 20px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;}
header h1{margin:0;font-size:22px;text-shadow:1px 1px 2px #000;}
button{cursor:pointer;padding:8px 12px;border:none;border-radius:10px;box-shadow:0 4px 6px rgba(0,0,0,0.3);margin-left:5px;font-weight:bold;transition:all .2s;}
button:hover{transform:translateY(-2px);box-shadow:0 6px 8px rgba(0,0,0,0.4);}
.btn-login{background:#2ecc71;color:white;}
.btn-logout{background:#e74c3c;color:white;}
.btn-new{background:#f39c12;color:white;}
main{padding:12px;}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:12px;}
.card{background:#fff;border-radius:12px;box-shadow:0 4px 6px rgba(0,0,0,0.2);padding:12px;transition:transform .2s;}
.card:hover{transform:scale(1.03);}
.card img{width:100%;height:180px;object-fit:cover;border-radius:8px;}
.card h3{margin:8px 0 4px;}
.card p{margin:2px 0;font-size:13px;}
.btnRow{display:flex;flex-wrap:wrap;gap:6px;margin-top:6px;}
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);align-items:center;justify-content:center;}
.modal-content{background:#fff;padding:15px;border-radius:12px;width:90%;max-width:500px;max-height:90%;overflow:auto;position:relative;}
.close{position:absolute;top:8px;right:12px;cursor:pointer;font-weight:bold;font-size:18px;}
form input, form select{width:100%;padding:6px;margin:6px 0 12px;border:1px solid #ccc;border-radius:8px;font-size:13px;}
form button{width:100%;background:#3498db;color:white;font-weight:bold;padding:10px;border-radius:10px;margin-top:10px;box-shadow:0 4px 6px rgba(0,0,0,0.3);}
form button:hover{background:#2980b9;}
.pending{border:2px dashed #f39c12;}
.searchBar{margin:12px;display:flex;flex-wrap:wrap;gap:10px;}
.searchBar input, .searchBar select{padding:8px;border-radius:6px;border:1px solid #ccc;font-size:14px;min-width:150px;}
</style>
</head>
<body>

<header>
<h1>Hospital Provider Portal</h1>
<div>
<button id="loginBtn" class="btn-login">üîë Login</button>
<button id="logoutBtn" class="btn-logout" style="display:none;">Logout</button>
<button id="newPostBtn" class="btn-new" style="display:none;">+ New Hospital</button>
</div>
</header>

<!-- Search and Filter -->
<div class="searchBar">
<input type="text" id="searchInput" placeholder="Search by Name / Dept / Doctor / City">
<select id="cityFilter">
<option value="">All Cities</option>
</select>
<select id="deptFilter">
<option value="">All Departments</option>
</select>
</div>

<main>
<div class="grid" id="posts"></div>
</main>

<!-- New Hospital Modal -->
<div class="modal" id="postModal">
<div class="modal-content">
<span class="close" id="closeForm">&times;</span>
<h2>Add Hospital</h2>
<form id="hospitalForm">
<input type="text" id="name" placeholder="Hospital Name" required>
<input type="text" id="department" placeholder="Department" required>
<input type="text" id="doctor" placeholder="Doctor Name" required>
<input type="text" id="city" placeholder="City" required>
<input type="number" id="beds" placeholder="Number of Beds" required>
<input type="number" id="icu" placeholder="ICU Beds" required>
<input type="number" id="fees" placeholder="Fees" required>
<input type="tel" id="phone" placeholder="Phone Number" required>
<input type="text" id="address" placeholder="Address" required>
<input type="file" id="image" accept="image/*" required>
<button type="submit">Submit</button>
</form>
</div>
</div>

<script>
const firebaseConfig = {
apiKey: "AIzaSyDT-D80OSwDetRfDEKHTKNvdRTPJnG8Cs4",
authDomain: "hospital-dc40b.firebaseapp.com",
databaseURL: "https://hospital-dc40b-default-rtdb.firebaseio.com",
projectId: "hospital-dc40b",
storageBucket: "hospital-dc40b.appspot.com",
messagingSenderId: "445806713376",
appId: "1:445806713376:web:77dab96b91f7fc71c07a45"
};
firebase.initializeApp(firebaseConfig);
const auth=firebase.auth();
const db=firebase.database();

const loginBtn=document.getElementById("loginBtn");
const logoutBtn=document.getElementById("logoutBtn");
const newPostBtn=document.getElementById("newPostBtn");
const postModal=document.getElementById("postModal");
const closeForm=document.getElementById("closeForm");
const hospitalForm=document.getElementById("hospitalForm");
const postsDiv=document.getElementById("posts");
const searchInput=document.getElementById("searchInput");
const cityFilter=document.getElementById("cityFilter");
const deptFilter=document.getElementById("deptFilter");

const imgbbKey="636b058a892ade35848bc77878ebf217";
let currentUser=null;
let allHospitals=[];

loginBtn.onclick=()=>{ const provider=new firebase.auth.GoogleAuthProvider(); auth.signInWithPopup(provider); };
logoutBtn.onclick=()=>auth.signOut();

auth.onAuthStateChanged(u=>{
currentUser=u;
if(u){
loginBtn.style.display="none";
logoutBtn.style.display="inline-block";
newPostBtn.style.display="inline-block";
} else{
loginBtn.style.display="inline-block";
logoutBtn.style.display="none";
newPostBtn.style.display="none";
}
loadHospitals();
});

newPostBtn.onclick=()=>postModal.style.display="flex";
closeForm.onclick=()=>postModal.style.display="none";

async function uploadImage(file){
const fd=new FormData();
fd.append("image",file);
const res=await fetch(`https://api.imgbb.com/1/upload?key=${imgbbKey}`,{method:"POST",body:fd});
const data=await res.json();
return data.data.url;
}

hospitalForm.onsubmit=async e=>{
e.preventDefault();
if(!currentUser) return alert("Login first!");

const submitBtn=hospitalForm.querySelector("button[type=submit]");
submitBtn.disabled=true; submitBtn.textContent="‚è≥ Uploading...";

const file=document.getElementById("image").files[0];
const imageUrl=await uploadImage(file);

const hospital={
name:document.getElementById("name").value,
department:document.getElementById("department").value,
doctor:document.getElementById("doctor").value,
city:document.getElementById("city").value,
beds:document.getElementById("beds").value,
icu:document.getElementById("icu").value,
fees:document.getElementById("fees").value,
phone:document.getElementById("phone").value,
address:document.getElementById("address").value,
image:imageUrl,
status:"pending",
posterUid:currentUser.uid,
posterName:currentUser.displayName,
created:Date.now()
};

db.ref("hospitals").push(hospital,err=>{
if(err) alert("‚ùå Error");
else alert("‚úÖ Hospital submitted! Waiting for approval.");
hospitalForm.reset(); postModal.style.display="none";
submitBtn.disabled=false; submitBtn.textContent="Submit";
});
};

function loadHospitals(){
db.ref("hospitals").orderByChild("created").on("value",snap=>{
allHospitals=[];
snap.forEach(ch=>allHospitals.push({...ch.val(),id:ch.key}));
allHospitals.reverse();
populateFilters();
renderHospitals();
});
}

function populateFilters(){
const cities=new Set();
const depts=new Set();
allHospitals.forEach(h=>{ cities.add(h.city); depts.add(h.department); });
cityFilter.innerHTML='<option value="">All Cities</option>'; deptsFilter.innerHTML='<option value="">All Departments</option>';
cities.forEach(c=>cityFilter.innerHTML+=`<option value="${c}">${c}</option>`);
depts.forEach(d=>deptFilter.innerHTML+=`<option value="${d}">${d}</option>`);
}

function renderHospitals(){
postsDiv.innerHTML="";
const keyword=searchInput.value.toLowerCase();
const cityVal=cityFilter.value;
const deptVal=deptFilter.value;

allHospitals.forEach(h=>{
if(currentUser?.email!=="zarasamajiksevasanstha@gmail.com" && h.status!=="approved" && h.posterUid!==currentUser?.uid) return;
if(cityVal && h.city!==cityVal) return;
if(deptVal && h.department!==deptVal) return;
if(keyword && !(h.name.toLowerCase().includes(keyword)||h.department.toLowerCase().includes(keyword)||h.doctor.toLowerCase().includes(keyword)||h.city.toLowerCase().includes(keyword))) return;

const card=document.createElement("div"); card.className="card";
if(h.status==="pending") card.classList.add("pending");
card.innerHTML=`
<img src="${h.image}">
<h3>${h.name}</h3>
<p><b>Department:</b> ${h.department}</p>
<p><b>Doctor:</b> ${h.doctor}</p>
<p><b>City:</b> ${h.city}</p>
<p><b>Beds:</b> ${h.beds} | ICU: ${h.icu}</p>
<p><b>Fees:</b> ‚Çπ${h.fees}</p>
<p>üìû ${h.phone}</p>
<p>${h.address}</p>
<p>Status: ${h.status==="approved"?"‚úÖ Approved":h.status==="rejected"?"‚ùå Rejected":"‚è≥ Pending"}</p>
`;

const btnRow=document.createElement("div"); btnRow.className="btnRow";
const wa=document.createElement("button"); wa.textContent="üí¨ WhatsApp"; wa.onclick=e=>{
e.stopPropagation();
const msg=`Hi, I am interested in ${h.name}, Dept: ${h.department}, Doctor: ${h.doctor}, City: ${h.city}`;
window.open(`https://wa.me/${h.phone}?text=${encodeURIComponent(msg)}`,"_blank");
}; btnRow.appendChild(wa);

if(currentUser && currentUser.uid===h.posterUid && currentUser.email!=="admin@example.com"){
const del=document.createElement("button"); del.textContent="üóë Delete"; del.className="btn-logout";
del.onclick=async e=>{e.stopPropagation(); if(confirm("Delete this hospital?")) await db.ref("hospitals/"+h.id).remove(); };
btnRow.appendChild(del);
}

if(currentUser && currentUser.email==="admin@example.com"){
const ap=document.createElement("button"); ap.textContent="‚úÖ Approve"; ap.className="btn-new";
ap.onclick=async e=>{ e.stopPropagation(); await db.ref("hospitals/"+h.id).update({status:"approved"}); };
const rj=document.createElement("button"); rj.textContent="‚ùå Reject"; rj.className="btn-logout";
rj.onclick=async e=>{ e.stopPropagation(); await db.ref("hospitals/"+h.id).update({status:"rejected"}); };
const del=document.createElement("button"); del.textContent="üóë Delete"; del.className="btn-logout";
del.onclick=async e=>{ e.stopPropagation(); if(confirm("Delete permanently?")) await db.ref("hospitals/"+h.id).remove(); };
btnRow.appendChild(ap); btnRow.appendChild(rj); btnRow.appendChild(del);
}

card.appendChild(btnRow);
postsDiv.appendChild(card);
});
}

searchInput.addEventListener("input",renderHospitals);
cityFilter.addEventListener("change",renderHospitals);
deptFilter.addEventListener("change",renderHospitals);

</script>
</body>
</html>
