<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Zara Property Listing</title>
<style>
  body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f0f2f5; }
  header { background:#1e90ff; color:white; padding:10px 20px; display:flex; justify-content:space-between; align-items:center; }
  header h1 { margin:0; font-size:24px; text-shadow:2px 2px 4px #000; }
  button { padding:8px 15px; border:none; border-radius:5px; cursor:pointer; box-shadow:2px 2px 5px #aaa; }
  #loginBtn { background:#fff; color:#1e90ff; }
  #logoutBtn { background:#ff4c4c; color:white; }
  #addPropertyForm { display:none; margin:20px; background:white; padding:20px; border-radius:10px; box-shadow:2px 2px 10px #aaa; }
  input, textarea { width:100%; padding:8px; margin:5px 0; border-radius:5px; border:1px solid #ccc; }
  #propertiesContainer { display:flex; flex-wrap:wrap; justify-content:center; margin:20px; }
  .propertyCard { background:white; margin:10px; padding:10px; border-radius:10px; width:300px; box-shadow:2px 2px 10px #aaa; cursor:pointer; transition: transform 0.2s; }
  .propertyCard:hover { transform:scale(1.03); }
  .propertyCard img { width:100%; border-radius:10px; object-fit:cover; height:200px; }
  .adminControls { margin-top:10px; }
  .adminControls button { margin-right:5px; }
</style>
<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
</head>
<body>

<header>
  <h1>Zara Property Listing</h1>
  <div>
    <button id="loginBtn">Login with Google</button>
    <button id="logoutBtn" style="display:none;">Logout</button>
  </div>
</header>

<div id="addPropertyForm">
  <h3>Add Property</h3>
  <input type="text" id="title" placeholder="Title">
  <input type="text" id="city" placeholder="City">
  <input type="text" id="type" placeholder="Type (sale/rent)">
  <input type="number" id="price" placeholder="Price">
  <textarea id="description" placeholder="Description"></textarea>
  <input type="text" id="whatsapp" placeholder="WhatsApp Number">
  <input type="file" id="imageFile">
  <button id="submitPropertyBtn">Submit Property</button>
</div>

<div id="propertiesContainer"></div>

<script>
  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyDTj2n1yhr1sFmuyBZ-jUwOmx1YqAN5QjA",
    authDomain: "property-20d6d.firebaseapp.com",
    databaseURL: "https://property-20d6d-default-rtdb.firebaseio.com",
    projectId: "property-20d6d",
    storageBucket: "property-20d6d.appspot.com",
    messagingSenderId: "916859697394",
    appId: "1:916859697394:web:2a8f9ad2d62f8306dcb86b"
  };
  firebase.initializeApp(firebaseConfig);

  const auth = firebase.auth();
  const db = firebase.database();
  const storage = firebase.storage();

  const loginBtn = document.getElementById('loginBtn');
  const logoutBtn = document.getElementById('logoutBtn');
  const addPropertyForm = document.getElementById('addPropertyForm');
  const propertiesContainer = document.getElementById('propertiesContainer');

  const submitPropertyBtn = document.getElementById('submitPropertyBtn');

  // Admin email
  const adminEmail = "zarasamajiksevasanstha@gmail.com";

  let currentUser = null;

  // Login
  loginBtn.onclick = () => {
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider);
  };

  // Logout
  logoutBtn.onclick = () => {
    auth.signOut();
  };

  auth.onAuthStateChanged(user => {
    if(user){
      currentUser = user;
      loginBtn.style.display = 'none';
      logoutBtn.style.display = 'inline-block';
      addPropertyForm.style.display = 'block';
      loadProperties();
    } else {
      currentUser = null;
      loginBtn.style.display = 'inline-block';
      logoutBtn.style.display = 'none';
      addPropertyForm.style.display = 'none';
      propertiesContainer.innerHTML = '';
    }
  });

  // Submit Property
  submitPropertyBtn.onclick = async () => {
    if(!currentUser) return alert("Login first!");
    const title = document.getElementById('title').value;
    const city = document.getElementById('city').value;
    const type = document.getElementById('type').value;
    const price = parseInt(document.getElementById('price').value);
    const description = document.getElementById('description').value;
    const whatsapp = document.getElementById('whatsapp').value;
    const imageFile = document.getElementById('imageFile').files[0];
    if(!title || !city || !type || !price || !description || !whatsapp || !imageFile) return alert("Fill all fields");

    // Upload image
    const storageRef = storage.ref('images/'+imageFile.name);
    await storageRef.put(imageFile);
    const imageUrl = await storageRef.getDownloadURL();

    // Push to DB
    const newPropRef = db.ref('properties').push();
    newPropRef.set({
      title, city, type, price, description, whatsapp,
      imageUrl,
      userId: currentUser.uid,
      userEmail: currentUser.email,
      approved: currentUser.email === adminEmail ? true : false,
      timestamp: Date.now()
    });

    alert("Property submitted!");
    addPropertyForm.reset();
  };

  // Load properties
  function loadProperties(){
    db.ref('properties').on('value', snapshot => {
      propertiesContainer.innerHTML = '';
      const properties = snapshot.val();
      for(let key in properties){
        const p = properties[key];
        if(!p.approved && currentUser.email !== adminEmail) continue;
        const card = document.createElement('div');
        card.className = 'propertyCard';
        card.innerHTML = `
          <img src="${p.imageUrl}" alt="${p.title}">
          <h3>${p.title}</h3>
          <p><b>City:</b> ${p.city}</p>
          <p><b>Type:</b> ${p.type}</p>
          <p><b>Price:</b> â‚¹${p.price}</p>
          <p>${p.description}</p>
          <p><a href="https://wa.me/${p.whatsapp}" target="_blank">Chat on WhatsApp</a></p>
        `;
        // Admin controls
        if(currentUser.email === adminEmail){
          const adminDiv = document.createElement('div');
          adminDiv.className = 'adminControls';
          const approveBtn = document.createElement('button');
          approveBtn.textContent = p.approved ? 'Approved' : 'Approve';
          approveBtn.onclick = () => db.ref('properties/'+key+'/approved').set(true);
          const deleteBtn = document.createElement('button');
          deleteBtn.textContent = 'Delete';
          deleteBtn.onclick = () => db.ref('properties/'+key).remove();
          adminDiv.appendChild(approveBtn);
          adminDiv.appendChild(deleteBtn);
          card.appendChild(adminDiv);
        }
        propertiesContainer.appendChild(card);
      }
    });
  }
</script>

</body>
</html>
