<!DOCTYPE html>
<html>
<head>
  <title>🛠️ ZaraFix Admin Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Arial, sans-serif; background: #f0f0f0; margin: 0; padding: 10px; }
    h2 { text-align: center; }
    .card {
      background: #fff;
      margin: 15px auto;
      padding: 15px;
      border-radius: 15px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      max-width: 500px;
      position: relative;
    }
    .approve-btn, .recharge-btn {
      padding: 8px 15px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin: 5px;
      font-weight: bold;
    }
    .approve-btn { background: #4CAF50; color: white; }
    .recharge-btn { background: #2196F3; color: white; }
    .approved-label { color: purple; font-weight: bold; }
    .blink { animation: blink 1s infinite; color: green; }
    @keyframes blink {
      0% { opacity: 1; }
      50% { opacity: 0.2; }
      100% { opacity: 1; }
    }
    select {
      margin-top: 10px;
      width: 100%;
      padding: 6px;
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <h2>🎯 ZaraFix Admin Dashboard</h2>
  <div id="adminDashboard"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getDatabase, ref, onValue, update } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD-WCCt_HuzO_dWMWDe1dtu8YuUtxxxxxxx",
      authDomain: "your-project-id.firebaseapp.com",
      databaseURL: "https://your-project-id-default-rtdb.firebaseio.com",
      projectId: "your-project-id",
      storageBucket: "your-project-id.appspot.com",
      messagingSenderId: "1234567890",
      appId: "1:1234567890:web:abcdef123456"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const dashboard = document.getElementById("adminDashboard");

    const postersRef = ref(db, 'posters');
    onValue(postersRef, (snapshot) => {
      const data = snapshot.val();
      if (data) {
        dashboard.innerHTML = '';
        const sorted = Object.entries(data).sort((a,b)=>b[1].timestamp - a[1].timestamp);
        sorted.forEach(([uid, poster]) => {
          const card = document.createElement('div');
          card.className = 'card';

          card.innerHTML = `
            <strong>🧑‍🔧 ${poster.name}</strong><br>
            📍 ${poster.address} | 🏪 ${poster.shop}<br>
            📞 ${poster.whatsapp}<br>
            🔧 ${poster.category}<br>
            💰 Wallet: ₹${poster.wallet || 0}<br>
            <div id="status-${uid}">
              ${poster.approved ? '<span class="approved-label">✅ Approved</span>' : '<span class="blink">🟢 Pending</span>'}
            </div>
            ${poster.approved ? '' : `<button class="approve-btn" onclick="approvePoster('${uid}')">Approve</button>`}
            <button class="recharge-btn" onclick="showRechargeRequests('${uid}')">Recharge Requests</button>
            <select id="recharges-${uid}" style="display:none;"><option>Loading...</option></select>
          `;

          dashboard.appendChild(card);
        });
      }
    });

    window.approvePoster = function(uid) {
      const updateRef = ref(db, 'posters/' + uid);
      update(updateRef, { approved: true });
    }

    window.showRechargeRequests = function(uid) {
      const rechargeRef = ref(db, 'rechargeRequests/' + uid);
      const dropdown = document.getElementById('recharges-' + uid);
      dropdown.style.display = 'block';
      dropdown.innerHTML = '<option>Loading...</option>';

      onValue(rechargeRef, (snapshot) => {
        const data = snapshot.val();
        if (data) {
          dropdown.innerHTML = '<option disabled selected>Select Recharge</option>';
          Object.values(data).forEach(req => {
            const opt = document.createElement('option');
            opt.text = `${req.timestamp || ''} - ₹100 - ${req.status || 'Pending'}`;
            dropdown.appendChild(opt);
          });
        } else {
          dropdown.innerHTML = '<option>No requests</option>';
        }
      }, {
        onlyOnce: true
      });
    }
  </script>
</body>
</html>
