<!DOCTYPE html>
<html>
<head>
  <title>Service Request Form</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
</head>
<body>
  <h2>🛠️ Service Request Form</h2>

  <!-- Login Button -->
  <button id="loginBtn">Login with Google</button>

  <!-- Request Form -->
  <form id="requestForm" style="display:none;">
    <input type="text" id="name" placeholder="Name" required><br><br>
    <input type="text" id="phone" placeholder="Phone Number" required><br><br>
    <textarea id="message" placeholder="Describe your service need..." required></textarea><br><br>
    <button type="submit">Submit Request</button>
  </form>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCH17_8W_UPmPt4KqpCaV7BpN6KsA4a67E",
      authDomain: "zara-fix.firebaseapp.com",
      databaseURL: "https://zara-fix-default-rtdb.firebaseio.com",
      projectId: "zara-fix",
      storageBucket: "zara-fix.appspot.com",
      messagingSenderId: "142673894657",
      appId: "1:142673894657:web:ff4194f227a87e9a3464fc"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    const loginBtn = document.getElementById('loginBtn');
    const requestForm = document.getElementById('requestForm');

    loginBtn.addEventListener('click', () => {
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider)
        .then(() => {
          loginBtn.style.display = 'none';
          requestForm.style.display = 'block';
        });
    });

    auth.onAuthStateChanged(user => {
      if (user) {
        loginBtn.style.display = 'none';
        requestForm.style.display = 'block';
      }
    });

    requestForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const user = auth.currentUser;
      if (!user) return;

      const name = document.getElementById('name').value;
      const phone = document.getElementById('phone').value;
      const message = document.getElementById('message').value;

      const requestId = "REQ" + Date.now();

      db.ref("requests/" + user.uid + "/" + requestId).set({
        name,
        phone,
        message,
        timestamp: new Date().toISOString()
      }).then(() => {
        alert("✅ Request Submitted!");
        requestForm.reset();
      });
    });
  </script>
</body>
</html>
