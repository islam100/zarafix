<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ZaraFix â€“ Services</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    input, select, button { padding: 8px; margin: 5px 0; width: 100%; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    button { cursor: pointer; }
  </style>
</head>
<body>

<h2>Add Service</h2>
<form id="serviceForm">
  <input type="text" id="ShopName" placeholder="Shop Name" required />
  <input type="text" id="OwnerName" placeholder="Owner Name" required />
  <input type="text" id="address" placeholder="Address" required />
  <input type="text" id="Whatsapp" placeholder="Whatsapp Number" required />
  <select id="posterType">
    <option value="public">Public</option>
    <option value="shopkeeper">Shopkeeper</option>
  </select>
  <button type="submit">Add Service</button>
</form>

<h2>All Services List</h2>
<table id="servicesTable">
  <thead>
    <tr>
      <th>Shop Name</th>
      <th>Owner Name</th>
      <th>Address</th>
      <th>Whatsapp</th>
      <th>Type</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody id="servicesList"></tbody>
</table>

<script>
  // Firebase Config
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_AUTH_DOMAIN",
    databaseURL: "YOUR_DATABASE_URL",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_STORAGE_BUCKET",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
  };
  firebase.initializeApp(firebaseConfig);

  // Mock currentUser (replace with Firebase Auth login)
  const currentUser = { displayName: "Admin", uid: "admin123" };

  const form = document.getElementById('serviceForm');
  const servicesList = document.getElementById('servicesList');

  // Submit handler
  form.addEventListener('submit', function(e) {
    e.preventDefault();

    const post = {
      shopName: document.getElementById('ShopName').value,
      ownerName: document.getElementById('OwnerName').value,
      address: document.getElementById('address').value,
      posterPhone: document.getElementById('Whatsapp').value,
      posterType: document.getElementById('posterType').value,
      posterName: currentUser.displayName,
      posterUid: currentUser.uid,
      created: Date.now()
    };

    firebase.database().ref('services/').push(post)
      .then(() => {
        alert('Service added successfully!');
        form.reset();
      })
      .catch(err => alert('Error: ' + err));
  });

  // Load services from Firebase
  firebase.database().ref('services/').on('value', snapshot => {
    servicesList.innerHTML = '';
    snapshot.forEach(child => {
      const data = child.val();
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${data.shopName}</td>
        <td>${data.ownerName}</td>
        <td>${data.address}</td>
        <td>${data.posterPhone}</td>
        <td>${data.posterType}</td>
        <td>
          <button onclick="editService('${child.key}')">Edit</button>
          <button onclick="deleteService('${child.key}')">Delete</button>
        </td>
      `;
      servicesList.appendChild(tr);
    });
  });

  function deleteService(id) {
    if(confirm('Are you sure to delete?')) {
      firebase.database().ref('services/' + id).remove();
    }
  }

  function editService(id) {
    firebase.database().ref('services/' + id).get().then(snapshot => {
      if(snapshot.exists()){
        const data = snapshot.val();
        document.getElementById('ShopName').value = data.shopName;
        document.getElementById('OwnerName').value = data.ownerName;
        document.getElementById('address').value = data.address;
        document.getElementById('Whatsapp').value = data.posterPhone;
        document.getElementById('posterType').value = data.posterType;

        // Update button temporarily
        const btn = form.querySelector('button[type="submit"]');
        btn.textContent = 'Update Service';

        form.onsubmit = function(e){
          e.preventDefault();
          const updated = {
            shopName: document.getElementById('ShopName').value,
            ownerName: document.getElementById('OwnerName').value,
            address: document.getElementById('address').value,
            posterPhone: document.getElementById('Whatsapp').value,
            posterType: document.getElementById('posterType').value
          };
          firebase.database().ref('services/' + id).update(updated)
            .then(()=> {
              alert('Service updated!');
              form.reset();
              btn.textContent = 'Add Service';
              form.onsubmit = null; // reset submit
            });
        };
      }
    });
  }
</script>
</body>
</html>
