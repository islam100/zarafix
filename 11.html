<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ZaraFix All Services</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<style>
/* 3D button effect */
.btn-3d { 
  transition: transform 0.2s; 
  box-shadow: 0 5px #666; 
}
.btn-3d:active { 
  transform: translateY(4px); 
  box-shadow: 0 2px #666; 
}
.card-3d {
  transition: transform 0.2s;
}
.card-3d:hover {
  transform: translateY(-5px) scale(1.02);
}
.unapproved { background-color: #fee2e2; } /* Redish for unapproved */
.approved { background-color: #dcfce7; } /* Greenish for approved */
</style>
</head>
<body class="bg-gradient-to-b from-blue-100 to-purple-100 min-h-screen">

<div class="container mx-auto p-4">

<h1 class="text-2xl font-bold text-center mb-4">ZaraFix All Services</h1>

<!-- Provider Form -->
<div id="providerForm" class="bg-white p-4 rounded-xl shadow-lg mb-6">
<h2 class="font-semibold mb-2">Submit Your Service</h2>
<input type="text" id="serviceName" placeholder="Service Name" class="border p-2 rounded w-full mb-2">
<input type="text" id="providerName" placeholder="Your Name" class="border p-2 rounded w-full mb-2">
<input type="text" id="whatsapp" placeholder="WhatsApp Number" class="border p-2 rounded w-full mb-2">
<input type="file" id="serviceImage" class="mb-2">
<button id="submitService" class="bg-blue-500 text-white px-4 py-2 rounded btn-3d">Submit</button>
</div>

<!-- Listing -->
<div id="listing" class="grid sm:grid-cols-2 md:grid-cols-3 gap-4"></div>

</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyD7ZqL-PVuFdd8rMVIyW7CgHQjPRGHD2h8",
  authDomain: "zara-fix-2e35a.firebaseapp.com",
  projectId: "zara-fix-2e35a",
  storageBucket: "zara-fix-2e35a.appspot.com",
  messagingSenderId: "636550144008",
  appId: "1:636550144008:web:a849496ad1d1557d7ab1bd"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const adminEmail = "zarasamajiksevasanstha@gmail.com";
let currentUserEmail = "";

// Submit service
document.getElementById("submitService").addEventListener("click", async ()=>{
    const name = document.getElementById("serviceName").value;
    const provider = document.getElementById("providerName").value;
    const whatsapp = document.getElementById("whatsapp").value;
    const file = document.getElementById("serviceImage").files[0];

    if(!name || !provider || !whatsapp || !file){
        alert("सभी फील्ड भरें और image select करें");
        return;
    }

    const formData = new FormData();
    formData.append("image", file);
    formData.append("key", "4dc5e5cb7654ffc308d5ca45452b014b"); // ImgBB API Key

    const res = await fetch("https://api.imgbb.com/1/upload?key=4dc5e5cb7654ffc308d5ca45452b014b", {
        method: "POST",
        body: formData
    });
    const data = await res.json();
    const imageUrl = data.data.display_url;

    const newPostRef = db.ref("services").push();
    newPostRef.set({
        name, provider, whatsapp, imageUrl, approved: false, timestamp: Date.now()
    });

    alert("Service submitted. Admin approval required!");
    document.getElementById("serviceName").value = "";
    document.getElementById("providerName").value = "";
    document.getElementById("whatsapp").value = "";
    document.getElementById("serviceImage").value = "";
});

// Display services
function renderServices(snapshot){
    const container = document.getElementById("listing");
    container.innerHTML = "";
    let servicesArray = [];
    snapshot.forEach(snap=>{
        servicesArray.push({id: snap.key, ...snap.val()});
    });
    // Sort: newest first
    servicesArray.sort((a,b)=> b.timestamp - a.timestamp);
    servicesArray.forEach(service=>{
        const div = document.createElement("div");
        div.className = `p-3 rounded-xl shadow card-3d ${service.approved ? "approved" : "unapproved"}`;

        div.innerHTML = `
        <h3 class="font-semibold">${service.name}</h3>
        <p>Provider: ${service.provider}</p>
        <img src="${service.imageUrl}" class="w-full h-40 object-cover rounded mb-2 cursor-pointer" onclick="window.open('${service.imageUrl}','_blank')">
        <p>WhatsApp: <a href="https://wa.me/${service.whatsapp}?text=Zara%20Fix%20ne%20apko%20customer%20diya%20hai" target="_blank" class="text-green-600 font-semibold">${service.whatsapp}</a></p>
        <p>Status: ${service.approved ? "Approved" : "Not Approved"}</p>
        `;

        // Admin controls
        const userEmail = currentUserEmail;
        if(userEmail === adminEmail){
            const approveBtn = document.createElement("button");
            approveBtn.innerText = service.approved ? "Reject" : "Approve";
            approveBtn.className = "bg-blue-500 text-white px-2 py-1 rounded btn-3d mr-2 mt-2";
            approveBtn.onclick = ()=> {
                db.ref("services/"+service.id+"/approved").set(!service.approved);
            };
            const deleteBtn = document.createElement("button");
            deleteBtn.innerText = "Delete";
            deleteBtn.className = "bg-red-500 text-white px-2 py-1 rounded btn-3d mt-2";
            deleteBtn.onclick = ()=> db.ref("services/"+service.id).remove();

            div.appendChild(approveBtn);
            div.appendChild(deleteBtn);
        }

        // Provider delete own post
        if(userEmail && userEmail !== adminEmail){
            const deleteBtn = document.createElement("button");
            deleteBtn.innerText = "Delete My Post";
            deleteBtn.className = "bg-red-500 text-white px-2 py-1 rounded btn-3d mt-2";
            deleteBtn.onclick = ()=> db.ref("services/"+service.id).remove();
            div.appendChild(deleteBtn);
        }

        container.appendChild(div);
    });
}

// Listen to DB
db.ref("services").on("value", renderServices);

// Authentication (email prompt)
currentUserEmail = prompt("अपना Email डालें (Admin: zarasamajiksevasanstha@gmail.com)");
</script>

</body>
</html>
