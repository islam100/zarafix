<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zara Property Admin</title>
<style>
  body { font-family: Arial, sans-serif; margin: 0; padding: 0; background:#f2f2f2;}
  header { background: #222; color: #fff; padding: 15px; display:flex; justify-content:space-between; align-items:center;}
  button { padding: 8px 12px; margin: 5px; cursor:pointer; border:none; border-radius:5px;}
  .admin-btn { background: #4CAF50; color:#fff;}
  .delete-btn { background: #f44336; color:#fff;}
  .approve-btn { background:#2196F3; color:#fff;}
  .card { background:#fff; margin:10px; padding:10px; border-radius:8px; box-shadow:0 2px 5px rgba(0,0,0,0.2);}
  .card img { width:100%; height:200px; object-fit:cover; border-radius:5px;}
  .card-container { display:flex; flex-wrap:wrap;}
  form { background:#fff; padding:15px; margin:10px; border-radius:8px; box-shadow:0 2px 5px rgba(0,0,0,0.2);}
  input, textarea { width:100%; padding:8px; margin:5px 0; border-radius:5px; border:1px solid #ccc;}
</style>
</head>
<body>

<header>
  <h2>Zara Property</h2>
  <button id="loginBtn">Login with Google</button>
  <button id="logoutBtn" style="display:none;">Logout</button>
</header>

<!-- Poster Form -->
<form id="posterForm" style="display:none;">
  <h3>Post Your Property</h3>
  <input type="text" id="title" placeholder="Title" required>
  <input type="text" id="city" placeholder="City" required>
  <select id="type">
    <option value="sale">Sale</option>
    <option value="rent">Rent</option>
  </select>
  <input type="number" id="price" placeholder="Price" required>
  <textarea id="description" placeholder="Description" required></textarea>
  <input type="text" id="imageUrl" placeholder="Image URL" required>
  <input type="text" id="whatsapp" placeholder="Whatsapp Number" required>
  <button type="submit">Submit Property</button>
</form>

<!-- Admin Dashboard -->
<div id="adminDashboard" style="display:none;">
  <h3>Admin Dashboard</h3>
  <div class="card-container" id="propertyList"></div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDTj2n1yhr1sFmuyBZ-jUwOmx1YqAN5QjA",
  authDomain: "property-20d6d.firebaseapp.com",
  databaseURL: "https://property-20d6d-default-rtdb.firebaseio.com",
  projectId: "property-20d6d",
  storageBucket: "property-20d6d.appspot.com",
  messagingSenderId: "916859697394",
  appId: "1:916859697394:web:2a8f9ad2d62f8306dcb86b"
};
firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.database();

const loginBtn = document.getElementById('loginBtn');
const logoutBtn = document.getElementById('logoutBtn');
const posterForm = document.getElementById('posterForm');
const adminDashboard = document.getElementById('adminDashboard');
const propertyList = document.getElementById('propertyList');

const admins = { "admin@example.com": true }; // Admin emails

loginBtn.onclick = () => {
  const provider = new firebase.auth.GoogleAuthProvider();
  auth.signInWithPopup(provider);
};

logoutBtn.onclick = () => auth.signOut();

auth.onAuthStateChanged(user => {
  if(user){
    loginBtn.style.display='none';
    logoutBtn.style.display='inline-block';
    posterForm.style.display='block';
    if(admins[user.email]){
      adminDashboard.style.display='block';
      loadProperties();
    } else {
      adminDashboard.style.display='none';
    }
  } else {
    loginBtn.style.display='inline-block';
    logoutBtn.style.display='none';
    posterForm.style.display='none';
    adminDashboard.style.display='none';
  }
});

// Submit Property
posterForm.addEventListener('submit', e=>{
  e.preventDefault();
  const id = 'property'+Date.now();
  db.ref('properties/'+id).set({
    title: document.getElementById('title').value,
    city: document.getElementById('city').value,
    type: document.getElementById('type').value,
    price: Number(document.getElementById('price').value),
    description: document.getElementById('description').value,
    imageUrl: document.getElementById('imageUrl').value,
    whatsapp: document.getElementById('whatsapp').value,
    userId: auth.currentUser.uid,
    userEmail: auth.currentUser.email,
    approved: false,
    timestamp: Date.now()
  });
  posterForm.reset();
  alert("Property submitted! Waiting for approval.");
});

// Load Properties for Admin
function loadProperties(){
  propertyList.innerHTML='';
  db.ref('properties').on('value', snapshot=>{
    propertyList.innerHTML='';
    snapshot.forEach(propSnap=>{
      const prop = propSnap.val();
      const key = propSnap.key;
      const card = document.createElement('div');
      card.className='card';
      card.innerHTML=`
        <h4>${prop.title} (${prop.type}) - ${prop.city}</h4>
        <img src="${prop.imageUrl}">
        <p>${prop.description}</p>
        <p>Price: â‚¹${prop.price}</p>
        <p>Whatsapp: <a href="https://wa.me/${prop.whatsapp}" target="_blank">${prop.whatsapp}</a></p>
        <p>Approved: ${prop.approved}</p>
        <button class="approve-btn">${prop.approved?'Unapprove':'Approve'}</button>
        <button class="delete-btn">Delete</button>
      `;
      // Approve / Unapprove
      card.querySelector('.approve-btn').onclick=()=>{
        db.ref('properties/'+key+'/approved').set(!prop.approved);
      };
      // Delete
      card.querySelector('.delete-btn').onclick=()=>{
        if(confirm('Delete this property?')) db.ref('properties/'+key).remove();
      };
      propertyList.appendChild(card);
    });
  });
}
</script>
</body>
</html>
