<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zara Property Dashboard</title>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
<style>
  body { font-family: Arial; padding: 10px; }
  .card { border: 1px solid #ccc; border-radius: 10px; padding: 10px; margin: 10px; display: inline-block; width: 250px; cursor: pointer; transition: transform 0.2s; }
  .card:hover { transform: scale(1.05); }
  .card img { width: 100%; height: 150px; object-fit: cover; border-radius: 5px; }
  .admin-btn { margin: 5px; padding: 5px 10px; cursor: pointer; }
</style>
</head>
<body>

<h2>Zara Property Dashboard</h2>
<div id="login-section">
  <button onclick="login()">Login with Google</button>
</div>

<div id="post-section" style="display:none;">
  <h3>Post Property</h3>
  <input type="text" id="title" placeholder="Title"><br>
  <input type="text" id="city" placeholder="City"><br>
  <input type="text" id="type" placeholder="Sale/Rent"><br>
  <input type="number" id="price" placeholder="Price"><br>
  <input type="text" id="whatsapp" placeholder="WhatsApp"><br>
  <textarea id="description" placeholder="Description"></textarea><br>
  <input type="file" id="image"><br>
  <button onclick="postProperty()">Post</button>
</div>

<h3>Properties</h3>
<div id="property-list"></div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyDTj2n1yhr1sFmuyBZ-jUwOmx1YqAN5QjA",
    authDomain: "property-20d6d.firebaseapp.com",
    databaseURL: "https://property-20d6d-default-rtdb.firebaseio.com",
    projectId: "property-20d6d",
    storageBucket: "property-20d6d.appspot.com",
    messagingSenderId: "916859697394",
    appId: "1:916859697394:web:2a8f9ad2d62f8306dcb86b"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const storage = firebase.storage();

  let currentUser = null;
  const adminEmail = "zarasamajiksevasanstha@gmail.com";

  function login() {
    const provider = new firebase.auth.GoogleAuthProvider();
    firebase.auth().signInWithPopup(provider).then(result => {
      currentUser = result.user;
      document.getElementById('login-section').style.display = 'none';
      document.getElementById('post-section').style.display = 'block';
      loadProperties();
    });
  }

  function postProperty() {
    if (!currentUser) return alert("Login required");
    const file = document.getElementById('image').files[0];
    const imageRef = storage.ref('images/' + file.name);
    imageRef.put(file).then(() => {
      imageRef.getDownloadURL().then(url => {
        const newPropKey = db.ref('properties').push().key;
        db.ref('properties/' + newPropKey).set({
          title: document.getElementById('title').value,
          city: document.getElementById('city').value,
          type: document.getElementById('type').value,
          price: Number(document.getElementById('price').value),
          whatsapp: document.getElementById('whatsapp').value,
          description: document.getElementById('description').value,
          imageUrl: url,
          userId: currentUser.uid,
          userEmail: currentUser.email,
          approved: false,
          timestamp: Date.now()
        });
      });
    });
  }

  function loadProperties() {
    db.ref('properties').on('value', snapshot => {
      const list = document.getElementById('property-list');
      list.innerHTML = '';
      const data = snapshot.val();
      for (let key in data) {
        const prop = data[key];
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <img src="${prop.imageUrl}" onclick="window.open('${prop.imageUrl}', '_blank')">
          <h4>${prop.title}</h4>
          <p>${prop.city} - ${prop.type}</p>
          <p>â‚¹${prop.price}</p>
          <p>${prop.description}</p>
          <p>WhatsApp: <a href="https://wa.me/${prop.whatsapp}" target="_blank">${prop.whatsapp}</a></p>
        `;
        if (currentUser.email === adminEmail) {
          const approveBtn = document.createElement('button');
          approveBtn.className = 'admin-btn';
          approveBtn.textContent = prop.approved ? 'Approved' : 'Approve';
          approveBtn.onclick = () => db.ref('properties/' + key + '/approved').set(true);
          const deleteBtn = document.createElement('button');
          deleteBtn.className = 'admin-btn';
          deleteBtn.textContent = 'Delete';
          deleteBtn.onclick = () => db.ref('properties/' + key).remove();
          card.appendChild(approveBtn);
          card.appendChild(deleteBtn);
        }
        list.appendChild(card);
      }
    });
  }
</script>

</body>
</html>
