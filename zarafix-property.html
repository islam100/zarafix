<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Zara Property</title>
<style>
  body{font-family:sans-serif;margin:0;padding:0;background:#f0f0f0;}
  header{background:#222;color:#fff;padding:10px 20px;display:flex;align-items:center;justify-content:space-between;}
  header h2{margin:0;}
  header button{padding:8px 12px;margin-left:10px;border:none;border-radius:5px;background:#ff9800;color:#fff;cursor:pointer;box-shadow: 0 4px 6px rgba(0,0,0,0.2);}
  .container{padding:20px;}
  .card-container{display:flex;flex-wrap:wrap;gap:15px;justify-content:center;}
  .card{background:#fff;padding:15px;border-radius:10px;box-shadow:0 4px 6px rgba(0,0,0,0.1);width:250px;position:relative;cursor:pointer;}
  .card img{width:100%;height:150px;object-fit:cover;border-radius:8px;}
  .card h3{margin:10px 0 5px;}
  .card p{margin:5px 0;font-size:14px;color:#555;}
  .card button{margin-top:5px;width:48%;padding:6px;border:none;border-radius:5px;background:#2196F3;color:#fff;cursor:pointer;}
  .card button.delete{background:red;}
  form{background:#fff;padding:15px;border-radius:10px;max-width:500px;margin:0 auto 20px;}
  input, textarea{width:100%;margin:5px 0 10px;padding:8px;border-radius:5px;border:1px solid #ccc;}
  #adminDashboard{display:none;}
  /* Modal Styles */
  .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);justify-content:center;align-items:center;}
  .modal-content{background:#fff;padding:20px;border-radius:10px;max-width:500px;width:90%;position:relative;}
  .modal-content img{width:100%;border-radius:8px;margin-bottom:10px;}
  .closeModal{position:absolute;top:10px;right:15px;font-size:20px;font-weight:bold;cursor:pointer;}
</style>
</head>
<body>

<header>
  <h2>Zara Property</h2>
  <div>
    <button id="loginBtn">Login with Google</button>
    <button id="logoutBtn" style="display:none;">Logout</button>
  </div>
</header>

<div class="container">

  <!-- Poster Form -->
  <form id="posterForm">
    <h3>Submit Property</h3>
    <input type="text" id="title" placeholder="Title" required>
    <input type="text" id="price" placeholder="Price" required>
    <input type="url" id="image" placeholder="Image URL" required>
    <textarea id="desc" placeholder="Description" required></textarea>
    <input type="text" id="whatsapp" placeholder="WhatsApp Number" required>
    <button type="submit">Submit Property</button>
  </form>

  <!-- Admin Dashboard -->
  <div id="adminDashboard">
    <h3>Admin Dashboard</h3>
    <div class="card-container" id="propertyList"></div>
  </div>

  <!-- Public Listing -->
  <h3>Approved Properties</h3>
  <div class="card-container" id="approvedList"></div>

</div>

<!-- Modal for card enlarge -->
<div class="modal" id="cardModal">
  <div class="modal-content">
    <span class="closeModal" onclick="closeModal()">✖</span>
    <div id="modalBody"></div>
  </div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDTj2n1yhr1sFmuyBZ-jUwOmx1YqAN5QjA",
  authDomain: "property-20d6d.firebaseapp.com",
  databaseURL: "https://property-20d6d-default-rtdb.firebaseio.com",
  projectId: "property-20d6d",
  storageBucket: "property-20d6d.appspot.com",
  messagingSenderId: "916859697394",
  appId: "1:916859697394:web:2a8f9ad2d62f8306dcb86b"
};
firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.database();

const adminEmail = "zarasamajiksevasanstha@gmail.com";

const loginBtn = document.getElementById('loginBtn');
const logoutBtn = document.getElementById('logoutBtn');
const posterForm = document.getElementById('posterForm');
const adminDashboard = document.getElementById('adminDashboard');
const propertyList = document.getElementById('propertyList');
const approvedList = document.getElementById('approvedList');
const cardModal = document.getElementById('cardModal');
const modalBody = document.getElementById('modalBody');

loginBtn.onclick = () => {
  const provider = new firebase.auth.GoogleAuthProvider();
  auth.signInWithPopup(provider);
}

logoutBtn.onclick = () => auth.signOut();

auth.onAuthStateChanged(user => {
  if(user){
    loginBtn.style.display = 'none';
    logoutBtn.style.display = 'inline-block';
    posterForm.style.display = 'block';
    if(user.email === adminEmail){
      adminDashboard.style.display = 'block';
      loadAdminProperties();
    } else {
      adminDashboard.style.display = 'none';
    }
  } else {
    loginBtn.style.display = 'inline-block';
    logoutBtn.style.display = 'none';
    posterForm.style.display = 'none';
    adminDashboard.style.display = 'none';
  }
});

// Submit property
posterForm.addEventListener('submit', e=>{
  e.preventDefault();
  if(!auth.currentUser) return alert('Login required!');
  const id = 'prop_'+Date.now();
  db.ref('properties/'+id).set({
    title: document.getElementById('title').value,
    price: document.getElementById('price').value,
    image: document.getElementById('image').value,
    desc: document.getElementById('desc').value,
    whatsapp: document.getElementById('whatsapp').value,
    approved: false
  });
  alert('Property submitted! Waiting for admin approval.');
  posterForm.reset();
});

// Load admin properties
function loadAdminProperties(){
  propertyList.innerHTML = '';
  db.ref('properties').on('value', snapshot=>{
    propertyList.innerHTML = '';
    snapshot.forEach(snap=>{
      const prop = snap.val();
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <img src="${prop.image}">
        <h3>${prop.title}</h3>
        <p>${prop.desc}</p>
        <p>₹ ${prop.price}</p>
        <p>WhatsApp: <a href="https://wa.me/${prop.whatsapp}" target="_blank">${prop.whatsapp}</a></p>
        <p>Status: ${prop.approved ? 'Approved ✅' : 'Pending ❌'}</p>
        <button class="approveBtn">${prop.approved ? 'Unapprove' : 'Approve'}</button>
        <button class="delete deleteBtn">Delete</button>
      `;
      const approveBtn = card.querySelector('.approveBtn');
      const deleteBtn = card.querySelector('.deleteBtn');

      approveBtn.onclick = (ev)=>{
        ev.stopPropagation();
        db.ref('properties/'+snap.key+'/approved').set(!prop.approved);
      }
      deleteBtn.onclick = (ev)=>{
        ev.stopPropagation();
        if(confirm('Delete this property?')){
          db.ref('properties/'+snap.key).remove();
        }
      }
      card.onclick = ()=>openModal(prop);
      propertyList.appendChild(card);
    });
  });
}

// Load approved properties
db.ref('properties').on('value', snapshot=>{
  approvedList.innerHTML = '';
  snapshot.forEach(snap=>{
    const prop = snap.val();
    if(prop.approved){
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <img src="${prop.image}">
        <h3>${prop.title}</h3>
        <p>${prop.desc}</p>
        <p>₹ ${prop.price}</p>
        <p><a href="https://wa.me/${prop.whatsapp}" target="_blank">WhatsApp</a></p>
      `;
      card.onclick = ()=>openModal(prop);
      approvedList.appendChild(card);
    }
  });
});

// Modal
function openModal(prop){
  modalBody.innerHTML = `
    <img src="${prop.image}">
    <h3>${prop.title}</h3>
    <p>${prop.desc}</p>
    <p>₹ ${prop.price}</p>
    <p><a href="https://wa.me/${prop.whatsapp}" target="_blank">WhatsApp</a></p>
  `;
  cardModal.style.display = 'flex';
}
function closeModal(){
  cardModal.style.display = 'none';
}
</script>

</body>
</html>
