<div id="acceptedRequests" class="p-3">
  <h3>Your Accepted Requests:</h3>
  <div id="requestCards"></div>
</div>

<style>
  .card {
    border-radius: 15px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    padding: 16px;
    margin-bottom: 16px;
    background: #fff;
  }
  .btn-3d {
    padding: 8px 16px;
    border-radius: 8px;
    border: none;
    background: linear-gradient(to bottom right, #4CAF50, #2E7D32);
    color: white;
    font-weight: bold;
    box-shadow: 0 4px #1b5e20;
    transition: all 0.1s ease-in-out;
  }
  .btn-3d:active {
    box-shadow: none;
    transform: translateY(4px);
  }
</style>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-app.js";
  import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-database.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCH17_8W_UPmPt4KqpCaV7BpN6KsA4a67E",
    authDomain: "zara-fix.firebaseapp.com",
    databaseURL: "https://zara-fix-default-rtdb.firebaseio.com",
    projectId: "zara-fix",
    storageBucket: "zara-fix.appspot.com",
    messagingSenderId: "1234567890",
    appId: "1:1234567890:web:abcdefghij"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const auth = getAuth();

  onAuthStateChanged(auth, (user) => {
    if (user) {
      const userId = user.uid;
      const requestsRef = ref(db, `requests/${userId}`);
      const postersRef = ref(db, `posters`);

      onValue(requestsRef, (snapshot) => {
        const requests = snapshot.val();
        const cardContainer = document.getElementById("requestCards");
        cardContainer.innerHTML = "";

        if (!requests) {
          cardContainer.innerHTML = "<p>No requests found.</p>";
          return;
        }

        onValue(postersRef, (posterSnap) => {
          const posters = posterSnap.val();

          Object.entries(requests).forEach(([reqId, reqData]) => {
            let posterInfo = "";
            if (reqData.acceptedBy) {
              const acceptedId = Object.keys(reqData.acceptedBy)[0];
              const poster = posters?.[acceptedId];

              if (poster) {
                posterInfo = `
                  <p><strong>Accepted by:</strong> ${poster.name} (${poster.category})</p>
                  <p><strong>Shop:</strong> ${poster.shop}</p>
                  <p><strong>Wallet:</strong> â‚¹${poster.wallet}</p>
                  <a class="btn-3d" href="https://wa.me/${poster.whatsapp}" target="_blank">ðŸ“± WhatsApp</a>
                `;
              }
            }

            const card = `
              <div class="card">
                <h4>Category: ${reqData.category}</h4>
                <p><strong>Description:</strong> ${reqData.description}</p>
                ${posterInfo}
              </div>
            `;
            cardContainer.innerHTML += card;
          });
        });
      });
    }
  });
</script>
