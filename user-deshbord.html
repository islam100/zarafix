<!DOCTYPE html>
<html>
<head>
  <title>Your Requests</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 10px;
      background: #f5f5f5;
    }
    .card {
      background: white;
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 15px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    h2 {
      text-align: center;
      color: #333;
    }
    .btn-3d {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 10px;
      margin: 5px;
      box-shadow: 0 5px #3e8e41;
      transition: all 0.2s ease-in-out;
    }
    .btn-3d:active {
      box-shadow: 0 2px #3e8e41;
      transform: translateY(3px);
    }
  </style>
</head>
<body>

  <h2>Your Accepted Requests</h2>
  <div id="requestList"></div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCH17_8W_UPmPt4KqpCaV7BpN6KsA4a67E",
      authDomain: "zara-fix.firebaseapp.com",
      databaseURL: "https://zara-fix-default-rtdb.firebaseio.com",
      projectId: "zara-fix",
      storageBucket: "zara-fix.appspot.com",
      messagingSenderId: "1234567890",
      appId: "1:1234567890:web:abc123"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    firebase.auth().onAuthStateChanged(user => {
      if (user) {
        const uid = user.uid;
        const requestRef = db.ref("requests/" + uid);
        const posterRef = db.ref("posters");

        requestRef.once("value", snapshot => {
          const data = snapshot.val();
          const requestList = document.getElementById("requestList");
          requestList.innerHTML = "";

          if (data) {
            Object.entries(data).forEach(([reqId, reqData]) => {
              const card = document.createElement("div");
              card.className = "card";

              card.innerHTML += `<h3>${reqData.category}</h3>`;
              card.innerHTML += `<p><strong>Description:</strong> ${reqData.description}</p>`;
              card.innerHTML += `<p><strong>Location:</strong> ${reqData.location}</p>`;

              // Check if accepted
              if (reqData.acceptedBy) {
                const posterId = Object.keys(reqData.acceptedBy)[0];
                posterRef.child(posterId).once("value", snap => {
                  const poster = snap.val();
                  if (poster) {
                    card.innerHTML += `<hr><h4>Accepted By:</h4>`;
                    card.innerHTML += `<p><strong>Name:</strong> ${poster.name} (${poster.category})</p>`;
                    card.innerHTML += `<p><strong>Shop:</strong> ${poster.shop}</p>`;
                    card.innerHTML += `<p><strong>Wallet:</strong> â‚¹${poster.wallet}</p>`;
                    card.innerHTML += `<button class="btn-3d" onclick="window.open('https://wa.me/${poster.whatsapp}')">ðŸ“± WhatsApp</button>`;
                  }
                });
              }

              requestList.appendChild(card);
            });
          } else {
            requestList.innerHTML = "<p>No requests found.</p>";
          }
        });

      } else {
        alert("Please login to view your requests.");
      }
    });
  </script>

</body>
</html>
