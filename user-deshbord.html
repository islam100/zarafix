<div id="acceptedRequestsContainer" class="p-4"></div>

<script>
const db = firebase.database();
const currentUser = firebase.auth().currentUser;

firebase.auth().onAuthStateChanged((user) => {
  if (user) {
    const uid = user.uid;
    db.ref(`requests/${uid}`).once('value', (snapshot) => {
      const data = snapshot.val();
      const container = document.getElementById('acceptedRequestsContainer');
      container.innerHTML = '<h2 class="text-xl font-bold mb-4">Your Accepted Requests</h2>';

      if (!data) {
        container.innerHTML += "<p>No requests found.</p>";
        return;
      }

      Object.entries(data).forEach(([reqId, req]) => {
        const acceptedBy = req.acceptedBy ? Object.keys(req.acceptedBy)[0] : null;
        if (!acceptedBy) return;

        db.ref(`posters/${acceptedBy}`).once('value', (posterSnap) => {
          const poster = posterSnap.val();
          if (!poster) return;

          const card = document.createElement('div');
          card.className = 'bg-white rounded-2xl shadow-lg p-4 mb-4 transition transform hover:scale-105';

          card.innerHTML = `
            <p><strong>Category:</strong> ${req.category}</p>
            <p><strong>Description:</strong> ${req.description}</p>
            <p><strong>Accepted By:</strong> ${poster.name}</p>
            <p><strong>Shop:</strong> ${poster.shop}</p>
            <p><strong>Category:</strong> ${poster.category}</p>
            <p><strong>Wallet:</strong> ‚Çπ${poster.wallet}</p>
            <div class="flex gap-3 mt-3">
              <button class="bg-green-500 text-white px-3 py-1 rounded-xl shadow-lg hover:bg-green-600" onclick="window.open('https://wa.me/${poster.whatsapp}')">üì± WhatsApp</button>
              <button class="bg-yellow-500 text-white px-3 py-1 rounded-xl shadow-lg hover:bg-yellow-600" onclick="deleteRequest('${uid}', '${reqId}')">üóëÔ∏è Delete</button>
              <button class="bg-red-500 text-white px-3 py-1 rounded-xl shadow-lg hover:bg-red-600" onclick="rejectRequest('${uid}', '${reqId}')">‚ùå Reject</button>
            </div>
          `;
          container.appendChild(card);
        });
      });
    });
  }
});

// Delete Request Function
function deleteRequest(userId, requestId) {
  if (confirm("Are you sure you want to delete this request?")) {
    firebase.database().ref(`requests/${userId}/${requestId}`).remove().then(() => {
      alert("Request deleted.");
      location.reload();
    });
  }
}

// Reject Request Function
function rejectRequest(userId, requestId) {
  firebase.database().ref(`requests/${userId}/${requestId}/acceptedBy`).remove().then(() => {
    alert("Request rejected.");
    location.reload();
  });
}
</script>
