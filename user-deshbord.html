<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin Dashboard</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .card {
      border: 1px solid #ccc;
      border-radius: 15px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      padding: 20px;
      margin-bottom: 20px;
    }
    .btn {
      padding: 10px 16px;
      border: none;
      color: white;
      border-radius: 10px;
      margin-top: 10px;
      cursor: pointer;
      box-shadow: 2px 4px 6px rgba(0,0,0,0.2);
    }
    .btn-accept { background-color: green; }
    .btn-reject { background-color: red; }
    .btn-whatsapp {
      background-color: #25D366;
      text-decoration: none;
      display: inline-block;
      margin-top: 10px;
    }
  </style>
</head>
<body>

<h2>🛠 Admin Dashboard</h2>
<div id="dashboard"></div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCH17_8W_UPmPt4KqpCaV7BpN6KsA4a67E",
    authDomain: "zara-fix.firebaseapp.com",
    databaseURL: "https://zara-fix-default-rtdb.firebaseio.com",
    projectId: "zara-fix",
    storageBucket: "zara-fix.appspot.com",
    messagingSenderId: "621509306423",
    appId: "1:621509306423:web:82e2c3a10b747cb2265f08"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const dashboard = document.getElementById('dashboard');

  function renderRequest(userId, requestId, data, posterData) {
    const div = document.createElement('div');
    div.className = 'card';
    div.innerHTML = `
      <strong>📝 Category:</strong> ${data.category} <br>
      <strong>📍 Description:</strong> ${data.description} <br>
      <strong>📌 Location:</strong> ${data.location || 'N/A'} <br><br>
      ${posterData ? `
        <strong>👨‍🔧 Accepted By:</strong><br>
        🔹 <strong>Name:</strong> ${posterData.name} <br>
        🔹 <strong>Category:</strong> ${posterData.category}<br>
        🔹 <strong>Shop:</strong> ${posterData.shop}<br>
        🔹 <a class="btn btn-whatsapp" href="https://wa.me/${posterData.whatsapp}" target="_blank">Chat on WhatsApp</a><br>
      ` : ''}
      <button class="btn btn-reject" onclick="rejectRequest('${userId}', '${requestId}')">Reject ❌</button>
    `;
    dashboard.prepend(div); // नए request सबसे ऊपर
  }

  function rejectRequest(userId, requestId) {
    if (confirm("Are you sure to reject this request?")) {
      db.ref(`requests/${userId}/${requestId}/acceptedBy`).remove();
      alert("❌ Request rejected.");
      location.reload();
    }
  }

  async function loadDashboard() {
    const postersSnap = await db.ref('posters').once('value');
    const posters = postersSnap.val() || {};

    db.ref('requests').on('value', snapshot => {
      dashboard.innerHTML = '';
      const requests = snapshot.val();
      if (!requests) return;

      for (const userId in requests) {
        for (const requestId in requests[userId]) {
          const req = requests[userId][requestId];
          let posterId = req.acceptedBy ? Object.keys(req.acceptedBy)[0] : null;
          let posterData = posterId ? posters[posterId] : null;
          renderRequest(userId, requestId, req, posterData);
        }
      }
    });
  }

  loadDashboard();
</script>
</body>
</html>
