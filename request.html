<!DOCTYPE html>
<html>
<head>
  <title>My Requests</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background-color: #f2f2f2; }
    h2 { text-align: center; }
    .request-card {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      padding: 15px;
      margin: 10px auto;
      max-width: 500px;
    }
    .request-card p { margin: 6px 0; }
    .btn {
      border: none;
      padding: 8px 12px;
      margin: 5px 4px 0 0;
      border-radius: 10px;
      cursor: pointer;
      font-weight: bold;
      box-shadow: 0 4px 0 rgba(0,0,0,0.2);
    }
    .accept { background: #4CAF50; color: white; }
    .reject { background: #f44336; color: white; }
    .delete { background: #333; color: white; }
    .whatsapp { background: #25D366; color: white; }
  </style>
</head>
<body>
  <h2>मेरे द्वारा किए गए Request</h2>
  <div id="requestList"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, onValue, update, remove } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCH17_8W_UPmPt4KqpCaV7BpN6KsA4a67E",
      authDomain: "zara-fix.firebaseapp.com",
      databaseURL: "https://zara-fix-default-rtdb.firebaseio.com",
      projectId: "zara-fix",
      storageBucket: "zara-fix.appspot.com",
      messagingSenderId: "476473209200",
      appId: "1:476473209200:web:9f6efe6c32fd4248949fb5"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const auth = getAuth();

    const requestList = document.getElementById("requestList");

    onAuthStateChanged(auth, user => {
      if (user) {
        const uid = user.uid;
        const myRequestsRef = ref(db, 'requests/' + uid);

        onValue(myRequestsRef, snapshot => {
          requestList.innerHTML = '';
          snapshot.forEach(reqSnap => {
            const requestId = reqSnap.key;
            const data = reqSnap.val();

            let card = document.createElement('div');
            card.className = 'request-card';

            let acceptText = 'अभी किसी ने नहीं किया';
            let whatsappButtons = '';
            if (data.acceptedBy) {
              acceptText = '';
              Object.entries(data.acceptedBy).forEach(([uid, provider]) => {
                acceptText += `<div>✅ ${provider.name} (${provider.date})</div>`;
                whatsappButtons += `<a class="btn whatsapp" target="_blank" href="https://wa.me/${provider.phone}">WhatsApp ${provider.name}</a>`;
              });
            }

            card.innerHTML = `
              <p><strong>काम:</strong> ${data.service}</p>
              <p><strong>विवरण:</strong> ${data.description}</p>
              <p><strong>तारीख:</strong> ${data.date || ''}</p>
              <p><strong>Accept किया:</strong><br> ${acceptText}</p>
              ${whatsappButtons}
              <button class="btn delete" onclick="deleteRequest('${uid}', '${requestId}')">❌ Delete</button>
            `;

            requestList.appendChild(card);
          });
        });
      }
    });

    window.deleteRequest = function(userId, reqId) {
      if (confirm("क्या आप इस Request को हटाना चाहते हैं?")) {
        const delRef = ref(db, `requests/${userId}/${reqId}`);
        remove(delRef);
      }
    }
  </script>
</body>
</html>
