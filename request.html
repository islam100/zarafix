<!DOCTYPE html>
<html>
<head>
  <title>📋 Admin Panel - All Requests</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Arial; background: #f5f5f5; padding: 10px; }
    h2 { text-align: center; }
    .card {
      background: white; margin: 10px 0; padding: 10px;
      border-left: 6px solid #4CAF50; box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .poster { margin-left: 10px; padding: 5px; background: #eef; border-left: 3px solid #00bcd4; }
  </style>
</head>
<body>

<h2>📋 Admin Panel - All Requests</h2>
<div id="requestList">Loading requests...</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  // 🔧 Firebase Config
  const firebaseConfig = {
    apiKey: "AIzaSyCH17_8W_UPmPt4KqpCaV7BpN6KsA4a67E",
    authDomain: "zara-fix.firebaseapp.com",
    databaseURL: "https://zara-fix-default-rtdb.firebaseio.com",
    projectId: "zara-fix",
    storageBucket: "zara-fix.appspot.com",
    messagingSenderId: "480206018141",
    appId: "1:480206018141:web:e7881db931a19191f86b60"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const requestList = document.getElementById("requestList");

  function loadRequests() {
    db.ref("requests").on("value", async (snapshot) => {
      const data = snapshot.val();
      requestList.innerHTML = "";
      const cards = [];

      if (data) {
        // Get posters once to avoid multiple DB calls
        const postersSnapshot = await db.ref("posters").once("value");
        const postersData = postersSnapshot.val() || {};

        for (let userId in data) {
          for (let requestId in data[userId]) {
            const req = data[userId][requestId];
            const div = document.createElement("div");
            div.className = "card";
            div.innerHTML = `
              <b>📌 Category:</b> ${req.category}<br>
              <b>📝 Description:</b> ${req.description}<br>
              <b>📍 Location:</b> ${req.location || "N/A"}<br>
              <b>👤 User ID:</b> ${userId}<br>
              <b>🆔 Request ID:</b> ${requestId}
              <br><b>✅ Accepted By:</b>
            `;

            if (req.acceptedBy) {
              for (let posterId in req.acceptedBy) {
                const poster = postersData[posterId];
                if (poster) {
                  div.innerHTML += `
                    <div class="poster">
                      <b>${poster.name}</b> (${poster.category})<br>
                      🏪 ${poster.shop}<br>
                      📱 ${poster.whatsapp}<br>
                      💰 Wallet: ₹${poster.wallet}
                    </div>
                  `;
                } else {
                  div.innerHTML += `<div class="poster">❌ Poster data not found for ID: ${posterId}</div>`;
                }
              }
            } else {
              div.innerHTML += "❌ Not accepted by any poster";
            }

            // Add to top
            cards.unshift(div);
          }
        }
      } else {
        requestList.innerHTML = "😴 No requests found.";
        return;
      }

      cards.forEach(c => requestList.appendChild(c));
    });
  }

  loadRequests();
</script>

</body>
</html>
