<!DOCTYPE html>
<html>
<head>
  <title>Service Request Form</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
</head>
<body>
  <h2>Post a Service Request</h2>
  <form id="requestForm">
    <label>Name:</label>
    <input type="text" id="name" required><br><br>

    <label>Category:</label>
    <select id="category" required>
      <option value="">--Select--</option>
      <option value="Electrician">Electrician</option>
      <option value="Plumber">Plumber</option>
      <option value="Carpenter">Carpenter</option>
      <option value="AC Repair">AC Repair</option>
    </select><br><br>

    <label>Description:</label>
    <textarea id="description" required></textarea><br><br>

    <label>Location:</label>
    <input type="text" id="location" required><br><br>

    <button type="submit">Submit Request</button>
  </form>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyCH17_8W_UPmPt4KqpCaV7BpN6KsA4a67E",
      authDomain: "zara-fix.firebaseapp.com",
      databaseURL: "https://zara-fix-default-rtdb.firebaseio.com",
      projectId: "zara-fix",
      storageBucket: "zara-fix.appspot.com",
      messagingSenderId: "476473209200",
      appId: "1:476473209200:web:9f6efe6c32fd4248949fb5"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);

    // Auth check and form submission
    firebase.auth().onAuthStateChanged(user => {
      if (user) {
        document.getElementById("requestForm").addEventListener("submit", function(e) {
          e.preventDefault();

          const name = document.getElementById("name").value;
          const category = document.getElementById("category").value;
          const description = document.getElementById("description").value;
          const location = document.getElementById("location").value;

          const userId = user.uid;
          const requestId = firebase.database().ref().child('requests').push().key;
          const datetime = new Date().toISOString();

          const requestData = {
            name,
            category,
            description,
            location,
            datetime
          };

          firebase.database().ref("requests/" + userId + "/" + requestId).set(requestData)
            .then(() => {
              alert("Request submitted successfully!");
              document.getElementById("requestForm").reset();
            })
            .catch(error => {
              alert("Error: " + error.message);
            });
        });
      } else {
        alert("Please login first!");
        window.location.href = "login.html"; // or your login page
      }
    });
  </script>
</body>
</html>
