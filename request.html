<!DOCTYPE html>
<html>
<head>
  <title>Service Requests</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Arial; background: #f9f9f9; padding: 20px; }
    .request-box {
      background: white;
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    h2 { margin: 0 0 10px 0; }
    .btn {
      padding: 10px 15px;
      margin: 5px 5px 0 0;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-weight: bold;
      box-shadow: 0 4px 6px rgba(0,0,0,0.2);
      transition: transform 0.2s ease;
    }
    .btn:hover { transform: scale(1.05); }
    .btn-whatsapp { background: #25D366; color: white; }
    .btn-delete { background: #ff4d4d; color: white; }
    .btn-reject { background: #ff9900; color: white; }
  </style>
</head>
<body>

<h1>üìã Service Requests</h1>
<div id="requestsContainer"></div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    databaseURL: "https://YOUR_PROJECT.firebaseio.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT.appspot.com",
    messagingSenderId: "SENDER_ID",
    appId: "APP_ID"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  function loadRequests() {
    const container = document.getElementById('requestsContainer');
    container.innerHTML = '';

    db.ref('requests').once('value', snapshot => {
      const requests = snapshot.val();
      if (!requests) {
        container.innerHTML = '<p>No requests yet.</p>';
        return;
      }

      for (let userId in requests) {
        for (let requestId in requests[userId]) {
          const req = requests[userId][requestId];
          const date = req.date || 'N/A';
          const acceptedBy = req.acceptedBy || {};

          let box = document.createElement('div');
          box.className = 'request-box';

          box.innerHTML = `
            <h2>‡§ï‡§æ‡§Æ: ${req.category || 'N/A'}</h2>
            <p><strong>‡§µ‡§ø‡§µ‡§∞‡§£:</strong> ${req.description || ''}</p>
            <p><strong>‡§§‡§æ‡§∞‡•Ä‡§ñ:</strong> ${date}</p>
            <p><strong>Accept ‡§ï‡§ø‡§Ø‡§æ:</strong></p>
          `;

          for (let posterId in acceptedBy) {
            db.ref('posters/' + posterId).once('value', snap => {
              const poster = snap.val();
              const name = poster?.name || 'Unknown';
              const whatsapp = poster?.whatsapp || '';

              let p = document.createElement('p');
              p.innerHTML = `‚úÖ ${name} (${posterId})<br>
                <a href="https://wa.me/${whatsapp}" target="_blank" class="btn btn-whatsapp">WhatsApp ${name}</a>
                <button class="btn btn-delete" onclick="deleteRequest('${userId}', '${requestId}', '${posterId}')">‚ùå Delete</button>
                <button class="btn btn-reject" onclick="rejectRequest('${userId}', '${requestId}', '${posterId}')">üö´ Reject</button>
              `;
              box.appendChild(p);
            });
          }

          container.appendChild(box);
        }
      }
    });
  }

  function deleteRequest(userId, requestId, posterId) {
    if (confirm("‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§á‡§∏ request ‡§ï‡•ã delete ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?")) {
      firebase.database().ref(`requests/${userId}/${requestId}/acceptedBy/${posterId}`).remove()
      .then(() => {
        alert("Request deleted.");
        loadRequests();
      });
    }
  }

  function rejectRequest(userId, requestId, posterId) {
    if (confirm("Reject ‡§ï‡§∞‡•á‡§Ç?")) {
      firebase.database().ref(`requests/${userId}/${requestId}/acceptedBy/${posterId}`).remove()
      .then(() => {
        alert("Rejected.");
        loadRequests();
      });
    }
  }

  loadRequests();
</script>

</body>
</html>
