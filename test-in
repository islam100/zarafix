function makeCard(p, ctx){
  const el = document.createElement('div');
  el.className = `card-3d colourful ${statusBorder(p)}`;

  const discountTxt = p.discount ? `<span class="text-amber-300 font-bold">-${p.discount}Rs.</span>` : '';

  let mainBtn = '';
  if(p.isAmazon){
    mainBtn = `<a class="btn-3d px-3 py-2 rounded-xl bg-yellow-500 font-bold" target="_blank" href="${p.affiliateLink}">Buy on Amazon</a>`;
  } else {
    mainBtn = `<a class="btn-3d px-3 py-2 rounded-xl ${p.sold?'bg-slate-600 pointer-events-none opacity-70':'bg-emerald-500'} font-bold" target="_blank" href="${p.sold?'#':waLink(p)}">${p.sold?'Sold':'WhatsApp'}</a>`;
  }

  // Admin + Shopkeeper buttons same as earlier
  let adminBtns='', shopBtns='';
  const isAdmin = auth.currentUser && auth.currentUser.email===ADMIN_EMAIL;
  if(isAdmin){
    adminBtns = `<button class="btn-3d px-3 py-2 rounded-xl bg-emerald-600 font-bold admin-sold">${p.sold?'UnSold':'Mark Sold'}</button>`;
  }
  if(auth.currentUser && auth.currentUser.email===p.owner && !p.isAmazon){
    shopBtns = `<button class="btn-3d px-3 py-2 rounded-xl bg-rose-600 font-bold mine-del">Delete</button>`;
  }

  const pendingNote = (ctx!=='public' && p.status!=='approved') ? `<div class="text-red-400 font-bold text-sm mt-1">WAIT FOR APPROVAL</div>` : '';

  el.innerHTML = `
    <div class="relative">${statusBadge(p)}</div>
    ${galleryHTML(p)}
    <div class="p-3">
      <div class="font-extrabold text-[15px] leading-tight">${clean(p.name||'')}</div>
      <div class="text-sm opacity-80 mt-1">${(p.category||'').toUpperCase()} â€¢ <span class="font-bold">${rupees(p.price||0)}</span> ${discountTxt}</div>
      ${p.desc? `<div class="text-xs opacity-70 mt-1">${clean(p.desc)}</div>`:''}
      <div class="flex gap-2 mt-2 flex-wrap">
        ${mainBtn}
        ${adminBtns}
        ${shopBtns}
      </div>
      ${pendingNote}
    </div>
  `;

  // gallery & button handlers
  attachGalleryHandlers(el,p);
  return el;
}
