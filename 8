<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Accepted Requests</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <style>
    body {
      font-family: Arial;
      padding: 20px;
    }
    .card {
      border: 2px solid #ccc;
      border-radius: 16px;
      padding: 15px;
      margin-bottom: 15px;
      box-shadow: 2px 2px 8px #aaa;
    }
    button {
      margin-right: 10px;
      padding: 10px 15px;
      border: none;
      border-radius: 10px;
      box-shadow: 2px 2px 5px #666;
      cursor: pointer;
    }
    .whatsapp { background-color: #25D366; color: white; }
    .delete { background-color: #f44336; color: white; }
    .reject { background-color: #ff9800; color: white; }
  </style>
</head>
<body>
  <h2>‚úÖ Your Accepted Requests</h2>
  <div id="requestsContainer">Loading...</div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCH17_8W_UPmPt4KqpCaV7BpN6KsA4a67E",
      authDomain: "zara-fix.firebaseapp.com",
      databaseURL: "https://zara-fix-default-rtdb.firebaseio.com",
      projectId: "zara-fix",
      storageBucket: "zara-fix.appspot.com",
      messagingSenderId: "473628251696",
      appId: "1:473628251696:web:857cb4bb3c43ac9300305d"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const container = document.getElementById("requestsContainer");

    const currentAdminEmail = "zarafix3@gmail.com"; // ‚Üê ‡§á‡§∏‡§ï‡•ã ‡§¨‡§¶‡§≤‡•ã ‡§Ö‡§™‡§®‡•á ‡§à‡§Æ‡•á‡§≤ ‡§∏‡•á

    db.ref("requests").once("value", snapshot => {
      container.innerHTML = "";
      snapshot.forEach(userSnap => {
        userSnap.forEach(reqSnap => {
          const req = reqSnap.val();
          if (req.acceptedBy === currentAdminEmail) {
            const card = document.createElement("div");
            card.className = "card";

            const name = req.name || "N/A";
            const address = req.address || "N/A";
            const pincode = req.pincode || "N/A";
            const category = req.category || "N/A";
            const issue = req.issue || "N/A";
            const location = req.location || "N/A";
            const acceptedBy = req.acceptedBy || "N/A";

            const phone = req.phone || "911234567890"; // ‚Üê WhatsApp ‡§®‡§Ç‡§¨‡§∞ (default ‡§Ö‡§ó‡§∞ missing ‡§π‡•à)

            card.innerHTML = `
              üßë‚Äçüîß <strong>Name:</strong> ${name}<br>
              üìå <strong>Category:</strong> ${category}<br>
              üìç <strong>Address:</strong> ${address}<br>
              üìç <strong>Pincode:</strong> ${pincode}<br>
              üìÖ <strong>Issue:</strong> ${issue}<br>
              üìç <strong>Location:</strong> ${location}<br>
              ‚úÖ <strong>Accepted By:</strong> ${acceptedBy}<br><br>
              <button class="whatsapp" onclick="window.open('https://wa.me/${phone}', '_blank')">WhatsApp</button>
              <button class="delete" onclick="deleteRequest('${userSnap.key}', '${reqSnap.key}')">Delete</button>
              <button class="reject" onclick="rejectRequest('${userSnap.key}', '${reqSnap.key}')">Reject</button>
            `;
            container.appendChild(card);
          }
        });
      });

      if (container.innerHTML === "") {
        container.innerHTML = "‚ùå ‡§ï‡•ã‡§à Accepted Request ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ‡•§";
      }
    });

    function deleteRequest(userId, reqId) {
      if (confirm("‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§µ‡§æ‡§ï‡§à ‡§°‡§ø‡§≤‡•Ä‡§ü ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?")) {
        firebase.database().ref(`requests/${userId}/${reqId}`).remove();
        alert("Request Deleted");
        location.reload();
      }
    }

    function rejectRequest(userId, reqId) {
      firebase.database().ref(`requests/${userId}/${reqId}/acceptedBy`).remove();
      alert("Request Rejected");
      location.reload();
    }
  </script>
</body>
</html>
