<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Zara Property Listing</title>
<style>
  body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
  header { background: #333; color: #fff; padding: 15px; display: flex; justify-content: space-between; align-items: center; }
  header h1 { margin: 0; font-size: 24px; }
  header button { padding: 8px 12px; cursor: pointer; }
  .container { padding: 20px; }
  .property { border: 1px solid #ccc; margin-bottom: 15px; padding: 10px; border-radius: 8px; }
  .property img { max-width: 100%; border-radius: 8px; }
  .delete-btn { background: red; color: #fff; padding: 5px 10px; border: none; cursor: pointer; margin-top: 5px; }
  .upload-box { border: 2px dashed #777; padding: 15px; margin-bottom: 20px; text-align: center; display: none; }
</style>
</head>
<body>
<header>
  <h1>Zara Property</h1>
  <div>
    <button id="loginBtn">Google Login</button>
    <button id="logoutBtn" style="display:none;">Logout</button>
  </div>
</header>

<div class="container">
  <!-- Upload Form -->
  <div class="upload-box" id="uploadBox">
    <h3>नई Property जोड़ें</h3>
    <input type="text" id="title" placeholder="Title"><br><br>
    <input type="text" id="price" placeholder="Price"><br><br>
    <input type="file" id="imageFile"><br><br>
    <button id="uploadBtn">Upload Property</button>
  </div>

  <!-- Property Listing -->
  <h2>Available Properties</h2>
  <div id="propertyList"></div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

<script>
  // ✅ Firebase Config
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    databaseURL: "https://YOUR_PROJECT.firebaseio.com",
    projectId: "YOUR_PROJECT",
    storageBucket: "YOUR_PROJECT.appspot.com",
    messagingSenderId: "SENDER_ID",
    appId: "APP_ID"
  };
  firebase.initializeApp(firebaseConfig);

  const db = firebase.database();
  const auth = firebase.auth();
  const provider = new firebase.auth.GoogleAuthProvider();

  const loginBtn = document.getElementById("loginBtn");
  const logoutBtn = document.getElementById("logoutBtn");
  const uploadBox = document.getElementById("uploadBox");
  const propertyList = document.getElementById("propertyList");

  // ✅ Login
  loginBtn.addEventListener("click", () => {
    auth.signInWithPopup(provider).then((result) => {
      localStorage.setItem("user", JSON.stringify(result.user));
      checkUser();
    });
  });

  // ✅ Logout
  logoutBtn.addEventListener("click", () => {
    auth.signOut().then(() => {
      localStorage.removeItem("user");
      checkUser();
    });
  });

  // ✅ Check User (Admin Access)
  function checkUser() {
    let user = JSON.parse(localStorage.getItem("user"));
    if (user) {
      loginBtn.style.display = "none";
      logoutBtn.style.display = "inline-block";
      uploadBox.style.display = "block"; // केवल लॉगिन पर दिखेगा
    } else {
      loginBtn.style.display = "inline-block";
      logoutBtn.style.display = "none";
      uploadBox.style.display = "none";
    }
  }

  checkUser();

  // ✅ ImgBB Upload + Firebase Save
  document.getElementById("uploadBtn").addEventListener("click", async () => {
    let title = document.getElementById("title").value;
    let price = document.getElementById("price").value;
    let file = document.getElementById("imageFile").files[0];

    if (!file || !title || !price) {
      alert("कृपया सभी जानकारी भरें!");
      return;
    }

    let formData = new FormData();
    formData.append("image", file);

    let res = await fetch("https://api.imgbb.com/1/upload?key=YOUR_IMGBB_API_KEY", {
      method: "POST",
      body: formData
    });

    let data = await res.json();
    if (data.success) {
      let imageUrl = data.data.url;
      let newRef = db.ref("properties").push();
      newRef.set({ title, price, image: imageUrl });
      alert("Property सफलतापूर्वक जोड़ दी गई!");
      document.getElementById("title").value = "";
      document.getElementById("price").value = "";
      document.getElementById("imageFile").value = "";
    }
  });

  // ✅ Property Fetch
  function fetchProperties() {
    db.ref("properties").on("value", (snapshot) => {
      propertyList.innerHTML = "";
      snapshot.forEach((child) => {
        let data = child.val();
        let div = document.createElement("div");
        div.classList.add("property");
        div.innerHTML = `
          <h3>${data.title}</h3>
          <p>Price: ${data.price}</p>
          <img src="${data.image}" alt="Property Image">
          ${localStorage.getItem("user") ? `<button class="delete-btn" onclick="deleteProperty('${child.key}')">Delete</button>` : ""}
        `;
        propertyList.appendChild(div);
      });
    });
  }

  fetchProperties();

  // ✅ Delete Function (Only Admin/User logged in)
  function deleteProperty(id) {
    if (!localStorage.getItem("user")) return alert("Only admin can delete!");
    db.ref("properties/" + id).remove();
  }
</script>
</body>
</html>
