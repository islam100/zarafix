<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Zara Fix - Admin & Post System</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f3f3f3; }
    h2 { color: #444; }
    .form-box, .admin-box { background: white; padding: 20px; margin-bottom: 30px; border-radius: 8px; box-shadow: 0 2px 6px #ccc; }
    input, select, button { padding: 10px; margin: 5px 0; width: 100%; border-radius: 6px; border: 1px solid #ccc; }
    .post { padding: 10px; border-bottom: 1px solid #ddd; }
    .led { color: red; animation: blink 1s infinite; }
    @keyframes blink { 50% { opacity: 0; } }
    .wa-btn { background: green; color: white; padding: 5px 10px; text-decoration: none; border-radius: 4px; display: inline-block; margin-top: 5px; }
  </style>
</head>
<body>

  <div class="form-box">
    <h2>üìù Post Form</h2>
    <input id="name" placeholder="Name" />
    <input id="price" placeholder="Price" type="number" />
    <input id="whatsapp" placeholder="WhatsApp Number (91...)" />
    <input id="imgurl" placeholder="Image URL (from imgbb)" />
    <select id="category">
      <option value="Mobile">Mobile</option>
      <option value="Laptop">Laptop</option>
      <option value="Other">Other</option>
    </select>
    <button onclick="submitPost()">Submit</button>
  </div>

  <div class="admin-box">
    <h2>üìã Admin Panel</h2>
    <div id="posts"></div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyD7ZqL-PVuFdd8rMVIyW7CgHQjPRGHD2h8",
      authDomain: "zara-fix-2e35a.firebaseapp.com",
      projectId: "zara-fix-2e35a",
      storageBucket: "zara-fix-2e35a.appspot.com",
      messagingSenderId: "636550144008",
      appId: "1:636550144008:web:a849496ad1d1557d7ab1bd"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function submitPost() {
      const name = document.getElementById("name").value;
      const price = document.getElementById("price").value;
      const whatsapp = document.getElementById("whatsapp").value;
      const imgurl = document.getElementById("imgurl").value;
      const category = document.getElementById("category").value;
      const postId = Date.now();

      db.ref("posts/" + postId).set({
        name, price, whatsapp, imgurl, category,
        timestamp: postId,
        approved: false
      });

      alert("Post submitted. Please wait for approval.");
    }

    function loadPosts() {
      const now = Date.now();
      const day30 = 1000 * 60 * 60 * 24 * 30;
      db.ref("posts").on("value", snap => {
        const data = snap.val();
        const postsDiv = document.getElementById("posts");
        postsDiv.innerHTML = "";
        for (let id in data) {
          const post = data[id];
          const isExpired = now - post.timestamp > day30;

          // Auto-set expired to false
          if (isExpired && post.approved) {
            db.ref("posts/" + id + "/approved").set(false);
          }

          const label = post.approved ?
            (!isExpired ? "‚úÖ Approved" : "‚ö†Ô∏è Expired") :
            "<span class='led'>‚è≥ Pending</span>";

          const waLink = `https://wa.me/${post.whatsapp}?text=Please+recharge+your+post.`;

          postsDiv.innerHTML += `
            <div class="post">
              <b>${post.name}</b> - ‚Çπ${post.price} - ${post.category} <br>
              <img src="${post.imgurl}" width="100" /><br>
              ${label}<br>
              <button onclick="approvePost('${id}')">Approve</button>
              <a class="wa-btn" href="${waLink}" target="_blank">Recharge</a>
            </div>
          `;
        }
      });
    }

    function approvePost(id) {
      db.ref("posts/" + id + "/approved").set(true);
    }

    loadPosts();
  </script>
</body>
</html>
