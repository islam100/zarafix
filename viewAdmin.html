<!DOCTYPE html>
<html>
<head>
  <title>ğŸ”§ Zara Admin Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      margin: 0;
      padding: 10px;
    }
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 12px;
      background: linear-gradient(to right, #007bff, #00c6ff);
      color: white;
      font-weight: bold;
      box-shadow: 0 4px 6px rgba(0,0,0,0.2);
      cursor: pointer;
      margin: 5px;
    }
    .card {
      border: 1px solid #ccc;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 10px;
      background: white;
    }
    .hidden { display: none; }
  </style>
</head>
<body>
  <h2>ğŸ”§ Zara Admin Panel</h2>
  <button id="loginBtn" class="btn">Login with Google</button>
  <div id="formSection" class="hidden">
    <h3>ğŸ“ Submit Your Post</h3>
    <input id="name" placeholder="Name"><br>
    <input id="price" placeholder="Price"><br>
    <input id="whatsapp" placeholder="WhatsApp Number"><br>
    <input type="file" id="imageInput"><br>
    <button id="submitBtn" class="btn">Submit</button>
    <p id="submitMsg"></p>
  </div>

  <hr>
  <div id="postsSection">
    <h3>ğŸ“ƒ View Posts</h3>
    <div id="postsContainer"></div>
  </div>

  <div id="adminPanel" class="hidden">
    <h3>ğŸ›  Admin Panel</h3>
    <div id="adminPosts"></div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getDatabase, ref, push, onValue, update, remove } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCH17_8W_UPmPt4KqpCaV7BpN6KsA4a67E",
      authDomain: "zara-fix.firebaseapp.com",
      projectId: "zara-fix",
      databaseURL: "https://zara-fix-default-rtdb.firebaseio.com",
      storageBucket: "zara-fix.appspot.com",
      messagingSenderId: "539619279396",
      appId: "1:539619279396:web:b076fc85831a79264a2385"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const auth = getAuth(app);

    const loginBtn = document.getElementById("loginBtn");
    const formSection = document.getElementById("formSection");
    const adminPanel = document.getElementById("adminPanel");
    const postsContainer = document.getElementById("postsContainer");
    const adminPosts = document.getElementById("adminPosts");
    const submitBtn = document.getElementById("submitBtn");
    const submitMsg = document.getElementById("submitMsg");

    const ADMIN_UID = "QT3LkEToHwaiORatoKfTx8QE45s2";

    loginBtn.onclick = () => {
      const provider = new GoogleAuthProvider();
      signInWithPopup(auth, provider)
        .then(result => {
          const user = result.user;
          checkUser(user.uid);
        });
    };

    function checkUser(uid) {
      formSection.classList.remove("hidden");
      if (uid === ADMIN_UID) {
        adminPanel.classList.remove("hidden");
      }
    }

    submitBtn.onclick = async () => {
      const name = document.getElementById("name").value;
      const price = document.getElementById("price").value;
      const whatsapp = document.getElementById("whatsapp").value;
      const imageFile = document.getElementById("imageInput").files[0];
      if (!imageFile) return alert("Please select image");

      const formData = new FormData();
      formData.append("image", imageFile);
      const imgbbApiKey = "YOUR_IMGBB_API_KEY";
      const res = await fetch(`https://api.imgbb.com/1/upload?key=${imgbbApiKey}`, {
        method: "POST",
        body: formData
      });
      const data = await res.json();
      const imageUrl = data.data.url;

      push(ref(db, 'posts/'), {
        name,
        price,
        whatsapp,
        image: imageUrl,
        approved: false,
        createdAt: Date.now()
      });

      document.getElementById("name").value = "";
      document.getElementById("price").value = "";
      document.getElementById("whatsapp").value = "";
      document.getElementById("imageInput").value = "";
      submitMsg.innerText = "âœ… Submit ho gaya!";
    };

    onValue(ref(db, 'posts/'), snapshot => {
      postsContainer.innerHTML = "";
      adminPosts.innerHTML = "";
      snapshot.forEach(child => {
        const post = child.val();
        const key = child.key;

        const html = `
          <div class="card">
            <img src="${post.image}" width="100%" /><br>
            <b>${post.name}</b> - â‚¹${post.price}<br>
            <a href="https://wa.me/${post.whatsapp}" class="btn">WhatsApp</a>
          </div>
        `;

        const adminHtml = `
          <div class="card">
            <img src="${post.image}" width="100%" /><br>
            <b>${post.name}</b> - â‚¹${post.price}<br>
            <a href="https://wa.me/${post.whatsapp}" class="btn">Chat</a>
            <button class="btn" onclick="approvePost('${key}')">Approve</button>
            <button class="btn" onclick="deletePost('${key}')">Delete</button>
          </div>
        `;

        if (post.approved) {
          postsContainer.innerHTML += html;
        }
        adminPosts.innerHTML += adminHtml;
      });
    });

    window.approvePost = (key) => {
      update(ref(db, 'posts/' + key), { approved: true });
    };

    window.deletePost = (key) => {
      remove(ref(db, 'posts/' + key));
    };
  </script>
</body>
</html>
