<!DOCTYPE html>
<html>
<head>
  <title>Zara Post System</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f4f4f4; }
    .card { border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); padding: 15px; background: white; margin-bottom: 20px; }
    .btn { padding: 10px 20px; margin-top: 10px; background: #007bff; color: white; border: none; border-radius: 10px; font-weight: bold; box-shadow: 0 4px 0 #0056b3; }
    .btn:active { transform: translateY(2px); box-shadow: 0 2px 0 #0056b3; }
    .hide { display: none; }
    input, textarea { padding: 10px; width: 100%; margin-top: 10px; border: 1px solid #ccc; border-radius: 8px; }
    img { max-width: 100%; border-radius: 10px; margin-top: 10px; }
    .admin-section { border-top: 2px dashed #ccc; padding-top: 20px; margin-top: 20px; }
    .whatsapp-btn { background: green; margin-top: 10px; }
  </style>
</head>
<body>
  <h2>üì∏ Zara Customer Post</h2>

  <button id="loginBtn" class="btn">Login with Google</button>
  <button id="logoutBtn" class="btn hide">Logout</button>

  <div id="formSection" class="hide">
    <input type="text" id="custName" placeholder="Name" />
    <input type="text" id="price" placeholder="Price" />
    <input type="text" id="whatsapp" placeholder="WhatsApp Number" />
    <input type="file" id="imgInput" accept="image/*" />
    <img id="previewImg" class="hide"/>
    <button class="btn" onclick="submitPost()">Post</button>
    <p id="submitMsg"></p>
  </div>

  <div id="postsSection"></div>

  <div id="adminPanel" class="hide admin-section">
    <h3>üîß Zara Admin Panel</h3>
    <input type="text" id="filterName" placeholder="Search by Name" />
    <button class="btn" onclick="filterPosts()">Filter</button>
    <div id="adminPosts"></div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getDatabase, ref, set, push, onValue, update, remove } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCH17_8W_UPmPt4KqpCaV7BpN6KsA4a67E",
      authDomain: "zara-fix.firebaseapp.com",
      databaseURL: "https://zara-fix-default-rtdb.firebaseio.com",
      projectId: "zara-fix",
      storageBucket: "zara-fix.appspot.com",
      messagingSenderId: "726155188433",
      appId: "1:726155188433:web:f8b7898eaf52c0c5dd4d3a"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase();
    const auth = getAuth();
    const provider = new GoogleAuthProvider();

    const loginBtn = document.getElementById('loginBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const formSection = document.getElementById('formSection');
    const adminPanel = document.getElementById('adminPanel');

    let currentUser;

    loginBtn.onclick = () => signInWithPopup(auth, provider);
    logoutBtn.onclick = () => signOut(auth);

    onAuthStateChanged(auth, user => {
      if (user) {
        currentUser = user;
        loginBtn.classList.add('hide');
        logoutBtn.classList.remove('hide');
        formSection.classList.remove('hide');
        if (user.uid === "QT3LkEToHwaiORatoKfTx8QE45s2") {
          adminPanel.classList.remove('hide');
        }
      } else {
        currentUser = null;
        loginBtn.classList.remove('hide');
        logoutBtn.classList.add('hide');
        formSection.classList.add('hide');
        adminPanel.classList.add('hide');
      }
    });

    let imageUrl = "";
    const imgInput = document.getElementById('imgInput');
    const previewImg = document.getElementById('previewImg');

    imgInput.onchange = async (e) => {
      const file = e.target.files[0];
      const formData = new FormData();
      formData.append("image", file);

      const res = await fetch("https://api.imgbb.com/1/upload?key=9241af9700e4690699c3eafc73cb2348", {
        method: "POST",
        body: formData
      });
      const data = await res.json();
      if (data.success) {
        imageUrl = data.data.url;
        previewImg.src = imageUrl;
        previewImg.classList.remove("hide");
      } else {
        alert("Image upload failed!");
      }
    };

    window.submitPost = () => {
      const name = document.getElementById('custName').value;
      const price = document.getElementById('price').value;
      const whatsapp = document.getElementById('whatsapp').value;

      if (!name || !price || !whatsapp || !imageUrl) {
        alert("Fill all fields and upload image!");
        return;
      }

      const postRef = push(ref(db, "posts/"));
      set(postRef, {
        name, price, whatsapp, image: imageUrl, status: "pending"
      }).then(() => {
        document.getElementById("submitMsg").innerText = "‚úÖ Submit ‡§π‡•ã ‡§ó‡§Ø‡§æ, Approval ‡§ï‡§æ ‡§á‡§Ç‡§§‡§ú‡§º‡§æ‡§∞ ‡§ï‡§∞‡•á‡§Ç";
        document.getElementById("custName").value = "";
        document.getElementById("price").value = "";
        document.getElementById("whatsapp").value = "";
        previewImg.src = "";
        previewImg.classList.add("hide");
        imageUrl = "";
      });
    };

    const postsSection = document.getElementById('postsSection');
    const adminPosts = document.getElementById('adminPosts');

    function loadPosts() {
      onValue(ref(db, "posts/"), snapshot => {
        postsSection.innerHTML = "";
        adminPosts.innerHTML = "";

        snapshot.forEach(child => {
          const post = child.val();
          const key = child.key;

          if (post.status === "approved") {
            postsSection.innerHTML += `
              <div class="card">
                <h4>${post.name}</h4>
                <img src="${post.image}" />
                <p>Price: ‚Çπ${post.price}</p>
                <button class="btn whatsapp-btn" onclick="location.href='https://wa.me/${post.whatsapp}'">WhatsApp</button>
              </div>
            `;
          }

          if (currentUser?.uid === "QT3LkEToHwaiORatoKfTx8QE45s2") {
            adminPosts.innerHTML += `
              <div class="card">
                <h4>${post.name}</h4>
                <img src="${post.image}" />
                <p>Price: ‚Çπ${post.price}</p>
                <p>WhatsApp: ${post.whatsapp}</p>
                <button class="btn" onclick="approvePost('${key}')">‚úÖ Approve</button>
                <button class="btn" style="background:red" onclick="deletePost('${key}')">‚ùå Reject</button>
              </div>
            `;
          }
        });
      });
    }

    window.approvePost = (key) => update(ref(db, "posts/" + key), { status: "approved" });
    window.deletePost = (key) => remove(ref(db, "posts/" + key));
    window.filterPosts = () => {
      const name = document.getElementById("filterName").value.toLowerCase();
      const all = document.querySelectorAll("#adminPosts .card");
      all.forEach(card => {
        card.style.display = card.innerText.toLowerCase().includes(name) ? "block" : "none";
      });
    };

    loadPosts();
  </script>
</body>
</html>
