<!DOCTYPE html>
<html>
<head>
  <title>Zara Post Panel</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <style>
    body { font-family: Arial; padding: 20px; background: #f0f0f0; }
    h2 { color: #444; }
    input, textarea { padding: 10px; margin: 5px; width: 100%; }
    button {
      padding: 10px 20px;
      margin: 10px 0;
      background: linear-gradient(#4CAF50, #2E7D32);
      color: white; border: none;
      border-radius: 8px;
      box-shadow: 0 5px #1B5E20;
    }
    button:active { box-shadow: 0 2px #1B5E20; transform: translateY(3px); }
    .admin-panel { display: none; background: #fff; padding: 10px; margin-top: 20px; }
    .success { color: green; font-weight: bold; }
  </style>
</head>
<body>

<h2>📝 Post Your Ad</h2>
<input type="text" id="name" placeholder="Product Name" required>
<input type="text" id="price" placeholder="Price (₹)" required>
<input type="text" id="whatsapp" placeholder="WhatsApp Number" required>
<input type="file" id="imageInput" accept="image/*">
<button onclick="submitPost()">📤 Submit Post</button>
<div id="msg" class="success"></div>

<h2>🔐 Login as Admin</h2>
<button onclick="googleLogin()">Login with Google</button>

<div id="adminPanel" class="admin-panel">
  <h2>🔧 Zara Admin Panel</h2>
  <div id="postList"></div>
</div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyD7ZqL-PVuFdd8rMVIyW7CgHQjPRGHD2h8",
    authDomain: "zara-fix-2e35a.firebaseapp.com",
    projectId: "zara-fix-2e35a",
    storageBucket: "zara-fix-2e35a.appspot.com",
    messagingSenderId: "636550144008",
    appId: "1:636550144008:web:a849496ad1d1557d7ab1bd",
    databaseURL: "https://zara-fix-2e35a-default-rtdb.firebaseio.com"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const auth = firebase.auth();
  const adminUID = "QT3LkEToHwaiORatoKfTx8QE45s2"; // Your Admin UID

  function submitPost() {
    const name = document.getElementById('name').value;
    const price = document.getElementById('price').value;
    const whatsapp = document.getElementById('whatsapp').value;
    const imageFile = document.getElementById('imageInput').files[0];

    if (!name || !price || !whatsapp || !imageFile) {
      alert("सभी फ़ील्ड भरें और एक इमेज चुनें!");
      return;
    }

    const formData = new FormData();
    formData.append("image", imageFile);
    fetch("https://api.imgbb.com/1/upload?key=YOUR_IMGBB_API_KEY", {
      method: "POST",
      body: formData
    })
    .then(res => res.json())
    .then(data => {
      const imageUrl = data.data.url;
      const postData = {
        name,
        price,
        whatsapp,
        imageUrl,
        approved: false,
        timestamp: Date.now()
      };
      const newPostKey = db.ref().child("posts").push().key;
      db.ref("posts/" + newPostKey).set(postData, () => {
        document.getElementById('msg').innerText = "✅ Submit हो गया!";
        document.getElementById('name').value = "";
        document.getElementById('price').value = "";
        document.getElementById('whatsapp').value = "";
        document.getElementById('imageInput').value = "";
      });
    })
    .catch(err => {
      alert("Image upload fail: " + err);
    });
  }

  function googleLogin() {
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider).then(result => {
      if (result.user.uid === adminUID) {
        document.getElementById("adminPanel").style.display = "block";
        loadPosts();
      } else {
        alert("आप Admin नहीं हैं!");
      }
    });
  }

  function loadPosts() {
    const postList = document.getElementById("postList");
    postList.innerHTML = "";
    db.ref("posts").once("value", snapshot => {
      snapshot.forEach(child => {
        const post = child.val();
        const key = child.key;
        const card = document.createElement("div");
        card.innerHTML = `
          <img src="${post.imageUrl}" width="100">
          <p><strong>${post.name}</strong> - ₹${post.price}</p>
          <p>WhatsApp: <a href="https://wa.me/91${post.whatsapp}" target="_blank">${post.whatsapp}</a></p>
          <p>Status: ${post.approved ? "✅ Approved" : "❌ Pending"}</p>
          ${!post.approved ? `<button onclick="approve('${key}')">✔ Approve</button>` : ""}
        `;
        postList.appendChild(card);
      });
    });
  }

  function approve(postId) {
    db.ref("posts/" + postId + "/approved").set(true, loadPosts);
  }
</script>

</body>
</html>
