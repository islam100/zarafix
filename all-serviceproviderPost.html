<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Provider - Zara Fix</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body { font-family: 'Arial', sans-serif; }
.card {
  perspective: 1000px;
}
.form-card {
  background: linear-gradient(135deg, #ff9a9e, #fad0c4, #a18cd1, #fbc2eb);
  padding: 20px;
  border-radius: 20px;
  box-shadow: 0 15px 25px rgba(0,0,0,0.3);
  transition: transform 0.5s;
}
.form-card:hover {
  transform: rotateY(10deg) scale(1.05);
}
input, textarea, select {
  padding: 10px;
  border-radius: 10px;
  border: none;
  margin-bottom: 12px;
  width: 100%;
  box-shadow: 0 5px 15px rgba(0,0,0,0.1);
  transition: 0.3s;
}
input:focus, textarea:focus, select:focus {
  outline: none;
  transform: scale(1.02);
}
button {
  background: linear-gradient(45deg, #6a11cb, #2575fc);
  color: white;
  padding: 12px;
  border: none;
  border-radius: 15px;
  width: 100%;
  font-size: 16px;
  cursor: pointer;
  box-shadow: 0 5px 20px rgba(0,0,0,0.3);
  transition: 0.3s;
}
button:hover { transform: scale(1.1); }
button:disabled { background: gray; cursor: not-allowed; }
</style>
</head>
<body class="bg-gradient-to-r from-pink-200 via-purple-200 to-blue-200 min-h-screen flex items-center justify-center">

<div class="w-full max-w-md card">
  <h1 class="text-3xl font-bold text-center mb-6 text-white drop-shadow-lg">Provider - Add Your Shop/Service</h1>
  <div id="providerForm" class="form-card">
    <select id="serviceCategory">
      <option value="">Select Service Category</option>
      <option value="Plumbing">Plumbing</option>
      <option value="Electrician">Electrician</option>
      <option value="Home Cleaning">Home Cleaning</option>
      <option value="Grocery Delivery">Grocery Delivery</option>
      <option value="Salon">Salon</option>
      <option value="Courier">Courier</option>
      <option value="Painting">Painting</option>
      <option value="Appliance Repair">Appliance Repair</option>
      <option value="Education/Tuition">Education/Tuition</option>
      <option value="Other">Other</option>
    </select>
    <input type="text" id="shopName" placeholder="Shop Name">
    <input type="text" id="ownerName" placeholder="Owner Name">
    <textarea id="shopAddress" placeholder="Shop Address"></textarea>
    <input type="text" id="whatsappNo" placeholder="WhatsApp Number">
    <input type="file" id="shopImage">
    <button id="submitBtn" onclick="addShop()">Submit Shop</button>
  </div>
  <div id="statusMessage" class="text-center mt-4 text-xl font-semibold hidden text-white drop-shadow-lg"></div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyD7ZqL-PVuFdd8rMVIyW7CgHQjPRGHD2h8",
  authDomain: "zara-fix-2e35a.firebaseapp.com",
  projectId: "zara-fix-2e35a",
  storageBucket: "zara-fix-2e35a.appspot.com",
  messagingSenderId: "636550144008",
  appId: "1:636550144008:web:a849496ad1d1557d7ab1bd"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();

const imgbbAPIKey = "4dc5e5cb7654ffc308d5ca45452b014b";

async function login() {
  const email = prompt("Email:");
  const pass = prompt("Password:");
  await auth.signInWithEmailAndPassword(email, pass).catch(e => alert(e.message));
}

auth.onAuthStateChanged(async user => {
  if(!user) { login(); return; }

  const query = await db.collection("posts").where("posterEmail", "==", user.email).get();
  if(!query.empty){
    const doc = query.docs[0];
    const post = doc.data();
    const now = new Date();
    const form = document.getElementById("providerForm");
    const msg = document.getElementById("statusMessage");
    if(post.status=="approved" && post.expiryDate.toDate() > now){
      form.style.display="none";
      msg.innerText = `You are active! Shop will expire on ${post.expiryDate.toDate().toDateString()}`;
      msg.classList.remove("hidden");
    } else if(post.status=="approved" && post.expiryDate.toDate() <= now){
      form.style.display="none";
      msg.innerText = "You are inactive. Please contact admin to recharge!";
      msg.classList.remove("hidden");
    } else if(post.status=="pending"){
      form.style.display="none";
      msg.innerText = "Your shop/service is pending admin approval.";
      msg.classList.remove("hidden");
    }
  }
});

async function uploadImage(file){
  const formData = new FormData();
  formData.append("image", file);
  const res = await fetch(`https://api.imgbb.com/1/upload?key=${imgbbAPIKey}`,{
    method:"POST",
    body: formData
  });
  const data = await res.json();
  return data.data.url;
}

async function addShop(){
  const btn = document.getElementById("submitBtn");
  btn.disabled = true;

  const serviceCategory = document.getElementById("serviceCategory").value;
  const shopName = document.getElementById("shopName").value;
  const ownerName = document.getElementById("ownerName").value;
  const shopAddress = document.getElementById("shopAddress").value;
  const whatsappNo = document.getElementById("whatsappNo").value;
  const shopImage = document.getElementById("shopImage").files[0];

  if(!serviceCategory || !shopName || !ownerName || !shopAddress || !whatsappNo || !shopImage){
    alert("Please fill all fields!");
    btn.disabled = false;
    return;
  }

  const imageUrl = await uploadImage(shopImage);
  const now = new Date();
  const expiry = new Date(now.getTime() + 30*24*60*60*1000);

  await db.collection("posts").add({
    serviceCategory,
    shopName,
    ownerName,
    shopAddress,
    whatsappNo,
    posterEmail: auth.currentUser.email,
    imageUrl,
    status: "pending",
    createdAt: firebase.firestore.Timestamp.fromDate(now),
    expiryDate: firebase.firestore.Timestamp.fromDate(expiry)
  });

  document.getElementById("providerForm").style.display="none";
  const msg = document.getElementById("statusMessage");
  msg.innerText = "Your shop/service is submitted! Waiting for admin approval.";
  msg.classList.remove("hidden");
}
</script>
</body>
</html>
