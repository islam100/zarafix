<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ZaraFix - Request a Service</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <style>
    body { font-family: sans-serif; background: #f5f7fa; padding: 20px; }
    form, #dashboard { background: #fff; padding: 20px; border-radius: 10px; max-width: 700px; margin: auto; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    label, select, input, textarea { display: block; width: 100%; padding: 12px; margin: 10px 0; font-size: 16px; }
    button { width: 100%; padding: 14px; font-size: 16px; color: white; background: linear-gradient(to bottom, #4CAF50, #388E3C); border: none; border-radius: 10px; box-shadow: 0 6px #2E7D32; cursor: pointer; transition: all 0.2s; margin-top: 10px; }
    button:active { transform: translateY(3px); box-shadow: 0 3px #2E7D32; }
    #statusOutput { background: #e8f5e9; padding: 15px; border-radius: 6px; display: none; }
  </style>
</head>
<body>

<form id="serviceRequestForm">
  <h2>ZaraFix - Request a Service</h2>

  <label>Full Name</label>
  <input id="name" required>

  <label>Address</label>
  <input id="address" required>

  <label>WhatsApp Number</label>
  <input id="phone" required>

  <label>Category</label>
  <select id="category" required>
    <option value="">-- Select Category --</option>
    <option value="home">Home Services</option>
    <option value="appliance">Appliance Repair</option>
    <option value="cleaning">Cleaning Services</option>
    <option value="auto">Auto Services</option>
    <option value="personal">Personal Services</option>
    <option value="relocation">Relocation & Logistics</option>
    <option value="digital">Digital & Networking</option>
    <option value="commercial">Commercial Services</option>
    <option value="professional">Professional Services</option>
  </select>

  <label>Service</label>
  <select id="subcategory" required>
    <option value="">-- Select Service --</option>
  </select>

  <label>Description</label>
  <textarea id="description" rows="4" required></textarea>

  <button type="submit">Submit Request</button>
</form>

<div style="text-align:center;">
  <button id="viewStatusBtn">üìã View My Request Status</button>
</div>

<div id="dashboard" style="display:none;">
  <h2>Your Request Status</h2>
  <div id="statusOutput">Loading...</div>
</div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCH17_8W_UPmPt4KqpCaV7BpN6KsA4a67E",
    authDomain: "zara-fix.firebaseapp.com",
    databaseURL: "https://zara-fix-default-rtdb.firebaseio.com",
    projectId: "zara-fix",
    storageBucket: "zara-fix.appspot.com",
    messagingSenderId: "476473209200",
    appId: "1:476473209200:web:9f6efe6c32fd4248949fb5"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const subcategories = {
    home: ["Electrician", "Plumber", "Carpenter", "Painter", "Interior Designer", "Pest Control"],
    appliance: ["Fridge Repair", "Washing Machine Repair", "AC Repair", "TV Repair", "Microwave Repair"],
    cleaning: ["House Cleaning", "Kitchen Cleaning", "Bathroom Cleaning", "Sofa Cleaning", "Mattress Cleaning"],
    auto: ["Car Repair", "Car Wash", "Bike Repair", "Battery Replacement", "Roadside Assistance"],
    personal: ["Babysitter", "Cook at Home", "Driver on Demand", "Makeup Artist", "Security Guard"],
    relocation: ["Packers and Movers", "Home Shifting", "Vehicle Shifting"],
    digital: ["CCTV Installation", "Wi-Fi Setup", "Printer Setup"],
    commercial: ["Office Cleaning", "Factory Electrician", "Shop Branding"],
    professional: ["Doctor", "Advocate", "Chartered Accountant", "Architect", "Consultant"]
  };

  const catSelect = document.getElementById('category');
  const subcatSelect = document.getElementById('subcategory');

  catSelect.onchange = () => {
    const selectedCat = catSelect.value;
    subcatSelect.innerHTML = '<option value="">-- Select Service --</option>';
    if (subcategories[selectedCat]) {
      subcategories[selectedCat].forEach(sub => {
        const opt = document.createElement('option');
        opt.value = sub;
        opt.textContent = sub;
        subcatSelect.appendChild(opt);
      });
    }
  };

  let lastRequestId = null;
  document.getElementById('serviceRequestForm').onsubmit = function(e) {
    e.preventDefault();
    const requestData = {
      name: name.value,
      address: address.value,
      phone: phone.value,
      category: category.value,
      subcategory: subcategory.value,
      description: description.value,
      assignedTo: null,
      timestamp: new Date().toISOString()
    };

    db.ref('serviceRequests').push(requestData).then(ref => {
      lastRequestId = ref.key;
      alert("‚úÖ Request submitted successfully!");
      this.reset();
    }).catch(err => {
      alert("‚ùå Error: " + err.message);
    });
  };

  document.getElementById('viewStatusBtn').onclick = () => {
    if (!lastRequestId) {
      alert("‚ùó Submit your request first.");
      return;
    }

    const out = document.getElementById('statusOutput');
    document.getElementById('dashboard').style.display = 'block';
    out.textContent = "Checking..."; out.style.display = "block";

    db.ref('serviceRequests/' + lastRequestId).once('value').then(snap => {
      const data = snap.val();
      if (data.assignedTo) {
        db.ref('serviceProviders/' + data.assignedTo).once('value').then(provSnap => {
          const p = provSnap.val();
          out.innerHTML = `
            ‚úÖ Assigned to: <b>${p.name}</b><br>
            üè™ ${p.shopName}<br>
            üìç ${p.address}<br>
            üì± <a href="https://wa.me/${p.whatsapp}" target="_blank">Contact on WhatsApp</a>
          `;
        });
      } else {
        out.textContent = "‚ùå No one has accepted your request yet.";
      }
    });
  };
</script>
</body>
</html>
