<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Zara Real Estate</title>
<style>
:root {
  --bg:#f0f2f5;
  --card:#fff;
  --brand:#2563eb;
  --muted:#6b7280;
}
body { margin:0; font-family:Arial,sans-serif; background:var(--bg);}
header { display:flex; justify-content:space-between; align-items:center; padding:10px 20px; background:#fff; box-shadow:0 2px 5px rgba(0,0,0,0.1);}
header h1 { font-size:24px; font-weight:bold; color:var(--brand); text-shadow:1px 1px 2px #aaa;}
button { padding:8px 12px; border:none; cursor:pointer; border-radius:6px; box-shadow:2px 2px 5px rgba(0,0,0,0.2);}
button.3d { background:var(--brand); color:#fff; transform: translateY(0); transition: transform 0.1s; }
button.3d:active { transform: translateY(3px); box-shadow:none; }
.cards-container { display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:15px; padding:15px;}
.card { background:var(--card); padding:15px; border-radius:10px; box-shadow:0 3px 6px rgba(0,0,0,0.1); position:relative; cursor:pointer; transition:0.2s;}
.card.blink { animation:blink 1s infinite;}
@keyframes blink { 0%,100%{border:2px solid red;} 50%{border:2px solid yellow;} }
.card img { width:100%; height:180px; object-fit:cover; border-radius:8px;}
.modal { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); display:flex; justify-content:center; align-items:center; display:none; z-index:1000;}
.modal-content { background:#fff; padding:15px; border-radius:10px; max-width:90%; max-height:90%; overflow:auto; position:relative;}
.modal-content img { width:100%; margin-bottom:10px;}
.close-modal { position:absolute; top:10px; right:10px; font-size:20px; cursor:pointer;}
.pagination { text-align:center; margin:10px;}
.whatsapp-btn { background:#25D366; color:#fff; padding:5px 8px; border-radius:5px; text-decoration:none; font-weight:bold; display:inline-block; margin-top:5px; box-shadow:2px 2px 4px rgba(0,0,0,0.2);}
.admin-panel { display:flex; justify-content:center; gap:10px; margin-top:5px;}
.admin-panel button { background:red; color:#fff;}
</style>
</head>
<body>

<header>
  <h1>Zara Real Estate</h1>
  <div id="auth-buttons">
    <button id="loginBtn" class="3d">Login</button>
    <button id="logoutBtn" class="3d" style="display:none;">Logout</button>
  </div>
</header>

<div class="cards-container" id="cardsContainer"></div>
<div class="pagination" id="pagination"></div>

<div class="modal" id="modal">
  <div class="modal-content" id="modalContent">
    <span class="close-modal" id="closeModal">&times;</span>
  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyDTj2n1yhr1sFmuyBZ-jUwOmx1YqAN5QjA",
  authDomain: "property-20d6d.firebaseapp.com",
  databaseURL: "https://property-20d6d-default-rtdb.firebaseio.com",
  projectId: "property-20d6d",
  storageBucket: "property-20d6d.appspot.com",
  messagingSenderId: "916859697394",
  appId: "1:916859697394:web:2a8f9ad2d62f8306dcb86b"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

let currentUser = null;
let isAdmin = false;
const cardsPerPage = 10;
let currentPage = 1;
let postsData = [];

const loginBtn = document.getElementById("loginBtn");
const logoutBtn = document.getElementById("logoutBtn");

loginBtn.onclick = () => {
  const provider = new firebase.auth.GoogleAuthProvider();
  auth.signInWithPopup(provider);
};
logoutBtn.onclick = () => auth.signOut();

auth.onAuthStateChanged(user => {
  currentUser = user;
  if(user){
    loginBtn.style.display="none";
    logoutBtn.style.display="inline-block";
    isAdmin = user.email === "admin@example.com"; // change admin email
    fetchPosts();
  } else {
    loginBtn.style.display="inline-block";
    logoutBtn.style.display="none";
    document.getElementById("cardsContainer").innerHTML="";
    document.getElementById("pagination").innerHTML="";
  }
});

function fetchPosts(){
  db.ref("posts").once("value", snap=>{
    postsData = [];
    snap.forEach(child=>{
      const post = child.val();
      post.id = child.key;
      postsData.push(post);
    });
    displayPosts();
  });
}

function displayPosts(){
  const container = document.getElementById("cardsContainer");
  container.innerHTML="";
  const start = (currentPage-1)*cardsPerPage;
  const end = start + cardsPerPage;
  postsData.slice(start,end).forEach(post=>{
    const card = document.createElement("div");
    card.className="card";
    if(!post.approved) card.classList.add("blink");

    card.innerHTML=`
      <h3>${post.title}</h3>
      <p>${post.description}</p>
      <img src="${post.images[0]}" />
      <div><a href="https://wa.me/${post.whatsapp}" target="_blank" class="whatsapp-btn">WhatsApp</a></div>
      ${isAdmin?`<div class="admin-panel">
        <button class="3d" onclick="approvePost('${post.id}')">Approve</button>
        <button class="3d" onclick="rejectPost('${post.id}')">Reject</button>
      </div>`: (currentUser && post.poster===currentUser.uid? `<button class="3d" onclick="deletePost('${post.id}')">Delete</button>`:"")}
    `;
    card.onclick = e=>{
      if(e.target.tagName!=="BUTTON" && e.target.tagName!=="A"){
        openModal(post);
      }
    }
    container.appendChild(card);
  });
  setupPagination();
}

function setupPagination(){
  const totalPages = Math.ceil(postsData.length/cardsPerPage);
  const pag = document.getElementById("pagination");
  pag.innerHTML="";
  if(currentPage>1){
    const prev = document.createElement("button");
    prev.innerText="Prev";
    prev.onclick=()=>{currentPage--; displayPosts();}
    pag.appendChild(prev);
  }
  if(currentPage<totalPages){
    const next = document.createElement("button");
    next.innerText="Next";
    next.onclick=()=>{currentPage++; displayPosts();}
    pag.appendChild(next);
  }
}

function approvePost(id){
  db.ref("posts/"+id).update({approved:true}).then(fetchPosts);
}
function rejectPost(id){
  db.ref("posts/"+id).update({approved:false}).then(fetchPosts);
}
function deletePost(id){
  if(confirm("Are you sure to delete?")){
    db.ref("posts/"+id).remove().then(fetchPosts);
  }
}

const modal = document.getElementById("modal");
const modalContent = document.getElementById("modalContent");
const closeModal = document.getElementById("closeModal");
closeModal.onclick = ()=>{modal.style.display="none";}
function openModal(post){
  modalContent.innerHTML=`<span class="close-modal" id="closeModal">&times;</span>
    <h3>${post.title}</h3>
    <p>${post.description}</p>
    ${post.images.map(img=>`<img src="${img}">`).join("")}
  `;
  modal.style.display="flex";
  document.getElementById("closeModal").onclick = ()=>{modal.style.display="none";}
}
</script>
</body>
</html>
