<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ZaraFix Real Estate</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f0f2f5; margin: 0; padding: 0; }
    header { background: #333; color: white; padding: 10px; display: flex; justify-content: space-between; align-items: center; }
    header h1 { margin: 0; }
    button { padding: 10px 20px; margin: 5px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
    #loginBtn { background: #4CAF50; color: white; }
    #logoutBtn { background: #f44336; color: white; display: none; }
    #adminBtn { background: #ff9800; color: white; display: none; }
    #formSection, #listSection { padding: 20px; }
    .card { background: white; padding: 15px; margin: 10px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
    label { display: block; margin-top: 10px; }
    input, select, textarea { width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 5px; }
    #submitBtn { background: #2196F3; color: white; }
    #loading { display: none; color: blue; margin-top: 10px; }
  </style>
</head>
<body>

<header>
  <h1>ZaraFix Real Estate</h1>
  <div>
    <button id="loginBtn">Login with Google</button>
    <button id="logoutBtn">Logout</button>
    <button id="adminBtn">Admin</button>
  </div>
</header>

<section id="formSection" style="display:none;">
  <h2>Post a Property</h2>
  <form id="propertyForm">
    <label>Title</label>
    <input type="text" id="title" required>
    
    <label>Description</label>
    <textarea id="description" required></textarea>
    
    <label>Category</label>
    <select id="category" required>
      <option value="">Select Category</option>
      <option value="Sell">Sell</option>
      <option value="Rent">Rent</option>
    </select>
    
    <label>Price (₹)</label>
    <input type="number" id="price" required>
    
    <button type="submit" id="submitBtn">Submit</button>
    <p id="loading">⏳ Posting... Please wait</p>
  </form>
</section>

<section id="listSection">
  <h2>Available Listings</h2>
  <div id="listings"></div>
</section>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
  import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
  import { getDatabase, ref, push, onValue, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

  // ✅ Firebase config (replace with yours)
  const firebaseConfig = {
    apiKey: "AIzaSyDTj2n1yhr1sFmuyBZ-jUwOmx1YqAN5QjA",
    authDomain: "property-20d6d.firebaseapp.com",
    databaseURL: "https://property-20d6d-default-rtdb.firebaseio.com",
    projectId: "property-20d6d",
    storageBucket: "property-20d6d.appspot.com",
    messagingSenderId: "123456789",
    appId: "1:123456789:web:abcd1234"
  };

  // ✅ Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const provider = new GoogleAuthProvider();
  const db = getDatabase(app);

  const loginBtn = document.getElementById("loginBtn");
  const logoutBtn = document.getElementById("logoutBtn");
  const adminBtn = document.getElementById("adminBtn");
  const formSection = document.getElementById("formSection");
  const propertyForm = document.getElementById("propertyForm");
  const listingsDiv = document.getElementById("listings");
  const loading = document.getElementById("loading");

  // ✅ Admin email (change as needed)
  const adminEmail = "admin@gmail.com";

  // Login
  loginBtn.onclick = () => {
    signInWithPopup(auth, provider);
  };

  // Logout
  logoutBtn.onclick = () => {
    signOut(auth);
  };

  // Auth state check
  onAuthStateChanged(auth, (user) => {
    if (user) {
      loginBtn.style.display = "none";
      logoutBtn.style.display = "inline-block";
      formSection.style.display = "block";

      // ✅ Show admin button if email matches
      if (user.email === adminEmail) {
        adminBtn.style.display = "inline-block";
      }
    } else {
      loginBtn.style.display = "inline-block";
      logoutBtn.style.display = "none";
      formSection.style.display = "none";
      adminBtn.style.display = "none";
    }
  });

  // Submit property
  propertyForm.onsubmit = async (e) => {
    e.preventDefault();
    loading.style.display = "block";

    const user = auth.currentUser;
    if (!user) {
      alert("Please login first.");
      loading.style.display = "none";
      return;
    }

    const postData = {
      title: document.getElementById("title").value,
      description: document.getElementById("description").value,
      category: document.getElementById("category").value,
      price: document.getElementById("price").value,
      user: user.email,
      timestamp: serverTimestamp()
    };

    await push(ref(db, "listings"), postData);

    propertyForm.reset();
    loading.style.display = "none";
    alert("✅ Property posted successfully!");
  };

  // Show listings to everyone (no login required)
  const listingsRef = ref(db, "listings");
  onValue(listingsRef, (snapshot) => {
    listingsDiv.innerHTML = "";
    snapshot.forEach((child) => {
      const data = child.val();
      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <h3>${data.title}</h3>
        <p>${data.description}</p>
        <p><b>Category:</b> ${data.category}</p>
        <p><b>Price:</b> ₹${data.price}</p>
        <p><small>Posted by: ${data.user}</small></p>
      `;
      listingsDiv.appendChild(card);
    });
  });

</script>

</body>
</html>
