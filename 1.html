<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Zara Fix - Property Sale/Rent</title>
<style>
  body, html {
    margin: 0; padding: 0; height: 100%;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(to bottom, #87ceeb 0%, #e0f7ff 80%);
    overflow-x: hidden;
    position: relative;
  }
  body::before {
    content: "";
    position: fixed;
    inset: 0;
    background: url('https://i.ibb.co/2sWjDvk/clouds.png') repeat-x;
    opacity: 0.3;
    animation: moveClouds 60s linear infinite;
    z-index: 0;
  }
  @keyframes moveClouds {0%{background-position-x:0}100%{background-position-x:10000px}}

  .container { position: relative; z-index: 10; min-height: 100vh; padding: 20px 15px 90px; box-sizing: border-box; text-align: center; }

  .logo {
    font-size: 3.5rem; font-weight: 900; color: #ff3c00;
    text-shadow: 2px 2px 0 #ffea00, 4px 4px 0 #00f7ff, 6px 6px 8px rgba(0,0,0,0.35);
    user-select: none; margin-bottom: 25px;
  }

  #googleLoginBtn {
    position: fixed; top: 15px; right: 15px;
    background: #4285F4; color: #fff; font-weight: 700;
    padding: 8px 14px; font-size: 13px; border-radius: 10px;
    box-shadow: 0 3px 8px rgba(0,0,0,0.25); cursor: pointer; user-select: none;
    transition: transform .15s ease; z-index: 20; border: none; outline: none;
  }
  #googleLoginBtn:hover { transform: scale(1.1); }

  .button-grid { display: flex; flex-direction: column; gap: 12px; max-width: 520px; margin: 0 auto 35px; }
  .line { display: flex; justify-content: center; gap: 12px; flex-wrap: wrap; }

  .btn-3d {
    padding: 12px 20px; font-size: 14px; font-weight: 700; border-radius: 14px; border: none; color: #fff; cursor: pointer;
    box-shadow: 0 5px 0 #444, 0 9px 15px rgba(0,0,0,0.25);
    transition: transform .15s ease; min-width: 140px; text-align: center; user-select: none;
  }
  .btn-3d:hover:not(:disabled){ transform: translateY(3px); box-shadow: 0 2px 0 #444, 0 5px 8px rgba(0,0,0,0.15); }
  .btn-3d:disabled { opacity: .5; cursor: not-allowed; box-shadow:none; transform:none!important; }

  .green { background: linear-gradient(to right, #4caf50, #2e7d32); }
  .blue { background: linear-gradient(to right, #2196f3, #0d47a1); }
  .red { background: linear-gradient(to right, #f44336, #b71c1c); }
  .purple { background: linear-gradient(to right, #9c27b0, #6a1b9a); }
  .orange { background: linear-gradient(to right, #ff9800, #e65100); }
  .teal { background: linear-gradient(to right, #009688, #004d40); }

  /* Property Card */
  #propertyCard {
    max-width: 380px; margin: 0 auto 22px; background: #fff; padding: 16px 16px 20px;
    border-radius: 18px; box-shadow: 0 10px 20px rgba(0,0,0,0.3); text-align: left; font-size: 16px;
  }
  #propertyImage {
    width: 100%; height: 220px; object-fit: cover; border-radius: 12px; margin-bottom: 12px; background: #f3f4f6;
  }
  .field { margin: 6px 0; }
  .muted { color: #6b7280; font-size: 13px; }

  /* Add Property Form */
  #addFormWrap {
    max-width: 520px; margin: 10px auto 40px; background: #ffffffd9; backdrop-filter: blur(2px);
    border-radius: 18px; padding: 18px; box-shadow: 0 10px 20px rgba(0,0,0,0.2); display: none; text-align: left;
  }
  .row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
  .row-1 { display: grid; grid-template-columns: 1fr; gap: 10px; }
  label { font-size: 12px; color: #374151; margin-bottom: 4px; display: block; }
  input, select, textarea {
    width: 100%; padding: 10px 12px; border: 1px solid #e5e7eb; border-radius: 12px; font-size: 14px; box-sizing: border-box;
    outline: none;
  }
  textarea { min-height: 70px; resize: vertical; }

  .scrolling-text {
    position: fixed; bottom: 15px; width: 100%; background: rgba(255 255 255 / 0.85); color: #222;
    font-weight: 700; padding: 8px 0; box-shadow: 0 0 12px rgba(0,0,0,0.1); user-select: none; z-index: 15; overflow: hidden; white-space: nowrap;
  }
  .scrolling-text span { display: inline-block; padding-left: 100%; animation: scroll-left 18s linear infinite; }
  @keyframes scroll-left { 0%{ transform: translateX(0)} 100%{ transform: translateX(-100%)} }

  @media (max-width: 560px){
    .btn-3d{ min-width: 110px; font-size: 13px; padding: 10px 16px; }
    #propertyCard{ max-width: 92%; font-size: 14px; }
    #propertyImage{ height: 180px; }
    .row{ grid-template-columns: 1fr; }
  }
</style>
</head>
<body>
<div class="container">

  <div class="logo" aria-label="Zara Fix Logo">Zara Fix</div>

  <button id="googleLoginBtn">Google Login</button>

  <div class="button-grid">
    <div class="line">
      <button class="btn-3d green" id="btnAddToggle">Add Property</button>
      <button class="btn-3d blue" id="btnBrowse">Browse (All)</button>
    </div>
    <div class="line">
      <button class="btn-3d purple" id="btnOnlySale">Only Sale</button>
      <button class="btn-3d orange" id="btnOnlyRent">Only Rent</button>
    </div>
    <div class="line">
      <button class="btn-3d teal" id="btnMyListings">My Listings</button>
      <button class="btn-3d red" id="btnClearFilter">Clear Filter</button>
    </div>
  </div>

  <!-- Property slider card -->
  <div id="propertyCard"><p class="muted">Please login to view properties.</p></div>

  <!-- Add Property Form -->
  <div id="addFormWrap">
    <h3 style="margin:0 0 10px">Add Property</h3>
    <div class="row">
      <div>
        <label>Type</label>
        <select id="pType">
          <option value="Sale">Sale</option>
          <option value="Rent">Rent</option>
        </select>
      </div>
      <div>
        <label>Category</label>
        <select id="pCategory">
          <option>Flat</option>
          <option>Plot</option>
          <option>Shop</option>
          <option>House</option>
          <option>Office</option>
        </select>
      </div>
    </div>

    <div class="row">
      <div>
        <label>Title</label>
        <input id="pTitle" placeholder="2BHK Near Station" />
      </div>
      <div>
        <label>Location</label>
        <input id="pLocation" placeholder="Nalasopara (E)" />
      </div>
    </div>

    <div class="row">
      <div>
        <label>Price (₹)</label>
        <input id="pPrice" type="number" min="1" placeholder="2500000" />
      </div>
      <div>
        <label>Owner Name</label>
        <input id="pOwner" placeholder="Rahul Sharma" />
      </div>
    </div>

    <div class="row">
      <div>
        <label>Contact (WhatsApp/Mobile)</label>
        <input id="pContact" placeholder="9876543210" />
      </div>
      <div>
        <label>Image</label>
        <input id="pImage" type="file" accept="image/*" />
      </div>
    </div>

    <div class="row-1">
      <div>
        <label>Description</label>
        <textarea id="pDesc" placeholder="Close to market, 24x7 water, well-ventilated..."></textarea>
      </div>
    </div>

    <div class="row" style="margin-top:10px">
      <button class="btn-3d green" id="btnSubmitProperty" type="button">Save Property</button>
      <button class="btn-3d red" id="btnCancelForm" type="button">Cancel</button>
    </div>

    <p id="formMsg" class="muted" style="margin-top:10px"></p>
  </div>

</div>

<!-- Scrolling text -->
<div class="scrolling-text" aria-live="polite">
  <span>Welcome to Zara Fix • Property Sale/Rent • Login to add & browse listings • New features coming soon •</span>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

<script>
  // --- CONFIGS YOU PROVIDED ---
  const firebaseConfig = {
    apiKey: "AIzaSyDTj2n1yhr1sFmuyBZ-jUwOmx1YqAN5QjA",
    authDomain: "property-20d6d.firebaseapp.com",
    databaseURL: "https://property-20d6d-default-rtdb.firebaseio.com",
    projectId: "property-20d6d",
    storageBucket: "property-20d6d.appspot.com",
    messagingSenderId: "916859697394",
    appId: "1:916859697394:web:2a8f9ad2d62f8306dcb86b"
  };
  const IMGBB_API_KEY = "cad1f0dbfbd25346460789376cc2d7d5"; // ImgBB API Key

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const auth = firebase.auth();

  // UI elements
  const loginBtn = document.getElementById('googleLoginBtn');
  const addFormWrap = document.getElementById('addFormWrap');
  const propertyCard = document.getElementById('propertyCard');
  const formMsg = document.getElementById('formMsg');

  const btnAddToggle   = document.getElementById('btnAddToggle');
  const btnBrowse      = document.getElementById('btnBrowse');
  const btnOnlySale    = document.getElementById('btnOnlySale');
  const btnOnlyRent    = document.getElementById('btnOnlyRent');
  const btnMyListings  = document.getElementById('btnMyListings');
  const btnClearFilter = document.getElementById('btnClearFilter');
  const allMainButtons = document.querySelectorAll('.btn-3d');

  // Form fields
  const pType = document.getElementById('pType');
  const pCategory = document.getElementById('pCategory');
  const pTitle = document.getElementById('pTitle');
  const pLocation = document.getElementById('pLocation');
  const pPrice = document.getElementById('pPrice');
  const pOwner = document.getElementById('pOwner');
  const pContact = document.getElementById('pContact');
  const pImage = document.getElementById('pImage');
  const pDesc = document.getElementById('pDesc');
  const btnSubmitProperty = document.getElementById('btnSubmitProperty');
  const btnCancelForm = document.getElementById('btnCancelForm');

  // State
  let ALL_PROPERTIES = [];
  let FILTERED = [];
  let current = 0;
  let sliderTimer = null;
  let currentFilter = { mode: "ALL", uid: null }; // ALL | SALE | RENT | MINE

  // Helpers
  function setButtonsEnabled(enabled){
    allMainButtons.forEach(btn=>{
      if (btn.id === 'btnClearFilter') return; // clear filter can stay enabled visually but follow enabled state
      btn.disabled = !enabled;
      btn.style.opacity = enabled ? '1' : '0.5';
      btn.style.cursor = enabled ? 'pointer' : 'not-allowed';
    });
    // Add form toggle specifically
    document.getElementById('btnAddToggle').disabled = !enabled;
  }

  function showCard(p){
    if(!p){
      propertyCard.innerHTML = '<p class="muted">No properties found for this filter.</p>';
      return;
    }
    propertyCard.innerHTML = `
      <img id="propertyImage" src="${p.imageUrl || ''}" alt="Property Image" onerror="this.src='https://i.ibb.co/2W3W56j/placeholder-image.png'"/>
      <div class="field"><b>${p.type}</b> • ${p.category || ''}</div>
      <div class="field"><b>Title:</b> ${p.title || 'N/A'}</div>
      <div class="field"><b>Location:</b> ${p.location || 'N/A'}</div>
      <div class="field"><b>Price:</b> ₹${p.price || 'N/A'}</div>
      <div class="field"><b>Owner:</b> ${p.owner || 'N/A'}</div>
      <div class="field"><b>Contact:</b> <a href="https://wa.me/${(p.contact||'').replace(/[^0-9]/g,'')}" target="_blank">${p.contact||'N/A'}</a></div>
      <div class="field"><b>Description:</b> <span class="muted">${p.description || ''}</span></div>
      <div class="field muted">Posted by: ${p.posterName || 'User'} • ${new Date(p.createdAt||Date.now()).toLocaleString()}</div>
    `;
  }

  function startSlider(){
    clearInterval(sliderTimer);
    if (!FILTERED.length){
      showCard(null);
      return;
    }
    current = 0;
    showCard(FILTERED[current]);
    sliderTimer = setInterval(()=>{
      current = (current + 1) % FILTERED.length;
      showCard(FILTERED[current]);
    }, 4000);
  }

  function applyFilter(){
    const u = auth.currentUser;
    if(currentFilter.mode === "SALE") FILTERED = ALL_PROPERTIES.filter(p=>p.type==="Sale");
    else if(currentFilter.mode === "RENT") FILTERED = ALL_PROPERTIES.filter(p=>p.type==="Rent");
    else if(currentFilter.mode === "MINE" && u) FILTERED = ALL_PROPERTIES.filter(p=>p.uid === u.uid);
    else FILTERED = [...ALL_PROPERTIES];
    startSlider();
  }

  function loadPropertiesOnce(){
    ALL_PROPERTIES = [];
    db.ref("properties").once("value").then(snap=>{
      snap.forEach(child=>{
        const val = child.val() || {};
        val._key = child.key;
        ALL_PROPERTIES.push(val);
      });
      applyFilter();
    }).catch(err=>{
      propertyCard.innerHTML = '<p class="muted">Failed to load properties: '+err.message+'</p>';
    });
  }

  // ImgBB Upload
  function fileToBase64(file){
    return new Promise((resolve,reject)=>{
      const reader = new FileReader();
      reader.onload = ()=> {
        const res = reader.result.split(',')[1] || '';
        resolve(res);
      };
      reader.onerror = reject;
      reader.readAsDataURL(file);
    });
  }

  async function uploadToImgBB(file){
    const base64 = await fileToBase64(file);
    const form = new FormData();
    form.append('image', base64);
    const resp = await fetch('https://api.imgbb.com/1/upload?key='+IMGBB_API_KEY, { method:'POST', body: form });
    if(!resp.ok) throw new Error('ImgBB upload failed');
    const data = await resp.json();
    if(!data || !data.success) throw new Error('ImgBB returned error');
    return data.data.url;
  }

  // Add Property
  async function saveProperty(){
    formMsg.textContent = '';
    const user = auth.currentUser;
    if(!user){ alert('Please login first.'); return; }

    const type = pType.value.trim();
    const category = pCategory.value.trim();
    const title = pTitle.value.trim();
    const location = pLocation.value.trim();
    const price = pPrice.value.trim();
    const owner = pOwner.value.trim();
    const contact = pContact.value.trim();
    const desc = pDesc.value.trim();

    if(!type || !title || !location || !price || !owner || !contact){
      formMsg.textContent = 'Please fill all required fields.';
      return;
    }

    let imageUrl = '';
    try{
      const file = pImage.files[0];
      if(file){
        formMsg.textContent = 'Uploading image...';
        imageUrl = await uploadToImgBB(file);
      }
      formMsg.textContent = 'Saving property...';
      const payload = {
        type, category, title, location, price, owner, contact,
        description: desc, imageUrl,
        uid: user.uid, posterName: user.displayName || user.email || 'User',
        createdAt: Date.now()
      };
      const ref = db.ref('properties').push();
      await ref.set(payload);
      formMsg.textContent = 'Property saved successfully!';
      // Refresh local list
      ALL_PROPERTIES.push(payload);
      applyFilter();
      // Clear form
      pTitle.value=''; pLocation.value=''; pPrice.value=''; pOwner.value=''; pContact.value=''; pDesc.value=''; pImage.value='';
    }catch(err){
      console.error(err);
      formMsg.textContent = 'Error: ' + err.message;
    }
  }

  // Auth + UI wiring
  function toggleForm(show){
    addFormWrap.style.display = show ? 'block' : 'none';
  }

  function setLoggedInUI(){
    loginBtn.textContent = "Logout";
    setButtonsEnabled(true);
    propertyCard.innerHTML = '<p class="muted">Loading properties...</p>';
    loadPropertiesOnce();
  }

  function setLoggedOutUI(){
    loginBtn.textContent = "Google Login";
    setButtonsEnabled(false);
    toggleForm(false);
    propertyCard.innerHTML = '<p class="muted">Please login to view properties.</p>';
    clearInterval(sliderTimer);
    ALL_PROPERTIES = []; FILTERED = [];
  }

  loginBtn.addEventListener('click', ()=>{
    if(auth.currentUser){
      auth.signOut().then(()=>{ alert('Logged out successfully!'); }).catch(e=>alert('Logout failed: '+e.message));
    }else{
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider).then(res=>{
        alert("Login successful! Welcome, " + (res.user.displayName||'User'));
      }).catch(err=> alert('Login failed: ' + err.message));
    }
  });

  auth.onAuthStateChanged(u=>{
    if(u) setLoggedInUI(); else setLoggedOutUI();
  });

  // Buttons
  btnAddToggle.addEventListener('click', ()=> toggleForm(addFormWrap.style.display !== 'block'));
  btnBrowse.addEventListener('click', ()=> { currentFilter.mode = "ALL"; applyFilter(); });
  btnOnlySale.addEventListener('click', ()=> { currentFilter.mode = "SALE"; applyFilter(); });
  btnOnlyRent.addEventListener('click', ()=> { currentFilter.mode = "RENT"; applyFilter(); });
  btnMyListings.addEventListener('click', ()=> { currentFilter.mode = "MINE"; applyFilter(); });
  btnClearFilter.addEventListener('click', ()=> { currentFilter.mode = "ALL"; applyFilter(); });

  btnSubmitProperty.addEventListener('click', saveProperty);
  btnCancelForm.addEventListener('click', ()=> toggleForm(false));

  // Initially disable all main buttons until login
  setButtonsEnabled(false);
</script>
</body>
</html>
