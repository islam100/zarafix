<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Real Estate Listings</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    .card { border: 1px solid #ddd; padding: 15px; margin: 10px; border-radius: 10px; }
    .blink { width: 15px; height: 15px; background: yellow; border-radius: 50%; animation: blink 1s infinite; }
    @keyframes blink { 50% { opacity: 0; } }
  </style>
</head>
<body>

  <h2>üè† Real Estate Listings</h2>
  <button id="loginBtn">Login</button>
  <button id="logoutBtn" style="display:none;">Logout</button>

  <div id="postForm" style="display:none; margin-top:20px;">
    <h3>Create New Post</h3>
    <input type="text" id="title" placeholder="Title"><br><br>
    <input type="text" id="location" placeholder="Location"><br><br>
    <input type="number" id="price" placeholder="Price"><br><br>
    <input type="text" id="whatsapp" placeholder="WhatsApp Number"><br><br>
    <textarea id="desc" placeholder="Description"></textarea><br><br>
    <input type="file" id="images" multiple accept="image/*"><br><br>
    <button onclick="addPost()">Post</button>
  </div>

  <h3>All Listings:</h3>
  <div id="listings"></div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

  <script>
    // ‚úÖ Your Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyDTj2n1yhr1sFmuyBZ-jUwOmx1YqAN5QjA",
      authDomain: "property-20d6d.firebaseapp.com",
      databaseURL: "https://property-20d6d-default-rtdb.firebaseio.com",
      projectId: "property-20d6d",
      storageBucket: "property-20d6d.appspot.com",
      messagingSenderId: "916859697394",
      appId: "1:916859697394:web:2a8f9ad2d62f8306dcb86b"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();

    // ‚úÖ ImgBB API Key
    const imgbbKey = "cad1f0dbfbd25346460789376cc2d7d5";

    // üîπ Simple Login/Logout (demo purpose)
    document.getElementById("loginBtn").onclick = () => {
      auth.signInWithEmailAndPassword("demo@test.com","123456")
      .then(()=>{ document.getElementById("postForm").style.display="block";
                  document.getElementById("loginBtn").style.display="none";
                  document.getElementById("logoutBtn").style.display="inline"; })
      .catch(()=> auth.createUserWithEmailAndPassword("demo@test.com","123456"));
    };

    document.getElementById("logoutBtn").onclick = () => {
      auth.signOut().then(()=> location.reload());
    };

    // üîπ Post add with images
    async function addPost(){
      let title=document.getElementById("title").value;
      let loc=document.getElementById("location").value;
      let price=document.getElementById("price").value;
      let desc=document.getElementById("desc").value;
      let whatsapp=document.getElementById("whatsapp").value;
      let files=document.getElementById("images").files;

      if(!title || !loc || !price){ alert("Please fill details"); return; }

      let imgUrls=[];
      for(let i=0;i<files.length && i<5;i++){
        let formData=new FormData();
        formData.append("image",files[i]);
        let res=await fetch(`https://api.imgbb.com/1/upload?key=${imgbbKey}`,{method:"POST",body:formData});
        let data=await res.json();
        imgUrls.push(data.data.url);
      }

      db.ref("posts/").push({
        title, location:loc, price, desc, whatsapp, images:imgUrls,
        approved:false, timestamp:Date.now()
      });

      alert("Post added (pending approval)");
      document.getElementById("title").value="";
      document.getElementById("desc").value="";
      document.getElementById("location").value="";
      document.getElementById("price").value="";
      document.getElementById("whatsapp").value="";
    }

    // üîπ Show posts
    db.ref("posts/").on("value",snap=>{
      let data=snap.val();
      let container=document.getElementById("listings");
      container.innerHTML="";
      for(let id in data){
        let p=data[id];
        let card=document.createElement("div");
        card.className="card";

        card.innerHTML=`
          <h4>${p.title} - ‚Çπ${p.price}</h4>
          <p>${p.location}</p>
          <p>${p.desc}</p>
          ${p.images? p.images.map(img=>`<img src="${img}" width="100">`).join(""):""}
          <br>
          <a href="https://wa.me/${p.whatsapp}" target="_blank">
            <button style="background:green;color:white;border-radius:10px;">WhatsApp</button>
          </a>
          ${!p.approved ? '<div class="blink"></div>' : ''}
        `;

        container.appendChild(card);
      }
    });
  </script>
</body>
</html>
