<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Property Listings</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />

  <style>
    :root {
      --bg:#0f172a;
      --text:#f8fafc;
      --card:#1e293b;
      --muted:#94a3b8;
    }
    [data-theme="light"] {
      --bg:#f1f5f9;
      --text:#0f172a;
      --card:#ffffff;
      --muted:#475569;
    }
    body {
      margin:0;font-family:sans-serif;
      background:var(--bg);color:var(--text);
    }
    header {
      display:flex;justify-content:space-between;align-items:center;
      padding:10px;background:var(--card);
    }
    header h2 {margin:0;font-size:18px;}
    .actions {display:flex;gap:10px;align-items:center;}
    button, select {
      padding:6px 12px;border:none;border-radius:6px;
      cursor:pointer;background:var(--muted);color:var(--text);
      transition:transform 0.2s, box-shadow 0.2s;
    }
    button:hover {transform:translateY(-2px);box-shadow:0 4px 6px rgba(0,0,0,0.2);}
    .postBtn {
      background:linear-gradient(145deg,#4ade80,#22c55e);
      color:#fff;font-weight:bold;
    }
    .grid {
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
      gap:14px;padding:14px;
    }
    .card {
      position:relative;background:var(--card);border-radius:10px;
      overflow:hidden;cursor:pointer;transition:transform 0.2s;
    }
    .card:hover{transform:translateY(-3px);}
    .card img.thumb{width:100%;height:120px;object-fit:cover;}
    .card h4{font-size:14px;margin:6px;}
    .desc{font-size:12px;margin:0 6px 6px;color:var(--muted);}
    .badge{position:absolute;top:6px;left:6px;padding:2px 6px;font-size:10px;
      border-radius:4px;background:#444;color:#fff;}
    .badge.approved{background:green;}
    .badge.pending{background:orange;}
    .badge.rejected{background:red;}

    /* modal base */
    #modal,#formModal {
      position:fixed;top:0;left:0;right:0;bottom:0;
      background:rgba(0,0,0,0.7);display:none;
      align-items:center;justify-content:center;z-index:1000;
    }
    #modal.open,#formModal.open{display:flex;}
    .box {
      background:var(--card);padding:16px;border-radius:10px;
      max-width:800px;width:100%;max-height:90vh;overflow-y:auto;
    }
    #modal h3,#formModal h3{margin-top:0;}
    .gallery img{width:100%;max-height:400px;object-fit:contain;margin-bottom:6px;}
    .whatsapp-btn {
      background:#25D366;color:#fff;padding:6px 10px;border-radius:6px;
      text-decoration:none;display:inline-block;
    }
    form label{display:block;margin:8px 0 4px;}
    form input,form textarea,form select {
      width:100%;padding:6px;border-radius:6px;border:1px solid var(--muted);
      margin-bottom:8px;background:var(--bg);color:var(--text);
    }
  </style>
</head>
<body data-theme="dark">
  <header>
    <h2>üè† Property Listings</h2>
    <div class="actions">
      <select id="priceFilter">
        <option value="default">Sort by Price</option>
        <option value="low">Low ‚Üí High</option>
        <option value="high">High ‚Üí Low</option>
      </select>
      <button id="themeToggle">üåô</button>
      <button id="postBtn" class="postBtn" style="display:none">+ Post Property</button>
      <button id="loginBtn">Login</button>
      <button id="logoutBtn" style="display:none">Logout</button>
    </div>
  </header>

  <main><div class="grid" id="cards"></div></main>

  <!-- detail modal -->
  <div id="modal"><div class="box">
    <button onclick="closeModal()">‚ùå</button>
    <h3 id="modalTitle"></h3>
    <div id="modalBody"></div>
  </div></div>

  <!-- form modal -->
  <div id="formModal"><div class="box">
    <button onclick="closeForm()">‚ùå</button>
    <h3>Post New Property</h3>
    <form id="postForm">
      <label>Price</label><input type="number" name="price" required>
      <label>BHK</label><input type="text" name="bhk" required>
      <label>Property Type</label>
      <select name="propertyType" required>
        <option>Flat</option><option>House</option><option>Plot</option>
      </select>
      <label>Address</label><textarea name="address" required></textarea>
      <label>Description</label><textarea name="description"></textarea>
      <label>Phone</label><input type="text" name="posterPhone" required>
      <label>Images (max 5)</label><input type="file" id="images" multiple accept="image/*">
      <button type="submit" class="postBtn">Submit</button>
    </form>
  </div></div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script>
    // üîπ Firebase config ‡§°‡§æ‡§≤‡•á‡§Ç
    const firebaseConfig = { /* your config */ };
    firebase.initializeApp(firebaseConfig);
    const db=firebase.database();

    let currentUser=null,isAdmin=false,allPosts=[];
    const adminEmail="zarasamajiksevasanstha@gmail.com";

    const loginBtn=document.getElementById('loginBtn');
    const logoutBtn=document.getElementById('logoutBtn');
    const postBtn=document.getElementById('postBtn');

    loginBtn.onclick=()=>{firebase.auth().signInWithPopup(new firebase.auth.GoogleAuthProvider());};
    logoutBtn.onclick=()=>firebase.auth().signOut();

    firebase.auth().onAuthStateChanged(u=>{
      if(u){
        currentUser=u;isAdmin=(u.email===adminEmail);
        loginBtn.style.display='none';
        logoutBtn.style.display='inline-block';
        postBtn.style.display='inline-block';
      }else{
        currentUser=null;isAdmin=false;
        loginBtn.style.display='inline-block';
        logoutBtn.style.display='none';
        postBtn.style.display='none';
      }
      renderCards();
    });

    db.ref('posts').on('value',snap=>{
      const val=snap.val()||{};
      allPosts=Object.keys(val).map(id=>({...val[id],id}));
      renderCards();
    });

    const cardsEl=document.getElementById('cards');
    function renderCards(){
      cardsEl.innerHTML='';
      let posts=[...allPosts];
      const pf=document.getElementById('priceFilter').value;
      if(pf==='low') posts.sort((a,b)=>parseInt(a.price||0)-parseInt(b.price||0));
      if(pf==='high') posts.sort((a,b)=>parseInt(b.price||0)-parseInt(a.price||0));
      posts.forEach(p=>{
        if(!isAdmin){
          if(!currentUser && p.status!=='approved') return;
          if(currentUser && p.posterUid!==currentUser.uid && p.status!=='approved') return;
        }
        const card=document.createElement('div');
        card.className='card';card.onclick=()=>openModal(p);
        card.innerHTML=`
          <img class="thumb" src="${(p.images&&p.images[0])||'https://via.placeholder.com/400'}" loading="lazy">
          <h4>${p.price||''} ‚Äî ${p.bhk||''} ${p.propertyType||''}</h4>
          <div class="desc">üìç ${p.address||''}<br>üë§ ${p.posterName||''}</div>
          <div class="badge ${p.status||'pending'}">${p.status||'pending'}</div>`;
        cardsEl.appendChild(card);
      });
    }

    const modal=document.getElementById('modal');
    const modalTitle=document.getElementById('modalTitle');
    const modalBody=document.getElementById('modalBody');
    function openModal(p){
      modal.classList.add('open');
      modalTitle.textContent=`${p.bhk} ${p.propertyType} ‚Äî ${p.price}`;
      modalBody.innerHTML='';
      const gal=document.createElement('div');
      gal.className='gallery';
      (p.images||[]).forEach(url=>{gal.innerHTML+=`<img src="${url}">`;});
      modalBody.appendChild(gal);
      modalBody.innerHTML+=`
        <p><b>üìç Address:</b> ${p.address||''}</p>
        <p><b>üë§ Owner:</b> ${p.posterName||''}</p>
        <p><b>üì± Phone:</b> ${p.posterPhone||''}</p>
        <p><b>Status:</b> ${p.status||''}</p>`;
      const act=document.createElement('div');act.style.marginTop='10px';
      if(p.posterPhone){act.innerHTML+=`<a class="whatsapp-btn" href="https://wa.me/${p.posterPhone}" target="_blank">WhatsApp</a>`;}
      if(currentUser && currentUser.uid===p.posterUid){
        const del=document.createElement('button');
        del.textContent='Delete';del.onclick=()=>{if(confirm('Delete?')) db.ref('posts/'+p.id).remove();closeModal();};
        act.appendChild(del);
      }
      if(isAdmin){
        const app=document.createElement('button');app.textContent='Approve';app.onclick=()=>db.ref('posts/'+p.id).update({status:'approved'});
        const rej=document.createElement('button');rej.textContent='Reject';rej.onclick=()=>db.ref('posts/'+p.id).update({status:'rejected'});
        act.appendChild(app);act.appendChild(rej);
      }
      modalBody.appendChild(act);
    }
    function closeModal(){modal.classList.remove('open');}
    window.onkeydown=e=>{if(e.key==='Escape'){closeModal();closeForm();}}

    // theme toggle
    document.getElementById('themeToggle').onclick=()=>{
      const b=document.body;
      b.setAttribute('data-theme',b.getAttribute('data-theme')==='dark'?'light':'dark');
    };
    document.getElementById('priceFilter').onchange=renderCards;

    // post form
    const formModal=document.getElementById('formModal');
    postBtn.onclick=()=>formModal.classList.add('open');
    function closeForm(){formModal.classList.remove('open');}
    document.getElementById('postForm').onsubmit=async e=>{
      e.preventDefault();
      if(!currentUser) return alert('Login required');
      const fd=new FormData(e.target);
      let images=[];
      const files=document.getElementById('images').files;
      for(let i=0;i<Math.min(files.length,5);i++){
        const f=files[i];
        const url=URL.createObjectURL(f); // NOTE: ‡§Ø‡§π‡§æ‡§Ç ‡§∏‡§ø‡§∞‡•ç‡§´ demo ‡§ï‡•á ‡§≤‡§ø‡§è blob url, ‡§Ö‡§∏‡§≤ ‡§Æ‡•á‡§Ç ‡§Ü‡§™‡§ï‡•ã imgbb ‡§Ø‡§æ storage upload ‡§ï‡§∞‡§®‡§æ ‡§π‡•ã‡§ó‡§æ
        images.push(url);
      }
      const post={
        price:fd.get('price'),bhk:fd.get('bhk'),propertyType:fd.get('propertyType'),
        address:fd.get('address'),description:fd.get('description'),
        posterPhone:fd.get('posterPhone'),
        posterName:currentUser.displayName,posterUid:currentUser.uid,
        images,status:'pending',createdAt:Date.now()
      };
      await db.ref('posts').push(post);
      closeForm();
    };
  </script>
</body>
</html>
