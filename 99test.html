<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ZaraFix Service Posting</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>
  <h1>Service Posting</h1>

  <!-- âœ… Login / Logout buttons -->
  <button id="loginBtn">Login with Google</button>
  <button id="logoutBtn" style="display:none;">Logout</button>

  <hr>

  <!-- âœ… Post Form -->
  <div id="postForm" style="display:none;">
    <input type="text" id="title" placeholder="Shop / Title"><br>
    <input type="text" id="price" placeholder="Price"><br>
    <input type="text" id="address" placeholder="Address"><br>
    <input type="text" id="phone" placeholder="Phone"><br>
    <select id="category">
      <option value="Car">Car</option>
      <option value="Bike">Bike</option>
      <option value="Electrician">Electrician</option>
      <option value="Driver">Driver</option>
    </select><br>
    <input type="text" id="image" placeholder="Image URL"><br>
    <button onclick="createPost()">Post Service</button>
  </div>

  <hr>

  <!-- âœ… Listings -->
  <div id="postList"></div>

<script>
  // -------------------- FIREBASE CONFIG --------------------
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    databaseURL: "https://YOUR_PROJECT.firebaseio.com",
    projectId: "YOUR_PROJECT",
    storageBucket: "YOUR_PROJECT.appspot.com",
    messagingSenderId: "XXXXXXX",
    appId: "XXXXXXX"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const auth = firebase.auth();

  const loginBtn = document.getElementById("loginBtn");
  const logoutBtn = document.getElementById("logoutBtn");
  const postForm = document.getElementById("postForm");
  const postList = document.getElementById("postList");

  // -------------------- LOGIN / LOGOUT --------------------
  loginBtn.onclick = () => {
    var provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider);
  };

  logoutBtn.onclick = () => auth.signOut();

  auth.onAuthStateChanged(user => {
    if (user) {
      loginBtn.style.display = "none";
      logoutBtn.style.display = "inline";
      postForm.style.display = "block";
    } else {
      loginBtn.style.display = "inline";
      logoutBtn.style.display = "none";
      postForm.style.display = "none";
    }
  });

  // -------------------- CREATE POST --------------------
  function createPost() {
    const user = auth.currentUser;
    if (!user) {
      alert("Please login first!");
      return;
    }

    const newPostKey = db.ref().child('posts').push().key;
    const postData = {
      title: document.getElementById("title").value,
      price: document.getElementById("price").value,
      address: document.getElementById("address").value,
      posterPhone: document.getElementById("phone").value,
      propertyType: document.getElementById("category").value,
      image: document.getElementById("image").value,
      posterUid: user.uid,
      posterName: user.displayName || "Unknown",
      status: "pending",
      created: Date.now()
    };

    let updates = {};
    updates['/posts/' + newPostKey] = postData;
    db.ref().update(updates);

    alert("Post submitted âœ…");
  }

  // -------------------- RENDER POSTS --------------------
  db.ref("posts").on("value", snapshot => {
    postList.innerHTML = "";
    snapshot.forEach(child => {
      const post = child.val();
      const key = child.key;
      const user = auth.currentUser;

      let card = document.createElement("div");
      card.style.border = "1px solid #ccc";
      card.style.margin = "10px";
      card.style.padding = "10px";

      card.innerHTML = `
        <img src="${post.image}" width="200"><br>
        <b>${post.propertyType} - ${post.title}</b><br>
        â‚¹${post.price}<br>
        ${post.address}<br>
        ðŸ“ž ${post.posterPhone}<br>
        ðŸ‘¤ ${post.posterName}<br>
        Status: ${post.status}<br>
      `;

      // âœ… Delete button condition
      if (user && (user.uid === post.posterUid || user.email === "zarasamajiksevasansth@gmail.com")) {
        let delBtn = document.createElement("button");
        delBtn.innerText = "ðŸ—‘ Delete";
        delBtn.onclick = () => {
          if (confirm("Delete this post?")) {
            db.ref("posts/" + key).remove();
          }
        };
        card.appendChild(delBtn);
      }

      // âœ… Admin controls (approve/reject)
      if (user && user.email === "zarasamajiksevasansth@gmail.com") {
        let approveBtn = document.createElement("button");
        approveBtn.innerText = "âœ… Approve";
        approveBtn.onclick = () => db.ref("posts/" + key).update({ status: "approved" });

        let rejectBtn = document.createElement("button");
        rejectBtn.innerText = "âŒ Reject";
        rejectBtn.onclick = () => db.ref("posts/" + key).update({ status: "rejected" });

        card.appendChild(approveBtn);
        card.appendChild(rejectBtn);
      }

      postList.appendChild(card);
    });
  });
</script>
</body>
</html>
