<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Ambulance Portal</title>
</head>
<body>
  <h2>Ambulance Post Form</h2>

  <form id="postForm">
    <label>Title:</label>
    <input type="text" id="title" required><br><br>

    <label>Description:</label>
    <textarea id="description" required></textarea><br><br>

    <label>Upload Image:</label>
    <input type="file" id="image" accept="image/*" required><br><br>

    <button type="submit">Submit</button>
  </form>

  <div id="status"></div>

  <!-- Firebase -->
  <script type="module">
    // Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyDuWPxtnSumumis8PJsrwo8BXZl8W_q7w0",
      authDomain: "ambulence-410c0.firebaseapp.com",
      projectId: "ambulence-410c0",
      storageBucket: "ambulence-410c0.appspot.com",
      messagingSenderId: "970590198679",
      appId: "1:970590198679:web:21b1acb30d2a7c09dec2d2"
    };

    // Import Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // ImgBB API Key
    const imgbbApiKey = "3aaba00e9c5a3a88955c9e5aebaeb5e5";

    document.getElementById("postForm").addEventListener("submit", async (e) => {
      e.preventDefault();

      const title = document.getElementById("title").value;
      const description = document.getElementById("description").value;
      const imageFile = document.getElementById("image").files[0];

      if (!imageFile) {
        alert("Please select an image!");
        return;
      }

      document.getElementById("status").innerText = "Uploading image...";

      // Upload to ImgBB
      const formData = new FormData();
      formData.append("image", imageFile);

      const res = await fetch(`https://api.imgbb.com/1/upload?key=${imgbbApiKey}`, {
        method: "POST",
        body: formData
      });

      const data = await res.json();

      if (data.success) {
        const imageUrl = data.data.url;

        // Save post to Firebase
        const newPostRef = push(ref(db, "posts"));
        await set(newPostRef, {
          title,
          description,
          image: imageUrl,
          createdAt: Date.now()
        });

        document.getElementById("status").innerText = "✅ Post uploaded successfully!";
        document.getElementById("postForm").reset();
      } else {
        document.getElementById("status").innerText = "❌ Image upload failed!";
      }
    });
  </script>
</body>
</html>
