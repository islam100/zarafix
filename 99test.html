<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ZaraFix Services</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background:#f7f7f7; }
    .card { background:#fff; padding:15px; margin:10px 0; border-radius:10px; box-shadow:0 2px 5px rgba(0,0,0,0.1);}
    .card h3{margin:0;}
    .btn { padding:6px 10px; border:none; border-radius:5px; margin:5px; cursor:pointer;}
    .btn-good{background:#4CAF50;color:#fff;}
    .btn-bad{background:#f44336;color:#fff;}
    .btn-neutral{background:#2196F3;color:#fff;}
  </style>
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>
<body>
  <h1>ZaraFix Services</h1>
  <button id="loginBtn" class="btn btn-neutral">Login with Google</button>
  <button id="logoutBtn" class="btn btn-bad" style="display:none;">Logout</button>
  <button id="newPostBtn" class="btn btn-good">+ New Post</button>

  <div id="postModal" style="display:none; background:#fff; padding:20px; border:1px solid #ccc; border-radius:10px;">
    <h2>Create Post</h2>
    <form id="postForm">
      <input type="text" id="shop" placeholder="Shop Name" required><br><br>
      <input type="text" id="address" placeholder="Address" required><br><br>
      <input type="text" id="phone" placeholder="Phone" required><br><br>
      <input type="text" id="owner" placeholder="Owner Name" required><br><br>
      <input type="number" id="price" placeholder="Price â‚¹" required><br><br>
      <select id="category" required>
        <option value="">--Select Category--</option>
        <option>Electrician</option>
        <option>Plumber</option>
        <option>Driver</option>
        <option>Car</option>
        <option>Bike</option>
        <option>AC</option>
      </select><br><br>
      <button type="submit" class="btn btn-good">Submit</button>
      <button type="button" id="closeModal" class="btn btn-bad">Cancel</button>
    </form>
  </div>

  <h2>All Posts</h2>
  <div id="posts"></div>

<script>
  // ðŸ”¥ Firebase config (apna wala daalna)
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    databaseURL: "https://YOUR_PROJECT.firebaseio.com",
    projectId: "YOUR_PROJECT",
    storageBucket: "YOUR_PROJECT.appspot.com",
    messagingSenderId: "SENDER_ID",
    appId: "APP_ID"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.database();

  let currentUser = null;
  const adminEmail = "zarasamajiksevasansth@gmail.com"; // ðŸ‘‘ admin

  const loginBtn = document.getElementById("loginBtn");
  const logoutBtn = document.getElementById("logoutBtn");
  const newPostBtn = document.getElementById("newPostBtn");
  const postModal = document.getElementById("postModal");
  const closeModal = document.getElementById("closeModal");
  const postForm = document.getElementById("postForm");
  const postsDiv = document.getElementById("posts");

  // Login with Google
  loginBtn.onclick = () => {
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider);
  };

  logoutBtn.onclick = () => auth.signOut();

  auth.onAuthStateChanged(user => {
    currentUser = user;
    if(user){
      loginBtn.style.display="none";
      logoutBtn.style.display="inline-block";
      console.log("Logged in:", user.email);
    } else {
      loginBtn.style.display="inline-block";
      logoutBtn.style.display="none";
    }
  });

  // Open Post Modal (only if login)
  newPostBtn.onclick = () => {
    if(!currentUser){ alert("âš ï¸ Please login first."); return; }
    postModal.style.display="block";
  };
  closeModal.onclick = () => postModal.style.display="none";

  // Submit Post (only if login)
  postForm.onsubmit = async (e) => {
    e.preventDefault();
    if(!currentUser){ alert("âš ï¸ You must login first."); return; }

    const post = {
      shop: document.getElementById("shop").value,
      address: document.getElementById("address").value,
      phone: document.getElementById("phone").value,
      owner: document.getElementById("owner").value,
      price: document.getElementById("price").value,
      category: document.getElementById("category").value,
      status: "pending",
      uid: currentUser.uid,
      userEmail: currentUser.email
    };

    await db.ref("posts").push(post);
    alert("âœ… Post submitted for approval.");
    postModal.style.display="none";
    postForm.reset();
  };

  // Load Posts
  db.ref("posts").on("value", snap => {
    postsDiv.innerHTML="";
    snap.forEach(child=>{
      const p = child.val(); p.id = child.key;
      const card = document.createElement("div");
      card.className="card";
      card.innerHTML = `
        <h3>${p.category} - ${p.shop}</h3>
        <p>â‚¹${p.price}</p>
        <p>${p.address}</p>
        <p>ðŸ“ž ${p.phone}</p>
        <p>ðŸ‘¤ ${p.owner} (${p.category})</p>
        <p>Status: ${p.status}</p>
      `;

      // WhatsApp button
      const wa = document.createElement("a");
      wa.href = "https://wa.me/"+p.phone;
      wa.textContent = "ðŸ’¬ WhatsApp";
      wa.className="btn btn-neutral";
      card.appendChild(wa);

      // Admin Approve/Reject/Delete
      if(currentUser && currentUser.email===adminEmail){
        const approve = document.createElement("button");
        approve.className="btn btn-good"; approve.textContent="âœ… Approve";
        approve.onclick=()=> db.ref("posts/"+p.id).update({status:"approved"});
        card.appendChild(approve);

        const reject = document.createElement("button");
        reject.className="btn btn-bad"; reject.textContent="âŒ Reject";
        reject.onclick=()=> db.ref("posts/"+p.id).update({status:"rejected"});
        card.appendChild(reject);

        const del = document.createElement("button");
        del.className="btn btn-bad"; del.textContent="ðŸ—‘ Delete";
        del.onclick=()=>{ if(confirm("Delete?")) db.ref("posts/"+p.id).remove(); };
        card.appendChild(del);
      }

      // Driver (post owner) delete button
      if(currentUser && p.uid===currentUser.uid){
        const delOwn = document.createElement("button");
        delOwn.className="btn btn-bad"; delOwn.textContent="ðŸ—‘ Delete";
        delOwn.onclick=()=>{ if(confirm("Delete?")) db.ref("posts/"+p.id).remove(); };
        card.appendChild(delOwn);
      }

      postsDiv.appendChild(card);
    });
  });
</script>
</body>
</html>
