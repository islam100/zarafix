<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ZaraFix Property/Service</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f6f9; margin: 0; }
    header { background: #4CAF50; color: white; padding: 15px; text-align: center; font-size: 22px; }
    .container { padding: 20px; max-width: 600px; margin: auto; }
    .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0px 4px 8px rgba(0,0,0,0.1); margin-bottom: 15px; }
    input, select, button { width: 100%; padding: 10px; margin-top: 8px; border: 1px solid #ccc; border-radius: 8px; }
    button { background: #4CAF50; color: white; cursor: pointer; font-size: 16px; }
    button:hover { background: #45a049; }
    .hidden { display: none; }
    .logout-btn { background: red; margin-top: 10px; }
  </style>
</head>
<body>
  <header>ZaraFix</header>
  <div class="container">

    <!-- Login Section -->
    <div id="loginSection" class="card">
      <h3>Login with Google</h3>
      <button onclick="googleLogin()">Login</button>
    </div>

    <!-- Form Section -->
    <div id="formSection" class="card hidden">
      <h3>Post a Property/Service</h3>
      <label>Title</label>
      <input type="text" id="title">

      <label>Shop Name</label>
      <input type="text" id="shop">

      <label>Category</label>
      <select id="category">
        <option value="Repair">Repair</option>
        <option value="Property">Property</option>
        <option value="Service">Service</option>
        <option value="Ambulance">Ambulance</option>
        <option value="Other">Other</option>
      </select>

      <label>Discount (â‚¹)</label>
      <input type="number" id="discount">

      <label>Image</label>
      <input type="file" id="image">

      <button onclick="submitPost()">Submit Post</button>
      <button class="logout-btn" onclick="logout()">Logout</button>
    </div>

    <!-- Posts Section -->
    <div id="postsSection" class="card">
      <h3>All Posts</h3>
      <div id="postsList"></div>
    </div>

    <!-- Admin Panel -->
    <div id="adminSection" class="card hidden">
      <h3>Admin Control</h3>
      <div id="adminList"></div>
    </div>

  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDTj2n1yhr1sFmuyBZ-jUwOmx1YqAN5QjA",
      authDomain: "property-20d6d.firebaseapp.com",
      databaseURL: "https://property-20d6d-default-rtdb.firebaseio.com",
      projectId: "property-20d6d",
      storageBucket: "property-20d6d.appspot.com",
      messagingSenderId: "868671000000",
      appId: "1:868671000000:web:example"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    const adminEmail = "admin@gmail.com"; // ðŸ”‘ Admin à¤•à¤¾ email fix

    // Login with Google
    function googleLogin() {
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider).then(res => {
        checkLogin(res.user);
      });
    }

    function logout() {
      auth.signOut().then(() => {
        location.reload();
      });
    }

    function checkLogin(user) {
      document.getElementById("loginSection").classList.add("hidden");
      document.getElementById("formSection").classList.remove("hidden");

      if (user.email === adminEmail) {
        document.getElementById("adminSection").classList.remove("hidden");
      }
    }

    // Check auth state
    auth.onAuthStateChanged(user => {
      if (user) {
        checkLogin(user);
      }
    });

    // Submit post
    function submitPost() {
      const title = document.getElementById("title").value;
      const shop = document.getElementById("shop").value;
      const category = document.getElementById("category").value;
      const discount = document.getElementById("discount").value;

      const postRef = db.ref("posts").push();
      postRef.set({
        title, shop, category, discount,
        user: auth.currentUser.email,
        time: new Date().toLocaleString()
      });
      alert("Post Submitted!");
    }

    // Load all posts
    db.ref("posts").on("value", snap => {
      const posts = snap.val();
      const list = document.getElementById("postsList");
      list.innerHTML = "";
      for (let id in posts) {
        list.innerHTML += `<div style="border:1px solid #ccc; padding:10px; margin:5px">
          <b>${posts[id].title}</b><br>
          Shop: ${posts[id].shop}<br>
          Category: ${posts[id].category}<br>
          Discount: â‚¹${posts[id].discount}<br>
          Posted By: ${posts[id].user}
        </div>`;
      }
    });

    // Admin Panel
    db.ref("posts").on("value", snap => {
      const posts = snap.val();
      const adminList = document.getElementById("adminList");
      adminList.innerHTML = "";
      for (let id in posts) {
        adminList.innerHTML += `<div style="border:1px solid red; padding:10px; margin:5px">
          <b>${posts[id].title}</b> (${posts[id].category})<br>
          Posted By: ${posts[id].user}<br>
          <button onclick="deletePost('${id}')">Delete</button>
        </div>`;
      }
    });

    function deletePost(id) {
      db.ref("posts/" + id).remove();
    }
  </script>
</body>
</html>
