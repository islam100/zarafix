<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ZaraFix â€“ Poster & Admin</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body class="bg-gray-100 p-5">

  <div id="loginBox" class="flex justify-center">
    <button onclick="googleLogin()" class="bg-blue-600 text-white px-5 py-2 rounded-xl shadow-lg">
      Google Login
    </button>
  </div>

  <!-- User Poster Section -->
  <div id="posterSection" class="hidden">
    <h2 class="text-xl font-bold mb-3">Post Add (Poster)</h2>
    <form id="postForm" class="grid gap-3">
      <input type="text" id="pPrice" placeholder="Price" class="p-2 rounded">
      <input type="text" id="pBhk" placeholder="BHK" class="p-2 rounded">
      <input type="text" id="pType" placeholder="Property Type" class="p-2 rounded">
      <input type="text" id="pAddress" placeholder="Address" class="p-2 rounded">
      <input type="text" id="pPhone" placeholder="Phone" class="p-2 rounded">
      <button type="submit" class="bg-green-600 text-white p-2 rounded">Submit Post</button>
    </form>

    <h3 class="mt-5 font-bold">My Posts</h3>
    <div id="myPosts" class="space-y-2"></div>
  </div>

  <!-- Admin Section -->
  <div id="adminSection" class="hidden">
    <h2 class="text-xl font-bold mb-3">Admin Panel</h2>
    <div id="allPosts" class="space-y-2"></div>
  </div>

  <script>
    // âœ… Firebase Config (apna config lagana)
   const firebaseConfig = {
  apiKey: "AIzaSyAAOYtvC0kiu_vZTYuQ8phPyMqTEFJj9O0",
  authDomain: "new-bike-59133.firebaseapp.com",
  projectId: "new-bike-59133",
  storageBucket: "new-bike-59133.appspot.com",
  messagingSenderId: "966945954091",
  appId: "1:966945954091:web:c1387e3a27af68aef3cd6e"
};

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    const loginBox = document.getElementById("loginBox");
    const posterSection = document.getElementById("posterSection");
    const adminSection = document.getElementById("adminSection");

    let currentUser = null;
    const adminEmail = "
zarasamajiksevasanstha@gmail.com"; // âœ… apna admin email set karo

    function googleLogin() {
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider).then(res => {
        currentUser = res.user;
        checkUserRole(currentUser);
      });
    }

    function checkUserRole(user) {
      loginBox.classList.add("hidden");
      if (user.email === adminEmail) {
        adminSection.classList.remove("hidden");
        loadAllPosts();
      } else {
        posterSection.classList.remove("hidden");
        loadMyPosts(user.uid);
      }
    }

    // âœ… Poster Form Submit
    document.getElementById("postForm").addEventListener("submit", e => {
      e.preventDefault();
      const postData = {
        price: document.getElementById("pPrice").value,
        bhk: document.getElementById("pBhk").value,
        propertyType: document.getElementById("pType").value,
        address: document.getElementById("pAddress").value,
        posterPhone: document.getElementById("pPhone").value,
        uid: currentUser.uid,
        email: currentUser.email
      };
      db.ref("posts").push(postData);
      alert("Post Added âœ…");
      document.getElementById("postForm").reset();
      loadMyPosts(currentUser.uid);
    });

    // âœ… Load My Posts (Poster)
    function loadMyPosts(uid) {
      const myPostsDiv = document.getElementById("myPosts");
      db.ref("posts").orderByChild("uid").equalTo(uid).on("value", snap => {
        myPostsDiv.innerHTML = "";
        snap.forEach(child => {
          const p = child.val();
          myPostsDiv.innerHTML += `
            <div class="p-2 border rounded">
              <b>${p.bhk} â€“ â‚¹${p.price}</b><br>
              ${p.propertyType}, ${p.address}<br>
              ðŸ“ž ${p.posterPhone}
            </div>`;
        });
      });
    }

    // âœ… Load All Posts (Admin)
    function loadAllPosts() {
      const allPostsDiv = document.getElementById("allPosts");
      db.ref("posts").on("value", snap => {
        allPostsDiv.innerHTML = "";
        snap.forEach(child => {
          const p = child.val();
          allPostsDiv.innerHTML += `
            <div class="p-2 border rounded">
              <b>${p.bhk} â€“ â‚¹${p.price}</b><br>
              ${p.propertyType}, ${p.address}<br>
              ðŸ“ž ${p.posterPhone} <br>
              <i>${p.email}</i>
            </div>`;
        });
      });
    }
  </script>
</body>
</html>
