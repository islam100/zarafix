<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Zara Samajik Seva</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding:20px; }
    #adminSection, #userSection { display: none; margin-top:20px; }
    .poster { border:1px solid #ccc; padding:10px; margin:5px; display:inline-block; width:200px; }
    .popup { position: fixed; top:50%; left:50%; transform: translate(-50%, -50%);
             background:#fff; padding:20px; box-shadow:0 0 10px rgba(0,0,0,0.5); display:none; }
    button { padding:10px 20px; cursor:pointer; }
  </style>
</head>
<body>

  <h2>Zara Samajik Seva Login</h2>
  <button id="loginBtn">Google Login</button>

  <!-- Popup -->
  <div id="popup" class="popup">
    <span id="popupMsg"></span><br><br>
    <button onclick="closePopup()">Close</button>
  </div>

  <!-- Admin Section -->
  <div id="adminSection">
    <h3>Admin Panel</h3>
    <div>
      <input type="text" id="posterTitle" placeholder="Poster Title">
      <input type="text" id="posterImg" placeholder="Poster Image URL">
      <button onclick="addPoster()">Add Poster</button>
    </div>
    <h4>All Posters:</h4>
    <div id="allPosters"></div>
  </div>

  <!-- User Section -->
  <div id="userSection">
    <h3>Posters</h3>
    <div id="userPosters"></div>
  </div>

  <script>
    // Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyAAOYtvC0kiu_vZTYuQ8phPyMqTEFJj9O0",
      authDomain: "new-bike-59133.firebaseapp.com",
      projectId: "new-bike-59133",
      storageBucket: "new-bike-59133.appspot.com",
      messagingSenderId: "966945954091",
      appId: "1:966945954091:web:c1387e3a27af68aef3cd6e"
    };
    firebase.initializeApp(firebaseConfig);

    const db = firebase.database();

    const loginBtn = document.getElementById('loginBtn');
    const adminEmail = 'zarasamajiksevasanstha@gmail.com';

    loginBtn.addEventListener('click', () => {
      const provider = new firebase.auth.GoogleAuthProvider();
      firebase.auth().signInWithPopup(provider)
        .then(result => {
          const user = result.user;
          showPopup(`Welcome ${user.displayName}`);
        })
        .catch(err => {
          showPopup(err.message);
        });
    });

    firebase.auth().onAuthStateChanged(user => {
      if(user){
        loginBtn.style.display = 'none';
        if(user.email === adminEmail){
          document.getElementById('adminSection').style.display = 'block';
        } else {
          document.getElementById('userSection').style.display = 'block';
        }
        loadPosters();
      }
    });

    // Popup Functions
    function showPopup(msg){
      const popup = document.getElementById('popup');
      document.getElementById('popupMsg').innerText = msg;
      popup.style.display = 'block';
    }
    function closePopup(){
      document.getElementById('popup').style.display = 'none';
    }

    // Add Poster (Admin)
    function addPoster(){
      const title = document.getElementById('posterTitle').value;
      const img = document.getElementById('posterImg').value;
      if(title && img){
        const key = db.ref('posters').push().key;
        db.ref('posters/' + key).set({ title, img })
          .then(() => showPopup('Poster Added'))
          .catch(err => showPopup(err.message));
        document.getElementById('posterTitle').value = '';
        document.getElementById('posterImg').value = '';
      } else {
        showPopup('Please enter title and image URL');
      }
    }

    // Load Posters
    function loadPosters(){
      db.ref('posters').on('value', snapshot => {
        const data = snapshot.val();
        let html = '';
        if(data){
          Object.values(data).forEach(p => {
            html += `<div class="poster">
                       <img src="${p.img}" width="180"><br>
                       <b>${p.title}</b>
                     </div>`;
          });
        }
        document.getElementById('allPosters').innerHTML = html;
        document.getElementById('userPosters').innerHTML = html;
      });
    }
  </script>

</body>
</html>
