<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <title>Admin â€“ Upload Ads</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="p-4">

  <h1 class="text-xl font-bold mb-4">Upload Ad Image</h1>
  <form id="uploadForm" class="space-y-3">
    <input id="adUrl" type="text" placeholder="Image URL" class="border p-2 w-full rounded">
    <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded">Upload</button>
  </form>

  <h2 class="text-lg font-semibold mt-6">Pending Ads</h2>
  <div id="pendingList" class="space-y-2"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, push, set, onValue, update } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyAAOYtvC0kiu_vZTYuQ8phPyMqTEFJj9O0",
  authDomain: "new-bike-59133.firebaseapp.com",
  projectId: "new-bike-59133",
  storageBucket: "new-bike-59133.appspot.com",
  messagingSenderId: "966945954091",
  appId: "1:966945954091:web:c1387e3a27af68aef3cd6e"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const uploadForm = document.getElementById("uploadForm");
uploadForm.addEventListener("submit", async (e)=>{
  e.preventDefault();
  const url = document.getElementById("adUrl").value;
  if(!url) return;
  const newRef = push(ref(db, "adsUploads"));
  await set(newRef, { url, status:"pending" });
  document.getElementById("adUrl").value="";
});

// show pending ads
const pendingList = document.getElementById("pendingList");
onValue(ref(db,"adsUploads"), (snap)=>{
  pendingList.innerHTML="";
  const data = snap.val() || {};
  Object.entries(data).forEach(([id,ad])=>{
    if(ad.status==="pending"){
      const div=document.createElement("div");
      div.className="border p-2 flex justify-between items-center";
      div.innerHTML=`<img src=\"${ad.url}\" class=\"h-16\"> 
        <button class='bg-green-500 text-white px-3 py-1 rounded'>Approve</button>`;
      div.querySelector("button").onclick=async()=>{
        await update(ref(db,`adsUploads/${id}`), { status: \"approved\" });
        await update(ref(db,`adsImages/${id}`), ad.url);
      };
      pendingList.appendChild(div);
    }
  });
});
</script>
</body>
</html>
