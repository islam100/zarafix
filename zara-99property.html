<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ZaraFix Posts</title>
<style>
  body{font-family:sans-serif;background:#f0f2f5;margin:0;padding:0;}
  .container{width:90%;max-width:1200px;margin:auto;padding:20px;}
  .post-card{
    background:#fff;padding:15px;margin:10px;box-shadow:0 4px 6px rgba(0,0,0,0.1);
    border-radius:10px;transition:all 0.3s;cursor:pointer;position:relative;
  }
  .post-card:hover{transform:scale(1.05);}
  .btn{
    padding:6px 12px;margin:2px;border:none;border-radius:5px;
    background:#2563eb;color:#fff;font-weight:bold;cursor:pointer;
    box-shadow:0 4px #1e40af;
    transition:0.2s;
  }
  .btn:active{transform:translateY(2px);box-shadow:0 2px #1e40af;}
  .checkbox{margin-right:8px;}
  #pendingSection{margin-top:30px;}
  h3{margin-bottom:10px;}
</style>
</head>
<body>
<div class="container">
  <h2>All Posts</h2>
  <div id="postsList"></div>

  <!-- Admin Pending Section -->
  <div id="pendingSection">
    <h3>Pending Posts</h3>
    <div style="margin-bottom:10px;">
      <button id="massApprove" class="btn">Approve All Selected</button>
      <button id="massDelete" class="btn">Delete All Selected</button>
    </div>
    <div id="pendingList"></div>
  </div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDTj2n1yhr1sFmuyBZ-jUwOmx1YqAN5QjA",
  authDomain: "property-20d6d.firebaseapp.com",
  databaseURL: "https://property-20d6d-default-rtdb.firebaseio.com",
  projectId: "property-20d6d",
  storageBucket: "property-20d6d.appspot.com",
  messagingSenderId: "916859697394",
  appId: "1:916859697394:web:2a8f9ad2d62f8306dcb86b"
};


firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const auth = firebase.auth();
const ADMIN_EMAIL = "admin@example.com"; // अपनी admin email डालें

// Function to render posts
function renderPosts(){
  const postsList = document.getElementById('postsList');
  postsList.innerHTML = '';
  db.ref('approvedPosts').on('value', snap=>{
    snap.forEach(c=>{
      const item = c.val();
      const div = document.createElement('div');
      div.className='post-card';
      div.innerHTML=`
        <strong>${item.title}</strong><br>
        <small>${item.city} | ${item.type}</small>
        <div style="position:absolute;top:10px;right:10px;">
          <button class="btn deleteBtn">Delete</button>
        </div>
      `;
      div.querySelector('.deleteBtn').addEventListener('click', ()=>{
        if(auth.currentUser?.email===ADMIN_EMAIL || auth.currentUser?.email===item.posterEmail){
          db.ref('approvedPosts/'+c.key).remove();
        } else {
          alert('You cannot delete this post.');
        }
      });
      div.addEventListener('click', ()=>div.style.transform='scale(1.1)');
      postsList.appendChild(div);
    });
  });
}

// Pending section (Admin only)
const pendingList = document.getElementById('pendingList');
if(auth.currentUser?.email===ADMIN_EMAIL){
  db.ref('pendingPosts').on('value', snap=>{
    pendingList.innerHTML='';
    snap.forEach(c=>{
      const item=c.val();
      const div=document.createElement('div'); 
      div.className='post-card';
      div.innerHTML=`
        <input type="checkbox" class="checkbox select-post" data-id="${c.key}"/>
        <strong>${item.title}</strong> (${item.city} | ${item.type})
        <div style="margin-left:auto; display:inline-block;">
          <button class="btn approve">Approve</button>
          <button class="btn reject">Reject</button>
        </div>
      `;
      
      div.querySelector('.approve').addEventListener('click', async ()=>{
        await db.ref('approvedPosts/'+c.key).set(item); 
        await c.ref.remove();
      });
      div.querySelector('.reject').addEventListener('click', ()=>c.ref.remove());
      pendingList.appendChild(div);
    });
  });

  // Mass Approve
  document.getElementById('massApprove').addEventListener('click', async ()=>{
    const selected = document.querySelectorAll('.select-post:checked');
    for(const checkbox of selected){
      const key = checkbox.dataset.id;
      const snap = await db.ref('pendingPosts/'+key).get();
      if(snap.exists()){
        await db.ref('approvedPosts/'+key).set(snap.val());
        await db.ref('pendingPosts/'+key).remove();
      }
    }
    alert('Selected posts approved!');
  });

  // Mass Delete
  document.getElementById('massDelete').addEventListener('click', async ()=>{
    const selected = document.querySelectorAll('.select-post:checked');
    for(const checkbox of selected){
      const key = checkbox.dataset.id;
      await db.ref('pendingPosts/'+key).remove();
    }
    alert('Selected posts deleted!');
  });
}

// Render posts on load
renderPosts();
</script>
</body>
</html>
