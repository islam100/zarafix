<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Real Estate Portal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <style>
    body { margin:0; font-family:Arial, sans-serif; background:#f5f5f5; }
    header { background:linear-gradient(135deg,#2196F3,#21CBF3); color:white;
             display:flex; align-items:center; justify-content:space-between;
             padding:10px 20px; box-shadow:0 3px 8px rgba(0,0,0,0.3); }
    header h1 { margin:0; font-size:20px; }
    button { cursor:pointer; padding:6px 10px; border:none; border-radius:8px;
             box-shadow:0 2px 4px rgba(0,0,0,0.3); font-weight:bold; font-size:12px; margin:2px; }
    .btn3d { background:#4CAF50; color:#fff; }
    .logoutBtn { background:#E53935; color:#fff; }
    .whatsappBtn { background:#25D366; color:#fff; }

    .grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
            gap:10px; padding:10px; }
    .card { background:#fff; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.2);
            padding:8px; position:relative; transition:transform .2s; cursor:pointer; font-size:13px; }
    .card:hover { transform:scale(1.02); }
    .card img { width:100%; height:120px; object-fit:cover; border-radius:6px; }
    .card h3 { margin:6px 0 3px; font-size:14px; }
    .card p { margin:2px 0; font-size:12px; }
    .btnRow { margin-top:6px; display:flex; flex-wrap:wrap; gap:4px; }
    .pending { background:#fff9c4; border:2px solid #fbc02d; animation: blinkBorder 1s infinite; }
    .rejected { background:#ffcdd2; border:2px solid #f44336; }
    @keyframes blinkBorder { 50% { border-color: #f57f17; } }
  </style>
</head>
<body>
<header>
  <h1>üè† Real Estate Portal</h1>
  <div>
    <button id="loginBtn" class="btn3d">Login</button>
    <button id="logoutBtn" class="logoutBtn" style="display:none;">Logout</button>
    <button id="newPostBtn" class="btn3d" style="display:none;">+ New Post</button>
  </div>
</header>

<main>
  <div class="grid" id="posts"></div>
</main>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDTj2n1yhr1sFmuyBZ-jUwOmx1YqAN5QjA",
  authDomain: "property-20d6d.firebaseapp.com",
  databaseURL: "https://property-20d6d-default-rtdb.firebaseio.com",
  projectId: "property-20d6d",
  storageBucket: "property-20d6d.appspot.com",
  messagingSenderId: "916859697394",
  appId: "1:916859697394:web:2a8f9ad2d62f8306dcb86b"
};
firebase.initializeApp(firebaseConfig);
const auth=firebase.auth();
const db=firebase.database();
let currentUser=null;

auth.onAuthStateChanged(u=>{ currentUser=u; loadPosts(); });

function loadPosts(){
  db.ref("posts").orderByChild("created").on("value",snap=>{
    const postsDiv=document.getElementById("posts");
    postsDiv.innerHTML="";
    const arr=[]; snap.forEach(ch=>arr.push({...ch.val(),id:ch.key})); arr.reverse();

    arr.forEach(p=>{
      if(currentUser?.email==="zarasamajiksevasanstha@gmail.com"){
        // admin sees all
      } else {
        if(p.status!=="approved" && (!currentUser || p.posterUid!==currentUser.uid)) return;
      }

      const card=document.createElement("div");
      card.className="card";
      if(p.status==="pending") card.classList.add("pending");
      if(p.status==="rejected") card.classList.add("rejected");

      if(p.images && p.images.length){
        const img=document.createElement("img"); img.src=p.images[0]; card.appendChild(img);
      }

      // details
      const h3=document.createElement("h3");
      h3.textContent=`${p.propertyType} - ${p.bhk}`;
      card.appendChild(h3);

      const price=document.createElement("p");
      price.textContent="üí∞ Price: ‚Çπ"+p.price;
      card.appendChild(price);

      const addr=document.createElement("p");
      addr.textContent="üìç "+p.address;
      card.appendChild(addr);

      const pt=document.createElement("p");
      pt.textContent="üßë Poster: "+p.posterType;
      card.appendChild(pt);

      const ph=document.createElement("p");
      ph.textContent="üìû "+p.posterPhone;
      card.appendChild(ph);

      // buttons
      const btnRow=document.createElement("div"); btnRow.className="btnRow";

      // WhatsApp share
      const wa=document.createElement("button");
      wa.textContent="üì≤ WhatsApp"; wa.className="whatsappBtn";
      wa.onclick=e=>{
        e.stopPropagation();
        const msg=`üè† ${p.propertyType} - ${p.bhk}\nüí∞ Price: ‚Çπ${p.price}\nüìç ${p.address}\nüë§ ${p.posterType}\nüìû ${p.posterPhone}`;
        window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`,"_blank");
      };
      btnRow.appendChild(wa);

      // admin actions
      if(currentUser && currentUser.email==="zarasamajiksevasanstha@gmail.com"){
        const ap=document.createElement("button");
        ap.textContent="‚úÖ Approve"; ap.className="btn3d";
        ap.onclick=e=>{e.stopPropagation(); db.ref("posts/"+p.id).update({status:"approved"});};
        const rj=document.createElement("button");
        rj.textContent="‚ùå Reject"; rj.className="logoutBtn";
        rj.onclick=e=>{e.stopPropagation(); db.ref("posts/"+p.id).update({status:"rejected"});};
        btnRow.appendChild(ap); btnRow.appendChild(rj);
      }

      card.appendChild(btnRow);
      postsDiv.appendChild(card);
    });
  });
}
</script>
</body>
</html>
