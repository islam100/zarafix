<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ZaraFix – Public | Shopkeeper | Admin</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Firebase compat -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <style>
    :root{
      --bg:#0b1220; --panel:#0e1524; --line:rgba(255,255,255,.1); --soft:rgba(255,255,255,.05);
    }
    body{ background:var(--bg); color:#e5e7eb; }
    .btn-3d{ box-shadow:0 6px 0 rgba(0,0,0,.6); transform:translateY(0); transition:transform .08s, box-shadow .08s, filter .2s; }
    .btn-3d:hover{ filter:brightness(1.05); }
    .btn-3d:active{ transform:translateY(3px); box-shadow:0 3px 0 rgba(0,0,0,.6); }
    .card-3d{ background:linear-gradient(160deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.08); border-radius:18px; overflow:hidden; box-shadow:0 14px 36px rgba(0,0,0,.45); user-select:none; }
    .card-3d.colourful{ border-image:linear-gradient(45deg,#8b5cf6,#06b6d4,#22c55e,#f59e0b) 1; border-width:1px; }
    .gal-img{ width:100%; height:190px; object-fit:contain; background:#07101d; }
    @media(min-width:640px){ .gal-img{ height:210px } }
    .modal{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,.75); z-index:70; }
    .modal.show{ display:flex }
    .modal-card{ width:min(95vw,900px); background:var(--panel); border:1px solid var(--line); border-radius:20px; overflow:hidden; box-shadow:0 20px 60px rgba(0,0,0,.6); }
    .open .dd-list{ display:block }
    .badge{ position:absolute; top:10px; left:10px; background:7fff00; border:1px solid rgba(255,255,255,.1); padding:6px 10px; border-radius:999px; font-size:12px; font-weight:800; }
    .badge-sold{ background:#3b1d1d; border-color:#4444ef; }
    .logo-3d{ font-weight:900; letter-spacing:.08em; background:conic-gradient(from 210deg, #ff4ecd, #8b5cf6, #06b6d4, #22c55e, #f59e0b, #ff4ecd); -webkit-background-clip:text; background-clip:text; color:transparent; text-shadow: 0 2px 0 rgba(0,0,0,.7), 0 10px 30px rgba(0,0,0,.5); filter:drop-shadow(0 8px 18px rgba(16,185,129,.35)); }
    .hdr-btn{ border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.06); }
    .inpt{ background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12) }
  </style>
</head>
<body class="min-h-screen flex flex-col">
<!-- Header and content same as before -->
<header class="sticky top-0 z-50 bg-[#0b1220]/95 backdrop-blur border-b border-white/10">
  <div class="max-w-7xl mx-auto flex items-center justify-between p-3">
    <div class="text-xl font-bold text-white">ZARA FIX</div>
    <div class="flex items-center space-x-4 relative z-50">
      <!-- Menu 1 & 2 (same as before) -->
    </div>
  </div>
</header>

<main class="w-full max-w-6xl mx-auto flex-1 p-3">
  <!-- PUBLIC, SHOPKEEPER, ADMIN sections same as before -->
  <!-- Shopkeeper form includes Amazon input already -->
</main>

<div id="modal" class="modal"><div id="modalCard" class="modal-card"></div></div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyAa8htkfGK-4D3cIQVyxT3o_8WMvghkr-8",
    authDomain: "loot-lo-15328.firebaseapp.com",
    databaseURL: "https://loot-lo-15328-default-rtdb.firebaseio.com",
    projectId: "loot-lo-15328",
    storageBucket: "loot-lo-15328.appspot.com",
    messagingSenderId: "677769861892",
    appId: "1:677769861892:web:bb235cb8479aeee9b58e51"
  };
  const ADMIN_EMAIL = "zarasamajiksevasanstha@gmail.com";
  const IMGBB_KEY = "ff05d1b5c3b3e139253856f0ad1123df";

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.database();
  const productsRef = db.ref('products');
  let ALL = [];

  const $ = s => document.querySelector(s);
  const byId = id => document.getElementById(id);
  const rupees = n => '₹' + Number(n||0).toLocaleString('en-IN');
  const toast = (el, msg) => { el.textContent = msg; setTimeout(()=> el.textContent='', 4000); };
  const clean = s => (s||'').replace(/</g,'&lt;');

  // Auth
  byId('loginBtn').onclick = async () => {
    if(auth.currentUser){ return auth.signOut(); }
    const provider = new firebase.auth.GoogleAuthProvider();
    await auth.signInWithPopup(provider);
  };

  auth.onAuthStateChanged(user=>{
    byId('loginBtn').textContent = user ? 'Logout' : 'Login with Google';
    renderAll(); loadMine(); renderAdmin();
  });

  // Filters
  byId('filterCategory').addEventListener('change', renderAll);
  byId('searchInput').addEventListener('input', ()=>{ clearTimeout(window.__t); window.__t=setTimeout(renderAll,150); });

  function applyFilters(list){
    const cat = byId('filterCategory').value;
    const q = byId('searchInput').value.trim().toLowerCase();
    return list.filter(p=>{
      if(cat && p.category!==cat) return false;
      if(q && !(p.name||'').toLowerCase().includes(q)) return false;
      return true;
    });
  }

  async function uploadToImgBB(file){
    const body = new FormData();
    body.append('key', IMGBB_KEY);
    body.append('image', file);
    const res = await fetch('https://api.imgbb.com/1/upload', { method:'POST', body });
    const data = await res.json();
    if(!data || !data.data || !data.data.display_url) throw new Error('ImgBB upload failed');
    return data.data.display_url;
  }

  async function uploadMultiple(files){
    const list = Array.from(files).slice(0,5);
    const out=[];
    for(const f of list){ out.push(await uploadToImgBB(f)); }
    return out;
  }

  // Submit Shopkeeper offer (Amazon included)
  let submitting=false;
  byId('submitProduct').onclick = async()=>{
    if(submitting) return;
    const u = auth.currentUser; if(!u){ alert('Please login first'); return; }
    const name = byId('pName').value.trim();
    const category = byId('pCategory').value.trim();
    const price = Number(byId('pPrice').value);
    const discount = Number(byId('pDiscount').value||0);
    const whats = byId('pWhats').value.trim();
    const desc = byId('pDesc').value.trim();
    const amazon = byId('pAmazon').value.trim(); // ← Amazon
    const files = byId('pImages').files;

    if(!name || !category || !price || !whats || !files.length){
      toast(byId('formMsg'),'Please fill all required fields*');
      return;
    }
    submitting=true; byId('submitProduct').disabled=true;
    byId('formMsg').textContent = 'Uploading images…';
    try{
      const images = await uploadMultiple(files);
      const id = productsRef.push().key;
      const item = { id, name, category, price, discount, desc, images, whats, amazon, owner: u.email, status:'pending', sold:false, createdAt: Date.now() };
      await productsRef.child(id).set(item);
      byId('formMsg').textContent = 'Product uploaded!';
      document.querySelector('form').reset();
      submitting=false; byId('submitProduct').disabled=false;
      ALL.push(item); renderAll();
    }catch(e){ console.error(e); toast(byId('formMsg'), 'Upload failed'); submitting=false; byId('submitProduct').disabled=false; }
  };

  productsRef.on('value',snap=>{
    ALL = snap.exists() ? Object.values(snap.val()) : [];
    renderAll(); renderAdmin();
  });

  // Create Amazon button
  function getAmazonBtn(p){
    if(!p.amazon) return '';
    return `<a class="btn-3d px-3 py-2 rounded-xl bg-blue-600 font-bold" target="_blank" href="${p.amazon}">Amazon</a>`;
  }

  function makeCard(p){
    const sold = p.sold;
    const adminBtns = '';
    const shopBtns = '';
    const amazonBtn = getAmazonBtn(p);
    const el = document.createElement('div');
    el.className='card-3d p-3 mb-4';
    el.innerHTML=`
      <img src="${p.images?.[0]||''}" class="gal-img rounded-xl cursor-pointer" onclick="openModal('${p.id}')"/>
      ${sold?'<div class="badge badge-sold">Sold</div>':''}
      <h3 class="mt-2 font-bold text-lg">${clean(p.name)}</h3>
      <p>${p.desc||''}</p>
      <div class="mt-2 flex gap-2 flex-wrap">
        <a class="btn-3d px-3 py-2 rounded-xl bg-green-600 font-bold" href="https://wa.me/${p.whats}" target="_blank">${sold?'Sold':'WhatsApp'}</a>
        ${amazonBtn}
        ${adminBtns}
        ${shopBtns}
      </div>
    `;
    return el;
  }

  function renderAll(){
    const container = byId('productsContainer');
    container.innerHTML='';
    const list = applyFilters(ALL).sort((a,b)=>b.createdAt-a.createdAt);
    list.forEach(p=>container.appendChild(makeCard(p)));
  }

  function openModal(id){
    const p = ALL.find(x=>x.id===id); if(!p) return;
    const amazonBtn = getAmazonBtn(p);
    byId('modalCard').innerHTML=`
      <img src="${p.images?.[0]||''}" class="w-full max-h-[400px] object-contain"/>
      <div class="p-4">
        <h2 class="text-xl font-bold">${clean(p.name)}</h2>
        <p>${p.desc||''}</p>
        <p class="mt-1 font-semibold">${rupees(p.price)} ${p.discount?`(-${p.discount}%)`:''}</p>
        <div class="mt-3 flex gap-2 flex-wrap">
          <a class="btn-3d px-3 py-2 rounded-xl bg-green-600 font-bold" href="https://wa.me/${p.whats}" target="_blank">${p.sold?'Sold':'WhatsApp'}</a>
          ${amazonBtn}
        </div>
      </div>
    `;
    byId('modal').classList.add('show');
  }

  byId('modal').onclick=e=>{ if(e.target.id==='modal') byId('modal').classList.remove('show'); };

</script>
</body>
</html>
