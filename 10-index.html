<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="ZaraFix ‡§™‡§∞ ‡§∏‡§≠‡•Ä Service Providers ‡§ï‡•Ä ‡§∏‡•Ç‡§ö‡•Ä‡•§ Doctors, Hospitals, Ambulance, Shops, Electricians, Plumbers ‡§Ü‡§¶‡§ø ‡§ñ‡•ã‡§ú‡•á‡§Ç‡•§">
  <meta name="google-site-verification" content="747ecEujhHluFPpMSv_v2bkpZ7IT6pbVqDW1XrpEQBo" />
  <title>All Service Provider Portal</title>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <style>

/* Card design */
.card {
  background: #ffffff;
  border-radius: 12px;
  padding: 16px;
  margin: 12px;
  box-shadow: 0 6px 15px rgba(0,0,0,0.2);
  transition: transform 0.3s, background-color 0.3s, box-shadow 0.3s;
  cursor: pointer;
  font-size: 13px;
}
/* Hover effect */
.card:hover {
  background-color: #d1f0ff;   /* hover ‡§™‡§∞ ‡§π‡§≤‡•ç‡§ï‡§æ ‡§®‡•Ä‡§≤‡§æ */
  transform: scale(1.03);
  box-shadow: 0 8px 18px rgba(0,0,0,0.3);
}


/* ‡§Ö‡§≤‡§ó-‡§Ö‡§≤‡§ó color cards */
.card:nth-child(1) { background-color: #ffe4e1; }
.card:nth-child(2) { background-color: #e6ffe6; }
.card:nth-child(3) { background-color: #e6f0ff; }
.card:nth-child(4) { background-color: #fff0e6; }

/* ‡§∏‡§ø‡§∞‡•ç‡§´ testing ‡§ï‡•á ‡§≤‡§ø‡§è (optional) */
.debugCard {
  border: 2px solid red;
}

/* Image fix */
.card img {
  width: 100%;
  height: 150px;
  object-fit: contain;
  border-radius: 6px;
  background: #000;
}

/* Grid */
.grid { 
  display: grid; 
  grid-template-columns: repeat(auto-fit,minmax(220px,1fr));
  gap: 12px; 
  padding: 12px; 
}


    
    body { margin:0; font-family:Arial, sans-serif; background:#f5f5f5; }
    header { background:linear-gradient(135deg,#2196F3,#21CBF3); color:white;
             display:flex; align-items:center; justify-content:space-between;
             padding:10px 20px; box-shadow:0 3px 8px rgba(0,0,0,0.3); flex-wrap:wrap; }
    header h1 { margin:0; font-size:20px; text-shadow:1px 1px 3px #000; }
    button { cursor:pointer; padding:6px 10px; border:none; border-radius:6px;
             box-shadow:0 3px 5px rgba(0,0,0,0.25); font-weight:bold; margin:3px; font-size:13px; }
    .btn3d { background:#4CAF50; color:#fff; }
    .btn3d:disabled { background:#999; box-shadow:none; }
    .logoutBtn { background:#E53935; color:#fff; }
    .waBtn { background:#25D366; color:#fff; }
    .newPostBtn { background:#FF9800; color:#fff; margin-left:10px; }

    /* Search Bar */
    .searchBar {
      margin:12px;
      display:flex;
      justify-content:center;
      align-items:center;
      gap:10px;
    }
    .searchBar input {
      padding:8px; border-radius:6px; border:1px solid #ccc; font-size:14px; min-width:220px;
    }

    /* Grid */
   /* Grid */
.grid { 
  display:grid; 
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:12px; 
  padding:12px; 
}


   
    .card h3 { margin:6px 0 3px; font-size:15px; }
    .card p { margin:1px 0; font-size:13px; }

    .pending { background:#ffcdd2; border:2px solid #f44336; animation:blinkBorder 1s infinite; }
    @keyframes blinkBorder { 50% { border-color:#b71c1c; } }

    .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%;
             background:rgba(0,0,0,0.6); align-items:center; justify-content:center; }
    .modal-content { background:#fff; padding:15px; border-radius:10px; width:90%; max-width:420px;
                     max-height:90%; overflow:auto; position:relative; font-size:14px; }
    .close { position:absolute; top:8px; right:12px; cursor:pointer; font-weight:bold; font-size:18px; }
    form label { font-size:13px; font-weight:bold; margin-top:6px; display:block; }
    form input { width:100%; padding:5px; margin:3px 0 8px;
                 border:1px solid #ccc; border-radius:6px; font-size:13px; }
    .btnRow { margin-top:6px; display:flex; flex-wrap:wrap; gap:5px; }
  </style>
</head>
<body>
<header>
  <h1>All Service Providers</h1>
  <div>
    <a href="index.html">
      <button style="background-color:blue; color:white;">üè° Home</button>
    </a>
    <button id="loginBtn" style="background-color:#4ade80; color:white;">üîë Login</button>
    <button id="logoutBtn" style="display:none; background-color:#ef4444; color:white;">Logout</button>
    <button id="newPostBtn" style="display:none; background-color:#2563eb; color:white;">+ New Post</button>
  </div>
</header>

<!-- üîç Search Bar -->
<div class="searchBar">
  <input type="text" id="searchInput" placeholder="Search by name, category, address...">
</div>

<main>
  <div class="grid" id="posts"></div>
</main>

<!-- Post Form Modal -->
<div class="modal" id="postModal">
  <div class="modal-content">
    <span class="close" id="closeForm">&times;</span>
    <h2>Post Your Service</h2>
    <form id="postForm">
      
      <label>Service/Business Name</label>
      <input type="text" id="serviceName" required>
      
      <label>Service Category (Doctor, Hospital, Ambulance, Shop, Electrician, Plumber...)</label>
      <input type="text" id="serviceCategory" required>

      <label>Address</label>
      <input type="text" id="address" required>
      
      <label>Mobile/WhatsApp Number</label>
      <input type="tel" id="phone" required>
      
      <label>Upload Images (max 5)</label>
      <input type="file" id="images" accept="image/*" multiple>
      
      <button type="submit" class="btn3d">Submit Service</button>
    </form>
  </div>
</div>

<!-- Card View Modal -->
<div class="modal" id="cardModal">
  <div class="modal-content" id="cardContent">
    <span class="close" id="closeCard">&times;</span>
    <div class="modal-body"></div>
  </div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyD7ZqL-PVuFdd8rMVIyW7CgHQjPRGHD2h8",
  authDomain: "zara-fix-2e35a.firebaseapp.com",
  databaseURL: "https://zara-fix-2e35a-default-rtdb.firebaseio.com",
  projectId: "zara-fix-2e35a",
  storageBucket: "zara-fix-2e35a.appspot.com",
  messagingSenderId: "636550144008",
  appId: "1:636550144008:web:a849496ad1d1557d7ab1bd"
};
  
firebase.initializeApp(firebaseConfig);
const auth=firebase.auth();
const db=firebase.database();

const loginBtn=document.getElementById('loginBtn');
const logoutBtn=document.getElementById('logoutBtn');
const newPostBtn=document.getElementById('newPostBtn');
const postModal=document.getElementById('postModal');
const closeForm=document.getElementById('closeForm');
const postForm=document.getElementById('postForm');
const postsDiv=document.getElementById('posts');
const cardModal=document.getElementById('cardModal');
const cardContent=document.getElementById('cardContent');
const closeCard=document.getElementById('closeCard');
const searchInput=document.getElementById('searchInput');

let currentUser=null;
let allPosts=[];

loginBtn.onclick=()=>{ const provider=new firebase.auth.GoogleAuthProvider(); auth.signInWithPopup(provider); };
logoutBtn.onclick=()=>auth.signOut();

auth.onAuthStateChanged(u=>{
  currentUser=u;
  if(u){
    loginBtn.style.display="none";
    logoutBtn.style.display="inline-block";
    newPostBtn.style.display="inline-block";
  } else {
    loginBtn.style.display="inline-block";
    logoutBtn.style.display="none";
    newPostBtn.style.display="none";
  }
  loadPosts();
});

newPostBtn.onclick=()=>postModal.style.display="flex";
closeForm.onclick=()=>postModal.style.display="none";
closeCard.onclick=()=>cardModal.style.display="none";

// Upload images via ImgBB
async function uploadImages(files) {
  const urls = [];
  const apiKey = "cad1f0dbfbd25346460789376cc2d7d5";
  for (let i = 0; i < Math.min(5, files.length); i++) {
    const f = files[i];
    const fd = new FormData();
    fd.append("image", f);
    try {
 const r = await fetch("https://api.imgbb.com/1/upload?key=cad1f0dbfbd25346460789376cc2d7d5", {method:"POST", body:fd});
      const j = await r.json();
      if (j && j.data && j.data.url) urls.push(j.data.url);
    } catch (err) { console.error("Upload failed", err); }
  }
  return urls;
}

// Post submit
postForm.onsubmit=async e=>{
  e.preventDefault();
  if(!currentUser) return alert("Login first");
  const submitBtn=postForm.querySelector("button[type=submit]");
  submitBtn.disabled=true; submitBtn.textContent="‚è≥ Submitting...";

  const post = {
    serviceName: document.getElementById('serviceName').value,
    serviceCategory: document.getElementById('serviceCategory').value,
    address: document.getElementById('address').value,
    phone: document.getElementById('phone').value,
    posterUid: currentUser.uid,
    posterName: currentUser.displayName,
    posterEmail: currentUser.email,
    status: "pending",
    created: Date.now()
  };

  const files=document.getElementById('images').files;
  if(files.length>0) post.images=await uploadImages(files);

  db.ref("posts").push(post,(err)=>{
    if(err){ alert("‚ùå Error"); }
    else{ alert("‚úÖ Post submitted! Waiting for approval."); postForm.reset(); postModal.style.display="none"; }
    submitBtn.disabled=false; submitBtn.textContent="Submit Service";
  });
};

// Load posts
function loadPosts(){
  db.ref("posts").orderByChild("created").on("value",snap=>{
    allPosts=[];
    snap.forEach(ch=>{ allPosts.push({...ch.val(), id:ch.key}); });
    allPosts.reverse();
    renderPosts();
  });
}

// Render posts
function renderPosts() {
  postsDiv.innerHTML = "";
  const keyword = searchInput.value.toLowerCase();

  allPosts.forEach(p => {
    // Admin sees all, others only approved or their own
    if (currentUser?.email !== "zarasamajiksevasanstha@gmail.com") {
      if (p.status !== "approved" && (!currentUser || p.posterUid !== currentUser.uid)) return;
    }

    if (keyword && !(
      p.serviceName?.toLowerCase().includes(keyword) ||
      p.serviceCategory?.toLowerCase().includes(keyword) ||
      p.address?.toLowerCase().includes(keyword)
    )) return;

    const card = document.createElement("div");
    card.className = "card";
    if (p.status === "pending") card.classList.add("pending");
    if (p.status === "rejected") card.style.background = "#ffe0b2";

    if (p.images && p.images.length) {
      const img = document.createElement("img");
      img.src = p.images[0];
      card.appendChild(img);
    }

    card.innerHTML += `
      <h3>üìå ${p.serviceName}</h3>
      <p>üè∑Ô∏è ${p.serviceCategory}</p>
      <p>üìç ${p.address}</p>
      <p>üìû ${p.phone}</p>
      <p>üë§ ${p.posterName}</p>
      <p>${p.status === "approved" ? "‚úÖ Approved" : p.status === "rejected" ? "‚ùå Rejected" : "‚è≥ Pending Approval"}</p>
    `;

    const btnRow = document.createElement("div");
    btnRow.className = "btnRow";

    const waBtn = document.createElement("button");
    waBtn.textContent = "üí¨ WhatsApp";
    waBtn.className = "waBtn";
    waBtn.onclick = e => {
      e.stopPropagation();
      const msg = `send by-ZARA FIX - Hello, I want to know more about your service: ${p.serviceName} (${p.serviceCategory}) at ${p.address}.`;
      window.open(`https://wa.me/${p.phone}?text=${encodeURIComponent(msg)}`, "_blank");
    };
    btnRow.appendChild(waBtn);

    if (currentUser && currentUser.email === "zarasamajiksevasanstha@gmail.com") {
      const apBtn = document.createElement("button");
      apBtn.textContent = "‚úÖ Approve";
      apBtn.className = "btn3d";
      apBtn.onclick = async e => { e.stopPropagation(); await db.ref("posts/" + p.id).update({status:"approved"}); };

      const rjBtn = document.createElement("button");
      rjBtn.textContent = "‚ùå Reject";
      rjBtn.className = "logoutBtn";
      rjBtn.onclick = async e => { e.stopPropagation(); await db.ref("posts/" + p.id).update({status:"rejected"}); };

      const delBtn = document.createElement("button");
      delBtn.textContent = "üóë Delete";
      delBtn.className = "logoutBtn";
      delBtn.onclick = async e => { e.stopPropagation(); if(confirm("Delete permanently?")) await db.ref("posts/"+p.id).remove(); };

      btnRow.appendChild(apBtn);
      btnRow.appendChild(rjBtn);
      btnRow.appendChild(delBtn);
    }

    card.appendChild(btnRow);

    card.onclick = () => {
      cardContent.querySelector('.modal-body').innerHTML = `
        <h2>${p.serviceName}</h2>
        <p><b>Category:</b> ${p.serviceCategory}</p>
        <p><b>Address:</b> ${p.address}</p>
        <p><b>Phone:</b> ${p.phone}</p>
      `;
      cardModal.style.display = "flex";
    };

    postsDiv.appendChild(card);
  });
}

searchInput.addEventListener("input",renderPosts);
</script>
</body>
</html>
