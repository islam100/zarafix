<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ZaraFix - Service Provider Portal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      margin: 0; padding: 0;
    }
    .container { max-width: 800px; margin: auto; padding: 20px; }
    .hidden { display: none; }

    button {
      background: linear-gradient(45deg, #007bff, #00c6ff);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      margin: 5px;
      transition: 0.3s;
    }
    button:hover { transform: scale(1.05); }

    .card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      margin: 15px 0;
      padding: 15px;
    }
    .card img {
      width: 100%;
      max-height: 200px;
      object-fit: contain;
      border-radius: 8px;
    }
    .wallet-box {
      background: #eaf7ff;
      padding: 10px;
      border-radius: 8px;
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <div class="container">

    <!-- Login Section -->
    <div id="loginSection">
      <h2>Login to Continue</h2>
      <button onclick="googleLogin()">Login with Google</button>
    </div>

    <!-- Wallet Section (Only After Login) -->
    <div id="walletSection" class="hidden">
      <h3>Your Wallet</h3>
      <div class="wallet-box">
        Balance: ₹<span id="walletBalance">0</span>
      </div>
      <button onclick="requestRecharge()">Recharge ₹100</button>
      <button onclick="logout()">Logout</button>
    </div>

    <!-- Post Form -->
    <div id="formSection" class="hidden">
      <h2>Post Your Service</h2>
      <form id="postForm">
        <input type="text" id="serviceName" placeholder="Service / Business Name" required><br><br>
        <input type="text" id="serviceCategory" placeholder="Service Category" required><br><br>
        <input type="text" id="serviceAddress" placeholder="Full Address" required><br><br>
        <input type="text" id="whatsapp" placeholder="WhatsApp Number" required><br><br>
        <input type="text" id="hours" placeholder="Service Hours (e.g. 9AM - 6PM)" required><br><br>
        <input type="file" id="photos" multiple><br><br>
        <button type="submit">Submit Service</button>
      </form>
    </div>

    <!-- Listings -->
    <div id="listingSection" class="hidden">
      <h2>Service Listings</h2>
      <div id="listingCards"></div>
    </div>

  </div>

<script>
  // Firebase Config (replace with your own)
const firebaseConfig = {
  apiKey: "AIzaSyD7ZqL-PVuFdd8rMVIyW7CgHQjPRGHD2h8",
  authDomain: "zara-fix-2e35a.firebaseapp.com",
  databaseURL: "https://zara-fix-2e35a-default-rtdb.firebaseio.com",
  projectId: "zara-fix-2e35a",
  storageBucket: "zara-fix-2e35a.appspot.com",
  messagingSenderId: "636550144008",
  appId: "1:636550144008:web:a849496ad1d1557d7ab1bd"
};

  firebase.initializeApp(firebaseConfig);

  const auth = firebase.auth();
  const db = firebase.database();
  let currentUser = null;

  // Google Login
  function googleLogin() {
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider).then(res => {
      console.log("Logged in:", res.user);
    }).catch(err => alert(err.message));
  }

  // Logout
  function logout() {
    auth.signOut();
  }

  // Auth State Change
  auth.onAuthStateChanged(user => {
    if (user) {
      currentUser = user;
      document.getElementById("loginSection").classList.add("hidden");
      document.getElementById("walletSection").classList.remove("hidden");
      document.getElementById("formSection").classList.remove("hidden");
      document.getElementById("listingSection").classList.remove("hidden");
      loadWallet();
      loadListings();
    } else {
      currentUser = null;
      document.getElementById("loginSection").classList.remove("hidden");
      document.getElementById("walletSection").classList.add("hidden");
      document.getElementById("formSection").classList.add("hidden");
      document.getElementById("listingSection").classList.add("hidden");
    }
  });

  // Wallet
  function loadWallet() {
    db.ref("wallets/" + currentUser.uid).on("value", snap => {
      let bal = snap.val() ? snap.val().balance : 0;
      document.getElementById("walletBalance").innerText = bal;
    });
  }

  function requestRecharge() {
    db.ref("recharges").push({
      userId: currentUser.uid,
      amount: 100,
      status: "pending",
      time: Date.now()
    });
    alert("Recharge request sent!");
  }

  // Post Form
  document.getElementById("postForm").addEventListener("submit", e => {
    e.preventDefault();
    const data = {
      userId: currentUser.uid,
      name: document.getElementById("serviceName").value,
      category: document.getElementById("serviceCategory").value,
      address: document.getElementById("serviceAddress").value,
      whatsapp: document.getElementById("whatsapp").value,
      hours: document.getElementById("hours").value,
      status: "pending",
      createdAt: Date.now()
    };
    db.ref("listings").push(data);
    alert("Service submitted! Waiting for approval.");
    document.getElementById("postForm").reset();
  });

  // Load Listings
  function loadListings() {
    db.ref("listings").on("value", snap => {
      const container = document.getElementById("listingCards");
      container.innerHTML = "";
      snap.forEach(child => {
        const item = child.val();
        if (item.status === "approved" || (item.userId === currentUser.uid)) {
          let card = `
            <div class="card">
              <h3>${item.name}</h3>
              <p><b>Category:</b> ${item.category}</p>
              <p><b>Address:</b> ${item.address}</p>
              <p><b>Hours:</b> ${item.hours}</p>
              <p><b>WhatsApp:</b> ${item.whatsapp}</p>
              <small>Status: ${item.status}</small>
            </div>
          `;
          container.innerHTML += card;
        }
      });
    });
  }
</script>
</body>
</html>
