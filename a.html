<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zara Property Listing</title>
<style>
  body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f2f2f2;}
  header { display:flex; justify-content:space-between; align-items:center; padding:10px 20px; background:#1e90ff; color:white;}
  header h1 { margin:0; font-size:1.5rem; text-shadow: 2px 2px 4px #000; }
  .btn { padding:10px 20px; margin:5px; border:none; cursor:pointer; border-radius:10px; font-weight:bold; box-shadow: 3px 3px 5px #888; }
  .btn-3d { box-shadow: 3px 3px 6px #555; }
  .btn-approve { background:green; color:white;}
  .btn-delete { background:red; color:white;}
  .btn-login { background:#fff; color:#1e90ff; }
  #propertyForm, #properties, #adminPanel { padding:20px; max-width:1200px; margin:auto;}
  .property-card { background:white; margin:10px; padding:10px; border-radius:10px; display:inline-block; width:250px; vertical-align:top; box-shadow: 3px 3px 5px #aaa;}
  .property-card img { width:100%; border-radius:10px; height:150px; object-fit:cover; }
  .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); justify-content:center; align-items:center;}
  .modal-content { background:white; padding:20px; border-radius:10px; max-width:500px; width:90%;}
</style>
</head>
<body>

<header>
  <h1>Zara Property Listing</h1>
  <button class="btn btn-login" id="googleLoginBtn">Admin Login</button>
</header>

<!-- Poster Form -->
<section id="propertyForm">
  <h2>Post Property</h2>
  <form id="newPropertyForm">
    <input type="text" id="title" placeholder="Title" required><br><br>
    <input type="text" id="city" placeholder="City" required><br><br>
    <select id="type" required>
      <option value="">Select Type</option>
      <option value="sale">Sale</option>
      <option value="rent">Rent</option>
    </select><br><br>
    <input type="number" id="price" placeholder="Price" required><br><br>
    <input type="text" id="whatsapp" placeholder="WhatsApp Number" required><br><br>
    <textarea id="description" placeholder="Description" required></textarea><br><br>
    <input type="file" id="image" accept="image/*" required><br><br>
    <button type="submit" class="btn btn-3d">Post Property</button>
  </form>
</section>

<!-- Properties Listing -->
<section id="properties">
  <h2>Properties</h2>
  <div id="propertyList"></div>
</section>

<!-- Admin Panel -->
<section id="adminPanel" style="display:none;">
  <h2>Admin Panel</h2>
  <div id="adminPropertyList"></div>
</section>

<!-- Modal -->
<div id="modal" class="modal">
  <div class="modal-content">
    <span id="modalClose" style="cursor:pointer; float:right;">&times;</span>
    <div id="modalBody"></div>
  </div>
</div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, push, onValue, update, remove } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";
import { getStorage, ref as sRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-storage.js";
import { getAuth, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyDTj2n1yhr1sFmuyBZ-jUwOmx1YqAN5QjA",
  authDomain: "property-20d6d.firebaseapp.com",
  databaseURL: "https://property-20d6d-default-rtdb.firebaseio.com",
  projectId: "property-20d6d",
  storageBucket: "property-20d6d.appspot.com",
  messagingSenderId: "916859697394",
  appId: "1:916859697394:web:2a8f9ad2d62f8306dcb86b"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const storage = getStorage(app);
const auth = getAuth(app);
const provider = new GoogleAuthProvider();

const googleLoginBtn = document.getElementById('googleLoginBtn');
const adminPanel = document.getElementById('adminPanel');

let currentAdmin = null;

// Google login
googleLoginBtn.addEventListener('click', async ()=>{
  const result = await signInWithPopup(auth, provider);
  const user = result.user;
  const adminCheck = ref(db, 'admins/' + user.email.replace('.',','));
  onValue(adminCheck, (snap)=>{
    if(snap.exists() && snap.val()===true){
      currentAdmin = user.email;
      alert('Admin logged in');
      adminPanel.style.display = 'block';
    } else {
      alert('You are not admin');
    }
  }, {onlyOnce:true});
});

// Post Property
const newPropertyForm = document.getElementById('newPropertyForm');
newPropertyForm.addEventListener('submit', async (e)=>{
  e.preventDefault();
  const title = document.getElementById('title').value;
  const city = document.getElementById('city').value;
  const type = document.getElementById('type').value;
  const price = document.getElementById('price').value;
  const whatsapp = document.getElementById('whatsapp').value;
  const description = document.getElementById('description').value;
  const file = document.getElementById('image').files[0];

  const storageReference = sRef(storage, 'images/'+Date.now()+file.name);
  await uploadBytes(storageReference, file);
  const imageUrl = await getDownloadURL(storageReference);

  push(ref(db, 'properties'), {
    title, city, type, price, whatsapp, description, imageUrl, approved:false, timestamp:Date.now()
  });

  newPropertyForm.reset();
  alert('Property posted, waiting for admin approval');
});

// Display Properties
const propertyList = document.getElementById('propertyList');
const adminPropertyList = document.getElementById('adminPropertyList');

onValue(ref(db,'properties'), (snapshot)=>{
  propertyList.innerHTML='';
  adminPropertyList.innerHTML='';
  snapshot.forEach(snap=>{
    const data = snap.val();
    const key = snap.key;
    if(data.approved){
      propertyList.innerHTML += `
      <div class="property-card">
        <img src="${data.imageUrl}" alt="${data.title}">
        <h3>${data.title}</h3>
        <p>${data.city} | ${data.type} | ₹${data.price}</p>
        <p>${data.description}</p>
        <a href="https://wa.me/${data.whatsapp}" target="_blank" class="btn btn-3d">WhatsApp</a>
      </div>`;
    }
    if(!data.approved && currentAdmin){
      adminPropertyList.innerHTML += `
      <div class="property-card">
        <img src="${data.imageUrl}" alt="${data.title}">
        <h3>${data.title}</h3>
        <p>${data.city} | ${data.type} | ₹${data.price}</p>
        <p>${data.description}</p>
        <a href="https://wa.me/${data.whatsapp}" target="_blank" class="btn btn-3d">WhatsApp</a><br><br>
        <button class="btn btn-approve" onclick="approveProperty('${key}')">Approve</button>
        <button class="btn btn-delete" onclick="deleteProperty('${key}')">Delete</button>
      </div>`;
    }
  });
});

// Approve/Delete functions
window.approveProperty = (key)=>{
  update(ref(db,'properties/'+key), {approved:true});
}
window.deleteProperty = (key)=>{
  remove(ref(db,'properties/'+key));
}

</script>

</body>
</html>
