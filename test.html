<!DOCTYPE html>
<html>
<head>
  <title>ğŸ”§ ZaraFix Admin Dashboard - Requests</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Arial; background: #f4f4f4; padding: 10px; }
    .card {
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      margin: 15px 0;
      padding: 15px;
    }
    .accepted-card {
      background: #e0ffe0;
      padding: 10px;
      margin-top: 10px;
      border-left: 4px solid green;
    }
    button {
      background: red;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 5px;
    }
  </style>
</head>
<body>
  <h2>ğŸ”§ ZaraFix Admin Dashboard - Requests</h2>
  <div id="requestList">Loading...</div>

  <!-- Firebase Scripts -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, onValue, remove } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD7ZqL-PVuFdd8rMVIyW7CgHQjPRGHD2h8",
      authDomain: "zara-fix-2e35a.firebaseapp.com",
      projectId: "zara-fix-2e35a",
      storageBucket: "zara-fix-2e35a.appspot.com",
      messagingSenderId: "636550144008",
      appId: "1:636550144008:web:a849496ad1d1557d7ab1bd"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const requestList = document.getElementById("requestList");

    const requestsRef = ref(db, "requests");
    onValue(requestsRef, (snapshot) => {
      requestList.innerHTML = "";
      const data = snapshot.val();
      if (!data) {
        requestList.innerHTML = "No requests found.";
        return;
      }

      Object.keys(data).forEach((userId) => {
        const userRequests = data[userId];
        Object.keys(userRequests).forEach((reqKey) => {
          const req = userRequests[reqKey];
          const card = document.createElement("div");
          card.className = "card";

          card.innerHTML = `
            <h3>ğŸ§¾ ${req.name || "Unnamed"}</h3>
            <p>ğŸ“ ${req.address || "No address"}</p>
            <p>ğŸ“± WhatsApp: ${req.whatsapp || "N/A"}</p>
            <button onclick="deleteRequest('${userId}', '${reqKey}')">âŒ Delete</button>
          `;

          // AcceptedBy Details
          if (req.acceptedBy) {
            const acceptDiv = document.createElement("div");
            acceptDiv.className = "accepted-card";

            acceptDiv.innerHTML = `<h4>âœ… Accepted By:</h4>`;
            Object.keys(req.acceptedBy).forEach(uid => {
              const poster = req.acceptedBy[uid];
              acceptDiv.innerHTML += `
                <p>ğŸ‘¤ Name: ${poster.name || "N/A"}</p>
                <ğŸª> Shop: ${poster.shop || "N/A"}</p>
                <p>ğŸ“ Address: ${poster.address || "N/A"}</p>
                <p>ğŸ“± WhatsApp: ${poster.whatsapp || "N/A"}</p>
                <p>ğŸ†” UID: ${uid}</p>
                <hr>
              `;
            });

            card.appendChild(acceptDiv);
          }

          requestList.appendChild(card);
        });
      });
    });

    window.deleteRequest = function(userId, reqKey) {
      if (confirm("Are you sure you want to delete this request?")) {
        remove(ref(db, `requests/${userId}/${reqKey}`));
      }
    }
  </script>
</body>
</html>
