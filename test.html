<!DOCTYPE html>
<html>
<head>
  <title>ZaraFix All-in-One</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: sans-serif;
      background: #f0f8ff;
      margin: 0;
      padding: 20px;
    }

    select, input, button {
      display: block;
      margin: 10px auto;
      padding: 10px;
      width: 90%;
      max-width: 400px;
      border-radius: 10px;
      border: none;
      box-shadow: 2px 2px 6px #ccc;
      font-size: 16px;
    }

    .section {
      display: none;
    }

    .card {
      background: white;
      padding: 15px;
      margin: 10px auto;
      max-width: 400px;
      border-radius: 15px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    .btn-3d {
      background: linear-gradient(to right, #00c6ff, #0072ff);
      color: white;
      font-weight: bold;
      box-shadow: 0 5px 0 #0049b7;
      transition: 0.2s;
      cursor: pointer;
    }

    .btn-3d:active {
      transform: translateY(3px);
      box-shadow: 0 2px 0 #0049b7;
    }

    .whatsapp-btn {
      background: linear-gradient(to right, #25D366, #128C7E);
    }

    .admin-section {
      margin-top: 30px;
    }

    .hidden {
      display: none;
    }

  </style>
</head>
<body>

<h2>üõ†Ô∏è Welcome to ZaraFix</h2>

<select id="roleSelect">
  <option value="">üë§ Select Role</option>
  <option value="user">üßç User</option>
  <option value="provider">üß∞ Service Provider</option>
  <option value="admin">üëë Admin</option>
</select>

<!-- User Section -->
<div id="userSection" class="section">
  <h3>User Form</h3>
  <input id="u_name" placeholder="Your Name" />
  <input id="u_address" placeholder="Address" />
  <input id="u_problem" placeholder="Problem" />
  <input id="u_category" placeholder="Category (AC, Car, etc)" />
  <input id="u_whatsapp" placeholder="WhatsApp No" />
  <button class="btn-3d" onclick="submitUserRequest()">Submit Request</button>
</div>

<!-- Provider Section -->
<div id="providerSection" class="section">
  <h3>Service Provider Registration</h3>
  <input id="p_name" placeholder="Name" />
  <input id="p_address" placeholder="Address" />
  <input id="p_shop" placeholder="Shop Name" />
  <input id="p_category" placeholder="Category" />
  <input id="p_whatsapp" placeholder="WhatsApp No" />
  <button class="btn-3d" onclick="registerProvider()">Register</button>
  <div id="providerJobs"></div>
</div>

<!-- Admin Section -->
<div id="adminSection" class="section admin-section">
  <h3>Admin Panel</h3>
  <div id="adminContent">
    <h4>Service Providers</h4>
    <div id="adminProviders"></div>
    <h4>User Requests</h4>
    <div id="adminRequests"></div>
    <h4>Recharge Requests</h4>
    <div id="adminRecharges"></div>
  </div>
</div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyD7ZqL-PVuFdd8rMVIyW7CgHQjPRGHD2h8",
    authDomain: "zara-fix-2e35a.firebaseapp.com",
    projectId: "zara-fix-2e35a",
    storageBucket: "zara-fix-2e35a.appspot.com",
    messagingSenderId: "636550144008",
    appId: "1:636550144008:web:a849496ad1d1557d7ab1bd"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const uid = "QT3LkEToHwaiORatoKfTx8QE45s2"; // hardcoded for demo

  const roleSelect = document.getElementById("roleSelect");
  roleSelect.addEventListener("change", () => {
    document.querySelectorAll(".section").forEach(sec => sec.style.display = "none");
    const selected = roleSelect.value;
    if (selected === "user") document.getElementById("userSection").style.display = "block";
    if (selected === "provider") {
      document.getElementById("providerSection").style.display = "block";
      loadRequestsForProvider();
    }
    if (selected === "admin") {
      document.getElementById("adminSection").style.display = "block";
      loadAdminData();
    }
  });

  function submitUserRequest() {
    const name = document.getElementById("u_name").value;
    const address = document.getElementById("u_address").value;
    const problem = document.getElementById("u_problem").value;
    const category = document.getElementById("u_category").value;
    const whatsapp = document.getElementById("u_whatsapp").value;
    const request = { name, address, problem, category, whatsapp, status: "pending", timestamp: Date.now() };
    const newRef = db.ref("requests").push();
    newRef.set(request).then(() => {
      alert("Request submitted!");
      document.getElementById("userSection").reset();
    });
  }

  function registerProvider() {
    const name = document.getElementById("p_name").value;
    const address = document.getElementById("p_address").value;
    const shop = document.getElementById("p_shop").value;
    const category = document.getElementById("p_category").value;
    const whatsapp = document.getElementById("p_whatsapp").value;
    const provider = { name, address, shop, category, whatsapp, wallet: 100 };
    db.ref("posters/" + uid).set(provider).then(() => {
      alert("Registered");
    });
  }

  function loadRequestsForProvider() {
    db.ref("requests").once("value", snap => {
      const jobs = snap.val();
      const div = document.getElementById("providerJobs");
      div.innerHTML = "";
      for (let key in jobs) {
        const job = jobs[key];
        const html = `
          <div class="card">
            <b>${job.name}</b><br>${job.problem}<br>${job.category}<br>
            <button class="btn-3d whatsapp-btn" onclick="acceptJob('${key}', '${job.whatsapp}')">Accept & WhatsApp</button>
          </div>`;
        div.innerHTML += html;
      }
    });
  }

  function acceptJob(jobId, whatsapp) {
    db.ref("requests/" + jobId + "/acceptedBy").push({ uid, timestamp: Date.now() });
    alert("Job Accepted! WhatsApp: " + whatsapp);
    window.open("https://wa.me/91" + whatsapp, "_blank");
  }

  function loadAdminData() {
    // Providers
    db.ref("posters").once("value", snap => {
      const div = document.getElementById("adminProviders");
      div.innerHTML = "";
      for (let uid in snap.val()) {
        const p = snap.val()[uid];
        div.innerHTML += `<div class="card">${p.name} - ${p.category}<br>Wallet: ‚Çπ${p.wallet || 0}
        <button class="btn-3d" onclick="rechargeWallet('${uid}')">+‚Çπ100</button></div>`;
      }
    });

    // Requests
    db.ref("requests").once("value", snap => {
      const div = document.getElementById("adminRequests");
      div.innerHTML = "";
      for (let key in snap.val()) {
        const r = snap.val()[key];
        div.innerHTML += `<div class="card">${r.name} (${r.category})<br>${r.problem}<br>Accepted By: ${r.acceptedBy ? Object.keys(r.acceptedBy).length : 0}</div>`;
      }
    });
  }

  function rechargeWallet(uid) {
    db.ref("posters/" + uid + "/wallet").once("value", snap => {
      const curr = snap.val() || 0;
      db.ref("posters/" + uid).update({ wallet: curr + 100 });
      alert("Recharged ‚Çπ100");
      loadAdminData();
    });
  }

</script>
</body>
</html>
