<!doctype html>
<html lang="hi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ZaraFix — Home (updated)</title>
<style>
  :root{--accent:#4285F4;--admin:#28a745;--maxw:1100px}
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter, "Segoe UI", Arial, sans-serif;background:linear-gradient(180deg,#87ceeb,#e0f7ff);color:#032;min-height:100vh;display:flex;flex-direction:column;}
  header{max-width:var(--maxw);margin:12px auto;padding:8px 16px;display:flex;justify-content:space-between;align-items:center;gap:12px}
  .brand{display:flex;align-items:center;gap:12px}
  .logo{font-weight:900;color:#ef0400;text-shadow:2px 2px 0 #ffea00,4px 4px 0 #00f7ff;font-size:1.4rem;line-height:1}
  .tag{font-size:0.8rem;color:#053047;opacity:.95}
  /* single dropdown */
  .dropdown{position:relative}
  .dropbtn{background:#fff;border:0;padding:8px 10px;border-radius:8px;box-shadow:0 6px 14px rgba(0,0,0,0.12);cursor:pointer;font-weight:700}
  .menu{position:absolute;top:calc(100% + 8px);left:0;background:#fff;border-radius:8px;min-width:240px;padding:6px;box-shadow:0 8px 30px rgba(0,0,0,0.12);display:none;z-index:50}
  .menu.show{display:block}
  .menu a{display:block;padding:8px 10px;color:#033;text-decoration:none;border-radius:6px;font-weight:600}
  .menu a:hover{background:#f3f7fb}
  /* auth */
  .auth{display:flex;align-items:center;gap:8px}
  #loginBtn{background:var(--accent);color:#fff;border:0;padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:700;box-shadow:0 8px 18px rgba(0,0,0,0.12)}
  #avatar{width:36px;height:36px;border-radius:50%;display:none;object-fit:cover;border:2px solid #fff}
  #authMsg{font-size:0.85rem;color:#111;margin-left:8px}
  /* main */
  main{max-width:var(--maxw);margin:18px auto;padding:0 16px;flex:1}
  .hero{background:#fff;border-radius:14px;padding:12px;box-shadow:0 8px 30px rgba(0,0,0,0.12)}
  .slider{position:relative;width:100%;height:calc(60vw);max-height:420px;min-height:140px;border-radius:12px;overflow:hidden;background:#ddd}
  .slide{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;opacity:0;transform:scale(1.02);transition:opacity .6s ease,transform .6s ease}
  .slide.active{opacity:1;transform:scale(1);z-index:2}
  .slide img{width:100%;height:100%;object-fit:cover;display:block}
  .slide .del{position:absolute;top:8px;right:8px;background:rgba(255,255,255,0.9);border:0;padding:6px 8px;border-radius:8px;cursor:pointer;display:none;font-weight:700;box-shadow:0 4px 12px rgba(0,0,0,0.12);color:#b11}
  .slide.admin .del{display:inline-block}
  .uploader{display:flex;gap:10px;align-items:center;margin-top:12px}
  #uploadBtn{display:none;background:var(--admin);color:#fff;border:0;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:700}
  .note{font-size:0.85rem;color:#053047;opacity:.9}
  .small-row{display:flex;gap:8px;justify-content:center;margin-top:14px}
  .small-row button{padding:6px 10px;border-radius:8px;border:0;background:#007bff;color:#fff;cursor:pointer;font-size:.85rem}
  .marqWrap{margin-top:12px;background:rgba(255,255,255,0.95);padding:8px;border-radius:10px;overflow:hidden;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
  .marq{display:inline-block;white-space:nowrap;padding-left:100%;animation:marq 18s linear infinite;font-weight:700;color:#023}
  @keyframes marq{0%{transform:translateX(0)}100%{transform:translateX(-100%)}}
  @media (prefers-reduced-motion: reduce){.marq{animation:none;padding-left:12px}}
  @media(max-width:720px){header{padding:8px 12px}.logo{font-size:1.15rem}.slider{height:45vw;max-height:260px}}
  /* small error box */
  .errbox{color:#b11;background:rgba(255,230,230,0.9);padding:8px;border-radius:8px;margin-top:8px;display:none}
</style>
</head>
<body>

<header>
  <div class="brand">
    <div>
      <div class="logo">ZaraFix</div>
      <div class="tag">All Services — One Place</div>
    </div>

    <!-- SINGLE DROPDOWN -->
    <div class="dropdown" style="margin-left:12px;">
      <button class="dropbtn" id="menuBtn" aria-haspopup="true" aria-expanded="false">Menu ▾</button>
      <div class="menu" id="menu" role="menu" aria-hidden="true"></div>
    </div>
  </div>

  <div class="auth">
    <img id="avatar" alt="avatar" />
    <button id="loginBtn">Google Login</button>
    <div id="authMsg" aria-live="polite"></div>
  </div>
</header>

<main>
  <div class="hero">
    <div id="slider" class="slider" aria-roledescription="carousel" aria-live="polite">
      <div id="placeholder" style="padding:28px;color:#555;font-weight:700">No images yet. Admin can upload.</div>
    </div>

    <div class="uploader">
      <button id="uploadBtn" title="Upload images (admin only)">Upload Images (Admin)</button>
      <div class="note">Max per image: 5MB. Admin only.</div>
    </div>

    <div class="marqWrap" role="note" aria-live="polite" style="margin-top:12px">
      <div class="marq" id="marquee">Welcome to ZaraFix — All Services. Admin can update announcements.</div>
    </div>
    <div id="errorBox" class="errbox" role="alert"></div>
  </div>

  <div class="small-row" style="margin-top:14px;">
    <button id="b1">Btn1</button>
    <button id="b2">Btn2</button>
    <button id="b3">Btn3</button>
  </div>
</main>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>

<script>
/* ============ CONFIG ============ 
   बदलें अगर आपकी firebase config अलग है */
const firebaseConfig = {
  apiKey: "AIzaSyCH17_8W_UPmPt4KqpCaV7BpN6KsA4a67E",
  authDomain: "zara-fix.firebaseapp.com",
  databaseURL: "https://zara-fix.firebaseio.com",
  projectId: "zara-fix",
  storageBucket: "zara-fix.appspot.com",
  messagingSenderId: "916859697394",
  appId: "1:916859697394:web:0000000000000000"
};
firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.database();
const storage = firebase.storage();

/* ============ DOM refs & constants ============ */
const ADMIN_EMAIL = "zarasamajiksevasanstha@gmail.com";
const loginBtn = document.getElementById('loginBtn');
const avatar = document.getElementById('avatar');
const authMsg = document.getElementById('authMsg');
const uploadBtn = document.getElementById('uploadBtn');
const slider = document.getElementById('slider');
const placeholder = document.getElementById('placeholder');
const marquee = document.getElementById('marquee');
const menu = document.getElementById('menu');
const menuBtn = document.getElementById('menuBtn');
const errorBox = document.getElementById('errorBox');

const MAX_SIZE = 5 * 1024 * 1024;
const SLIDE_INTERVAL = 3500;

let slides = []; // {key,url,name,timestamp}
let carouselTimer = null;
let carouselIndex = 0;

/* ============ MENU: 8 links single dropdown ============ */
let links = [
  {text:'Home', href:'#'},
  {text:'Services', href:'#services'},
  {text:'Contact', href:'#contact'},
  {text:'About', href:'#about'},
  {text:'Offers', href:'#offers'},
  {text:'FAQ', href:'#faq'},
  {text:'Gallery', href:'#gallery'},
  {text:'Help', href:'#help'}
];

function renderMenu(){
  menu.innerHTML = '';
  links.forEach((l,i)=>{
    const a = document.createElement('a');
    a.href = l.href || '#';
    a.textContent = l.text || ('Link '+(i+1));
    menu.appendChild(a);
  });
}
renderMenu();

/* menu toggle */
menuBtn.addEventListener('click', e=>{
  const open = menu.classList.toggle('show');
  menuBtn.setAttribute('aria-expanded', open? 'true':'false');
  menu.setAttribute('aria-hidden', open? 'false':'true');
});
document.addEventListener('click', e=>{
  if(!e.target.closest('.dropdown')){
    menu.classList.remove('show');
    menuBtn.setAttribute('aria-expanded','false');
    menu.setAttribute('aria-hidden','true');
  }
});

/* ============ AUTH ============ */
async function signIn(){
  try{
    clearError();
    const provider = new firebase.auth.GoogleAuthProvider();
    const result = await auth.signInWithPopup(provider);
    // success handled in onAuthStateChanged
    console.log('Signed in:', result.user && result.user.email);
  }catch(err){
    console.error('Sign-in error:', err);
    showError('Login failed: ' + (err.message || err));
  }
}
async function signOut(){
  try{
    clearError();
    await auth.signOut();
  }catch(err){
    console.error('Sign-out error', err);
    showError('Logout failed: ' + (err.message || err));
  }
}

loginBtn.addEventListener('click', async ()=>{
  if(auth.currentUser) await signOut();
  else await signIn();
});

/* reflect auth state in UI */
auth.onAuthStateChanged(user=>{
  clearError();
  if(user){
    loginBtn.textContent = 'Logout';
    avatar.src = user.photoURL || '';
    avatar.style.display = user.photoURL ? 'inline-block' : 'none';
    authMsg.textContent = user.displayName ? `Hello, ${user.displayName}` : (user.email || '');
    // admin controls
    if((user.email||'').toLowerCase() === ADMIN_EMAIL.toLowerCase()){
      uploadBtn.style.display = 'inline-block';
    } else {
      uploadBtn.style.display = 'none';
    }
    // update slide delete visibility
    updateSlideAdminClasses();
  } else {
    loginBtn.textContent = 'Google Login';
    avatar.style.display = 'none';
    authMsg.textContent = '';
    uploadBtn.style.display = 'none';
    updateSlideAdminClasses();
  }
});

/* Helpful function to show user-friendly error near page */
function showError(msg){
  errorBox.style.display = 'block';
  errorBox.textContent = msg;
  // also log to console
  console.error(msg);
}
function clearError(){
  errorBox.style.display = 'none';
  errorBox.textContent = '';
}

/* ============ SLIDER: load, render, carousel, admin upload/delete ============ */
function listenSlides(){
  db.ref('sliderImages').on('value', snap=>{
    const val = snap.val();
    slides = [];
    if(val){
      Object.keys(val).forEach(k=>{
        slides.push(Object.assign({key:k}, val[k]));
      });
      slides.sort((a,b)=> (a.timestamp||0) - (b.timestamp||0));
    }
    renderSlides();
  }, err=>{
    console.error('DB slider listen error', err);
    showError('Error loading slider: ' + (err.message || err.code || ''));
  });
}
function renderSlides(){
  slider.innerHTML = '';
  if(!slides || slides.length === 0){
    slider.appendChild(placeholder);
    stopCarousel();
    return;
  }
  slides.forEach((it, idx)=>{
    const wrap = document.createElement('div');
    wrap.className = 'slide' + (idx===0? ' active' : '');
    wrap.dataset.key = it.key;
    const img = document.createElement('img'); img.src = it.url; img.alt = it.name || 'Slide image';
    const del = document.createElement('button'); del.className='del'; del.innerText='🗑️';
    del.title = 'Delete (admin only)';
    del.addEventListener('click', async (e)=>{
      e.stopPropagation();
      const user = auth.currentUser;
      if(!user || (user.email||'').toLowerCase() !== ADMIN_EMAIL.toLowerCase()){
        return alert('Only admin can delete images.');
      }
      if(!confirm('Delete this image?')) return;
      await deleteSlide(it.key, it.url);
    });
    wrap.appendChild(img);
    wrap.appendChild(del);
    slider.appendChild(wrap);
  });
  updateSlideAdminClasses();
  startCarousel();
}
function updateSlideAdminClasses(){
  const isAdmin = auth.currentUser && (auth.currentUser.email||'').toLowerCase() === ADMIN_EMAIL.toLowerCase();
  slider.querySelectorAll('.slide').forEach(s=>{
    if(isAdmin) s.classList.add('admin'); else s.classList.remove('admin');
  });
}
function startCarousel(){
  stopCarousel();
  const s = slider.querySelectorAll('.slide');
  if(s.length <= 1) return;
  carouselIndex = 0;
  carouselTimer = setInterval(()=>{
    const prev = carouselIndex;
    carouselIndex = (carouselIndex + 1) % s.length;
    s[prev].classList.remove('active');
    s[carouselIndex].classList.add('active');
  }, SLIDE_INTERVAL);
}
function stopCarousel(){ if(carouselTimer){ clearInterval(carouselTimer); carouselTimer = null; } }

async function deleteSlide(key, url){
  try{
    // try delete storage object (best-effort)
    try{ await storage.refFromURL(url).delete(); } catch(e){ console.warn('Storage delete failed', e.message||e); }
    await db.ref('sliderImages').child(key).remove();
    alert('Deleted.');
  }catch(e){ console.error(e); showError('Delete failed: ' + (e.message || e)); }
}

/* Admin upload - multiple files */
uploadBtn.addEventListener('click', ()=>{
  const user = auth.currentUser;
  if(!user || (user.email||'').toLowerCase() !== ADMIN_EMAIL.toLowerCase()){
    return alert('Only admin can upload.');
  }
  const inp = document.createElement('input'); inp.type='file'; inp.accept='image/*'; inp.multiple=true;
  inp.onchange = async ()=>{
    const files = Array.from(inp.files || []);
    if(files.length === 0) return;
    uploadBtn.disabled = true; uploadBtn.textContent = 'Uploading...';
    try{
      let uploaded = 0;
      for(const f of files){
        if(f.size > MAX_SIZE){ alert(`"${f.name}" बड़ा है (max 5MB). Skip करता हूँ.`); continue; }
        const safe = f.name.replace(/\s+/g,'_');
        const fileKey = 'slider_' + Date.now() + '_' + Math.floor(Math.random()*10000) + '_' + safe;
        const ref = storage.ref('sliderImages/' + fileKey);
        const snap = await ref.put(f);
        const url = await snap.ref.getDownloadURL();
        const newRef = db.ref('sliderImages').push();
        await newRef.set({ url, name: f.name, timestamp: firebase.database.ServerValue.TIMESTAMP});
        uploaded++;
      }
      if(uploaded) alert('Uploaded '+uploaded+' images');
      else alert('No images uploaded.');
    }catch(e){ console.error(e); showError('Upload failed: ' + (e.message || e)); }
    finally{ uploadBtn.disabled=false; uploadBtn.textContent='Upload Images (Admin)'; }
  };
  inp.click();
}

/* marquee text */
db.ref('marqueeText').on('value', snap=>{
  const v = snap.val(); if(v) marquee.textContent = v;
});

/* initial */
listenSlides();

/* helpful: log errors to UI if auth popup blocked or domain not authorized */
window.addEventListener('error', e=>{
  console.error('Global error', e);
});
window.addEventListener('unhandledrejection', e=>{
  console.error('Unhandled rejection', e.reason);
});

/* ============ Troubleshooting instructions shown in console (for you) ============ */
console.log('If login fails: 1) Check Firebase Console → Authentication → Sign-in method → enable Google. 2) Check Authentication → Authorized domains contains your domain (e.g., localhost or your deployed domain). 3) Open browser console to see detailed error message printed above. If error says "popup blocked", allow popups for this site.');

</script>
</body>
</html>
