<!DOCTYPE html>
<html>
<head>
  <title>Zara Admin Panel</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <style>
    body { font-family: Arial; padding: 20px; background: #f9f9f9; }
    h2 { color: #444; }
    .post { border: 1px solid #ccc; border-radius: 10px; padding: 10px; margin-bottom: 15px; background: #fff; box-shadow: 2px 2px 5px #ccc; }
    img { max-width: 200px; }
    button { margin: 5px; padding: 6px 10px; border: none; border-radius: 6px; background: #2196f3; color: white; cursor: pointer; }
    .pending { border: 2px solid red; }
  </style>
</head>
<body>
  <h2>üîß Zara Admin Panel</h2>
  <div id="postList">Loading posts...</div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyD7ZqL-PVuFdd8rMVIyW7CgHQjPRGHD2h8",
      authDomain: "zara-fix-2e35a.firebaseapp.com",
      projectId: "zara-fix-2e35a",
      databaseURL: "https://zara-fix-2e35a-default-rtdb.firebaseio.com",
      storageBucket: "zara-fix-2e35a.appspot.com",
      messagingSenderId: "636550144008",
      appId: "1:636550144008:web:a849496ad1d1557d7ab1bd"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function loadPosts() {
      db.ref("posts").once("value", (snapshot) => {
        const data = snapshot.val();
        const container = document.getElementById("postList");
        container.innerHTML = "";

        for (let key in data) {
          const post = data[key];
          const now = Date.now();
          const thirtyDays = 30 * 24 * 60 * 60 * 1000;
          const isExpired = now - post.timestamp > thirtyDays;
          const statusText = isExpired ? "‚õî Pending - Recharge Needed" : "‚úÖ Approved";
          const borderClass = isExpired ? "pending" : "";

          const postDiv = document.createElement("div");
          postDiv.className = `post ${borderClass}`;
          postDiv.innerHTML = `
            <h3>${post.title}</h3>
            <p><strong>User:</strong> ${post.user}</p>
            <p><strong>Mobile:</strong> ${post.mobile}</p>
            <p><strong>Status:</strong> ${statusText}</p>
            <img src="${post.image}" alt="Image" />
            <p>${post.description}</p>
            <p><strong>Date:</strong> ${new Date(post.timestamp).toLocaleString()}</p>
            <div>
              <button onclick="approvePost('${key}')">Approve</button>
              <button onclick="sendWhatsApp('${post.mobile}', '${post.title}')">Send Reminder</button>
            </div>
          `;
          container.appendChild(postDiv);
        }
      });
    }

    function approvePost(key) {
      db.ref("posts/" + key).update({
        timestamp: Date.now(),
        status: "approved"
      }).then(() => {
        alert("‚úÖ Post Approved!");
        loadPosts();
      });
    }

    function sendWhatsApp(mobile, title) {
      const msg = `‚ö†Ô∏è Dear User, your post "${title}" has expired. Please recharge to continue displaying.`;
      const url = `https://wa.me/91${mobile}?text=${encodeURIComponent(msg)}`;
      window.open(url, '_blank');
    }

    loadPosts();
  </script>
</body>
</html>
