<!doctype html>
<html lang="hi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ZaraFix â€” Home</title>
<style>
  :root{
    --accent:#4285F4;
    --admin:#28a745;
    --maxw:1100px;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter, "Segoe UI", Arial, sans-serif;background:linear-gradient(180deg,#87ceeb,#e0f7ff);color:#032;min-height:100vh;display:flex;flex-direction:column;}
  header{max-width:var(--maxw);margin:12px auto;padding:8px 16px;display:flex;justify-content:space-between;align-items:center;gap:12px}
  .brand{display:flex;align-items:center;gap:12px}
  .logo{font-weight:900;color:#ef0400;text-shadow:2px 2px 0 #ffea00,4px 4px 0 #00f7ff;font-size:1.4rem;line-height:1}
  .tag{font-size:0.8rem;color:#053047;opacity:.95}
  /* dropdowns next to logo */
  .menu-row{display:flex;gap:8px;align-items:center}
  .dropdown{position:relative}
  .dropbtn{background:#fff;border:0;padding:8px 10px;border-radius:8px;box-shadow:0 6px 14px rgba(0,0,0,0.12);cursor:pointer;font-weight:700}
  .menu{position:absolute;top:calc(100% + 8px);left:0;background:#fff;border-radius:8px;min-width:200px;padding:6px;box-shadow:0 8px 30px rgba(0,0,0,0.12);display:none;z-index:50}
  .menu.show{display:block}
  .menu a{display:block;padding:8px 10px;color:#033;text-decoration:none;border-radius:6px;font-weight:600}
  .menu a:hover{background:#f3f7fb}
  .menu .admin-area{border-top:1px solid #eee;padding-top:6px;margin-top:6px;display:flex;justify-content:space-between;gap:6px}
  /* login top-right */
  .auth{display:flex;align-items:center;gap:8px}
  #loginBtn{background:var(--accent);color:#fff;border:0;padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:700;box-shadow:0 8px 18px rgba(0,0,0,0.12)}
  #avatar{width:36px;height:36px;border-radius:50%;display:none;object-fit:cover;border:2px solid #fff}
  /* main content */
  main{max-width:var(--maxw);margin:18px auto;padding:0 16px;flex:1}
  .hero{background:#fff;border-radius:14px;padding:12px;box-shadow:0 8px 30px rgba(0,0,0,0.12)}
  /* slider */
  .slider{position:relative;width:100%;height:calc(60vw);max-height:420px;min-height:140px;border-radius:12px;overflow:hidden;background:#ddd}
  .slide{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;opacity:0;transform:scale(1.02);transition:opacity .6s ease,transform .6s ease}
  .slide.active{opacity:1;transform:scale(1);z-index:2}
  .slide img{width:100%;height:100%;object-fit:cover;display:block}
  .slide .del{position:absolute;top:8px;right:8px;background:rgba(255,255,255,0.9);border:0;padding:6px 8px;border-radius:8px;cursor:pointer;display:none;font-weight:700;box-shadow:0 4px 12px rgba(0,0,0,0.12);color:#b11}
  .slide.admin .del{display:inline-block}
  /* admin uploader */
  .uploader{display:flex;gap:10px;align-items:center;margin-top:12px}
  #uploadBtn{background:var(--admin);color:#fff;border:0;padding:8px 12px;border-radius:8px;cursor:pointer;display:none;font-weight:700}
  .note{font-size:0.85rem;color:#053047;opacity:.9}
  /* small footer buttons */
  .small-row{display:flex;gap:8px;justify-content:center;margin-top:14px}
  .small-row button{padding:6px 10px;border-radius:8px;border:0;background:#007bff;color:#fff;cursor:pointer;font-size:.85rem}
  /* marquee */
  .marqWrap{margin-top:12px;background:rgba(255,255,255,0.95);padding:8px;border-radius:10px;overflow:hidden;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
  .marq{display:inline-block;white-space:nowrap;padding-left:100%;animation:marq 18s linear infinite;font-weight:700;color:#023}
  @keyframes marq{0%{transform:translateX(0)}100%{transform:translateX(-100%)}}
  @media (prefers-reduced-motion: reduce){.marq{animation:none;padding-left:12px}}
  /* responsive */
  @media(max-width:720px){
    header{padding:8px 12px}
    .logo{font-size:1.15rem}
    .slider{height:45vw;max-height:260px}
  }
</style>
</head>
<body>

<header>
  <div class="brand">
    <div>
      <div class="logo">ZaraFix</div>
      <div class="tag">All Services â€” One Place</div>
    </div>

    <div class="menu-row" style="margin-left:8px;">
      <!-- Dropdown 1 -->
      <div class="dropdown" id="dd1">
        <button class="dropbtn dropbtn1" aria-haspopup="true" aria-expanded="false">Menu 1 â–¾</button>
        <div class="menu" id="menu1" role="menu" aria-hidden="true"></div>
      </div>

      <!-- Dropdown 2 -->
      <div class="dropdown" id="dd2">
        <button class="dropbtn dropbtn2" aria-haspopup="true" aria-expanded="false">Menu 2 â–¾</button>
        <div class="menu" id="menu2" role="menu" aria-hidden="true"></div>
      </div>
    </div>
  </div>

  <div class="auth">
    <img id="avatar" alt="avatar" />
    <button id="loginBtn">Google Login</button>
  </div>
</header>

<main>
  <div class="hero">
    <div id="slider" class="slider" aria-roledescription="carousel" aria-live="polite">
      <div id="placeholder" style="padding:28px;color:#555;font-weight:700">No images yet. Admin can upload.</div>
    </div>

    <div class="uploader">
      <button id="uploadBtn" title="Upload images (admin only)">Upload Images (Admin)</button>
      <div class="note">Max per image: 5MB. Admin only.</div>
    </div>

    <div class="marqWrap" role="note" aria-live="polite" style="margin-top:12px">
      <div class="marq" id="marquee">Welcome to ZaraFix â€” All Services. Admin can update announcements.</div>
    </div>
  </div>

  <div class="small-row">
    <button id="b1">Btn1</button>
    <button id="b2">Btn2</button>
    <button id="b3">Btn3</button>
  </div>
</main>

<!-- fixed bottom marquee (optional duplicate) -->
<div style="height:56px"></div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>

<script>
/* =========================
   CONFIG - change if needed
   ========================= */
const firebaseConfig = {
  apiKey: "AIzaSyCH17_8W_UPmPt4KqpCaV7BpN6KsA4a67E",
  authDomain: "zara-fix.firebaseapp.com",
  databaseURL: "https://zara-fix.firebaseio.com",
  projectId: "zara-fix",
  storageBucket: "zara-fix.appspot.com",
  messagingSenderId: "916859697394",
  appId: "1:916859697394:web:0000000000000000"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();
const storage = firebase.storage();

/* =========================
   DOM refs & constants
   ========================= */
const ADMIN_EMAIL = "zarasamajiksevasanstha@gmail.com";
const loginBtn = document.getElementById('loginBtn');
const avatar = document.getElementById('avatar');
const uploadBtn = document.getElementById('uploadBtn');
const slider = document.getElementById('slider');
const placeholder = document.getElementById('placeholder');
const marquee = document.getElementById('marquee');
const menu1 = document.getElementById('menu1');
const menu2 = document.getElementById('menu2');

const MAX_SIZE = 5 * 1024 * 1024;
const SLIDE_INTERVAL = 3500;

let slides = []; // {key,url,name,timestamp}
let carouselTimer = null;
let carouselIndex = 0;

/* =========================
   MENU: default 8 links (4+4)
   ========================= */
let linksA = [
  {text:'Home',href:'#'},
  {text:'Services',href:'#services'},
  {text:'Contact',href:'#contact'},
  {text:'About',href:'#about'}
];
let linksB = [
  {text:'Offers',href:'#offers'},
  {text:'FAQ',href:'#faq'},
  {text:'Gallery',href:'#gallery'},
  {text:'Help',href:'#help'}
];
function renderMenus(){
  menu1.innerHTML = '';
  linksA.forEach(l=>{
    const a = document.createElement('a'); a.href = l.href; a.textContent = l.text;
    menu1.appendChild(a);
  });
  // admin edit area
  const adminArea1 = document.createElement('div'); adminArea1.className='admin-area';
  const edit1 = document.createElement('button'); edit1.textContent='Edit'; edit1.style.cursor='pointer';
  edit1.onclick = () => editLinks(1);
  adminArea1.appendChild(edit1);
  menu1.appendChild(adminArea1);

  menu2.innerHTML = '';
  linksB.forEach(l=>{
    const a = document.createElement('a'); a.href = l.href; a.textContent = l.text;
    menu2.appendChild(a);
  });
  const adminArea2 = document.createElement('div'); adminArea2.className='admin-area';
  const edit2 = document.createElement('button'); edit2.textContent='Edit'; edit2.style.cursor='pointer';
  edit2.onclick = () => editLinks(2);
  adminArea2.appendChild(edit2);
  menu2.appendChild(adminArea2);
}
function editLinks(idx){
  // only admin can edit â€” enforce
  const user = auth.currentUser;
  if(!user || (user.email||'').toLowerCase() !== ADMIN_EMAIL.toLowerCase()){
    return alert('Only admin can edit menu links.');
  }
  const target = (idx===1? linksA : linksB);
  for(let i=0;i<4;i++){
    const cur = target[i] || {text:'',href:'#'};
    const t = prompt(`Menu ${idx} - Link ${i+1} text:`, cur.text);
    if(t === null) return;
    const h = prompt(`Menu ${idx} - Link ${i+1} href:`, cur.href);
    if(h === null) return;
    target[i] = {text: t.trim() || ('Link'+(i+1)), href: h.trim() || '#'};
  }
  // persist to DB
  db.ref('menuLinksA').set(linksA);
  db.ref('menuLinksB').set(linksB);
  renderMenus();
}

/* load persisted menus from db */
db.ref('menuLinksA').on('value', snap=>{
  const v = snap.val(); if(Array.isArray(v)) linksA = v; renderMenus();
});
db.ref('menuLinksB').on('value', snap=>{
  const v = snap.val(); if(Array.isArray(v)) linksB = v; renderMenus();
});

/* dropdown toggle behavior (click to open) */
document.querySelectorAll('.dropbtn').forEach(btn=>{
  btn.addEventListener('click', e=>{
    const menu = btn.nextElementSibling;
    const open = menu.classList.toggle('show');
    btn.setAttribute('aria-expanded', open? 'true' : 'false');
    menu.setAttribute('aria-hidden', open? 'false' : 'true');
  });
});
document.addEventListener('click', e=>{
  if(!e.target.closest('.dropdown')){
    document.querySelectorAll('.menu').forEach(m=>{ m.classList.remove('show'); m.setAttribute('aria-hidden','true')});
    document.querySelectorAll('.dropbtn').forEach(b=>b.setAttribute('aria-expanded','false'));
  }
});

/* =========================
   AUTH (Google)
   ========================= */
loginBtn.addEventListener('click', async ()=>{
  try{
    if(auth.currentUser){
      await auth.signOut();
      alert('Logged out');
    } else {
      const provider = new firebase.auth.GoogleAuthProvider();
      await auth.signInWithPopup(provider);
      // alert on success handled in onAuthStateChanged
    }
  } catch(err){
    console.error(err); alert('Auth error: '+(err.message||err));
  }
});

auth.onAuthStateChanged(user=>{
  if(user){
    loginBtn.textContent = 'Logout';
    avatar.src = user.photoURL || ''; avatar.style.display = user.photoURL? 'inline-block' : 'none';
    // admin controls
    if((user.email||'').toLowerCase() === ADMIN_EMAIL.toLowerCase()){
      uploadBtn.style.display = 'inline-block';
    } else {
      uploadBtn.style.display = 'none';
    }
    updateSlideAdminClasses();
  } else {
    loginBtn.textContent = 'Google Login';
    avatar.style.display = 'none';
    uploadBtn.style.display = 'none';
    updateSlideAdminClasses();
  }
});

/* =========================
   SLIDER: listen DB, render, admin upload/delete
   ========================= */
function listenSlides(){
  db.ref('sliderImages').on('value', snap=>{
    const val = snap.val();
    slides = [];
    if(val){
      Object.keys(val).forEach(k=>{
        slides.push(Object.assign({key:k}, val[k]));
      });
      // sort by timestamp ascending
      slides.sort((a,b)=> (a.timestamp||0) - (b.timestamp||0));
    }
    renderSlides();
  });
}
function renderSlides(){
  // clear
  slider.innerHTML = '';
  if(!slides || slides.length === 0){
    slider.appendChild(placeholder);
    stopCarousel();
    return;
  }
  slides.forEach((it, idx)=>{
    const wrap = document.createElement('div');
    wrap.className = 'slide' + (idx===0? ' active':'');
    wrap.dataset.key = it.key;
    const img = document.createElement('img'); img.src = it.url; img.alt = it.name || 'Slide image';
    const del = document.createElement('button'); del.className='del'; del.innerText='ðŸ—‘ï¸';
    del.title = 'Delete (admin only)';
    del.addEventListener('click', async (e)=>{
      e.stopPropagation();
      const user = auth.currentUser;
      if(!user || (user.email||'').toLowerCase() !== ADMIN_EMAIL.toLowerCase()){
        return alert('Only admin can delete images.');
      }
      if(!confirm('Delete this image?')) return;
      await deleteSlide(it.key, it.url);
    });
    wrap.appendChild(img);
    wrap.appendChild(del);
    slider.appendChild(wrap);
  });
  // show admin delete icons as per auth state
  updateSlideAdminClasses();
  startCarousel();
}

function updateSlideAdminClasses(){
  const isAdmin = auth.currentUser && (auth.currentUser.email||'').toLowerCase() === ADMIN_EMAIL.toLowerCase();
  slider.querySelectorAll('.slide').forEach(s=>{
    if(isAdmin) s.classList.add('admin'); else s.classList.remove('admin');
  });
}

function startCarousel(){
  stopCarousel();
  const s = slider.querySelectorAll('.slide');
  if(s.length <= 1) return;
  carouselIndex = 0;
  carouselTimer = setInterval(()=>{
    const prev = carouselIndex;
    carouselIndex = (carouselIndex+1) % s.length;
    s[prev].classList.remove('active');
    s[carouselIndex].classList.add('active');
  }, SLIDE_INTERVAL);
}
function stopCarousel(){ if(carouselTimer){ clearInterval(carouselTimer); carouselTimer = null; } }

async function deleteSlide(key, url){
  try{
    // try delete storage
    try { await storage.refFromURL(url).delete(); } catch(e){ console.warn('storage delete failed', e.message||e); }
    // delete db record
    await db.ref('sliderImages').child(key).remove();
    alert('Deleted.');
  }catch(e){ console.error(e); alert('Delete failed: '+(e.message||e)); }
}

/* Admin upload button */
uploadBtn.addEventListener('click', ()=>{
  const user = auth.currentUser;
  if(!user || (user.email||'').toLowerCase() !== ADMIN_EMAIL.toLowerCase()){
    return alert('Only admin can upload.');
  }
  const inp = document.createElement('input'); inp.type='file'; inp.accept='image/*'; inp.multiple=true;
  inp.onchange = async ()=>{
    const files = Array.from(inp.files || []);
    if(files.length === 0) return;
    uploadBtn.disabled = true; uploadBtn.textContent = 'Uploading...';
    try{
      let uploaded = 0;
      for(const f of files){
        if(f.size > MAX_SIZE){ alert(`"${f.name}" too large (max 5MB). Skipping.`); continue; }
        const safe = f.name.replace(/\s+/g,'_');
        const fileKey = 'slider_' + Date.now() + '_' + Math.floor(Math.random()*10000) + '_' + safe;
        const ref = storage.ref('sliderImages/' + fileKey);
        const snap = await ref.put(f);
        const url = await snap.ref.getDownloadURL();
        const newRef = db.ref('sliderImages').push();
        await newRef.set({ url, name: f.name, timestamp: firebase.database.ServerValue.TIMESTAMP});
        uploaded++;
      }
      if(uploaded) alert('Uploaded '+uploaded+' images');
      else alert('No images uploaded.');
    }catch(e){ console.error(e); alert('Upload failed: '+(e.message||e)); }
    finally{ uploadBtn.disabled=false; uploadBtn.textContent='Upload Images (Admin)'; }
  };
  inp.click();
}

/* =========================
   marquee text from DB
   ========================= */
db.ref('marqueeText').on('value', snap=>{
  const v = snap.val();
  if(v) marquee.textContent = v;
});

/* =========================
   initial listeners
   ========================= */
listenSlides();
renderMenus();

/* tiny footer handlers */
document.getElementById('b1').addEventListener('click', ()=>alert('Btn1'));
document.getElementById('b2').addEventListener('click', ()=>alert('Btn2'));
document.getElementById('b3').addEventListener('click', ()=>alert('Btn3'));
</script>
</body>
</html>
