<!DOCTYPE html>
<html>
<head>
  <title>üõ†Ô∏è Admin - All Service Requests</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: Arial;
      background: #f0f0f0;
      margin: 0;
      padding: 10px;
    }

    .card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      padding: 15px;
      margin-bottom: 15px;
      position: relative;
    }

    .led {
      width: 12px;
      height: 12px;
      background-color: yellow;
      border-radius: 50%;
      position: absolute;
      top: 10px;
      right: 10px;
      animation: blink 1s infinite;
    }

    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.1; }
    }

    button {
      background-color: red;
      color: white;
      border: none;
      padding: 6px 12px;
      margin-top: 10px;
      border-radius: 6px;
    }

    h2 {
      text-align: center;
    }
  </style>
</head>
<body>
  <h2>üõ†Ô∏è Admin - All Service Requests</h2>
  <div id="requestsContainer"></div>

  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

  <script>
    const firebaseConfig = {
      // üîê apka config yahan dalein
      apiKey: "AIza...",
      authDomain: "your-app.firebaseapp.com",
      databaseURL: "https://your-app.firebaseio.com",
      projectId: "your-app",
      storageBucket: "your-app.appspot.com",
      messagingSenderId: "1234567890",
      appId: "1:1234567890:web:abc"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function loadRequests() {
      const container = document.getElementById('requestsContainer');
      container.innerHTML = '';
      db.ref("requests").once("value", snapshot => {
        if (!snapshot.exists()) {
          container.innerHTML = "<p>No service requests found.</p>";
          return;
        }

        snapshot.forEach(userSnap => {
          userSnap.forEach(reqSnap => {
            const data = reqSnap.val();
            const card = document.createElement("div");
            card.className = "card";

            let acceptedHTML = "";
            if (data.acceptedBy && typeof data.acceptedBy === 'object') {
              const acceptedList = Object.values(data.acceptedBy);
              if (acceptedList.length > 0) {
                acceptedHTML = "<b>‚úÖ Accepted By:</b><br>";
                acceptedList.forEach(poster => {
                  acceptedHTML += `
                    Name: ${poster.name || "N/A"}<br>
                    WhatsApp: ${poster.whatsapp || "N/A"}<br>
                    Shop: ${poster.shop || "N/A"}<br>
                    Category: ${poster.category || "N/A"}<br><br>
                  `;
                });
              } else {
                acceptedHTML = "<b>‚è≥ Wait for Accept</b>";
              }
            } else {
              acceptedHTML = "<b>‚è≥ Wait for Accept</b>";
            }

            card.innerHTML = `
              üë§ ${data.name || ""}<br>
              üìû ${data.whatsapp || ""}<br><br>
              üõ†Ô∏è ${data.category || ""}<br><br>
              üìç ${data.address || ""}<br><br>
              ‚ùì ${data.problem || ""}<br><br>
              ${acceptedHTML}<br>
              <button onclick="deleteRequest('${userSnap.key}', '${reqSnap.key}')">üóëÔ∏è Delete</button>
            `;

            // LED only if accepted
            if (acceptedHTML.includes("Accepted By")) {
              const led = document.createElement("div");
              led.className = "led";
              card.appendChild(led);
            }

            container.appendChild(card);
          });
        });
      });
    }

    function deleteRequest(userId, requestId) {
      if (confirm("Delete this request?")) {
        firebase.database().ref(`requests/${userId}/${requestId}`).remove().then(() => {
          loadRequests();
        });
      }
    }

    loadRequests();
  </script>
</body>
</html>
