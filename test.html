<!DOCTYPE html>
<html>
<head>
  <title>ZaraFix Admin Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Arial, sans-serif; background: #eef2f3; margin: 0; padding: 10px; }
    .section { margin-bottom: 40px; }
    h2 { background: #008080; color: white; padding: 10px; border-radius: 5px; }
    .card {
      background: #fff; margin: 10px 0; padding: 15px;
      border-radius: 12px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    button {
      padding: 8px 12px; border: none; border-radius: 6px;
      background: #28a745; color: white; margin-top: 5px;
      cursor: pointer;
    }
    button.recharge { background: #007bff; }
    button.approve { background: #ff9800; }
  </style>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
</head>
<body>
  <div class="section">
    <h2>ðŸ“‹ Posters (Service Providers)</h2>
    <div id="postersList"></div>
  </div>

  <div class="section">
    <h2>ðŸ“¬ User Service Requests</h2>
    <div id="requestsList"></div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyD7ZqL-PVuFdd8rMVIyW7CgHQjPRGHD2h8",
      authDomain: "zara-fix-2e35a.firebaseapp.com",
      projectId: "zara-fix-2e35a",
      storageBucket: "zara-fix-2e35a.appspot.com",
      messagingSenderId: "636550144008",
      appId: "1:636550144008:web:a849496ad1d1557d7ab1bd"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Show all posters
    const postersList = document.getElementById("postersList");
    db.ref("posters").once("value", snap => {
      postersList.innerHTML = "";
      snap.forEach(child => {
        const id = child.key;
        const p = child.val();
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <b>Name:</b> ${p.name}<br>
          <b>Shop:</b> ${p.shop}<br>
          <b>Address:</b> ${p.address}<br>
          <b>Category:</b> ${p.category}<br>
          <b>WhatsApp:</b> <a href="https://wa.me/${p.whatsapp}" target="_blank">${p.whatsapp}</a><br>
          <b>Wallet:</b> â‚¹${p.wallet || 0}<br>
        `;
        // Add Approve button if not approved
        db.ref("admins/" + id).once("value", adminSnap => {
          if (!adminSnap.exists()) {
            const approveBtn = document.createElement("button");
            approveBtn.textContent = "Approve";
            approveBtn.className = "approve";
            approveBtn.onclick = () => {
              db.ref("admins/" + id).set(true);
              alert("Approved!");
              location.reload();
            };
            card.appendChild(approveBtn);
          }
        });

        // Recharge Button
        const rechargeBtn = document.createElement("button");
        rechargeBtn.textContent = "Recharge â‚¹100";
        rechargeBtn.className = "recharge";
        rechargeBtn.onclick = () => {
          const newAmount = (p.wallet || 0) + 100;
          db.ref("posters/" + id + "/wallet").set(newAmount);
          alert("Wallet recharged.");
          location.reload();
        };
        card.appendChild(rechargeBtn);

        postersList.appendChild(card);
      });
    });

    // Show all service requests
    const requestsList = document.getElementById("requestsList");
    db.ref("requests").once("value", snap => {
      requestsList.innerHTML = "";
      snap.forEach(userSnap => {
        userSnap.forEach(reqSnap => {
          const req = reqSnap.val();
          const card = document.createElement("div");
          card.className = "card";
          card.innerHTML = `
            <b>Name:</b> ${req.name}<br>
            <b>Category:</b> ${req.category}<br>
            <b>Address:</b> ${req.address}<br>
            <b>Problem:</b> ${req.problem}<br>
            <b>WhatsApp:</b> ${req.whatsapp}<br>
          `;

          // Show who accepted
          if (req.acceptedBy) {
            const accepted = Object.values(req.acceptedBy);
            card.innerHTML += `<b>Accepted By (${accepted.length}):</b><ul>`;
            accepted.forEach(a => {
              card.innerHTML += `<li>${a.name} - <a href="https://wa.me/${a.whatsapp}" target="_blank">${a.whatsapp}</a></li>`;
            });
            card.innerHTML += "</ul>";
          } else {
            card.innerHTML += `<b>Accepted By:</b> No one yet`;
          }

          requestsList.appendChild(card);
        });
      });
    });
  </script>
</body>
</html>
