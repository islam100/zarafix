<!DOCTYPE html>
<html>
<head>
  <title>üéØ Posters Who Accepted Your Request</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Arial; background: #f2f2f2; padding: 20px; text-align: center; }
    .card {
      background: white; padding: 15px; margin: 10px auto; max-width: 400px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2); border-radius: 10px;
      transition: transform 0.2s;
    }
    .card:hover { transform: scale(1.02); }
    .btn {
      padding: 10px 20px; background: #007BFF; color: white;
      border: none; border-radius: 5px; cursor: pointer;
    }
    .btn:hover { background: #0056b3; }
  </style>
</head>
<body>

<h2>üéØ Posters Who Accepted Your Request</h2>
<div id="authSection"></div>
<div id="output">Loading...</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSy...",
    authDomain: "your-project.firebaseapp.com",
    databaseURL: "https://your-project.firebaseio.com",
    projectId: "your-project",
    storageBucket: "your-project.appspot.com",
    messagingSenderId: "123456789",
    appId: "1:123456789:web:abc123"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.database();

  const output = document.getElementById('output');
  const authSection = document.getElementById('authSection');

  auth.onAuthStateChanged(async (user) => {
    if (!user) {
      authSection.innerHTML = `<button class="btn" onclick="login()">Login with Google</button>`;
      output.innerHTML = 'Please login first.';
      return;
    }

    authSection.innerHTML = `<button class="btn" onclick="logout()">Logout</button>`;
    const userId = user.uid;

    const reqSnap = await db.ref('requests/' + userId).once('value');
    const reqData = reqSnap.val();

    if (!reqData) {
      output.innerHTML = '‚ùå No requests found.';
      return;
    }

    let acceptedList = [];
    for (const reqId in reqData) {
      const request = reqData[reqId];
      if (request.acceptedBy) {
        acceptedList.push(...Object.keys(request.acceptedBy));
      }
    }

    if (acceptedList.length === 0) {
      output.innerHTML = '‚ùå No posters have accepted your request yet.';
      return;
    }

    let html = '';
    for (const posterId of acceptedList) {
      const posterSnap = await db.ref('posters/' + posterId).once('value');
      const poster = posterSnap.val();
      if (!poster) continue;

      html += `
        <div class="card">
          <h3>üß∞ ${poster.name}</h3>
          <p>üìç ${poster.shop} - ${poster.category}</p>
          <a class="btn" href="https://wa.me/91${poster.whatsapp}" target="_blank">WhatsApp</a>
          <br><br>
          <a class="btn" href="https://www.google.com/maps?q=${poster.lat || 0},${poster.lng || 0}" target="_blank">üìç View Live Location</a>
        </div>
      `;
    }

    output.innerHTML = html;
  });

  function login() {
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider);
  }

  function logout() {
    auth.signOut();
  }
</script>

</body>
</html>
