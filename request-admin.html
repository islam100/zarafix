<!DOCTYPE html>
<html>
<head>
  <title>🎯 Accepted Posters - ZaraFix</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Arial; background: #f4f4f4; margin: 0; padding: 20px; text-align: center; }
    .card {
      background: white;
      padding: 15px;
      margin: 10px auto;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      max-width: 400px;
    }
    button {
      padding: 8px 16px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 20px;
      cursor: pointer;
    }
  </style>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
</head>
<body>

<h2>🎯 Posters Who Accepted Your Request</h2>
<div id="authSection">
  <button onclick="logout()" style="display:none;" id="logoutBtn">Logout</button>
</div>
<div id="content">Loading...</div>

<script>
  // ✅ Firebase Config
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    databaseURL: "https://YOUR_PROJECT.firebaseio.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT.appspot.com",
    messagingSenderId: "SENDER_ID",
    appId: "APP_ID"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.database();

  // 🔄 Check Login
  auth.onAuthStateChanged(user => {
    if (user) {
      document.getElementById('logoutBtn').style.display = 'inline-block';
      loadAcceptedPosters(user.uid);
    } else {
      document.getElementById('content').innerText = 'Please login first.';
    }
  });

  // 🔓 Logout
  function logout() {
    auth.signOut().then(() => {
      location.reload();
    });
  }

  // 📥 Load Accepted Posters
  function loadAcceptedPosters(userId) {
    const contentDiv = document.getElementById('content');
    contentDiv.innerHTML = 'Loading...';

    db.ref(`requests/${userId}`).once('value', snap => {
      const allRequests = snap.val();
      if (!allRequests) {
        contentDiv.innerHTML = '❌ No service requests found.';
        return;
      }

      let found = false;
      contentDiv.innerHTML = '';

      Object.keys(allRequests).forEach(reqId => {
        const acceptedBy = allRequests[reqId].acceptedBy;
        if (acceptedBy) {
          found = true;
          Object.keys(acceptedBy).forEach(posterId => {
            db.ref(`posters/${posterId}`).once('value', posterSnap => {
              const poster = posterSnap.val();
              if (poster) {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                  <h3>🧰 ${poster.name}</h3>
                  <p>🏪 ${poster.shop}</p>
                  <p>📞 <a href="https://wa.me/91${poster.whatsapp}" target="_blank">${poster.whatsapp}</a></p>
                  <p>📍 <a href="https://www.google.com/maps?q=${poster.location || ''}" target="_blank">Live Location</a></p>
                `;
                contentDiv.appendChild(card);
              }
            });
          });
        }
      });

      setTimeout(() => {
        if (!found) {
          contentDiv.innerHTML = '❌ No posters have accepted your request yet.';
        }
      }, 2000); // Give 2 sec to load all
    });
  }
</script>

</body>
</html>
