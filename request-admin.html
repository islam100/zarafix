<!DOCTYPE html>
<html>
<head>
  <title>🎯 Posters Who Accepted Your Request</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; margin: 0; padding: 20px; text-align: center; }
    .card {
      background: white;
      border-radius: 15px;
      padding: 15px;
      margin: 10px auto;
      max-width: 400px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      transition: transform 0.2s;
    }
    .card:hover { transform: scale(1.02); }
    button {
      background: #ff3c3c;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 25px;
      cursor: pointer;
      margin: 10px;
    }
  </style>
</head>
<body>

<h2>🎯 Posters Who Accepted Your Request</h2>
<div id="loginStatus">Loading...</div>
<div id="logoutBtn" style="display:none;">
  <button onclick="logout()">Logout</button>
</div>
<div id="postersList"></div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

<script>
  // ✅ Firebase Config
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_DOMAIN",
    databaseURL: "https://YOUR_PROJECT.firebaseio.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT.appspot.com",
    messagingSenderId: "SENDER_ID",
    appId: "APP_ID"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.database();

  // ✅ Auth State Check
  auth.onAuthStateChanged(user => {
    const postersList = document.getElementById("postersList");
    if (user) {
      document.getElementById("loginStatus").innerText = "";
      document.getElementById("logoutBtn").style.display = "block";
      const userId = user.uid;

      postersList.innerHTML = "<p>Loading...</p>";
      db.ref("requests/" + userId).once("value", snap => {
        const allRequests = snap.val();
        let found = false;
        postersList.innerHTML = "";

        if (allRequests) {
          Object.entries(allRequests).forEach(([reqId, reqData]) => {
            if (reqData.acceptedBy) {
              Object.keys(reqData.acceptedBy).forEach(posterId => {
                db.ref("posters/" + posterId).once("value", psnap => {
                  const poster = psnap.val();
                  if (poster) {
                    found = true;
                    postersList.innerHTML += `
                      <div class="card">
                        <h3>${poster.name}</h3>
                        <p>📞 <a href="https://wa.me/91${poster.whatsapp}" target="_blank">WhatsApp</a></p>
                        <p>🏪 ${poster.shop}</p>
                        <p>🔧 ${poster.category}</p>
                      </div>
                    `;
                  }
                });
              });
            }
          });
        }

        setTimeout(() => {
          if (!found) {
            postersList.innerHTML = "<p>❌ No posters have accepted your request yet.</p>";
          }
        }, 1500);
      });

    } else {
      document.getElementById("loginStatus").innerHTML = "Please login first.";
      document.getElementById("logoutBtn").style.display = "none";
    }
  });

  // ✅ Logout Function
  function logout() {
    firebase.auth().signOut();
    location.reload();
  }
</script>
</body>
</html>
