<div id="acceptedPostersContainer"></div>

<script>
const userId = firebase.auth().currentUser.uid;

function loadAcceptedPosters() {
  firebase.database().ref('requests/' + userId).once('value', snapshot => {
    const data = snapshot.val();
    if (!data) return;

    const container = document.getElementById('acceptedPostersContainer');
    container.innerHTML = '';

    Object.entries(data).forEach(([requestId, request]) => {
      if (request.acceptedBy) {
        Object.entries(request.acceptedBy).forEach(([posterId, _]) => {
          // Fetch poster details from posterUsers
          firebase.database().ref('posterUsers/' + posterId).once('value', posterSnap => {
            const poster = posterSnap.val();
            if (!poster) return;

            const card = document.createElement('div');
            card.style = "background: #fff; border-radius: 20px; box-shadow: 5px 5px 15px rgba(0,0,0,0.1); padding: 15px; margin: 15px 0;";

            card.innerHTML = `
              <h3>🧑‍🔧 <b>${poster.name}</b></h3>
              <p>🏪 <b>Shop:</b> ${poster.shop}</p>
              <p>🔧 <b>Category:</b> ${poster.category}</p>
              <p>📍 <b>Address:</b> ${poster.address}</p>
              <p>📬 <b>Pincode:</b> ${poster.pincode}</p>
              <p>💬 <b>WhatsApp:</b> <a href="https://wa.me/91${poster.whatsapp.trim()}" target="_blank" style="color: green;">${poster.whatsapp}</a></p>
              <div style="margin-top: 10px;">
                <button onclick="rejectPoster('${requestId}', '${posterId}')" style="padding: 10px 20px; border: none; background: linear-gradient(145deg, #ff5f6d, #ffc371); color: white; border-radius: 12px; box-shadow: 0 6px 10px rgba(0,0,0,0.2); margin-right: 10px; cursor: pointer;">❌ Reject</button>
                <a href="https://wa.me/91${poster.whatsapp.trim()}" target="_blank" style="padding: 10px 20px; background: linear-gradient(145deg, #25D366, #128C7E); color: white; border-radius: 12px; box-shadow: 0 6px 10px rgba(0,0,0,0.2); text-decoration: none; cursor: pointer;">💬 WhatsApp</a>
              </div>
            `;

            container.appendChild(card);
          });
        });
      } else {
        container.innerHTML = "<p style='text-align:center;'>🚫 No one accepted your request yet.</p>";
      }
    });
  });
}

function rejectPoster(requestId, posterId) {
  if (confirm("Are you sure you want to reject this poster?")) {
    firebase.database().ref('requests/' + userId + '/' + requestId + '/acceptedBy/' + posterId).remove()
    .then(() => {
      alert("Poster rejected.");
      loadAcceptedPosters();
    })
    .catch(err => alert("Error: " + err.message));
  }
}

// Auto-load after login
firebase.auth().onAuthStateChanged(user => {
  if (user) loadAcceptedPosters();
});
</script>
