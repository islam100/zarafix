<!DOCTYPE html>
<html>
<head>
  <title>Submitted Requests</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
  <style>
    body {
      font-family: sans-serif;
      background: #f2f2f2;
      padding: 20px;
    }
    .card {
      background: white;
      padding: 20px;
      margin-bottom: 15px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .card h3 {
      margin-top: 0;
    }
    .btn {
      padding: 10px 16px;
      margin-right: 10px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      color: white;
      font-weight: bold;
      transition: 0.3s;
    }
    .btn-reject {
      background: #e74c3c;
    }
    .btn-delete {
      background: #2c3e50;
    }
    .btn-whatsapp {
      background: #25D366;
    }
    .btn:hover {
      opacity: 0.8;
    }
  </style>
</head>
<body>

<h2>üéØ Submitted Service Requests</h2>
<div id="requestList">‚è≥ Loading...</div>

<script>
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_AUTH_DOMAIN",
    databaseURL: "YOUR_DATABASE_URL",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_STORAGE_BUCKET",
    messagingSenderId: "YOUR_MSG_ID",
    appId: "YOUR_APP_ID"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const requestList = document.getElementById('requestList');

  function loadRequests() {
    requestList.innerHTML = "‚è≥ Loading...";
    db.ref('requests').once('value', snap => {
      const data = snap.val();
      requestList.innerHTML = "";

      if (!data) {
        requestList.innerHTML = "‚ùå ‡§ï‡•ã‡§à Request ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ‡•§";
        return;
      }

      Object.entries(data).forEach(([userId, userRequests]) => {
        Object.entries(userRequests).forEach(([reqId, reqData]) => {
          const {
            name = "N/A",
            address = "N/A",
            category = "N/A",
            issue = "N/A",
            acceptedBy = null
          } = reqData;

          let acceptedInfoHTML = "<b>‚úÖ Accepted By:</b> Not yet accepted";
          if (acceptedBy) {
            const [acceptedName, acceptedPhone] = acceptedBy.split('|');
            acceptedInfoHTML = `
              <b>‚úÖ Accepted By:</b> ${acceptedName} <br/>
              <button class="btn btn-whatsapp" onclick="openWhatsapp('${acceptedPhone}')">WhatsApp</button>
            `;
          }

          const card = document.createElement('div');
          card.className = "card";
          card.innerHTML = `
            <h3>üßë‚Äçüîß Name: ${name}</h3>
            <p>üìå Category: ${category}</p>
            <p>üìç Address: ${address}</p>
            <p>üìÖ Issue: ${issue}</p>
            ${acceptedInfoHTML}
            <br><br>
            <button class="btn btn-reject" onclick="rejectRequest('${userId}', '${reqId}')">Reject</button>
            <button class="btn btn-delete" onclick="deleteRequest('${userId}', '${reqId}')">Delete</button>
          `;
          requestList.appendChild(card);
        });
      });
    });
  }

  function openWhatsapp(phone) {
    window.open(`https://wa.me/${phone}`, "_blank");
  }

  function rejectRequest(userId, reqId) {
    db.ref(`requests/${userId}/${reqId}/acceptedBy`).remove().then(loadRequests);
  }

  function deleteRequest(userId, reqId) {
    db.ref(`requests/${userId}/${reqId}`).remove().then(loadRequests);
  }

  loadRequests();
</script>
</body>
</html>
